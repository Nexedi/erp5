<HTML>
  <HEAD>
    <meta http-equiv="content-type" content="text/html;charset=ISO-8859-1">
    <title tal:content="here/getTitle">Coramy</title>
    <link rel=stylesheet type="text/css" href="modele_catalog_c">
  </HEAD>
  <BODY bgcolor="#ffffff" tal:define="delivery_list python:here.object_action_list(selection_name='sales_packing_list_selection',max_nb=10);
                                       page_number python:[0]">
    <TABLE tal:repeat="delivery delivery_list" width="660" height="955"  cellpadding="0" cellspacing="0" tal:attributes="class python:here.PT_pageBreak(page_number)">
      <TABLE border="0" width="660" height="900"  cellpadding="0" cellspacing="0"
              tal:define="order python:delivery.getCausalityValue(portal_type=['Sales Order']);
                          destination python:delivery.getDestinationValue(portal_type=['Organisation']);
                          distinct_container_list python:delivery.PackingList_getDistinctContainerList();
                          totalizer python:[0,0,0,0]"><!-- Tableau general -->
        <TR>
          <TD>
            <TABLE border="0" width="100%" height="100%">
              <TR>
                <TD class="Titre" tal:content="python:delivery.getSourceSectionTitle()">Coramy</TD>
                <TD align="center">
                  <span class="Titre2">Liste de colisage<span tal:content="python:' n° '+delivery.getId()"/></span><br>
                  Lieferschein Nr / Delivery note N°
                </TD>
                <TD align="right">
                  <span tal:content="python:'Gravelines, le '+str(here.DateTime_getFormattedDate())"/>
                </TD>
              </TR>
            </TABLE>
          </TD>
        </TR>
        <TR height="18%"><!-- Infos -->
          <TD><br>
            <TABLE border="0" width="100%" height="100%">
              <TR>
                <TD nowrap align="center" class="Bordereau">Commande N°<br>Auftrag Nr / Order N°<br><span class="Normal" tal:content="python:order.getDestinationReference()" /></TD>
                <TD nowrap align="center" class="Bordereau" >Poids brut (Kg)<br>Brutto-gewicht / Gross weight <br><span class="Normal" tal:content="python:delivery.PackingList_getTotalGrossWeight()" /></TD>
                <TD nowrap rowspan="3">
                  <SPAN tal:condition="python:destination<>None">
                  <b><SPAN tal:content="python:modules['string'].capwords(destination.getTitle())"/></b>
                  <br><SPAN tal:condition="python:destination.getPortalType()<>'Category'">
                      <SPAN tal:define="address_items python:modules['string'].
                              split(destination.getDefaultAddress().asText(country='France'),'\n')">
                        <SPAN tal:repeat="item address_items">
                          <SPAN tal:content="item"/><br>
                        </SPAN>
                      </SPAN>
                    </SPAN>
                  </SPAN>
                </TD>
                <TD nowrap align="center" rowspan="2" class="Bordereau">Port<br>Porto / Freight<br><span class="Normal" tal:content="python:delivery.getIncoterm()" /></TD>
              </TR>
              <TR>
                <TD nowrap align="center" class="Bordereau">Confirmation N°<br>Bestätigung Nr <br><span class="Normal" tal:content="python:order.getId()" /></TD>
                <TD nowrap align="center" class="Bordereau">Nombre de colis<br>Kolli Anzahl / Nb of parcels <br><span class="Normal" tal:content="python:len(delivery.contentValues(filter={'portal_type':'Container'}))" /></TD>
              </TR>
              <TR>
                <TD nowrap align="center" class="Bordereau"> Date d'expédition<br>Versand Tag / Sending Date <br><span class="Normal" tal:content="python:str(here.DateTime_getFormattedDate(delivery.getTargetStartDate()))" /></TD>
                <TD nowrap align="center" class="Bordereau" >Nombre d'articles<br>Artikel Anzahl / Nb of items<br><span class="Normal" tal:content="python:delivery.getTargetTotalQuantity()" /></TD>
                <TD nowrap align="center" class="Bordereau" >Transporteur <br> Carrier / Spediteur<br><span class="Normal" tal:content="python:delivery.getDeliveryMode()" /></TD>
              </TR>
            </TABLE>
          </TD>
        </TR>


        <SPAN tal:repeat="container_template distinct_container_list">
          <SPAN tal:define="toto python:here.PT_reset_total_list(totalizer,[1])"/>
          <SPAN tal:repeat="delivery_line python:container_template[0].contentValues(filter={'portal_type':
                          'Container Line'})">
            <TR><!-- Matrice de ligne de livraison -->
              <TD>

                  <TABLE border="1" width="100%"
                          tal:define="correspondance_tailles python:delivery_line.getResourceValue().getSpecialiseValue(portal_type=['Correspondance Tailles']);
                                      coloris_list python:delivery_line.Variated_getColorisList();
                                      taille_qty python:len(delivery_line.Variated_getTailleList(correspondance_tailles)[0]);
                                      morphologie_list python:delivery_line.getMorphologieList()
                                      ">
                    <TR>
                      <TD align="left"
                       tal:condition="python:container_template[1][0]==container_template[1][1]">
                        <b tal:content="python:'Colis %s'%container_template[1][0]"/>
                      </TD>
                      <TD align="left"
                       tal:condition="python:container_template[1][0]<>container_template[1][1]">
                        <b tal:content="python:'Colis %s a %s'%(container_template[1][0],container_template[1][1])"/>
                      </TD>
                      <TD tal:attributes="colspan python:taille_qty+1" align="center">Quantités réparties par tailles</TD>
                    </TR>

                    <SPAN tal:condition="python:len(morphologie_list)==0"
                          tal:define="taille_list python:delivery_line.Variated_getTailleList(correspondance_tailles)"><!-- S'Il N'Y A PAS DE VARIANTES MORPHOLOGIQUES -->
                        <TR tal:condition="python:1">
                          <TD nowrap><SPAN tal:content="python:'Modèle : %s' %delivery_line.getResourceValue().getId()"/></TD>
                          <TD rowspan="2" align="center" tal:repeat="index python:range(taille_qty)"
                            tal:content="python:taille_list[1][index]">36</TD><!-- BOUCLE SUR LE NB DE TAILLES -->
                          <TD align="center" rowspan="2" nowrap>Total</TD>
                        </TR>
                        <TR>

                          <TD>
                            <SPAN tal:condition="python:delivery_line.getResourceValue().getPortalType()=='Modele'" width="30%" tal:content="python:delivery_line.getResourceValue().getComposition()"/>
                            <SPAN tal:condition="python:delivery_line.getResourceValue().getPortalType()=='Assortiment'" width="30%" tal:content="python:delivery_line.getResourceValue().getDescription()"/>
                          </TD>
                        </TR>

                        <SPAN tal:condition="python:len(coloris_list[0])>0">
                        <TR tal:repeat="index python:range(len(coloris_list[0]))"><!-- BOUCLE SUR LES COLORIS -->
                          <TD align="left" tal:content="python:'coloris '+coloris_list[1][index]"></TD>
                          <SPAN tal:define="toto python:delivery_line.PT_reset_total_list(totalizer,[2,3])"/>
                          <SPAN tal:repeat="target_quantity python:delivery_line.DeliveryLine_getTargetQuantityList(taille_list[2],coloris_list[2][index])">
                            <TD align = right tal:content="python: '%.0f' %target_quantity"/>
                            <SPAN tal:define="toto python:delivery_line.PT_update_total_list(totalizer,[0,1,2,3],target_quantity)"/>
                          </SPAN>
                          <TD align="right" tal:content="python: '%.0f' %totalizer[3]"/>
                        </TR>
                        </SPAN>

                        <SPAN tal:condition="python:len(coloris_list[0])==0">
                        <TR><!-- PAS DE COLORIS -->
                          <TD align="left"></TD>
                          <SPAN tal:define="toto python:delivery_line.PT_reset_total_list(totalizer,[2,3])"/>
                          <SPAN tal:repeat="target_quantity python:delivery_line.DeliveryLine_getTargetQuantityList(taille_list[2])">
                            <TD align = right tal:content="python: '%.0f' %target_quantity"/>
                            <SPAN tal:define="toto python:delivery_line.PT_update_total_list(totalizer,[0,1,2,3],target_quantity)"/>
                          </SPAN>
                          <SPAN tal:condition="python:taille_qty==0"
                                tal:define="toto python:delivery_line.PT_update_total_list(totalizer,[0,1,2,3],delivery_line.getTargetQuantity())"/>
                          <TD align="right" tal:content="python: '%.0f' %totalizer[3]"/>
                        </TR>
                        </SPAN>

                      <TR>
                        <TD align = "right" tal:attributes="colspan python:taille_qty+1">Total colis
                        </TD>
                        <TD align="right" tal:content="python: '%.0f' %totalizer[1]">
                        </TD>
                      </TR>
                    </SPAN>

                    <SPAN tal:condition="python:len(morphologie_list)>0"><!-- S'Il Y A DES VARIANTES MORPHOLOGIQUES -->
                      <SPAN tal:repeat="morphologie morphologie_list">
                      <SPAN tal:define="taille_list python:delivery_line.Variated_getTailleList(correspondance_tailles,morphologie);
                                        toto python:delivery_line.PT_reset_total_list(totalizer,[3])"><!-- BOUCLE SUR LES VARIANTES MORPHOLOGIQUES -->
                        <TR tal:condition="python:1">
                          <TD nowrap><SPAN tal:content="python:'Modèle : %s' % '/'.join(morphologie.split('/')[1:])"/></TD>
                          <TD rowspan="2" align="center" tal:repeat="index python:range(taille_qty)"
                            tal:content="python:taille_list[1][index]">36</TD><!-- BOUCLE SUR LE NB DE TAILLES -->
                          <TD align="center" rowspan="2" nowrap>Total</TD>
                        </TR>
                        <TR>

                          <TD>
                            <SPAN tal:condition="python:delivery_line.getResourceValue().getPortalType()=='Modele'" width="30%" tal:content="python:delivery_line.getResourceValue().getComposition()"/>
                            <SPAN tal:condition="python:delivery_line.getResourceValue().getPortalType()=='Assortiment'" width="30%" tal:content="python:delivery_line.getResourceValue().getDescription()"/>
                          </TD>
                        </TR>

                        <TR tal:repeat="index python:range(len(coloris_list[0]))"><!-- BOUCLE SUR LES COLORIS -->
                          <TD align="left" tal:content="python:'coloris '+coloris_list[1][index]"></TD>
                          <SPAN tal:define="toto python:delivery_line.PT_reset_total_list(totalizer,[3])"/>
                          <SPAN tal:repeat="target_quantity python:delivery_line.DeliveryLine_getTargetQuantityList(taille_list[2],coloris_list[2][index],morphologie)">
                            <TD align = right tal:content="python: '%.0f' %target_quantity"/>
                            <SPAN tal:define="toto python:delivery_line.PT_update_total_list(totalizer,[0,1,2,3],target_quantity)"/>
                          </SPAN>
                          <TD align="right" tal:content="python: '%.0f' %totalizer[3]"/>
                        </TR>
                      </SPAN>
                      <TR>
                        <TD align = "right" tal:attributes="colspan python:taille_qty+1">Total colis
                        </TD>
                        <TD align="right" tal:content="python: '%.0f' %totalizer[1]">
                        </TD>
                      </TR>
                      </SPAN>

                    </SPAN>

                  </TABLE>
              </TD>
            </TR>

            <TR tal:define="commentaires_list python:modules['string'].split('','\n')"><!-- Notes -->
              <TD valign="top">
                <span tal:repeat="commentaires_item commentaires_list">
                <span tal:content="python:commentaires_item"/></span>
              </TD>
            </TR>

          </SPAN>
        </SPAN>

        <TR>
          <TD height="40%"/>
        </TR>
        <TR>
          <TD tal:condition="python:delivery.getSourceSectionTitle()=='BLS'" align="center">BLS - 5 bis, rue Denis Cordonnier - 59820 Gravelines (FRANCE)<br>Tél. : + 33 (0) 3 28 51 86 26 -  Fax : + 33 (0) 3 28 23 34 96
            <p class="Copy">S.A.R.L. au capital de 10.000 € - T.V.A. FR 51 442 959 243 - R.C. Dunkerque 442 959 243 - SIRET 442 959 243 00019</p>
          </TD>
          <TD tal:condition="python:delivery.getSourceSectionTitle()=='Houvenaegel'" align="center">Houvenaegel Création - 5 bis, rue Denis Cordonnier - 59820 Gravelines (FRANCE)<br>Tél. : + 33 (0) 3 28 51 91 55 -  Fax : + 33 (0) 3 28 23 34 96
            <p class="Copy">S.A.R.L. au capital de 7.622,45 € - T.V.A. FR 07 422 769 810 - R.C. Dunkerque 422 769 810 - SIRET 422 769 810 00025</p>
          </TD>
          <TD tal:condition="python:delivery.getSourceSectionTitle()=='Coramy'" align="center">Coramy - 5 bis, rue Denis Cordonnier - 59820 Gravelines (FRANCE)<br>Tél. : + 33 (0) 3 28 51 91 51 -  Fax : + 33 (0) 3 28 23 34 96
            <p class="Copy">S.A.S. au capital de 435.200 € - T.V.A. FR 67 611 750 274 - R.C. Dunkerque 611 750 274 - SIRET 611 750 274 00023  - CNUF 15971</p>
          </TD>
        </TR>
      </TABLE>
    </TABLE>
  </BODY>
</HTML>
