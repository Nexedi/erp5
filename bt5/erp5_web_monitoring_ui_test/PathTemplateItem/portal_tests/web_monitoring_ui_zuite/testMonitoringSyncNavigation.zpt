<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Test SlapOS Monitoring UI</title>
</head>
  <body tal:define="instance_root string:rootInstance; instance_1 string:subInstance-1; instance_2 string:subInstance-2; username string:admin; password string:ntpvmhkg; hosting_title string:TEST Hosting Subscription">
    <table cellpadding="1" cellspacing="1" border="1">
      <thead>
        <tr><td rowspan="1" colspan="3">Test SlapOS Monitoring UI</td></tr>
      </thead>
      <tbody>
        <tal:block metal:use-macro="here/Zuite_CommonTemplate/macros/init" />
        <tr>
          <td>store</td>
          <td tal:content="here/portal_tests/web_monitoring_ui_zuite/MonitorBackend_getBaseUrl">http://example.com/erp5</td>
          <td>monitor_simulator_url</td>
        </tr>
        <tr>
          <td colspan="3"><b>Cleanup</b></td>
        </tr>
        <tr>
          <td>open</td>
          <td>${base_url}/bar_module/ListBoxZuite_reset</td>
          <td></td>
        </tr>
        <tr>
          <td>assertTextPresent</td>
          <td>Reset Successfully.</td>
          <td></td>
        </tr>
        <tr>
          <td colspan="3"><b>Initialize</b></td>
        </tr>
        <tr>
          <td>open</td>
          <td>${base_url}/web_site_module/officejs_monitoring/</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/wait_for_app_loaded" />
        <tr>
          <td colspan="3"><b>Add monitoring endpoint</b></td>
        </tr>
        <tal:block tal:define="click_configuration python: {'text': 'Monitoring Configurations'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/click_on_panel_link" />
        </tal:block>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tr>
          <td>click</td>
          <td>//input[@name='check_online_access']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/save" />
        <tal:block tal:define="click_configuration python: {'text': 'Add'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/click_on_header_link" />
        </tal:block>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tr>
          <td>store</td>
          <td>${monitor_simulator_url}/rootInstance/public/feeds</td>
          <td>opml_url</td>
        </tr>
        <tr>
          <td>store</td>
          <td tal:content="instance_root"></td>
          <td>instance_root</td>
        </tr>
        <tr>
          <td>store</td>
          <td tal:content="instance_1"></td>
          <td>instance_1</td>
        </tr>
        <tr>
          <td>store</td>
          <td tal:content="instance_2"></td>
          <td>instance_2</td>
        </tr>
        <tr>
          <td>store</td>
          <td tal:content="username"></td>
          <td>username</td>
        </tr>
        <tr>
          <td>store</td>
          <td tal:content="password"></td>
          <td>password</td>
        </tr>
        <tr>
          <td>store</td>
          <td tal:content="hosting_title"></td>
          <td>hosting_title</td>
        </tr>
        <tr>
          <td>type</td>
          <td>name=url</td>
          <td>${opml_url}</td>
        </tr>
        <tr>
          <td>type</td>
          <td>name=username</td>
          <td>${username}</td>
        </tr>
        <tr>
          <td>type</td>
          <td>name=password</td>
          <td>${password}</td>
        </tr>
        <tr>
          <td>click</td>
          <td>//button[@data-i18n='Save']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementNotPresent</td>
          <td>//span[contains(@class, 'ui-text-error')]</td>
          <td></td>
        </tr>
        <tr>
          <td>waitForElementPresent</td>
          <td>//span[@data-i18n='Monitoring Promises Status']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//span[@data-i18n='Monitoring Promises Status']</td>
          <td></td>
        </tr>
        <tal:block tal:define="click_configuration python: {'text': 'Monitoring Configurations'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/click_on_panel_link" />
        </tal:block>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tr>
          <td>waitForElementPresent</td>
          <td>//button[@id="destroyOPML"]</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//button[@id="destroyOPML"]</td>
          <td></td>
        </tr>
        <tr>
          <td>waitForElementPresent</td>
          <td>//a["${opml_url}"]</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//a["${opml_url}"]</td>
          <td></td>
        </tr>
        <tr>
          <td colspan="3"><b>Synchronize manually</b></td>
        </tr>
        <tal:block tal:define="click_configuration python: {'text': 'Synchronize'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/click_on_panel_link" />
        </tal:block>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/wait_for_listbox_loaded" />
        <tal:block tal:define="pagination_configuration python: {'header': '(16)', 'footer': '16 Records'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_pagination_text" />
        </tal:block>
        <tr>
          <td colspan="3"><b>Check Hosting Subscription</b></td>
        </tr>
        <tal:block tal:define="click_configuration python: {'text': 'Hosting Subscriptions'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/click_on_panel_link" />
        </tal:block>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tr>
          <td>waitForElementPresent</td>
          <td>//a[text()='${hosting_title}']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//a[text()='${hosting_title}']</td>
          <td></td>
        </tr>
        <tr>
          <td>click</td>
          <td>//a[text()='${hosting_title}']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/wait_for_listbox_loaded" />
        <tal:block tal:define="pagination_configuration python: {'header': '(3)', 'footer': '3 Records'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_pagination_text" />
        </tal:block>
        <tal:block tal:define="cell_configuration python: {'line': 0, 'index': 0, 'text': instance_root}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_cell_text" />
        </tal:block>
        <tal:block tal:define="cell_configuration python: {'line': 1, 'index': 0, 'text': instance_1}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_cell_text" />
        </tal:block>
        <tal:block tal:define="cell_configuration python: {'line': 2, 'index': 0, 'text': instance_2}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_cell_text" />
        </tal:block>
        <tr>
          <td colspan="3"><b>Navigate to the root instance</b></td>
        </tr>
        <tr>
          <td>click</td>
          <td>//a[text()='${instance_root}']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tr>
          <td>waitForElementPresent</td>
          <td>//a[@data-i18n='Instance: ${instance_root}']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//a[@data-i18n='Instance: ${instance_root}']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//h1[contains(.,'Instance Promises Status')]</td>
          <td></td>
        </tr>
        <tr>
          <td colspan="3"><b>Display list of promises</b></td>
        </tr>
        <tr>
          <td>click</td>
          <td>//a[@data-i18n='Promises']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/wait_for_listbox_loaded" />
        <tal:block tal:define="pagination_configuration python: {'header': '(16)', 'footer': '16 Records'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_pagination_text" />
        </tal:block>
        <tal:block tal:define="cell_configuration python: {'line': 0, 'index': 3, 'text': hosting_title}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_cell_text" />
        </tal:block>
        <tal:block tal:define="cell_configuration python: {'line': 0, 'index': 2, 'text': instance_root}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_cell_text" />
        </tal:block>
        <tal:block tal:define="cell_configuration python: {'line': 1, 'index': 2, 'text': instance_2}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_cell_text" />
        </tal:block>
        <tr>
          <td colspan="3"><b>Check the promise</b></td>
        </tr>
        <tr>
          <td>store</td>
          <td>test_promise_2</td>
          <td>promise_title</td>
        </tr>
        <tr>
          <td>click</td>
          <td>//a[text()='${promise_title}']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tr>
          <td>waitForElementPresent</td>
          <td>//a[@data-i18n='Promise: ${promise_title}']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//a[@data-i18n='Promise: ${promise_title}']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertTextPresent</td>
          <td>${hosting_title}</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/wait_for_listbox_loaded" />
        <tal:block tal:define="pagination_configuration python: {'header': '(0)', 'footer': 'No records'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_pagination_text" />
        </tal:block>
        <tr>
          <td>open</td>
          <td>${base_url}/web_page_module/Zuite_waitForActivities</td>
          <td></td>
        </tr>
        <tr>
          <td>assertTextPresent</td>
          <td>Done.</td>
          <td></td>
        </tr>
        <tr>
          <td>open</td>
          <td>${base_url}/web_site_module/officejs_monitoring/app/#!display?n.page=settings_configurator</td>
          <td></td>
        </tr>
        <tr>
          <td>waitForElementPresent</td>
          <td>//a[@data-i18n='Monitoring Configurations']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//a[@data-i18n='Monitoring Configurations']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/wait_for_listbox_loaded" />
        <tal:block tal:define="pagination_configuration python: {'header': '(1)', 'footer': '1 Records'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_pagination_text" />
        </tal:block>
        <tr>
          <td>assertElementPresent</td>
          <td>//a[text()='${hosting_title}']</td>
          <td></td>
        </tr>
        <tr>
          <td>click</td>
          <td>//a[text()='${hosting_title}']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tr>
          <td>waitForElementPresent</td>
          <td>//a[@data-i18n='${hosting_title}']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//a[@data-i18n='${hosting_title}']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/save" />
        <tr>
          <td>type</td>
          <td>name=password</td>
          <td>${password}</td>
        </tr>
        <tr>
          <td>click</td>
          <td>//input[@name='verify_password']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/save" />
        <tr>
          <td>click</td>
          <td>//a[@data-i18n='Synchronize']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/wait_for_listbox_loaded" />
        <tal:block tal:define="pagination_configuration python: {'header': '(16)', 'footer': '16 Records'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_pagination_text" />
        </tal:block>
        <tal:block tal:define="click_configuration python: {'text': 'Monitoring Configurations'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/click_on_panel_link" />
        </tal:block>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/wait_for_listbox_loaded" />
        <tal:block tal:define="pagination_configuration python: {'header': '(1)', 'footer': '1 Records'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_pagination_text" />
        </tal:block>
        <tr>
          <td>assertElementPresent</td>
          <td>//a[text()='${hosting_title}']</td>
          <td></td>
        </tr>
        <tr>
          <td>click</td>
          <td>//a[text()='${hosting_title}']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tr>
          <td>waitForElementPresent</td>
          <td>//a[@data-i18n='${hosting_title}']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//a[@data-i18n='${hosting_title}']</td>
          <td></td>
        </tr>
        <tr>
          <td>click</td>
          <td>//a[@data-i18n='Delete']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/wait_for_listbox_loaded" />
        <tal:block tal:define="pagination_configuration python: {'header': '(0)', 'footer': 'No records'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_pagination_text" />
        </tal:block>
        <tr>
          <td>assertTextNotPresent</td>
          <td>${opml_url}</td>
          <td></td>
        </tr>
        <tr>
          <td>assertTextNotPresent</td>
          <td>${hosting_title}</td>
          <td></td>
        </tr>
        <tr>
          <td>click</td>
          <td>//a[@data-i18n='Hosting Subscriptions']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tr>
          <td>assertTextNotPresent</td>
          <td>${hosting_title}</td>
          <td></td>
        </tr>
      </tbody>
    </table>
  </body>
</html>