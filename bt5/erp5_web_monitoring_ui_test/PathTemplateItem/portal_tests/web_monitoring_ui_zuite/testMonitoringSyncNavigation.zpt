<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Test SlapOS Monitoring UI</title>
</head>
<body>
<table cellpadding="1" cellspacing="1" border="1">
<thead>
<tr><td rowspan="1" colspan="3">Test SlapOS Monitoring UI</td></tr>
</thead><tbody>
<tal:block metal:use-macro="here/Zuite_CommonTemplate/macros/init" />
<tr>
  <td>store</td>
  <td tal:content="here/portal_tests/web_monitoring_ui_zuite/MonitorBackend_getBaseUrl">http://example.com/erp5</td>
  <td>monitor_simulator_url</td>
</tr>
<tr>
  <td colspan="3"><b>Cleanup</b></td>
</tr>
<tr>
  <td>open</td>
  <td>${base_url}/bar_module/ListBoxZuite_reset</td>
  <td></td>
</tr>
<tr>
  <td>assertTextPresent</td>
  <td>Reset Successfully.</td>
  <td></td>
</tr>
<tr>
  <td colspan="3"><b>Initialize</b></td>
</tr>
<tr>
  <td>open</td>
  <td>${base_url}/web_site_module/officejs_monitoring/</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//a[@data-i18n='Monitoring Configurations']</td>
  <td></td>
</tr>
<tr>
  <td colspan="3"><b><i>XXX:</i> Cleanup previous run or clone and install offline?</b></td>
</tr>
<tr>
  <td colspan="3"><b>Add monitoring endpoint</b></td>
</tr>
<tr>
  <td>click</td>
  <td>//a[@data-i18n='Monitoring Configurations']</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//button[@id="destroyOPML"]</td>
  <td></td>
</tr>
<tr>
  <td>click</td>
  <td>//input[@name='check_online_access']</td>
  <td></td>
</tr>
<tr>
  <td>click</td>
  <td>//button[@data-i18n='Save']</td>
  <td></td>
</tr>
<tr>
  <td>click</td>
  <td>//a[@data-i18n='Add']</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//button[@data-i18n="Save"]</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//a[@data-i18n='Change Password']</td>
  <td></td>
</tr>
<tr>
  <td>store</td>
  <td>${monitor_simulator_url}/rootInstance/public/feeds</td>
  <td>opml_url</td>
</tr>
<tr>
  <td>store</td>
  <td>rootInstance</td>
  <td>instance_root</td>
</tr>
<tr>
  <td>store</td>
  <td>subInstance-1</td>
  <td>instance_1</td>
</tr>
<tr>
  <td>store</td>
  <td>subInstance-2</td>
  <td>instance_2</td>
</tr>
<tr>
  <td>store</td>
  <td>admin</td>
  <td>username</td>
</tr>
<tr>
  <td>store</td>
  <td>ntpvmhkg</td>
  <td>password</td>
</tr>
<tr>
  <td>type</td>
  <td>name=url</td>
  <td>${opml_url}</td>
</tr>
<tr>
  <td>type</td>
  <td>name=username</td>
  <td>${username}</td>
</tr>
<tr>
  <td>type</td>
  <td>name=password</td>
  <td>${password}</td>
</tr>
<tr>
  <td>click</td>
  <td>//button[@data-i18n='Save']</td>
  <td></td>
</tr>
<tr>
  <td>assertElementNotPresent</td>
  <td>//span[contains(@class, 'ui-text-error')]</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//span[@data-i18n='Monitoring Promises Status']</td>
  <td></td>
</tr>
<tr>
  <td>click</td>
  <td>//a[@data-i18n='Monitoring Configurations']</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//button[@id="destroyOPML"]</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//a["${opml_url}"]</td>
  <td></td>
</tr>
<tr>
  <td>store</td>
  <td>TEST Hosting Subscription</td>
  <td>hosting_title</td>
</tr>
<tr>
  <td colspan="3"><b>Synchronize manually</b></td>
</tr>
<tr>
  <td>click</td>
  <td>//a[@data-i18n='Synchronize']</td>
  <td></td>
</tr>
<tr>
  <td>waitForTextPresent</td>
  <td>Synchronizing Data...</td>
  <td></td>
</tr>
<tr>
  <td>waitForTextPresent</td>
  <td>Synchronisation finished</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//span[@data-i18n='Monitoring Promises Status']</td>
  <td></td>
</tr>
<tr>
  <td colspan="3"><b>Check Hosting Subscription</b></td>
</tr>
<tr>
  <td>click</td>
  <td>//a[@data-i18n='Hosting Subscriptions']</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//a[text()='${hosting_title}']</td>
  <td></td>
</tr>
<tr>
  <td>click</td>
  <td>//a[text()='${hosting_title}']</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//h1[contains(.,'Software Instances')]</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//a[text()='${instance_root}']</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//a[text()='${instance_1}']</td>
  <td></td>
</tr>
<tr>
  <td colspan="3"><b>Navigate to the root instance</b></td>
</tr>
<tr>
  <td>click</td>
  <td>//a[text()='${instance_root}']</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//a[@data-i18n='Instance: ${instance_root}']</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//h1[contains(.,'Instance Promises Status')]</td>
  <td></td>
</tr>
<tr>
  <td colspan="3"><b>Display list of promises</b></td>
</tr>
<tr>
  <td>click</td>
  <td>//a[@data-i18n='Promises']</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//h1[contains(.,'Monitoring Promises')]</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//a[text()='${hosting_title}']</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//a[text()='${instance_root}']</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//a[text()='${instance_1}']</td>
  <td></td>
</tr>
<tr>
  <td colspan="3"><b>Check the promise</b></td>
</tr>
<tr>
  <td>store</td>
  <td>test_promise_2</td>
  <td>promise_title</td>
</tr>
<tr>
  <td>click</td>
  <td>//a[text()='${promise_title}']</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//a[@data-i18n='Promise: ${promise_title}']</td>
  <td></td>
</tr>
<tr>
  <td>assertTextPresent</td>
  <td>${hosting_title}</td>
  <td></td>
</tr>
<tr>
  <td>assertElementPresent</td>
  <td>//h1[contains(.,'Promise Status History')]</td>
  <td></td>
</tr>
<tr>
  <td>assertElementPresent</td>
  <td>//span[contains(@class, 'label')]</td>
  <td></td>
</tr>
<tr>
  <td>open</td>
  <td>${base_url}/web_page_module/Zuite_waitForActivities</td>
  <td></td>
</tr>
<tr>
  <td>assertTextPresent</td>
  <td>Done.</td>
  <td></td>
</tr>
<tr>
  <td>open</td>
  <td>${base_url}/web_site_module/officejs_monitoring/app/#!display?n.page=settings_configurator</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//a[@data-i18n='Monitoring Configurations']</td>
  <td></td>
</tr>
<tr>
  <td>pause</td>
  <td>2000</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//h1[contains(.,'OPML Documents')]</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//a[text()='${hosting_title}']</td>
  <td></td>
</tr>
<tr>
  <td>click</td>
  <td>//a[text()='${hosting_title}']</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//a[@data-i18n='${hosting_title}']</td>
  <td></td>
</tr>
<tr>
  <td>click</td>
  <td>//button[@data-i18n='Save']</td>
  <td></td>
</tr>
<tr>
  <td>type</td>
  <td>name=password</td>
  <td>${password}</td>
</tr>
<tr>
  <td>click</td>
  <td>//input[@name='verify_password']</td>
  <td></td>
</tr>
<tr>
  <td>click</td>
  <td>//button[@data-i18n='Save']</td>
  <td></td>
</tr>
<tr>
  <td>click</td>
  <td>//a[@data-i18n='Synchronize']</td>
  <td></td>
</tr>
<tr>
  <td>waitForTextPresent</td>
  <td>Synchronizing Data...</td>
  <td></td>
</tr>
<tr>
  <td>waitForTextPresent</td>
  <td>Synchronisation finished</td>
  <td></td>
</tr>
<tr>
  <td>click</td>
  <td>//a[@data-i18n='Monitoring Configurations']</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//h1[contains(.,'OPML Documents')]</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//a[text()='${hosting_title}']</td>
  <td></td>
</tr>
<tr>
  <td>click</td>
  <td>//a[text()='${hosting_title}']</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//a[@data-i18n='${hosting_title}']</td>
  <td></td>
</tr>
<tr>
  <td colspan="3"><b><i>XXX</i>: Checkpoint, clicking Delete hangs the browser, infinite recursion</b></td>
</tr>
<tr>
  <td>click</td>
  <td>//a[@data-i18n='Delete']</td>
  <td></td>
</tr>
<tr>
  <td>waitForElementPresent</td>
  <td>//h1[contains(.,'OPML Documents')]</td>
  <td></td>
</tr>
<tr>
  <td>assertTextNotPresent</td>
  <td>${opml_url}</td>
  <td></td>
</tr>
<tr>
  <td>assertTextNotPresent</td>
  <td>${hosting_title}</td>
  <td></td>
</tr>
<tr>
  <td>click</td>
  <td>//a[@data-i18n='Hosting Subscriptions']</td>
  <td></td>
</tr>
<tr>
  <td>assertTextNotPresent</td>
  <td>${hosting_title}</td>
  <td></td>
</tr>
</tbody></table>
</body>
</html>