<html xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Test SlapOS Monitoring UI</title>
</head>
  <body>
    <table cellpadding="1" cellspacing="1" border="1">
      <thead>
        <tr><td rowspan="1" colspan="3">Test SlapOS Monitoring UI</td></tr>
      </thead>
      <tbody>
        <tal:block metal:use-macro="here/Zuite_CommonTemplate/macros/init" />
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/monitoring_ui_setup"/>
        <tr>
          <td colspan="3"><b>Add monitoring endpoint</b></td>
        </tr>
        <tal:block tal:define="click_configuration python: {'text': 'Monitoring Configurations'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/click_on_panel_link" />
        </tal:block>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tr>
          <td>click</td>
          <td>//input[@name='check_online_access']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/save" />
        <tal:block tal:define="click_configuration python: {'text': 'Add'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/click_on_header_link" />
        </tal:block>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tr>
          <td>type</td>
          <td>name=url</td>
          <td>${MONITORING_OPML_URL}</td>
        </tr>
        <tr>
          <td>type</td>
          <td>name=username</td>
          <td>${MONITORING_USERNAME}</td>
        </tr>
        <tr>
          <td>type</td>
          <td>name=password</td>
          <td>${MONITORING_PASSWORD}</td>
        </tr>
        <tr>
          <td>click</td>
          <td>//button[@data-i18n='Save']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementNotPresent</td>
          <td>//span[contains(@class, 'ui-text-error')]</td>
          <td></td>
        </tr>
        <tr>
          <td>waitForElementPresent</td>
          <td>//span[@data-i18n='Monitoring Promises Status']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//span[@data-i18n='Monitoring Promises Status']</td>
          <td></td>
        </tr>
        <tal:block tal:define="click_configuration python: {'text': 'Monitoring Configurations'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/click_on_panel_link" />
        </tal:block>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tr>
          <td>waitForElementPresent</td>
          <td>//button[@id="destroyOPML"]</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//button[@id="destroyOPML"]</td>
          <td></td>
        </tr>
        <tr>
          <td>waitForElementPresent</td>
          <td>//a["${MONITORING_OPML_URL}"]</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//a["${MONITORING_OPML_URL}"]</td>
          <td></td>
        </tr>
        <tr>
          <td colspan="3"><b>Synchronize manually</b></td>
        </tr>
        <tal:block tal:define="click_configuration python: {'text': 'Synchronize'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/click_on_panel_link" />
        </tal:block>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/wait_for_listbox_loaded" />
        <tal:block tal:define="pagination_configuration python: {'header': '(16)', 'footer': '16 Records'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_pagination_text" />
        </tal:block>
        <tr>
          <td colspan="3"><b>Check Hosting Subscription</b></td>
        </tr>
        <tal:block tal:define="click_configuration python: {'text': 'Hosting Subscriptions'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/click_on_panel_link" />
        </tal:block>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tr>
          <td>waitForElementPresent</td>
          <td>//a[text()='${MONITORING_HOSTING_TITLE}']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//a[text()='${MONITORING_HOSTING_TITLE}']</td>
          <td></td>
        </tr>
        <tr>
          <td>click</td>
          <td>//a[text()='${MONITORING_HOSTING_TITLE}']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/wait_for_listbox_loaded" />
        <tal:block tal:define="pagination_configuration python: {'header': '(3)', 'footer': '3 Records'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_pagination_text" />
        </tal:block>
        <tal:block tal:define="cell_configuration python: {'line': 0, 'index': 0, 'text': MONITORING_INSTANCE_ROOT}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_cell_text" />
        </tal:block>
        <tal:block tal:define="cell_configuration python: {'line': 1, 'index': 0, 'text': MONITORING_INSTANCE_1}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_cell_text" />
        </tal:block>
        <tal:block tal:define="cell_configuration python: {'line': 2, 'index': 0, 'text': MONITORING_INSTANCE_2}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_cell_text" />
        </tal:block>
        <tr>
          <td colspan="3"><b>Navigate to the root instance</b></td>
        </tr>
        <tr>
          <td>click</td>
          <td>//a[text()='${MONITORING_INSTANCE_ROOT}']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tr>
          <td>waitForElementPresent</td>
          <td>//a[@data-i18n='Instance: ${MONITORING_INSTANCE_ROOT}']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//a[@data-i18n='Instance: ${MONITORING_INSTANCE_ROOT}']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//h1[contains(.,'Instance Promises Status')]</td>
          <td></td>
        </tr>
        <tr>
          <td colspan="3"><b>Display list of promises</b></td>
        </tr>
        <tr>
          <td>click</td>
          <td>//a[@data-i18n='Promises']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/wait_for_listbox_loaded" />
        <tal:block tal:define="pagination_configuration python: {'header': '(16)', 'footer': '16 Records'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_pagination_text" />
        </tal:block>
        <tal:block tal:define="cell_configuration python: {'line': 0, 'index': 3, 'text': MONITORING_HOSTING_TITLE}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_cell_text" />
        </tal:block>
        <tal:block tal:define="cell_configuration python: {'line': 0, 'index': 2, 'text': MONITORING_INSTANCE_ROOT}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_cell_text" />
        </tal:block>
        <tal:block tal:define="cell_configuration python: {'line': 1, 'index': 2, 'text': MONITORING_INSTANCE_2}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_cell_text" />
        </tal:block>
        <tr>
          <td colspan="3"><b>Check the promise</b></td>
        </tr>
        <tr>
          <td>click</td>
          <td>//a[text()='${MONITORING_PROMISE_TITLE}']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tr>
          <td>waitForElementPresent</td>
          <td>//a[@data-i18n='Promise: ${MONITORING_PROMISE_TITLE}']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//a[@data-i18n='Promise: ${MONITORING_PROMISE_TITLE}']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertTextPresent</td>
          <td>${MONITORING_HOSTING_TITLE}</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/wait_for_listbox_loaded" />
        <tal:block tal:define="pagination_configuration python: {'header': '(0)', 'footer': 'No records'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_pagination_text" />
        </tal:block>
        <tr>
          <td colspan="3"><b>Let the backend process all work</b></td>
        </tr>
        <tr>
          <td>open</td>
          <td>${base_url}/web_page_module/Zuite_waitForActivities</td>
          <td></td>
        </tr>
        <tr>
          <td>assertTextPresent</td>
          <td>Done.</td>
          <td></td>
        </tr>
        <tr>
          <td colspan="3"><b>Update the Hosting Subscription</b></td>
        </tr>
        <tr>
          <td>open</td>
          <td>${base_url}/web_site_module/officejs_monitoring/app/#!display?n.page=settings_configurator</td>
          <td></td>
        </tr>
        <tr>
          <td>waitForElementPresent</td>
          <td>//a[@data-i18n='Monitoring Configurations']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//a[@data-i18n='Monitoring Configurations']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/wait_for_listbox_loaded" />
        <tal:block tal:define="pagination_configuration python: {'header': '(1)', 'footer': '1 Records'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_pagination_text" />
        </tal:block>
        <tr>
          <td>assertElementPresent</td>
          <td>//a[text()='${MONITORING_HOSTING_TITLE}']</td>
          <td></td>
        </tr>
        <tr>
          <td>click</td>
          <td>//a[text()='${MONITORING_HOSTING_TITLE}']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tr>
          <td>waitForElementPresent</td>
          <td>//a[@data-i18n='${MONITORING_HOSTING_TITLE}']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//a[@data-i18n='${MONITORING_HOSTING_TITLE}']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/save" />
        <tr>
          <td>type</td>
          <td>name=password</td>
          <td>${MONITORING_PASSWORD}</td>
        </tr>
        <tr>
          <td>click</td>
          <td>//input[@name='verify_password']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/save" />
        <tal:block tal:define="click_configuration python: {'text': 'Synchronize'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/click_on_panel_link" />
        </tal:block>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/wait_for_listbox_loaded" />
        <tal:block tal:define="pagination_configuration python: {'header': '(16)', 'footer': '16 Records'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_pagination_text" />
        </tal:block>
        <tal:block tal:define="click_configuration python: {'text': 'Monitoring Configurations'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/click_on_panel_link" />
        </tal:block>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/wait_for_listbox_loaded" />
        <tal:block tal:define="pagination_configuration python: {'header': '(1)', 'footer': '1 Records'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_pagination_text" />
        </tal:block>
        <tr>
          <td colspan="3"><b>Delete the Hosting Subscription</b></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//a[text()='${MONITORING_HOSTING_TITLE}']</td>
          <td></td>
        </tr>
        <tr>
          <td>click</td>
          <td>//a[text()='${MONITORING_HOSTING_TITLE}']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tr>
          <td>waitForElementPresent</td>
          <td>//a[@data-i18n='${MONITORING_HOSTING_TITLE}']</td>
          <td></td>
        </tr>
        <tr>
          <td>assertElementPresent</td>
          <td>//a[@data-i18n='${MONITORING_HOSTING_TITLE}']</td>
          <td></td>
        </tr>
        <tr>
          <td>click</td>
          <td>//a[@data-i18n='Delete']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/wait_for_listbox_loaded" />
        <tal:block tal:define="pagination_configuration python: {'header': '(0)', 'footer': 'No records'}">
          <tal:block metal:use-macro="here/Zuite_CommonTemplateForRenderjsUi/macros/check_listbox_pagination_text" />
        </tal:block>
        <tr>
          <td>assertTextNotPresent</td>
          <td>${MONITORING_OPML_URL}</td>
          <td></td>
        </tr>
        <tr>
          <td>assertTextNotPresent</td>
          <td>${MONITORING_HOSTING_TITLE}</td>
          <td></td>
        </tr>
        <tr>
          <td>click</td>
          <td>//a[@data-i18n='Hosting Subscriptions']</td>
          <td></td>
        </tr>
        <tal:block metal:use-macro="here/Zuite_CommonTemplateForMonitoringUi/macros/wait_for_content_loaded" />
        <tr>
          <td>assertTextNotPresent</td>
          <td>${MONITORING_HOSTING_TITLE}</td>
          <td></td>
        </tr>
      </tbody>
    </table>
  </body>
</html>