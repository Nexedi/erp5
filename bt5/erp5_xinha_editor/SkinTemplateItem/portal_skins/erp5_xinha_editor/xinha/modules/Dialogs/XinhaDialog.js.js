/* This compressed file is part of Xinha. For uncompressed sources, forum, and bug reports, go to xinha.org */
Xinha.Dialog=function(e,h,k,n,f){var t=this;this.id={};this.r_id={};this.editor=e;this.document=document;this.size=n;this.modal=(f&&f.modal===false)?false:true;this.closable=(f&&f.closable===false)?false:true;this.resizable=(f&&f.resizable===false)?false:true;this.layer=(f&&f.layer)?f.layer:0;this.centered=(f&&f.centered===true)?true:false;this.closeOnEscape=(f&&f.closeOnEscape===true)?true:false;this.rootElem=null;this.captionBar=null;this.main=null;this.background=null;this.centered=null;this.greyout=null;this.buttons=null;this.closer=null;this.icon=null;this.resizer=null;this.initialZ=null;var a=e.config.dialogOptions;if(a){if(typeof a.centered!="undefined"){this.centered=a.centered}if(typeof a.resizable!="undefined"){this.resizable=a.resizable}if(typeof a.closable!="undefined"){this.closable=a.closable}if(typeof a.greyout!="undefined"){this.greyout=a.greyout}if(typeof a.closeOnEscape!="undefined"){this.closeOnEscape=a.closeOnEscape}}var m;if(Xinha.is_ie){m=document.createElement("iframe");m.src="about:blank";m.onreadystatechange=function(){var w=window.event.srcElement.contentWindow.document;if(this.readyState=="complete"&&w&&w.body){var y=w.createElement("div");var p,x=document.styleSheets;for(var s=0;s<x.length;s++){if(x[s].id.indexOf("Xinha")!=-1&&x[s].cssText){p+=x[s].cssText}}y.innerHTML='<br><style type="text/css">\n'+p+"\n</style>";w.getElementsByTagName("body")[0].appendChild(y);w.body.className="xinha_dialog_background";if(t.modal){w.body.className+="_modal"}if(t.greyout){w.body.className+="_greyout"}}}}else{m=document.createElement("div")}m.className="xinha_dialog_background";if(this.modal){m.className+="_modal"}if(this.greyout){m.className+="_greyout"}var g=1000;if(!Xinha.Dialog.initialZ){var o=e._htmlArea;while(o){if(o.style&&parseInt(o.style.zIndex,10)>g){g=parseInt(o.style.zIndex,10)}o=o.parentNode}Xinha.Dialog.initialZ=g}g=Xinha.Dialog.initialZ;var l=m.style;l.position="absolute";l.top=0;l.left=0;l.border="none";l.overflow="hidden";l.display="none";l.zIndex=(this.modal?g+25:g+1)+this.layer;document.body.appendChild(m);this.background=m;m=null;Xinha.freeLater(this,"background");var j=document.createElement("div");j.style.position=(Xinha.is_ie||!this.modal)?"absolute":"fixed";j.style.zIndex=(this.modal?g+27:g+3)+this.layer;j.style.display="none";if(!this.modal){Xinha._addEvent(j,"mousedown",function(){Xinha.Dialog.activateModeless(t)})}j.className="dialog"+(this.modal?"":" modeless");if(Xinha.is_chrome){j.className+=" chrome"}document.body.appendChild(j);j.style.paddingBottom="10px";j.style.width=(n&&n.width)?n.width+"px":"";if(n&&n.height){if(Xinha.ie_version<7){j.style.height=n.height+"px"}else{j.style.minHeight=n.height+"px"}}h=this.translateHtml(h,k);var d=document.createElement("div");j.appendChild(d);d.innerHTML=h;this.fixupDOM(d,k);var q=d.removeChild(d.getElementsByTagName("h1")[0]);j.insertBefore(q,d);Xinha._addEvent(q,"mousedown",function(i){t.dragStart(i)});q.style.MozUserSelect="none";q.style.WebkitUserSelect="none";q.unselectable="on";q.onselectstart=function(){return false};this.buttons=document.createElement("div");l=this.buttons.style;l.position="absolute";l.top="0";l.right="2px";j.appendChild(this.buttons);if(this.closable&&this.closeOnEscape){Xinha._addEvent(document,"keypress",function(i){if(i.keyCode==27){if(Xinha.Dialog.activeModeless==t||t.modal){t.hide();return true}}})}this.closer=null;if(this.closable){this.closer=document.createElement("div");this.closer.className="closeButton";this.closer.onmousedown=function(i){this.className="closeButton buttonClick";Xinha._stopEvent(Xinha.getEvent(i));return false};this.closer.onmouseout=function(i){this.className="closeButton";Xinha._stopEvent(Xinha.getEvent(i));return false};this.closer.onmouseup=function(){this.className="closeButton";t.hide();return false};this.buttons.appendChild(this.closer);var v=document.createElement("span");v.className="innerX";v.style.position="relative";v.style.top="-3px";v.appendChild(document.createTextNode("\u00D7"));this.closer.appendChild(v);v=null}this.icon=document.createElement("img");var u=this.icon;u.className="icon";u.src=e.config.iconList.dialogCaption;u.style.position="absolute";u.style.top="3px";u.style.left="2px";u.ondrag=function(){return false};j.appendChild(this.icon);var c=j.getElementsByTagName("*");for(var r=0;r<c.length;r++){var b=c[r];if(b.tagName.toLowerCase()=="textarea"||b.tagName.toLowerCase()=="input"){}else{b.unselectable="on"}}this.resizer=null;if(this.resizable){this.resizer=document.createElement("div");this.resizer.className="resizeHandle";l=this.resizer.style;l.position="absolute";l.bottom="0px";l.right="0px";l.MozUserSelect="none";Xinha._addEvent(this.resizer,"mousedown",function(i){t.resizeStart(i)});j.appendChild(this.resizer)}this.rootElem=j;this.captionBar=q;this.main=d;q=null;j=null;d=null;Xinha.freeLater(this,"rootElem");Xinha.freeLater(this,"captionBar");Xinha.freeLater(this,"main");Xinha.freeLater(this,"buttons");Xinha.freeLater(this,"closer");Xinha.freeLater(this,"icon");Xinha.freeLater(this,"resizer");Xinha.freeLater(this,"document");this.size={}};Xinha.Dialog.prototype.onresize=function(){return true};Xinha.Dialog.prototype.show=function(l){var h=this.rootElem;var n=h.style;var m=this.modal;var d=this.editor.scrollPos();this.scrollPos=d;var a=this;if(this.attached){this.editor.showPanel(h)}if(Xinha._someEditorHasBeenActivated){this._lastRange=this.editor.saveSelection();if(Xinha.is_ie&&!m){a.saveSelection=function(){a._lastRange=a.editor.saveSelection()};Xinha._addEvent(this.editor._doc,"mouseup",a.saveSelection)}}if(m){this.editor.deactivateEditor();this.editor.suspendUpdateToolbar=true;this.editor.currentModal=a}if(Xinha.is_ff2&&m){this._restoreTo=[this.editor._textArea.style.display,this.editor._iframe.style.visibility,this.editor.hidePanels()];this.editor._textArea.style.display="none";this.editor._iframe.style.visibility="hidden"}if(!this.attached){if(m){this.showBackground();this.posBackground({top:0,left:0});this.resizeBackground(Xinha.Dialog.calcFullBgSize())}else{this.background.style.display=""}Xinha.Dialog.fadeIn(this.rootElem,100,function(){if(m){var o=a.rootElem.getElementsByTagName("input");for(var p=0;p<o.length;p++){if(o[p].type=="text"){try{o[p].focus();break}catch(q){}}}}});var k=h.offsetHeight;var f=h.offsetWidth;var i=Xinha.viewportSize();var g=i.y;var c=i.x;if(k>g){n.height=g+"px";if(h.scrollHeight>k){a.main.style.overflowY="auto"}}if(this.size.top&&this.size.left){n.top=parseInt(this.size.top,10)+"px";n.left=parseInt(this.size.left,10)+"px"}else{if(this.editor.btnClickEvent&&!this.centered){var b=this.editor.btnClickEvent;if(n.position=="absolute"){n.top=b.clientY+this.scrollPos.y+"px"}else{n.top=b.clientY+"px"}if(k+h.offsetTop>g){n.top=(n.position=="absolute"?this.scrollPos.y:0)+"px"}if(n.position=="absolute"){n.left=b.clientX+this.scrollPos.x+"px"}else{n.left=b.clientX+"px"}if(f+h.offsetLeft>c){n.left=b.clientX-f+"px";if(h.offsetLeft<0){n.left=0}}this.editor.btnClickEvent=null}else{var j=(g-k)/2;var e=(c-f)/2;n.top=((j>0)?j:0)+"px";n.left=((e>0)?e:0)+"px"}}}this.width=f;this.height=k;if(!m){this.resizeBackground({width:f+"px",height:k+"px"});this.posBackground({top:n.top,left:n.left})}if(typeof l!="undefined"){this.setValues(l)}this.dialogShown=true};Xinha.Dialog.prototype.hide=function(){if(this.attached){this.editor.hidePanel(this.rootElem)}else{Xinha.Dialog.fadeOut(this.rootElem);this.hideBackground();var a=this;if(Xinha.is_ff2&&this.modal){this.editor._textArea.style.display=this._restoreTo[0];this.editor._iframe.style.visibility=this._restoreTo[1];this.editor.showPanels(this._restoreTo[2])}if(!this.editor._isFullScreen&&this.modal){window.scroll(this.scrollPos.x,this.scrollPos.y)}if(Xinha.is_ie&&!this.modal){Xinha._removeEvent(this.editor._doc,"mouseup",a.saveSelection)}if(this.modal){this.editor.suspendUpdateToolbar=false;this.editor.currentModal=null;this.editor.activateEditor()}}if(this.modal){this.editor.restoreSelection(this._lastRange)}this.dialogShown=false;this.editor.updateToolbar();this.editor.focusEditor();return this.getValues()};Xinha.Dialog.prototype.toggle=function(){if(this.rootElem.style.display=="none"){this.show()}else{this.hide()}};Xinha.Dialog.prototype.collapse=function(){if(this.collapsed){this.collapsed=false;this.show()}else{this.main.style.height=0;this.collapsed=true}};Xinha.Dialog.prototype.getElementById=function(a){if(!this.rootElem.parentNode){this.document.body.appendChild(this.rootElem)}return this.document.getElementById(this.id[a]?this.id[a]:a)};Xinha.Dialog.prototype.getElementsByName=function(a){if(!this.rootElem.parentNode){this.document.body.appendChild(this.rootElem)}var b=this.document.getElementsByName(this.id[a]?this.id[a]:a);return Xinha.collectionToArray(b)};Xinha.Dialog.prototype.getElementsByClassName=function(a){return Xinha.getElementsByClassName(this.rootElem,a)};Xinha.Dialog.prototype.dragStart=function(c){if(this.attached||this.dragging){return}if(!this.modal){this.posBackground({top:0,left:0});this.resizeBackground(Xinha.Dialog.calcFullBgSize());this.editor.suspendUpdateToolbar=true}c=Xinha.getEvent(c);var b=this;b.dragging=true;b.scrollPos=b.editor.scrollPos();var a=b.rootElem.style;b.xOffs=c.offsetX||c.layerX;b.yOffs=c.offsetY||c.layerY;b.mouseMove=function(d){b.dragIt(d)};Xinha._addEvent(document,"mousemove",b.mouseMove);if(Xinha.is_ie){Xinha._addEvent(this.background.contentWindow.document,"mousemove",b.mouseMove)}b.mouseUp=function(d){b.dragEnd(d)};Xinha._addEvent(document,"mouseup",b.mouseUp);if(Xinha.is_ie){Xinha._addEvent(this.background.contentWindow.document,"mouseup",b.mouseUp)}};Xinha.Dialog.prototype.dragIt=function(c){var b=this;if(!b.dragging){return false}var d,e,a;if(b.rootElem.style.position=="absolute"){d=(c.clientY+this.scrollPos.y)-b.yOffs+"px";e=(c.clientX+this.scrollPos.x)-b.xOffs+"px";a={top:d,left:e}}else{if(b.rootElem.style.position=="fixed"){d=c.clientY-b.yOffs+"px";e=c.clientX-b.xOffs+"px";a={top:d,left:e}}}b.posDialog(a)};Xinha.Dialog.prototype.dragEnd=function(b){var a=this;if(!this.modal){this.editor.suspendUpdateToolbar=false}if(!a.dragging){return false}a.dragging=false;Xinha._removeEvent(document,"mousemove",a.mouseMove);if(Xinha.is_ie){Xinha._removeEvent(this.background.contentWindow.document,"mousemove",a.mouseMove)}Xinha._removeEvent(document,"mouseup",a.mouseUp);if(Xinha.is_ie){Xinha._removeEvent(this.background.contentWindow.document,"mouseup",a.mouseUp)}var c=a.rootElem.style;a.size.top=c.top;a.size.left=c.left;if(!this.modal){this.sizeBgToDialog()}};Xinha.Dialog.prototype.resizeStart=function(c){var b=this;if(b.resizing){return}b.resizing=true;if(!this.modal){this.editor.suspendUpdateToolbar=true;this.posBackground({top:0,left:0});this.resizeBackground(Xinha.Dialog.calcFullBgSize())}b.scrollPos=b.editor.scrollPos();var a=b.rootElem.style;a.minHeight="";a.overflow="hidden";b.xOffs=parseInt(a.left,10);b.yOffs=parseInt(a.top,10);b.mouseMove=function(d){b.resizeIt(d)};Xinha._addEvent(document,"mousemove",b.mouseMove);if(Xinha.is_ie){Xinha._addEvent(this.background.contentWindow.document,"mousemove",b.mouseMove)}b.mouseUp=function(d){b.resizeEnd(d)};Xinha._addEvent(document,"mouseup",b.mouseUp);if(Xinha.is_ie){Xinha._addEvent(this.background.contentWindow.document,"mouseup",b.mouseUp)}};Xinha.Dialog.prototype.resizeIt=function(c){var b=this;if(!b.resizing){return false}var d,e;if(b.rootElem.style.position=="absolute"){d=c.clientY+b.scrollPos.y;e=c.clientX+b.scrollPos.x}else{d=c.clientY;e=c.clientX}e-=b.xOffs;d-=b.yOffs;var a={};a.width=((e>10)?e:10)+8+"px";a.height=((d>10)?d:10)+"px";b.sizeDialog(a);b.width=b.rootElem.offsetWidth;b.height=b.rootElem.offsetHeight;b.onresize()};Xinha.Dialog.prototype.resizeEnd=function(b){var a=this;a.resizing=false;if(!this.modal){this.editor.suspendUpdateToolbar=false}Xinha._removeEvent(document,"mousemove",a.mouseMove);if(Xinha.is_ie){Xinha._removeEvent(this.background.contentWindow.document,"mouseup",a.mouseUp)}Xinha._removeEvent(document,"mouseup",a.mouseUp);if(Xinha.is_ie){Xinha._removeEvent(this.background.contentWindow.document,"mouseup",a.mouseUp)}a.size.width=a.rootElem.offsetWidth;a.size.height=a.rootElem.offsetHeight;if(!this.modal){this.sizeBgToDialog()}};Xinha.Dialog.prototype.attachToPanel=function(c){var b=this;var d=this.rootElem;var a=this.editor;this.attached=true;this.rootElem.side=c;this.captionBar.ondblclick=function(e){b.detachFromPanel(Xinha.getEvent(e))};d.style.position="static";d.parentNode.removeChild(d);this.background.style.display="none";this.captionBar.style.paddingLeft="3px";this.resizer.style.display="none";if(this.closable){this.closer.style.display="none"}this.icon.style.display="none";if(c=="left"||c=="right"){d.style.width=a.config.panel_dimensions[c]}else{d.style.width=""}Xinha.addClasses(d,"panel");a._panels[c].panels.push(d);a._panels[c].div.appendChild(d);a.notifyOf("panel_change",{action:"add",panel:d})};Xinha.Dialog.prototype.detachFromPanel=function(){var b=this;var c=b.rootElem;var d=c.style;var a=b.editor;b.attached=false;var e=Xinha.getElementTopLeft(c);d.position="absolute";d.top=e.top+"px";d.left=e.left+"px";b.resizer.style.display="";if(b.closable){b.closer.style.display=""}b.icon.style.display="";if(b.size.width){c.style.width=b.size.width+"px"}Xinha.removeClasses(c,"panel");a.removePanel(c);document.body.appendChild(c);b.captionBar.ondblclick=function(){b.attachToPanel(c.side)};this.background.style.display="";this.sizeBgToDialog()};Xinha.Dialog.calcFullBgSize=function(){var b=Xinha.pageSize();var a=Xinha.viewportSize();return{width:(b.x>a.x?b.x:a.x)+"px",height:(b.x>a.y?b.y:a.y)+"px"}};Xinha.Dialog.prototype.sizeBgToDialog=function(){var b=this.rootElem.style;var a=this.background.style;a.top=b.top;a.left=b.left;a.width=b.width;a.height=b.height};Xinha.Dialog.prototype.hideBackground=function(){Xinha.Dialog.fadeOut(this.background)};Xinha.Dialog.prototype.showBackground=function(){Xinha.Dialog.fadeIn(this.background,70)};Xinha.Dialog.prototype.posBackground=function(a){if(this.background.style.display!="none"){this.background.style.top=a.top;this.background.style.left=a.left}};Xinha.Dialog.prototype.resizeBackground=function(a){if(this.background.style.display!="none"){this.background.style.width=a.width;this.background.style.height=a.height}};Xinha.Dialog.prototype.posDialog=function(b){var a=this.rootElem.style;a.left=b.left;a.top=b.top};Xinha.Dialog.prototype.sizeDialog=function(b){var a=this.rootElem.style;a.height=b.height;a.width=b.width;var c=parseInt(b.width,10);var d=parseInt(b.height,10)-this.captionBar.offsetHeight;this.main.style.height=(d>20)?d:20+"px";this.main.style.width=(c>10)?c:10+"px"};Xinha.Dialog.prototype.setValues=function(g){for(var f in g){if(typeof f=="string"){var c=this.getElementsByName(f);if(!c){continue}for(var a=0;a<c.length;a++){var h=c[a];switch(h.tagName.toLowerCase()){case"select":for(var d=0;d<h.options.length;d++){if(typeof g[f]=="object"){for(var b=0;b<g[f].length;b++){if(g[f][b]==h.options[d].value){h.options[d].selected=true}}}else{if(g[f]==h.options[d].value){h.options[d].selected=true}}}break;case"textarea":case"input":switch(h.getAttribute("type")){case"radio":if(h.value==g[f]){h.checked=true}break;case"checkbox":if(typeof g[f]=="object"){for(d in g[f]){if(g[f][d]==h.value){h.checked=true}}}else{if(g[f]==h.value){h.checked=true}}break;default:h.value=g[f];break}}}}}};Xinha.Dialog.prototype.getValues=function(){var e=[];var f=Xinha.collectionToArray(this.rootElem.getElementsByTagName("input")).append(Xinha.collectionToArray(this.rootElem.getElementsByTagName("textarea"))).append(Xinha.collectionToArray(this.rootElem.getElementsByTagName("select")));for(var a=0;a<f.length;a++){var d=f[a];if(!(d.name&&this.r_id[d.name])){continue}if(typeof e[this.r_id[d.name]]=="undefined"){e[this.r_id[d.name]]=null}var b=e[this.r_id[d.name]];switch(d.tagName.toLowerCase()){case"select":if(d.multiple){if(!b.push){if(b!==null){b=[b]}else{b=[]}}for(var c=0;c<d.options.length;c++){if(d.options[c].selected){b.push(d.options[c].value)}}}else{if(d.selectedIndex>=0){b=d.options[d.selectedIndex]}}break;default:switch(d.type.toLowerCase()){case"radio":if(d.checked){b=d.value}break;case"checkbox":if(b===null){if(this.getElementsByName(this.r_id[d.name]).length>1){b=[]}}if(d.checked){if(b!==null&&typeof b=="object"&&b.push){b.push(d.value)}else{b=d.value}}break;default:b=d.value;break}}e[this.r_id[d.name]]=b}return e};Xinha.Dialog.prototype.setLocalizer=function(b){var a=this;if(typeof b=="function"){a._lc=b}else{if(b){this._lc=function(c){return Xinha._lc(c,b)}}else{this._lc=function(c){return c}}}};Xinha.Dialog.prototype.translateHtml=function(b,c){var a=this;if(c){this.setLocalizer(c)}b=b.replace(/((?:name)|(?:id))=(['"])\[([a-z0-9_]+)\]\2/ig,function(e,f,d,g){return f+"="+d+a.createId(g)+d}).replace(/<l10n>(.*?)<\/l10n>/ig,function(d,e){return a._lc(e)}).replace(/\="_\((.*?)\)"/g,function(d,e){return'="'+a._lc(e)+'"'});return b};Xinha.Dialog.prototype.fixupDOM=function(j,c){var b=this;if(typeof c!="string"){c="GenericPlugin"}var h=function(m,l){switch(l){case"editor":return _editor_url;case"plugin":return Xinha.getPluginDir(c);case"images":return b.editor.imgURL("images")}};var a=Xinha.collectionToArray(j.getElementsByTagName("img"));for(var g=0;g<a.length;++g){var d=a[g];var f=d.getAttribute("src");if(f){var e=f.replace(/^\[(editor|plugin|images)\]/,h);if(e!=f){d.setAttribute("src",e)}}}var k=Xinha.collectionToArray(j.getElementsByTagName("a"));for(var g=0;g<k.length;++g){var i=k[g];var f=i.getAttribute("href");if(f){var e=f.replace(/^\[(editor|plugin|images)\]/,h);if(e!=f){i.setAttribute("href",e)}}}};Xinha.Dialog.prototype.createId=function(b){var a=this;if(typeof a.id[b]=="undefined"){a.id[b]=Xinha.uniq("Dialog");a.r_id[a.id[b]]=b}return a.id[b]};Xinha.Dialog.activateModeless=function(a){if(Xinha.Dialog.activeModeless==a||a.attached){return}if(Xinha.Dialog.activeModeless){Xinha.Dialog.activeModeless.rootElem.style.zIndex=parseInt(Xinha.Dialog.activeModeless.rootElem.style.zIndex,10)-10}Xinha.Dialog.activeModeless=a;Xinha.Dialog.activeModeless.rootElem.style.zIndex=parseInt(Xinha.Dialog.activeModeless.rootElem.style.zIndex,10)+10};Xinha.Dialog.setOpacity=function(a,b){if(typeof a.style.filter!="undefined"){a.style.filter=(b<100)?"alpha(opacity="+b+")":""}else{a.style.opacity=b/100}};Xinha.Dialog.fadeIn=function(c,b,e,a,d){a=a||1;d=d||25;b=b||100;c.op=c.op||0;var f=c.op;if(c.style.display=="none"){Xinha.Dialog.setOpacity(c,0);c.style.display=""}if(f<b){c.op+=d;Xinha.Dialog.setOpacity(c,f);c.timeOut=setTimeout(function(){Xinha.Dialog.fadeIn(c,b,e,a,d)},a)}else{Xinha.Dialog.setOpacity(c,b);c.op=b;c.timeOut=null;if(typeof e=="function"){e.call()}}};Xinha.Dialog.fadeOut=function(b,a,c){a=a||1;c=c||30;if(typeof b.op=="undefined"){b.op=100}var d=b.op;if(d>=0){b.op-=c;Xinha.Dialog.setOpacity(b,d);b.timeOut=setTimeout(function(){Xinha.Dialog.fadeOut(b,a,c)},a)}else{Xinha.Dialog.setOpacity(b,0);b.style.display="none";b.op=0;b.timeOut=null}};