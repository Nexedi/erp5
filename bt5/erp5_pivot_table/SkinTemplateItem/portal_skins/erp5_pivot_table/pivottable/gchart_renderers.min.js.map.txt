{"version":3,"sources":["/source/gchart_renderers.coffee","gchart_renderers.min.js"],"names":["callWithJQuery","pivotModule","exports","module","require","define","amd","jQuery","$","makeGoogleChart","chartType","extraOptions","pivotData","opts","agg","colKey","colKeys","dataArray","dataTable","defaults","fullAggName","groupByTitle","h","hAxisTitle","headers","i","j","k","len","len1","numCharsInHAxis","options","ref","result","row","rowKey","rowKeys","title","tree2","v","vAxisTitle","val","wrapper","x","y","localeStrings","vs","by","gchart","width","window","innerWidth","height","innerHeight","extend","getRowKeys","length","push","getColKeys","aggregatorName","valAttrs","join","results","unshift","tree","parseFloat","format","value","google","visualization","DataTable","addColumn","colAttrs","rowAttrs","type","role","addRows","getAggregator","isNumeric","toPrecision","toFixed","arrayToDataTable","hAxis","slantedText","vAxis","tooltip","textStyle","fontName","fontSize","minValue","legend","position","chartArea","css","ChartWrapper","draw","bind","editor","ChartEditor","events","addListener","getChartWrapper","openDialog","pivotUtilities","gchart_renderers","Line Chart","Bar Chart","Stacked Bar Chart","isStacked","Area Chart","Scatter Chart","call","this"],"mappings":"CAAA,WAAA,GAAAA,IAAAA,EAAiB,SAACC,GACd,MAAqB,gBAAlBC,UAAgD,gBAAjBC,QAC9BF,EAAYG,QAAQ,WACC,kBAAjBC,SAAgCA,OAAOC,IAC3CD,QAAQ,UAAWJ,GAGnBA,EAAYM,UAEL,SAACC,GAEZ,GAAAC,ECkKA,ODlKAA,GAAkB,SAACC,EAAWC,GCK5B,MDL6C,UAACC,EAAWC,GACvD,GAAAC,GAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,CAqBA,IArBAzB,GACI0B,eACIC,GAAI,KACJC,GAAI,MACRC,QACIC,MAAO,WCQT,MDRYC,QAAOC,WAAa,KAC9BC,OAAQ,WCUV,MDVaF,QAAOG,YAAc,OAExCxC,EAAOL,EAAE8C,OAAOnC,EAAUN,GAE1BuB,EAAUxB,EAAU2C,aACiB,IAAlBnB,EAAQoB,QAA3BpB,EAAQqB,SACRzC,EAAUJ,EAAU8C,aACiB,IAAlB1C,EAAQwC,QAA3BxC,EAAQyC,SACRrC,EAAcR,EAAU+C,eACrB/C,EAAUgD,SAASJ,SAClBpC,GAAe,IAAIR,EAAUgD,SAASC,KAAK,MAAM,KACrDrC,EAAA,WCiBE,GAAIC,GAAGG,EAAKkC,CAEZ,KDnBSA,KAAArC,EAAA,EAAAG,EAAAQ,EAAAoB,OAAA5B,EAAAH,EAAAA,ICoBPH,EAAIc,EAAQX,GDpBLqC,EAAAL,KAAAnC,EAAEuC,KAAK,KCuBhB,OAAOC,MDtBTtC,EAAQuC,QAAQ,IAEhBjC,EAAkB,EACF,iBAAbpB,EAAH,CACIO,KACAe,EAAApB,EAAAoD,IAAA,KAAApB,IAAAZ,GAAA,CCyBAM,EAAQN,EAAIY,EDxBR,KAAAD,IAAAL,GC0BFxB,EAAMwB,EAAMK,GDzBL1B,EAAUwC,MACPQ,WAAWtB,GACXsB,WAAWrB,GACXxB,EAAY,OAAON,EAAIoD,OAAOpD,EAAIqD,WAE9CjD,EAAgB,GAAAkD,QAAOC,cAAcC,UACrCpD,EAAUqD,UAAU,SAAU3D,EAAU4D,SAASX,KAAK,MACtD3C,EAAUqD,UAAU,SAAU3D,EAAU6D,SAASZ,KAAK,MACtD3C,EAAUqD,WAAUG,KAAM,SAAUC,KAAM,YAC1CzD,EAAU0D,QAAQ3D,GAClBM,EAAaX,EAAU4D,SAASX,KAAK,KACrCrB,EAAa5B,EAAU6D,SAASZ,KAAK,KACrCxB,EAAQ,OAhBZ,CAmBI,IADApB,GAAaO,GACbC,EAAA,EAAAG,EAAAZ,EAAAwC,OAAA5B,EAAAH,EAAAA,IAAA,CAGI,ICyBJV,EAASC,EAAQS,GD3BbS,GAAOnB,EAAO8C,KAAK,MACnB/B,GAAmBI,EAAI,GAAGsB,OAC1B9B,EAAA,EAAAG,EAAAO,EAAAoB,OAAA3B,EAAAH,EAAAA,IC6BFS,EAASC,EAAQV,GD5BXZ,EAAMF,EAAUiE,cAAc1C,EAAQpB,GACnC,MAAAD,EAAAqD,SACC1B,EAAM3B,EAAIqD,QAGFjC,EAAIuB,KAFTjD,EAAEsE,UAAUrC,GACF,EAANA,EACUwB,WAAWxB,EAAIsC,YAAY,IAE3Bd,WAAWxB,EAAIuC,QAAQ,IAE3BvC,IACZP,EAAIuB,KAAK,KAClBxC,GAAUwC,KAAKvB,GAEnBhB,EAAYkD,OAAOC,cAAcY,iBAAiBhE,GAElDoB,EAAQG,EAAapB,EACrBG,EAAaX,EAAU4D,SAASX,KAAK,KAC+B,KAAdtC,IAAtDc,GAAS,IAAIxB,EAAKgC,cAAcC,GAAG,IAAGvB,GACtCF,EAAeT,EAAU6D,SAASZ,KAAK,KACiC,KAAhBxC,IAAxDgB,GAAS,IAAIxB,EAAKgC,cAAcE,GAAG,IAAG1B,GAE1CU,GACIkB,MAAOpC,EAAKmC,OAAOC,QACnBG,OAAQvC,EAAKmC,OAAOI,SACpBf,MAAOA,EACP6C,OAAQ7C,MAAOd,EAAY4D,YAAarD,EAAkB,IAC1DsD,OAAQ/C,MAAOG,GACf6C,SAAWC,WAAaC,SAAU,QAASC,SAAU,MAEzC,gBAAb9E,IACCqB,EAAQqD,MAAMK,SAAW,GAEb,iBAAb/E,GACCqB,EAAQ2D,QAASC,SAAU,QAC3B5D,EAAQ6D,WAAa3C,MAAS,MAAOG,OAAU,QAEpB,IAAvBnC,EAAU,GAAGuC,QAAoC,KAApBvC,EAAU,GAAG,KAC9Cc,EAAQ2D,QAASC,SAAU,QAE/B,KAAAhE,IAAAhB,GCsDE4B,EAAI5B,EAAagB,GDtDnBI,EAAQJ,GAAKY,CAUb,OARAN,GAASzB,EAAE,SAASqF,KAAI5C,MAAO,OAAQG,OAAQ,SAC/CV,EAAc,GAAA0B,QAAOC,cAAcyB,cAAc5E,UAAAA,EAAWR,UAAAA,EAAWqB,QAAAA,IACvEW,EAAQqD,KAAK9D,EAAO,IACpBA,EAAO+D,KAAK,WAAY,WACpB,GAAAC,ECmEF,ODnEEA,GAAa,GAAA7B,QAAOC,cAAc6B,YAClC9B,OAAOC,cAAc8B,OAAOC,YAAYH,EAAQ,KAAM,WCgEtD,MD/DIA,GAAOI,kBAAkBN,KAAK9D,EAAO,MACzCgE,EAAOK,WAAW5D,KACfT,IAEXzB,EAAE+F,eAAeC,kBACbC,aAAchG,EAAgB,aAC9BiG,YAAajG,EAAgB,eAC7BkG,oBAAqBlG,EAAgB,eAAemG,WAAW,IAC/DC,aAAcpG,EAAgB,aAAamG,WAAW,IACtDE,gBAAiBrG,EAAgB,qBC0EtCsG,KAAKC","file":"gchart_renderers.min.js","sourcesContent":["callWithJQuery = (pivotModule) ->\n    if typeof exports is \"object\" and typeof module is \"object\" # CommonJS\n        pivotModule require(\"jquery\")\n    else if typeof define is \"function\" and define.amd # AMD\n        define [\"jquery\"], pivotModule\n    # Plain browser env\n    else\n        pivotModule jQuery\n        \ncallWithJQuery ($) ->\n\n    makeGoogleChart = (chartType, extraOptions) -> (pivotData, opts) ->\n        defaults =\n            localeStrings:\n                vs: \"vs\"\n                by: \"by\"\n            gchart:\n                width: -> window.innerWidth / 1.4\n                height: -> window.innerHeight / 1.4\n\n        opts = $.extend defaults, opts\n\n        rowKeys = pivotData.getRowKeys()\n        rowKeys.push [] if rowKeys.length == 0\n        colKeys = pivotData.getColKeys()\n        colKeys.push [] if colKeys.length == 0\n        fullAggName = pivotData.aggregatorName \n        if pivotData.valAttrs.length\n            fullAggName += \"(#{pivotData.valAttrs.join(\", \")})\"\n        headers = (h.join(\"-\") for h in rowKeys)\n        headers.unshift \"\"\n\n        numCharsInHAxis = 0\n        if chartType == \"ScatterChart\"\n            dataArray = []\n            for y, tree2 of pivotData.tree\n                for x, agg of tree2\n                     dataArray.push [\n                        parseFloat(x),\n                        parseFloat(y),\n                        fullAggName+\": \\n\"+agg.format(agg.value())\n                        ]\n            dataTable = new google.visualization.DataTable()\n            dataTable.addColumn 'number', pivotData.colAttrs.join(\"-\")\n            dataTable.addColumn 'number', pivotData.rowAttrs.join(\"-\") \n            dataTable.addColumn type: \"string\", role: \"tooltip\"\n            dataTable.addRows dataArray\n            hAxisTitle = pivotData.colAttrs.join(\"-\")\n            vAxisTitle = pivotData.rowAttrs.join(\"-\")\n            title = \"\"\n        else\n            dataArray = [headers]\n            for colKey in colKeys\n                row = [colKey.join(\"-\")]\n                numCharsInHAxis += row[0].length\n                for rowKey in rowKeys\n                    agg = pivotData.getAggregator(rowKey, colKey)\n                    if agg.value()?\n                        val = agg.value()\n                        if $.isNumeric val\n                            if val < 1\n                                row.push parseFloat(val.toPrecision(3))\n                            else\n                                row.push parseFloat(val.toFixed(3))\n                        else\n                            row.push val\n                    else row.push null\n                dataArray.push row\n\n            dataTable = google.visualization.arrayToDataTable(dataArray)\n\n            title = vAxisTitle = fullAggName\n            hAxisTitle = pivotData.colAttrs.join(\"-\")\n            title += \" #{opts.localeStrings.vs} #{hAxisTitle}\" if hAxisTitle != \"\"\n            groupByTitle = pivotData.rowAttrs.join(\"-\")\n            title += \" #{opts.localeStrings.by} #{groupByTitle}\" if groupByTitle != \"\"\n\n        options = \n            width: opts.gchart.width()\n            height: opts.gchart.height()\n            title: title\n            hAxis: {title: hAxisTitle, slantedText: numCharsInHAxis > 50}\n            vAxis: {title: vAxisTitle}\n            tooltip: { textStyle: { fontName: 'Arial', fontSize: 12 } }\n\n        if chartType == \"ColumnChart\"\n            options.vAxis.minValue = 0\n\n        if chartType == \"ScatterChart\"\n            options.legend = position: \"none\"\n            options.chartArea = {'width': '80%', 'height': '80%'}\n\n        else if dataArray[0].length == 2 and dataArray[0][1] ==  \"\"\n            options.legend = position: \"none\"\n\n        options[k] = v for k, v of extraOptions\n\n        result = $(\"<div>\").css(width: \"100%\", height: \"100%\")\n        wrapper = new google.visualization.ChartWrapper {dataTable, chartType, options}\n        wrapper.draw(result[0])    \n        result.bind \"dblclick\", -> \n            editor = new google.visualization.ChartEditor()\n            google.visualization.events.addListener editor, 'ok', -> \n                editor.getChartWrapper().draw(result[0])\n            editor.openDialog(wrapper)\n        return result\n\n    $.pivotUtilities.gchart_renderers = \n        \"Line Chart\": makeGoogleChart(\"LineChart\")\n        \"Bar Chart\": makeGoogleChart(\"ColumnChart\")\n        \"Stacked Bar Chart\": makeGoogleChart(\"ColumnChart\", isStacked: true)\n        \"Area Chart\": makeGoogleChart(\"AreaChart\", isStacked: true)\n        \"Scatter Chart\": makeGoogleChart(\"ScatterChart\")\n","(function(){var t;(t=function(t){return\"object\"==typeof exports&&\"object\"==typeof module?t(require(\"jquery\")):\"function\"==typeof define&&define.amd?define([\"jquery\"],t):t(jQuery)})(function(t){var e;return e=function(e,r){return function(n,i){var o,a,l,h,s,u,g,d,c,f,p,v,C,w,A,m,y,j,b,S,x,z,T,k,F,q,D,L,N,W,B;if(u={localeStrings:{vs:\"vs\",by:\"by\"},gchart:{width:function(){return window.innerWidth/1.4},height:function(){return window.innerHeight/1.4}}},i=t.extend(u,i),T=n.getRowKeys(),0===T.length&&T.push([]),l=n.getColKeys(),0===l.length&&l.push([]),g=n.aggregatorName,n.valAttrs.length&&(g+=\"(\"+n.valAttrs.join(\", \")+\")\"),p=function(){var t,e,r;for(r=[],t=0,e=T.length;e>t;t++)c=T[t],r.push(c.join(\"-\"));return r}(),p.unshift(\"\"),y=0,\"ScatterChart\"===e){h=[],b=n.tree;for(B in b){F=b[B];for(W in F)o=F[W],h.push([parseFloat(W),parseFloat(B),g+\": \\n\"+o.format(o.value())])}s=new google.visualization.DataTable,s.addColumn(\"number\",n.colAttrs.join(\"-\")),s.addColumn(\"number\",n.rowAttrs.join(\"-\")),s.addColumn({type:\"string\",role:\"tooltip\"}),s.addRows(h),f=n.colAttrs.join(\"-\"),D=n.rowAttrs.join(\"-\"),k=\"\"}else{for(h=[p],v=0,A=l.length;A>v;v++){for(a=l[v],x=[a.join(\"-\")],y+=x[0].length,C=0,m=T.length;m>C;C++)z=T[C],o=n.getAggregator(z,a),null!=o.value()?(L=o.value(),x.push(t.isNumeric(L)?1>L?parseFloat(L.toPrecision(3)):parseFloat(L.toFixed(3)):L)):x.push(null);h.push(x)}s=google.visualization.arrayToDataTable(h),k=D=g,f=n.colAttrs.join(\"-\"),\"\"!==f&&(k+=\" \"+i.localeStrings.vs+\" \"+f),d=n.rowAttrs.join(\"-\"),\"\"!==d&&(k+=\" \"+i.localeStrings.by+\" \"+d)}j={width:i.gchart.width(),height:i.gchart.height(),title:k,hAxis:{title:f,slantedText:y>50},vAxis:{title:D},tooltip:{textStyle:{fontName:\"Arial\",fontSize:12}}},\"ColumnChart\"===e&&(j.vAxis.minValue=0),\"ScatterChart\"===e?(j.legend={position:\"none\"},j.chartArea={width:\"80%\",height:\"80%\"}):2===h[0].length&&\"\"===h[0][1]&&(j.legend={position:\"none\"});for(w in r)q=r[w],j[w]=q;return S=t(\"<div>\").css({width:\"100%\",height:\"100%\"}),N=new google.visualization.ChartWrapper({dataTable:s,chartType:e,options:j}),N.draw(S[0]),S.bind(\"dblclick\",function(){var t;return t=new google.visualization.ChartEditor,google.visualization.events.addListener(t,\"ok\",function(){return t.getChartWrapper().draw(S[0])}),t.openDialog(N)}),S}},t.pivotUtilities.gchart_renderers={\"Line Chart\":e(\"LineChart\"),\"Bar Chart\":e(\"ColumnChart\"),\"Stacked Bar Chart\":e(\"ColumnChart\",{isStacked:!0}),\"Area Chart\":e(\"AreaChart\",{isStacked:!0}),\"Scatter Chart\":e(\"ScatterChart\")}})}).call(this);\n//# sourceMappingURL=gchart_renderers.min.js.map"],"sourceRoot":"/source/"}