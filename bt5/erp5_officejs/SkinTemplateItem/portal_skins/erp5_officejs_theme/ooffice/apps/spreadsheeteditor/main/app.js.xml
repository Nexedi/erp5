<?xml version="1.0"?>
<ZopeData>
  <record id="1" aka="AAAAAAAAAAE=">
    <pickle>
      <global name="File" module="OFS.Image"/>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>_EtagSupport__etag</string> </key>
            <value> <string>ts50885461.09</string> </value>
        </item>
        <item>
            <key> <string>__name__</string> </key>
            <value> <string>app.js</string> </value>
        </item>
        <item>
            <key> <string>content_type</string> </key>
            <value> <string>application/javascript</string> </value>
        </item>
        <item>
            <key> <string>data</string> </key>
            <value>
              <persistent> <string encoding="base64">AAAAAAAAAAI=</string> </persistent>
            </value>
        </item>
        <item>
            <key> <string>precondition</string> </key>
            <value> <string></string> </value>
        </item>
        <item>
            <key> <string>size</string> </key>
            <value> <int>981571</int> </value>
        </item>
        <item>
            <key> <string>title</string> </key>
            <value> <string></string> </value>
        </item>
      </dictionary>
    </pickle>
  </record>
  <record id="2" aka="AAAAAAAAAAI=">
    <pickle>
      <global name="Pdata" module="OFS.Image"/>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>data</string> </key>
            <value> <string encoding="cdata"><![CDATA[

/*\n
 * Copyright (c) Ascensio System SIA 2015. All rights reserved\n
 *\n
 * http://www.onlyoffice.com \n
 *\n
 * Version: 3.0.0 (build:859, rev:cb3d33b\n
, date:Fri Dec 18 22:30:55 2015 +0300\n
)\n
 */\n
function onDropDownKeyDown(e){var t=$(this),n=t.parent(),r=jQuery.Event("keydown.before.bs.dropdown"),i=jQuery.Event("keydown.after.bs.dropdown");n.trigger(r);if(r.isDefaultPrevented())return;patchDropDownKeyDown.call(this,e),e.preventDefault(),e.stopPropagation(),n.trigger(i)}function patchDropDownKeyDown(e){if(!/(38|40|27)/.test(e.keyCode))return;var t=$(this);e.preventDefault(),e.stopPropagation();if(t.is(".disabled, :disabled"))return;var n=getParent(t),r=n.hasClass("open");if(!r||r&&e.keyCode==27){if(e.which==27){i=$("[role=menu] li.dropdown-submenu.over:visible",n);if(i.size())return i.eq(i.size()-1).removeClass("over"),!1;n.find("[data-toggle=dropdown]").focus()}return t.click()}var i=$("[role=menu] li:not(.divider):not(.disabled):visible",n).find("> a");if(!i.length)return;var s=i.index(i.filter(":focus"));e.keyCode==38?s>0?s--:s=i.length-1:e.keyCode==40&&(s<i.length-1?s++:s=0),~s||(s=0),i.eq(s).focus()}function getParent(e){var t=e.attr("data-target");t||(t=e.attr("href"),t=t&&/#/.test(t)&&t.replace(/.*(?=#[^\\s]*$)/,""));var n=t&&$(t);return n&&n.length?n:e.parent()}(function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.5.2";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else{var o=x.keys(e);for(var i=0,s=o.length;i<s;i++)if(t.call(r,e[o[i]],o[i],e)===n)return}};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r.push(t.call(n,e,i,s))}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&r.push(e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?void 0:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r},x.sample=function(e,t,n){return arguments.length<2||n?e[x.random(e.length-1)]:x.shuffle(e).slice(0,Math.max(0,t))};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index-t.index}),"value")};var L=function(e){return function(t,n,r){var i={},s=n==null?x.identity:k(n);return T(t,function(n,o){var u=s.call(r,n,o,t);e(i,u,n)}),i}};x.groupBy=L(function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)}),x.indexBy=L(function(e,t,n){e[t]=n}),x.countBy=L(function(e,t){x.has(e,t)?e[t]++:e[t]=1}),x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t==null||n?e[0]:u.call(e,0,t)},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t==null||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return t&&x.every(e,x.isArray)?a.apply(n,e):(T(e,function(e){x.isArray(e)||x.isArguments(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n)};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(x.flatten(arguments,!0))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=x.max(x.pluck(arguments,"length").concat(0)),t=new Array(e);for(var n=0;n<e;n++)t[n]=x.pluck(arguments,""+n);return t},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s};var O=function(){};x.bind=function(e,t){var n,r;if(S&&e.bind===S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);if(t.length===0)throw new Error("bindAll must be passed function names");return T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:new Date,o=null,s=e.apply(r,i)};return function(){var f=new Date;!u&&n.leading===!1&&(u=f);var l=t-(f-u);return r=this,i=arguments,l<=0?(clearTimeout(o),o=null,u=f,s=e.apply(r,i)):!o&&n.trailing!==!1&&(o=setTimeout(a,l)),s}},x.debounce=function(e,t,n){var r,i,s,o,u;return function(){s=this,i=arguments,o=new Date;var a=function(){var f=new Date-o;f<t?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i)))},f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i)),u}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&t.push(n);return t},x.values=function(e){var t=x.keys(e),n=t.length,r=new Array(n);for(var i=0;i<n;i++)r[i]=e[t[i]];return r},x.pairs=function(e){var t=x.keys(e),n=t.length,r=new Array(n);for(var i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},x.invert=function(e){var t={},n=x.keys(e);for(var r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]===void 0&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;var o=e.constructor,u=t.constructor;if(o!==u&&!(x.isFunction(o)&&o instanceof o&&x.isFunction(u)&&u instanceof u))return!1;n.push(e),r.push(t);var a=0,l=!0;if(i=="[object Array]"){a=e.length,l=a==t.length;if(l)while(a--)if(!(l=M(e[a],t[a],n,r)))break}else{for(var c in e)if(x.has(e,c)){a++;if(!(l=x.has(t,c)&&M(e[c],t[c],n,r)))break}if(l){for(c in t)if(x.has(t,c)&&!(a--))break;l=!a}}return n.pop(),r.pop(),l};x.isEqual=function(e,t){return M(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(Math.max(0,e));for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",\'"\':"&quot;","\'":"&#x27;"}};_.unescape=x.invert(_.escape);var D={escape:new RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),x.result=function(e,t){if(e==null)return void 0;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=++P+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\\s\\S]+?)%>/g,interpolate:/<%=([\\s\\S]+?)%>/g,escape:/<%-([\\s\\S]+?)%>/g};var H=/(.)^/,B={"\'":"\'","\\\\":"\\\\","\\r":"r","\\n":"n","\t":"t","\\u2028":"u2028","\\u2029":"u2029"},j=/\\\\|\'|\\r|\\n|\\t|\\u2028|\\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),s=0,o="__p+=\'";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(j,function(e){return"\\\\"+B[e]}),n&&(o+="\'+\\n((__t=("+n+"))==null?\'\':_.escape(__t))+\\n\'"),r&&(o+="\'+\\n((__t=("+r+"))==null?\'\':__t)+\\n\'"),i&&(o+="\';\\n"+i+"\\n__p+=\'"),s=u+t.length,t}),o+="\';\\n",n.variable||(o="with(obj||{}){\\n"+o+"}\\n"),o="var __t,__p=\'\',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,\'\');};\\n"+o+"return __p;\\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],F.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this),define("underscore",function(e){return function(){var t,n;return t||e._}}(this)),function(window,undefined){function isArraylike(e){var t=e.length,n=jQuery.type(e);return jQuery.isWindow(e)?!1:e.nodeType===1&&t?!0:n==="array"||n!=="function"&&(t===0||typeof t=="number"&&t>0&&t-1 in e)}function createOptions(e){var t=optionsCache[e]={};return jQuery.each(e.match(core_rnotwhite)||[],function(e,n){t[n]=!0}),t}function Data(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=jQuery.expando+Math.random()}function dataAttr(e,t,n){var r;if(n===undefined&&e.nodeType===1){r="data-"+t.replace(rmultiDash,"-$1").toLowerCase(),n=e.getAttribute(r);if(typeof n=="string"){try{n=n==="true"?!0:n==="false"?!1:n==="null"?null:+n+""===n?+n:rbrace.test(n)?JSON.parse(n):n}catch(i){}data_user.set(e,t,n)}else n=undefined}return n}function returnTrue(){return!0}function returnFalse(){return!1}function safeActiveElement(){try{return document.activeElement}catch(e){}}function sibling(e,t){while((e=e[t])&&e.nodeType!==1);return e}function winnow(e,t,n){if(jQuery.isFunction(t))return jQuery.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return jQuery.grep(e,function(e){return e===t!==n});if(typeof t=="string"){if(isSimple.test(t))return jQuery.filter(t,e,n);t=jQuery.filter(t,e)}return jQuery.grep(e,function(e){return core_indexOf.call(t,e)>=0!==n})}function manipulationTarget(e,t){return jQuery.nodeName(e,"table")&&jQuery.nodeName(t.nodeType===1?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function disableScript(e){return e.type=(e.getAttribute("type")!==null)+"/"+e.type,e}function restoreScript(e){var t=rscriptTypeMasked.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function setGlobalEval(e,t){var n=e.length,r=0;for(;r<n;r++)data_priv.set(e[r],"globalEval",!t||data_priv.get(t[r],"globalEval"))}function cloneCopyEvent(e,t){var n,r,i,s,o,u,a,f;if(t.nodeType!==1)return;if(data_priv.hasData(e)){s=data_priv.access(e),o=data_priv.set(t,s),f=s.events;if(f){delete o.handle,o.events={};for(i in f)for(n=0,r=f[i].length;n<r;n++)jQuery.event.add(t,i,f[i][n])}}data_user.hasData(e)&&(u=data_user.access(e),a=jQuery.extend({},u),data_user.set(t,a))}function getAll(e,t){var n=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return t===undefined||t&&jQuery.nodeName(e,t)?jQuery.merge([e],n):n}function fixInput(e,t){var n=t.nodeName.toLowerCase();if(n==="input"&&manipulation_rcheckableType.test(e.type))t.checked=e.checked;else if(n==="input"||n==="textarea")t.defaultValue=e.defaultValue}function vendorPropName(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=cssPrefixes.length;while(i--){t=cssPrefixes[i]+n;if(t in e)return t}return r}function isHidden(e,t){return e=t||e,jQuery.css(e,"display")==="none"||!jQuery.contains(e.ownerDocument,e)}function getStyles(e){return window.getComputedStyle(e,null)}function showHide(e,t){var n,r,i,s=[],o=0,u=e.length;for(;o<u;o++){r=e[o];if(!r.style)continue;s[o]=data_priv.get(r,"olddisplay"),n=r.style.display,t?(!s[o]&&n==="none"&&(r.style.display=""),r.style.display===""&&isHidden(r)&&(s[o]=data_priv.access(r,"olddisplay",css_defaultDisplay(r.nodeName)))):s[o]||(i=isHidden(r),(n&&n!=="none"||!i)&&data_priv.set(r,"olddisplay",i?n:jQuery.css(r,"display")))}for(o=0;o<u;o++){r=e[o];if(!r.style)continue;if(!t||r.style.display==="none"||r.style.display==="")r.style.display=t?s[o]||"":"none"}return e}function setPositiveNumber(e,t,n){var r=rnumsplit.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function augmentWidthOrHeight(e,t,n,r,i){var s=n===(r?"border":"content")?4:t==="width"?1:0,o=0;for(;s<4;s+=2)n==="margin"&&(o+=jQuery.css(e,n+cssExpand[s],!0,i)),r?(n==="content"&&(o-=jQuery.css(e,"padding"+cssExpand[s],!0,i)),n!=="margin"&&(o-=jQuery.css(e,"border"+cssExpand[s]+"Width",!0,i))):(o+=jQuery.css(e,"padding"+cssExpand[s],!0,i),n!=="padding"&&(o+=jQuery.css(e,"border"+cssExpand[s]+"Width",!0,i)));return o}function getWidthOrHeight(e,t,n){var r=!0,i=t==="width"?e.offsetWidth:e.offsetHeight,s=getStyles(e),o=jQuery.support.boxSizing&&jQuery.css(e,"boxSizing",!1,s)==="border-box";if(i<=0||i==null){i=curCSS(e,t,s);if(i<0||i==null)i=e.style[t];if(rnumnonpx.test(i))return i;r=o&&(jQuery.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+augmentWidthOrHeight(e,t,n||(o?"border":"content"),r,s)+"px"}function css_defaultDisplay(e){var t=document,n=elemdisplay[e];if(!n){n=actualDisplay(e,t);if(n==="none"||!n)iframe=(iframe||jQuery("<iframe frameborder=\'0\' width=\'0\' height=\'0\'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(iframe[0].contentWindow||iframe[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=actualDisplay(e,t),iframe.detach();elemdisplay[e]=n}return n}function actualDisplay(e,t){var n=jQuery(t.createElement(e)).appendTo(t.body),r=jQuery.css(n[0],"display");return n.remove(),r}function buildParams(e,t,n,r){var i;if(jQuery.isArray(t))jQuery.each(t,function(t,i){n||rbracket.test(e)?r(e,i):buildParams(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&jQuery.type(t)==="object")for(i in t)buildParams(e+"["+i+"]",t[i],n,r);else r(e,t)}function addToPrefiltersOrTransports(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(core_rnotwhite)||[];if(jQuery.isFunction(n))while(r=s[i++])r[0]==="+"?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function inspectPrefiltersOrTransports(e,t,n,r){function o(u){var a;return i[u]=!0,jQuery.each(e[u]||[],function(e,u){var f=u(t,n,r);if(typeof f=="string"&&!s&&!i[f])return t.dataTypes.unshift(f),o(f),!1;if(s)return!(a=f)}),a}var i={},s=e===transports;return o(t.dataTypes[0])||!i["*"]&&o("*")}function ajaxExtend(e,t){var n,r,i=jQuery.ajaxSettings.flatOptions||{};for(n in t)t[n]!==undefined&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&jQuery.extend(!0,e,r),e}function ajaxHandleResponses(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while(a[0]==="*")a.shift(),r===undefined&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in u)if(u[i]&&u[i].test(r)){a.unshift(i);break}if(a[0]in n)s=a[0];else{for(i in n){if(!a[0]||e.converters[i+" "+a[0]]){s=i;break}o||(o=i)}s=s||o}if(s)return s!==a[0]&&a.unshift(s),n[s]}function ajaxConvert(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s){e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift();if(s)if(s==="*")s=a;else if(a!=="*"&&a!==s){o=f[a+" "+s]||f["* "+s];if(!o)for(i in f){u=i.split(" ");if(u[1]===s){o=f[a+" "+u[0]]||f["* "+u[0]];if(o){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}}}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}}return{state:"success",data:t}}function createFxNow(){return setTimeout(function(){fxNow=undefined}),fxNow=jQuery.now()}function createTween(e,t,n){var r,i=(tweeners[t]||[]).concat(tweeners["*"]),s=0,o=i.length;for(;s<o;s++)if(r=i[s].call(n,t,e))return r}function Animation(e,t,n){var r,i,s=0,o=animationPrefilters.length,u=jQuery.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;var t=fxNow||createFxNow(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;for(;o<a;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),s<1&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:jQuery.extend({},t),opts:jQuery.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:fxNow||createFxNow(),duration:n.duration,tweens:[],createTween:function(t,n){var r=jQuery.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;i=!0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;propFilter(l,f.opts.specialEasing);for(;s<o;s++){r=animationPrefilters[s].call(f,e,l,f.opts);if(r)return r}return jQuery.map(l,createTween,f),jQuery.isFunction(f.opts.start)&&f.opts.start.call(e,f),jQuery.fx.timer(jQuery.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function propFilter(e,t){var n,r,i,s,o;for(n in e){r=jQuery.camelCase(n),i=t[r],s=e[n],jQuery.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=jQuery.cssHooks[r];if(o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}}function defaultPrefilter(e,t,n){var r,i,s,o,u,a,f=this,l={},c=e.style,h=e.nodeType&&isHidden(e),p=data_priv.get(e,"fxshow");n.queue||(u=jQuery._queueHooks(e,"fx"),u.unqueued==null&&(u.unqueued=0,a=u.empty.fire,u.empty.fire=function(){u.unqueued||a()}),u.unqueued++,f.always(function(){f.always(function(){u.unqueued--,jQuery.queue(e,"fx").length||u.empty.fire()})})),e.nodeType===1&&("height"in t||"width"in t)&&(n.overflow=[c.overflow,c.overflowX,c.overflowY],jQuery.css(e,"display")==="inline"&&jQuery.css(e,"float")==="none"&&(c.display="inline-block")),n.overflow&&(c.overflow="hidden",f.always(function(){c.overflow=n.overflow[0],c.overflowX=n.overflow[1],c.overflowY=n.overflow[2]}));for(r in t){i=t[r];if(rfxtypes.exec(i)){delete t[r],s=s||i==="toggle";if(i===(h?"hide":"show")){if(i!=="show"||!p||p[r]===undefined)continue;h=!0}l[r]=p&&p[r]||jQuery.style(e,r)}}if(!jQuery.isEmptyObject(l)){p?"hidden"in p&&(h=p.hidden):p=data_priv.access(e,"fxshow",{}),s&&(p.hidden=!h),h?jQuery(e).show():f.done(function(){jQuery(e).hide()}),f.done(function(){var t;data_priv.remove(e,"fxshow");for(t in l)jQuery.style(e,t,l[t])});for(r in l)o=createTween(h?p[r]:0,r,f),r in p||(p[r]=o.start,h&&(o.end=o.start,o.start=r==="width"||r==="height"?1:0))}}function Tween(e,t,n,r,i){return new Tween.prototype.init(e,t,n,r,i)}function genFx(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)n=cssExpand[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function getWindow(e){return jQuery.isWindow(e)?e:e.nodeType===9&&e.defaultView}var rootjQuery,readyList,core_strundefined=typeof undefined,location=window.location,document=window.document,docElem=document.documentElement,_jQuery=window.jQuery,_$=window.$,class2type={},core_deletedIds=[],core_version="2.0.3",core_concat=core_deletedIds.concat,core_push=core_deletedIds.push,core_slice=core_deletedIds.slice,core_indexOf=core_deletedIds.indexOf,core_toString=class2type.toString,core_hasOwn=class2type.hasOwnProperty,core_trim=core_version.trim,jQuery=function(e,t){return new jQuery.fn.init(e,t,rootjQuery)},core_pnum=/[+-]?(?:\\d*\\.|)\\d+(?:[eE][+-]?\\d+|)/.source,core_rnotwhite=/\\S+/g,rquickExpr=/^(?:\\s*(<[\\w\\W]+>)[^>]*|#([\\w-]*))$/,rsingleTag=/^<(\\w+)\\s*\\/?>(?:<\\/\\1>|)$/,rmsPrefix=/^-ms-/,rdashAlpha=/-([\\da-z])/gi,fcamelCase=function(e,t){return t.toUpperCase()},completed=function(){document.removeEventListener("DOMContentLoaded",completed,!1),window.removeEventListener("load",completed,!1),jQuery.ready()};jQuery.fn=jQuery.prototype={jquery:core_version,constructor:jQuery,init:function(e,t,n){var r,i;if(!e)return this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?r=[null,e,null]:r=rquickExpr.exec(e);if(r&&(r[1]||!t)){if(r[1]){t=t instanceof jQuery?t[0]:t,jQuery.merge(this,jQuery.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:document,!0));if(rsingleTag.test(r[1])&&jQuery.isPlainObject(t))for(r in t)jQuery.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return i=document.getElementById(r[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=document,this.selector=e,this}return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e)}return e.nodeType?(this.context=this[0]=e,this.length=1,this):jQuery.isFunction(e)?n.ready(e):(e.selector!==undefined&&(this.selector=e.selector,this.context=e.context),jQuery.makeArray(e,this))},selector:"",length:0,toArray:function(){return core_slice.call(this)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e){var t=jQuery.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return jQuery.each(this,e,t)},ready:function(e){return jQuery.ready.promise().done(e),this},slice:function(){return this.pushStack(core_slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},map:function(e){return this.pushStack(jQuery.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:core_push,sort:[].sort,splice:[].splice},jQuery.fn.init.prototype=jQuery.fn,jQuery.extend=jQuery.fn.extend=function(){var e,t,n,r,i,s,o=arguments[0]||{},u=1,a=arguments.length,f=!1;typeof o=="boolean"&&(f=o,o=arguments[1]||{},u=2),typeof o!="object"&&!jQuery.isFunction(o)&&(o={}),a===u&&(o=this,--u);for(;u<a;u++)if((e=arguments[u])!=null)for(t in e){n=o[t],r=e[t];if(o===r)continue;f&&r&&(jQuery.isPlainObject(r)||(i=jQuery.isArray(r)))?(i?(i=!1,s=n&&jQuery.isArray(n)?n:[]):s=n&&jQuery.isPlainObject(n)?n:{},o[t]=jQuery.extend(f,s,r)):r!==undefined&&(o[t]=r)}return o},jQuery.extend({expando:"jQuery"+(core_version+Math.random()).replace(/\\D/g,""),noConflict:function(e){return window.$===jQuery&&(window.$=_$),e&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},isReady:!1,readyWait:1,holdReady:function(e){e?jQuery.readyWait++:jQuery.ready(!0)},ready:function(e){if(e===!0?--jQuery.readyWait:jQuery.isReady)return;jQuery.isReady=!0;if(e!==!0&&--jQuery.readyWait>0)return;readyList.resolveWith(document,[jQuery]),jQuery.fn.trigger&&jQuery(document).trigger("ready").off("ready")},isFunction:function(e){return jQuery.type(e)==="function"},isArray:Array.isArray,isWindow:function(e){return e!=null&&e===e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):typeof e=="object"||typeof e=="function"?class2type[core_toString.call(e)]||"object":typeof e},isPlainObject:function(e){if(jQuery.type(e)!=="object"||e.nodeType||jQuery.isWindow(e))return!1;try{if(e.constructor&&!core_hasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){if(!e||typeof e!="string")return null;typeof t=="boolean"&&(n=t,t=!1),t=t||document;var r=rsingleTag.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=jQuery.buildFragment([e],t,i),i&&jQuery(i).remove(),jQuery.merge([],r.childNodes))},parseJSON:JSON.parse,parseXML:function(e){var t,n;if(!e||typeof e!="string")return null;try{n=new DOMParser,t=n.parseFromString(e,"text/xml")}catch(r){t=undefined}return(!t||t.getElementsByTagName("parsererror").length)&&jQuery.error("Invalid XML: "+e),t},noop:function(){},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code),code&&(code.indexOf("use strict")===1?(script=document.createElement("script"),script.text=code,document.head.appendChild(script).parentNode.removeChild(script)):indirect(code))},camelCase:function(e){return e.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=isArraylike(e);if(n)if(o)for(;i<s;i++){r=t.apply(e[i],n);if(r===!1)break}else for(i in e){r=t.apply(e[i],n);if(r===!1)break}else if(o)for(;i<s;i++){r=t.call(e[i],i,e[i]);if(r===!1)break}else for(i in e){r=t.call(e[i],i,e[i]);if(r===!1)break}return e},trim:function(e){return e==null?"":core_trim.call(e)},makeArray:function(e,t){var n=t||[];return e!=null&&(isArraylike(Object(e))?jQuery.merge(n,typeof e=="string"?[e]:e):core_push.call(n,e)),n},inArray:function(e,t,n){return t==null?-1:core_indexOf.call(t,e,n)},merge:function(e,t){var n=t.length,r=e.length,i=0;if(typeof n=="number")for(;i<n;i++)e[r++]=t[i];else while(t[i]!==undefined)e[r++]=t[i++];return e.length=r,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;n=!!n;for(;s<o;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,t,n){var r,i=0,s=e.length,o=isArraylike(e),u=[];if(o)for(;i<s;i++)r=t(e[i],i,n),r!=null&&(u[u.length]=r);else for(i in e)r=t(e[i],i,n),r!=null&&(u[u.length]=r);return core_concat.apply([],u)},guid:1,proxy:function(e,t){var n,r,i;return typeof t=="string"&&(n=e[t],t=e,e=n),jQuery.isFunction(e)?(r=core_slice.call(arguments,2),i=function(){return e.apply(t||this,r.concat(core_slice.call(arguments)))},i.guid=e.guid=e.guid||jQuery.guid++,i):undefined},access:function(e,t,n,r,i,s,o){var u=0,a=e.length,f=n==null;if(jQuery.type(n)==="object"){i=!0;for(u in n)jQuery.access(e,t,u,n[u],!0,s,o)}else if(r!==undefined){i=!0,jQuery.isFunction(r)||(o=!0),f&&(o?(t.call(e,r),t=null):(f=t,t=function(e,t,n){return f.call(jQuery(e),n)}));if(t)for(;u<a;u++)t(e[u],n,o?r:r.call(e[u],u,t(e[u],n)))}return i?e:f?t.call(e):a?t(e[0],n):s},now:Date.now,swap:function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i}}),jQuery.ready.promise=function(e){return readyList||(readyList=jQuery.Deferred(),document.readyState==="complete"?setTimeout(jQuery.ready):(document.addEventListener("DOMContentLoaded",completed,!1),window.addEventListener("load",completed,!1))),readyList.promise(e)},jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){class2type["[object "+t+"]"]=t.toLowerCase()}),rootjQuery=jQuery(document),function(e,t){function st(e,t,n,i){var s,o,u,a,f,l,p,m,g,E;(t?t.ownerDocument||t:w)!==h&&c(t),t=t||h,n=n||[];if(!e||typeof e!="string")return n;if((a=t.nodeType)!==1&&a!==9)return[];if(d&&!i){if(s=Y.exec(e))if(u=s[1]){if(a===9){o=t.getElementById(u);if(!o||!o.parentNode)return n;if(o.id===u)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(u))&&y(t,o)&&o.id===u)return n.push(o),n}else{if(s[2])return P.apply(n,t.getElementsByTagName(e)),n;if((u=s[3])&&r.getElementsByClassName&&t.getElementsByClassName)return P.apply(n,t.getElementsByClassName(u)),n}if(r.qsa&&(!v||!v.test(e))){m=p=b,g=t,E=a===9&&e;if(a===1&&t.nodeName.toLowerCase()!=="object"){l=vt(e),(p=t.getAttribute("id"))?m=p.replace(tt,"\\\\$&"):t.setAttribute("id",m),m="[id=\'"+m+"\'] ",f=l.length;while(f--)l[f]=m+mt(l[f]);g=V.test(e)&&t.parentNode||t,E=l.join(",")}if(E)try{return P.apply(n,g.querySelectorAll(E)),n}catch(S){}finally{p||t.removeAttribute("id")}}}return Tt(e.replace(z,"$1"),t,n,i)}function ot(){function t(n,r){return e.push(n+=" ")>s.cacheLength&&delete t[e.shift()],t[n]=r}var e=[];return t}function ut(e){return e[b]=!0,e}function at(e){var t=h.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ft(e,t){var n=e.split("|"),r=e.length;while(r--)s.attrHandle[n[r]]=t}function lt(e,t){var n=t&&e,r=n&&e.nodeType===1&&t.nodeType===1&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ct(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function ht(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function pt(e){return ut(function(t){return t=+t,ut(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function dt(){}function vt(e,t){var n,r,i,o,u,a,f,l=T[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=s.preFilter;while(u){if(!n||(r=W.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(i=[]);n=!1;if(r=X.exec(u))n=r.shift(),i.push({value:n,type:r[0].replace(z," ")}),u=u.slice(n.length);for(o in s.filter)(r=Q[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(n=r.shift(),i.push({value:n,type:o,matches:r}),u=u.slice(n.length));if(!n)break}return t?u.length:u?st.error(e):T(e,a).slice(0)}function mt(e){var t=0,n=e.length,r="";for(;t<n;t++)r+=e[t].value;return r}function gt(e,t,n){var r=t.dir,s=n&&r==="parentNode",o=S++;return t.first?function(t,n,i){while(t=t[r])if(t.nodeType===1||s)return e(t,n,i)}:function(t,n,u){var a,f,l,c=E+" "+o;if(u){while(t=t[r])if(t.nodeType===1||s)if(e(t,n,u))return!0}else while(t=t[r])if(t.nodeType===1||s){l=t[b]||(t[b]={});if((f=l[r])&&f[0]===c){if((a=f[1])===!0||a===i)return a===!0}else{f=l[r]=[c],f[1]=e(t,n,u)||i;if(f[1]===!0)return!0}}}}function yt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function bt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function wt(e,t,n,r,i,s){return r&&!r[b]&&(r=wt(r)),i&&!i[b]&&(i=wt(i,s)),ut(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||xt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?bt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=bt(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?B.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=bt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):P.apply(o,g)})}function Et(e){var t,n,r,i=e.length,o=s.relative[e[0].type],u=o||s.relative[" "],a=o?1:0,l=gt(function(e){return e===t},u,!0),c=gt(function(e){return B.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;a<i;a++)if(n=s.relative[e[a].type])h=[gt(yt(h),n)];else{n=s.filter[e[a].type].apply(null,e[a].matches);if(n[b]){r=++a;for(;r<i;r++)if(s.relative[e[r].type])break;return wt(a>1&&yt(h),a>1&&mt(e.slice(0,a-1).concat({value:e[a-2].type===" "?"*":""})).replace(z,"$1"),n,a<r&&Et(e.slice(a,r)),r<i&&Et(e=e.slice(r)),r<i&&mt(e))}h.push(n)}return yt(h)}function St(e,t){var n=0,r=t.length>0,o=e.length>0,u=function(u,a,l,c,p){var d,v,m,g=[],y=0,b="0",w=u&&[],S=p!=null,x=f,T=u||o&&s.find.TAG("*",p&&a.parentNode||a),N=E+=x==null?1:Math.random()||.1;S&&(f=a!==h&&a,i=n);for(;(d=T[b])!=null;b++){if(o&&d){v=0;while(m=e[v++])if(m(d,a,l)){c.push(d);break}S&&(E=N,i=++n)}r&&((d=!m&&d)&&y--,u&&w.push(d))}y+=b;if(r&&b!==y){v=0;while(m=t[v++])m(w,g,a,l);if(u){if(y>0)while(b--)!w[b]&&!g[b]&&(g[b]=_.call(c));g=bt(g)}P.apply(c,g),S&&!u&&g.length>0&&y+t.length>1&&st.uniqueSort(c)}return S&&(E=N,f=x),w};return r?ut(u):u}function xt(e,t,n){var r=0,i=t.length;for(;r<i;r++)st(e,t[r],n);return n}function Tt(e,t,n,i){var o,u,f,l,c,h=vt(e);if(!i&&h.length===1){u=h[0]=h[0].slice(0);if(u.length>2&&(f=u[0]).type==="ID"&&r.getById&&t.nodeType===9&&d&&s.relative[u[1].type]){t=(s.find.ID(f.matches[0].replace(nt,rt),t)||[])[0];if(!t)return n;e=e.slice(u.shift().value.length)}o=Q.needsContext.test(e)?0:u.length;while(o--){f=u[o];if(s.relative[l=f.type])break;if(c=s.find[l])if(i=c(f.matches[0].replace(nt,rt),V.test(u[0].type)&&t.parentNode||t)){u.splice(o,1),e=i.length&&mt(u);if(!e)return P.apply(n,i),n;break}}}return a(e,h)(i,t,!d,n,V.test(e)),n}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b="sizzle"+ -(new Date),w=e.document,E=0,S=0,x=ot(),T=ot(),N=ot(),C=!1,k=function(e,t){return e===t?(C=!0,0):0},L=typeof t,A=1<<31,O={}.hasOwnProperty,M=[],_=M.pop,D=M.push,P=M.push,H=M.slice,B=M.indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},j="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\\\x20\\\\t\\\\r\\\\n\\\\f]",I="(?:\\\\\\\\.|[\\\\w-]|[^\\\\x00-\\\\xa0])+",q=I.replace("w","w#"),R="\\\\["+F+"*("+I+")"+F+"*(?:([*^$|!~]?=)"+F+"*(?:([\'\\"])((?:\\\\\\\\.|[^\\\\\\\\])*?)\\\\3|("+q+")|)|)"+F+"*\\\\]",U=":("+I+")(?:\\\\((([\'\\"])((?:\\\\\\\\.|[^\\\\\\\\])*?)\\\\3|((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|"+R.replace(3,8)+")*)|.*)\\\\)|)",z=new RegExp("^"+F+"+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)"+F+"+$","g"),W=new RegExp("^"+F+"*,"+F+"*"),X=new RegExp("^"+F+"*([>+~]|"+F+")"+F+"*"),V=new RegExp(F+"*[+~]"),$=new RegExp("="+F+"*([^\\\\]\'\\"]*)"+F+"*\\\\]","g"),J=new RegExp(U),K=new RegExp("^"+q+"$"),Q={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\\\.("+I+")"),TAG:new RegExp("^("+I.replace("w","w*")+")"),ATTR:new RegExp("^"+R),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\("+F+"*(even|odd|(([+-]|)(\\\\d*)n|)"+F+"*(?:([+-]|)"+F+"*(\\\\d+)|))"+F+"*\\\\)|)","i"),bool:new RegExp("^(?:"+j+")$","i"),needsContext:new RegExp("^"+F+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\("+F+"*((?:-\\\\d)?\\\\d*)"+F+"*\\\\)|)(?=[^-]|$)","i")},G=/^[^{]+\\{\\s*\\[native \\w/,Y=/^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,Z=/^(?:input|select|textarea|button)$/i,et=/^h\\d$/i,tt=/\'|\\\\/g,nt=new RegExp("\\\\\\\\([\\\\da-f]{1,6}"+F+"?|("+F+")|.)","ig"),rt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,r&1023|56320)};try{P.apply(M=H.call(w.childNodes),w.childNodes),M[w.childNodes.length].nodeType}catch(it){P={apply:M.length?function(e,t){D.apply(e,H.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}u=st.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},r=st.support={},c=st.setDocument=function(e){var t=e?e.ownerDocument||e:w,n=t.defaultView;if(t===h||t.nodeType!==9||!t.documentElement)return h;h=t,p=t.documentElement,d=!u(t),n&&n.attachEvent&&n!==n.top&&n.attachEvent("onbeforeunload",function(){c()}),r.attributes=at(function(e){return e.className="i",!e.getAttribute("className")}),r.getElementsByTagName=at(function(e){return e.appendChild(t.createComment("")),!e.getElementsByTagName("*").length}),r.getElementsByClassName=at(function(e){return e.innerHTML="<div class=\'a\'></div><div class=\'a i\'></div>",e.firstChild.className="i",e.getElementsByClassName("i").length===2}),r.getById=at(function(e){return p.appendChild(e).id=b,!t.getElementsByName||!t.getElementsByName(b).length}),r.getById?(s.find.ID=function(e,t){if(typeof t.getElementById!==L&&d){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},s.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){return e.getAttribute("id")===t}}):(delete s.find.ID,s.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}),s.find.TAG=r.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!==L)return t.getElementsByTagName(e)}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if(e==="*"){while(n=s[i++])n.nodeType===1&&r.push(n);return r}return s},s.find.CLASS=r.getElementsByClassName&&function(e,t){if(typeof t.getElementsByClassName!==L&&d)return t.getElementsByClassName(e)},m=[],v=[];if(r.qsa=G.test(t.querySelectorAll))at(function(e){e.innerHTML="<select><option selected=\'\'></option></select>",e.querySelectorAll("[selected]").length||v.push("\\\\["+F+"*(?:value|"+j+")"),e.querySelectorAll(":checked").length||v.push(":checked")}),at(function(e){var n=t.createElement("input");n.setAttribute("type","hidden"),e.appendChild(n).setAttribute("t",""),e.querySelectorAll("[t^=\'\']").length&&v.push("[*^$]="+F+"*(?:\'\'|\\"\\")"),e.querySelectorAll(":enabled").length||v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")});return(r.matchesSelector=G.test(g=p.webkitMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector||p.msMatchesSelector))&&at(function(e){r.disconnectedMatch=g.call(e,"div"),g.call(e,"[s!=\'\']:x"),m.push("!=",U)}),v=v.length&&new RegExp(v.join("|")),m=m.length&&new RegExp(m.join("|")),y=G.test(p.contains)||p.compareDocumentPosition?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&r.nodeType===1&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&e.compareDocumentPosition(r)&16)}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},k=p.compareDocumentPosition?function(e,n){if(e===n)return C=!0,0;var i=n.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(n);if(i)return i&1||!r.sortDetached&&n.compareDocumentPosition(e)===i?e===t||y(w,e)?-1:n===t||y(w,n)?1:l?B.call(l,e)-B.call(l,n):0:i&4?-1:1;return e.compareDocumentPosition?-1:1}:function(e,n){var r,i=0,s=e.parentNode,o=n.parentNode,u=[e],a=[n];if(e===n)return C=!0,0;if(!s||!o)return e===t?-1:n===t?1:s?-1:o?1:l?B.call(l,e)-B.call(l,n):0;if(s===o)return lt(e,n);r=e;while(r=r.parentNode)u.unshift(r);r=n;while(r=r.parentNode)a.unshift(r);while(u[i]===a[i])i++;return i?lt(u[i],a[i]):u[i]===w?-1:a[i]===w?1:0},t},st.matches=function(e,t){return st(e,null,null,t)},st.matchesSelector=function(e,t){(e.ownerDocument||e)!==h&&c(e),t=t.replace($,"=\'$1\']");if(r.matchesSelector&&d&&(!m||!m.test(t))&&(!v||!v.test(t)))try{var n=g.call(e,t);if(n||r.disconnectedMatch||e.document&&e.document.nodeType!==11)return n}catch(i){}return st(t,h,null,[e]).length>0},st.contains=function(e,t){return(e.ownerDocument||e)!==h&&c(e),y(e,t)},st.attr=function(e,n){(e.ownerDocument||e)!==h&&c(e);var i=s.attrHandle[n.toLowerCase()],o=i&&O.call(s.attrHandle,n.toLowerCase())?i(e,n,!d):t;return o===t?r.attributes||!d?e.getAttribute(n):(o=e.getAttributeNode(n))&&o.specified?o.value:null:o},st.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},st.uniqueSort=function(e){var t,n=[],i=0,s=0;C=!r.detectDuplicates,l=!r.sortStable&&e.slice(0),e.sort(k);if(C){while(t=e[s++])t===e[s]&&(i=n.push(s));while(i--)e.splice(n[i],1)}return e},o=st.getText=function(e){var t,n="",r=0,i=e.nodeType;if(!i)for(;t=e[r];r++)n+=o(t);else if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(i===3||i===4)return e.nodeValue;return n},s=st.selectors={cacheLength:50,createPseudo:ut,match:Q,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(nt,rt),e[3]=(e[4]||e[5]||"").replace(nt,rt),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1].slice(0,3)==="nth"?(e[3]||st.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(e[3]==="even"||e[3]==="odd")),e[5]=+(e[7]+e[8]||e[3]==="odd")):e[3]&&st.error(e[0]),e},PSEUDO:function(e){var n,r=!e[5]&&e[2];return Q.CHILD.test(e[0])?null:(e[3]&&e[4]!==t?e[2]=e[4]:r&&J.test(r)&&(n=vt(r,!0))&&(n=r.indexOf(")",r.length-n)-r.length)&&(e[0]=e[0].slice(0,n),e[2]=r.slice(0,n)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(nt,rt).toLowerCase();return e==="*"?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=x[e+" "];return t||(t=new RegExp("(^|"+F+")"+e+"("+F+"|$)"))&&x(e,function(e){return t.test(typeof e.className=="string"&&e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=st.attr(r,e);return i==null?t==="!=":t?(i+="",t==="="?i===n:t==="!="?i!==n:t==="^="?n&&i.indexOf(n)===0:t==="*="?n&&i.indexOf(n)>-1:t==="$="?n&&i.slice(-n.length)===n:t==="~="?(" "+i+" ").indexOf(n)>-1:t==="|="?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s=e.slice(0,3)!=="nth",o=e.slice(-4)!=="last",u=t==="of-type";return r===1&&i===0?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:c.nodeType===1)return!1;d=v=e==="only"&&!d&&"nextSibling"}return!0}d=[o?m.firstChild:m.lastChild];if(o&&y){l=m[b]||(m[b]={}),f=l[e]||[],p=f[0]===E&&f[1],h=f[0]===E&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(c.nodeType===1&&++h&&c===t){l[e]=[E,p,h];break}}else if(y&&(f=(t[b]||(t[b]={}))[e])&&f[0]===E)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:c.nodeType===1)&&++h){y&&((c[b]||(c[b]={}))[e]=[E,h]);if(c===t)break}return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,r=s.pseudos[e]||s.setFilters[e.toLowerCase()]||st.error("unsupported pseudo: "+e);return r[b]?r(t):r.length>1?(n=[e,e,"",t],s.setFilters.hasOwnProperty(e.toLowerCase())?ut(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=B.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:ut(function(e){var t=[],n=[],r=a(e.replace(z,"$1"));return r[b]?ut(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:ut(function(e){return function(t){return st(e,t).length>0}}),contains:ut(function(e){return function(t){return(t.textContent||t.innerText||o(t)).indexOf(e)>-1}}),lang:ut(function(e){return K.test(e||"")||st.error("unsupported lang: "+e),e=e.replace(nt,rt).toLowerCase(),function(t){var n;do if(n=d?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||n.indexOf(e+"-")===0;while((t=t.parentNode)&&t.nodeType===1);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===p},focus:function(e){return e===h.activeElement&&(!h.hasFocus||h.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||e.nodeType===3||e.nodeType===4)return!1;return!0},parent:function(e){return!s.pseudos.empty(e)},header:function(e){return et.test(e.nodeName)},input:function(e){return Z.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},text:function(e){var t;return e.nodeName.toLowerCase()==="input"&&e.type==="text"&&((t=e.getAttribute("type"))==null||t.toLowerCase()===e.type)},first:pt(function(){return[0]}),last:pt(function(e,t){return[t-1]}),eq:pt(function(e,t,n){return[n<0?n+t:n]}),even:pt(function(e,t){var n=0;for(;n<t;n+=2)e.push(n);return e}),odd:pt(function(e,t){var n=1;for(;n<t;n+=2)e.push(n);return e}),lt:pt(function(e,t,n){var r=n<0?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:pt(function(e,t,n){var r=n<0?n+t:n;for(;++r<t;)e.push(r);return e})}},s.pseudos.nth=s.pseudos.eq;for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})s.pseudos[n]=ct(n);for(n in{submit:!0,reset:!0})s.pseudos[n]=ht(n);dt.prototype=s.filters=s.pseudos,s.setFilters=new dt,a=st.compile=function(e,t){var n,r=[],i=[],s=N[e+" "];if(!s){t||(t=vt(e)),n=t.length;while(n--)s=Et(t[n]),s[b]?r.push(s):i.push(s);s=N(e,St(i,r))}return s},r.sortStable=b.split("").sort(k).join("")===b,r.detectDuplicates=C,c(),r.sortDetached=at(function(e){return e.compareDocumentPosition(h.createElement("div"))&1}),at(function(e){return e.innerHTML="<a href=\'#\'></a>",e.firstChild.getAttribute("href")==="#"})||ft("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,t.toLowerCase()==="type"?1:2)}),(!r.attributes||!at(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),e.firstChild.getAttribute("value")===""}))&&ft("value",function(e,t,n){if(!n&&e.nodeName.toLowerCase()==="input")return e.defaultValue}),at(function(e){return e.getAttribute("disabled")==null})||ft(j,function(e,t,n){var r;if(!n)return(r=e.getAttributeNode(t))&&r.specified?r.value:e[t]===!0?t.toLowerCase():null}),jQuery.find=st,jQuery.expr=st.selectors,jQuery.expr[":"]=jQuery.expr.pseudos,jQuery.unique=st.uniqueSort,jQuery.text=st.getText,jQuery.isXMLDoc=st.isXML,jQuery.contains=st.contains}(window);var optionsCache={};jQuery.Callbacks=function(e){e=typeof e=="string"?optionsCache[e]||createOptions(e):jQuery.extend({},e);var t,n,r,i,s,o,u=[],a=!e.once&&[],f=function(c){t=e.memory&&c,n=!0,o=i||0,i=0,s=u.length,r=!0;for(;u&&o<s;o++)if(u[o].apply(c[0],c[1])===!1&&e.stopOnFalse){t=!1;break}r=!1,u&&(a?a.length&&f(a.shift()):t?u=[]:l.disable())},l={add:function(){if(u){var n=u.length;(function o(t){jQuery.each(t,function(t,n){var r=jQuery.type(n);r==="function"?(!e.unique||!l.has(n))&&u.push(n):n&&n.length&&r!=="string"&&o(n)})})(arguments),r?s=u.length:t&&(i=n,f(t))}return this},remove:function(){return u&&jQuery.each(arguments,function(e,t){var n;while((n=jQuery.inArray(t,u,n))>-1)u.splice(n,1),r&&(n<=s&&s--,n<=o&&o--)}),this},has:function(e){return e?jQuery.inArray(e,u)>-1:!!u&&!!u.length},empty:function(){return u=[],s=0,this},disable:function(){return u=a=t=undefined,this},disabled:function(){return!u},lock:function(){return a=undefined,t||l.disable(),this},locked:function(){return!a},fireWith:function(e,t){return u&&(!n||a)&&(t=t||[],t=[e,t.slice?t.slice():t],r?a.push(t):f(t)),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!n}};return l},jQuery.extend({Deferred:function(e){var t=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return jQuery.Deferred(function(n){jQuery.each(t,function(t,s){var o=s[0],u=jQuery.isFunction(e[t])&&e[t];i[s[1]](function(){var e=u&&u.apply(this,arguments);e&&jQuery.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o+"With"](this===r?n.promise():this,u?[e]:arguments)})}),e=null}).promise()},promise:function(e){return e!=null?jQuery.extend(e,r):r}},i={};return r.pipe=r.then,jQuery.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=core_slice.call(arguments),r=n.length,i=r!==1||e&&jQuery.isFunction(e.promise)?r:0,s=i===1?e:jQuery.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?core_slice.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1){u=new Array(r),a=new Array(r),f=new Array(r);for(;t<r;t++)n[t]&&jQuery.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i}return i||s.resolveWith(f,n),s.promise()}}),jQuery.support=function(e){var t=document.createElement("input"),n=document.createDocumentFragment(),r=document.createElement("div"),i=document.createElement("select"),s=i.appendChild(document.createElement("option"));return t.type?(t.type="checkbox",e.checkOn=t.value!=="",e.optSelected=s.selected,e.reliableMarginRight=!0,e.boxSizingReliable=!0,e.pixelPosition=!1,t.checked=!0,e.noCloneChecked=t.cloneNode(!0).checked,i.disabled=!0,e.optDisabled=!s.disabled,t=document.createElement("input"),t.value="t",t.type="radio",e.radioValue=t.value==="t",t.setAttribute("checked","t"),t.setAttribute("name","t"),n.appendChild(t),e.checkClone=n.cloneNode(!0).cloneNode(!0).lastChild.checked,e.focusinBubbles="onfocusin"in window,r.style.backgroundClip="content-box",r.cloneNode(!0).style.backgroundClip="",e.clearCloneStyle=r.style.backgroundClip==="content-box",jQuery(function(){var t,n,i="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",s=document.getElementsByTagName("body")[0];if(!s)return;t=document.createElement("div"),t.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",s.appendChild(t).appendChild(r),r.innerHTML="",r.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",jQuery.swap(s,s.style.zoom!=null?{zoom:1}:{},function(){e.boxSizing=r.offsetWidth===4}),window.getComputedStyle&&(e.pixelPosition=(window.getComputedStyle(r,null)||{}).top!=="1%",e.boxSizingReliable=(window.getComputedStyle(r,null)||{width:"4px"}).width==="4px",n=r.appendChild(document.createElement("div")),n.style.cssText=r.style.cssText=i,n.style.marginRight=n.style.width="0",r.style.width="1px",e.reliableMarginRight=!parseFloat((window.getComputedStyle(n,null)||{}).marginRight)),s.removeChild(t)}),e):e}({});var data_user,data_priv,rbrace=/(?:\\{[\\s\\S]*\\}|\\[[\\s\\S]*\\])$/,rmultiDash=/([A-Z])/g;Data.uid=1,Data.accepts=function(e){return e.nodeType?e.nodeType===1||e.nodeType===9:!0},Data.prototype={key:function(e){if(!Data.accepts(e))return 0;var t={},n=e[this.expando];if(!n){n=Data.uid++;try{t[this.expando]={value:n},Object.defineProperties(e,t)}catch(r){t[this.expando]=n,jQuery.extend(e,t)}}return this.cache[n]||(this.cache[n]={}),n},set:function(e,t,n){var r,i=this.key(e),s=this.cache[i];if(typeof t=="string")s[t]=n;else if(jQuery.isEmptyObject(s))jQuery.extend(this.cache[i],t);else for(r in t)s[r]=t[r];return s},get:function(e,t){var n=this.cache[this.key(e)];return t===undefined?n:n[t]},access:function(e,t,n){var r;return t===undefined||t&&typeof t=="string"&&n===undefined?(r=this.get(e,t),r!==undefined?r:this.get(e,jQuery.camelCase(t))):(this.set(e,t,n),n!==undefined?n:t)},remove:function(e,t){var n,r,i,s=this.key(e),o=this.cache[s];if(t===undefined)this.cache[s]={};else{jQuery.isArray(t)?r=t.concat(t.map(jQuery.camelCase)):(i=jQuery.camelCase(t),t in o?r=[t,i]:(r=i,r=r in o?[r]:r.match(core_rnotwhite)||[])),n=r.length;while(n--)delete o[r[n]]}},hasData:function(e){return!jQuery.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}},data_user=new Data,data_priv=new Data,jQuery.extend({acceptData:Data.accepts,hasData:function(e){return data_user.hasData(e)||data_priv.hasData(e)},data:function(e,t,n){return data_user.access(e,t,n)},removeData:function(e,t){data_user.remove(e,t)},_data:function(e,t,n){return data_priv.access(e,t,n)},_removeData:function(e,t){data_priv.remove(e,t)}}),jQuery.fn.extend({data:function(e,t){var n,r,i=this[0],s=0,o=null;if(e===undefined){if(this.length){o=data_user.get(i);if(i.nodeType===1&&!data_priv.get(i,"hasDataAttrs")){n=i.attributes;for(;s<n.length;s++)r=n[s].name,r.indexOf("data-")===0&&(r=jQuery.camelCase(r.slice(5)),dataAttr(i,r,o[r]));data_priv.set(i,"hasDataAttrs",!0)}}return o}return typeof e=="object"?this.each(function(){data_user.set(this,e)}):jQuery.access(this,function(t){var n,r=jQuery.camelCase(e);if(i&&t===undefined){n=data_user.get(i,e);if(n!==undefined)return n;n=data_user.get(i,r);if(n!==undefined)return n;n=dataAttr(i,r,undefined);if(n!==undefined)return n;return}this.each(function(){var n=data_user.get(this,r);data_user.set(this,r,t),e.indexOf("-")!==-1&&n!==undefined&&data_user.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){data_user.remove(this,e)})}}),jQuery.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=data_priv.get(e,t),n&&(!r||jQuery.isArray(n)?r=data_priv.access(e,t,jQuery.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=jQuery.queue(e,t),r=n.length,i=n.shift(),s=jQuery._queueHooks(e,t),o=function(){jQuery.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return data_priv.get(e,n)||data_priv.access(e,n,{empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(e,[t+"queue",n])})})}}),jQuery.fn.extend({queue:function(e,t){var n=2;return typeof e!="string"&&(t=e,e="fx",n--),arguments.length<n?jQuery.queue(this[0],e):t===undefined?this:this.each(function(){var n=jQuery.queue(this,e,t);jQuery._queueHooks(this,e),e==="fx"&&n[0]!=="inprogress"&&jQuery.dequeue(this,e)})},dequeue:function(e){return this.each(function(){jQuery.dequeue(this,e)})},delay:function(e,t){return e=jQuery.fx?jQuery.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=jQuery.Deferred(),s=this,o=this.length,u=function(){--r||i.resolveWith(s,[s])};typeof e!="string"&&(t=e,e=undefined),e=e||"fx";while(o--)n=data_priv.get(s[o],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(u));return u(),i.promise(t)}});var nodeHook,boolHook,rclass=/[\\t\\r\\n\\f]/g,rreturn=/\\r/g,rfocusable=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({attr:function(e,t){return jQuery.access(this,jQuery.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){jQuery.removeAttr(this,e)})},prop:function(e,t){return jQuery.access(this,jQuery.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[jQuery.propFix[e]||e]})},addClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=typeof e=="string"&&e;if(jQuery.isFunction(e))return this.each(function(t){jQuery(this).addClass(e.call(this,t,this.className))});if(a){t=(e||"").match(core_rnotwhite)||[];for(;o<u;o++){n=this[o],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(rclass," "):" ");if(r){s=0;while(i=t[s++])r.indexOf(" "+i+" ")<0&&(r+=i+" ");n.className=jQuery.trim(r)}}}return this},removeClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=arguments.length===0||typeof e=="string"&&e;if(jQuery.isFunction(e))return this.each(function(t){jQuery(this).removeClass(e.call(this,t,this.className))});if(a){t=(e||"").match(core_rnotwhite)||[];for(;o<u;o++){n=this[o],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(rclass," "):"");if(r){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?jQuery.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e;return typeof t=="boolean"&&n==="string"?t?this.addClass(e):this.removeClass(e):jQuery.isFunction(e)?this.each(function(n){jQuery(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var t,r=0,i=jQuery(this),s=e.match(core_rnotwhite)||[];while(t=s[r++])i.hasClass(t)?i.removeClass(t):i.addClass(t)}else if(n===core_strundefined||n==="boolean")this.className&&data_priv.set(this,"__className__",this.className),this.className=this.className||e===!1?"":data_priv.get(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(rclass," ").indexOf(t)>=0)return!0;return!1},val:function(e){var t,n,r,i=this[0];if(!arguments.length){if(i)return t=jQuery.valHooks[i.type]||jQuery.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&(n=t.get(i,"value"))!==undefined?n:(n=i.value,typeof n=="string"?n.replace(rreturn,""):n==null?"":n);return}return r=jQuery.isFunction(e),this.each(function(n){var i;if(this.nodeType!==1)return;r?i=e.call(this,n,jQuery(this).val()):i=e,i==null?i="":typeof i=="number"?i+="":jQuery.isArray(i)&&(i=jQuery.map(i,function(e){return e==null?"":e+""})),t=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!t||!("set"in t)||t.set(this,i,"value")===undefined)this.value=i})}}),jQuery.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(jQuery.support.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!jQuery.nodeName(n.parentNode,"optgroup"))){t=jQuery(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n,r,i=e.options,s=jQuery.makeArray(t),o=i.length;while(o--){r=i[o];if(r.selected=jQuery.inArray(jQuery(r).val(),s)>=0)n=!0}return n||(e.selectedIndex=-1),s}}},attr:function(e,t,n){var r,i,s=e.nodeType;if(!e||s===3||s===8||s===2)return;if(typeof e.getAttribute===core_strundefined)return jQuery.prop(e,t,n);if(s!==1||!jQuery.isXMLDoc(e))t=t.toLowerCase(),r=jQuery.attrHooks[t]||(jQuery.expr.match.bool.test(t)?boolHook:nodeHook);if(n===undefined)return r&&"get"in r&&(i=r.get(e,t))!==null?i:(i=jQuery.find.attr(e,t),i==null?undefined:i);if(n!==null)return r&&"set"in r&&(i=r.set(e,n,t))!==undefined?i:(e.setAttribute(t,n+""),n);jQuery.removeAttr(e,t)},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(core_rnotwhite);if(s&&e.nodeType===1)while(n=s[i++])r=jQuery.propFix[n]||n,jQuery.expr.match.bool.test(n)&&(e[r]=!1),e.removeAttribute(n)},attrHooks:{type:{set:function(e,t){if(!jQuery.support.radioValue&&t==="radio"&&jQuery.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var r,i,s,o=e.nodeType;if(!e||o===3||o===8||o===2)return;return s=o!==1||!jQuery.isXMLDoc(e),s&&(t=jQuery.propFix[t]||t,i=jQuery.propHooks[t]),n!==undefined?i&&"set"in i&&(r=i.set(e,n,t))!==undefined?r:e[t]=n:i&&"get"in i&&(r=i.get(e,t))!==null?r:e[t]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||rfocusable.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),boolHook={set:function(e,t,n){return t===!1?jQuery.removeAttr(e,n):e.setAttribute(n,n),n}},jQuery.each(jQuery.expr.match.bool.source.match(/\\w+/g),function(e,t){var n=jQuery.expr.attrHandle[t]||jQuery.find.attr;jQuery.expr.attrHandle[t]=function(e,t,r){var i=jQuery.expr.attrHandle[t],s=r?undefined:(jQuery.expr.attrHandle[t]=undefined)!=n(e,t,r)?t.toLowerCase():null;return jQuery.expr.attrHandle[t]=i,s}}),jQuery.support.optSelected||(jQuery.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this}),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(e,t){if(jQuery.isArray(t))return e.checked=jQuery.inArray(jQuery(e).val(),t)>=0}},jQuery.support.checkOn||(jQuery.valHooks[this].get=function(e){return e.getAttribute("value")===null?"on":e.value})});var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\\.(.+)|)$/;jQuery.event={global:{},add:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=data_priv.get(e);if(!m)return;n.handler&&(s=n,n=s.handler,i=s.selector),n.guid||(n.guid=jQuery.guid++),(a=m.events)||(a=m.events={}),(o=m.handle)||(o=m.handle=function(e){return typeof jQuery===core_strundefined||!!e&&jQuery.event.triggered===e.type?undefined:jQuery.event.dispatch.apply(o.elem,arguments)},o.elem=e),t=(t||"").match(core_rnotwhite)||[""],f=t.length;while(f--){u=rtypenamespace.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort();if(!p)continue;c=jQuery.event.special[p]||{},p=(i?c.delegateType:c.bindType)||p,c=jQuery.event.special[p]||{},l=jQuery.extend({type:p,origType:v,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&jQuery.expr.match.needsContext.test(i),namespace:d.join(".")},s),(h=a[p])||(h=a[p]=[],h.delegateCount=0,(!c.setup||c.setup.call(e,r,d,o)===!1)&&e.addEventListener&&e.addEventListener(p,o,!1)),c.add&&(c.add.call(e,l),l.handler.guid||(l.handler.guid=n.guid)),i?h.splice(h.delegateCount++,0,l):h.push(l),jQuery.event.global[p]=!0}e=null},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=data_priv.hasData(e)&&data_priv.get(e);if(!m||!(a=m.events))return;t=(t||"").match(core_rnotwhite)||[""],f=t.length;while(f--){u=rtypenamespace.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort();if(!p){for(p in a)jQuery.event.remove(e,p+t[f],n,r,!0);continue}c=jQuery.event.special[p]||{},p=(r?c.delegateType:c.bindType)||p,h=a[p]||[],u=u[2]&&new RegExp("(^|\\\\.)"+d.join("\\\\.(?:.*\\\\.|)")+"(\\\\.|$)"),o=s=h.length;while(s--)l=h[s],(i||v===l.origType)&&(!n||n.guid===l.guid)&&(!u||u.test(l.namespace))&&(!r||r===l.selector||r==="**"&&l.selector)&&(h.splice(s,1),l.selector&&h.delegateCount--,c.remove&&c.remove.call(e,l));o&&!h.length&&((!c.teardown||c.teardown.call(e,d,m.handle)===!1)&&jQuery.removeEvent(e,p,m.handle),delete a[p])}jQuery.isEmptyObject(a)&&(delete m.handle,data_priv.remove(e,"events"))},trigger:function(e,t,n,r){var i,s,o,u,a,f,l,c=[n||document],h=core_hasOwn.call(e,"type")?e.type:e,p=core_hasOwn.call(e,"namespace")?e.namespace.split("."):[];s=o=n=n||document;if(n.nodeType===3||n.nodeType===8)return;if(rfocusMorph.test(h+jQuery.event.triggered))return;h.indexOf(".")>=0&&(p=h.split("."),h=p.shift(),p.sort()),a=h.indexOf(":")<0&&"on"+h,e=e[jQuery.expando]?e:new jQuery.Event(h,typeof e=="object"&&e),e.isTrigger=r?2:3,e.namespace=p.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\\\.)"+p.join("\\\\.(?:.*\\\\.|)")+"(\\\\.|$)"):null,e.result=undefined,e.target||(e.target=n),t=t==null?[e]:jQuery.makeArray(t,[e]),l=jQuery.event.special[h]||{};if(!r&&l.trigger&&l.trigger.apply(n,t)===!1)return;if(!r&&!l.noBubble&&!jQuery.isWindow(n)){u=l.delegateType||h,rfocusMorph.test(u+h)||(s=s.parentNode);for(;s;s=s.parentNode)c.push(s),o=s;o===(n.ownerDocument||document)&&c.push(o.defaultView||o.parentWindow||window)}i=0;while((s=c[i++])&&!e.isPropagationStopped())e.type=i>1?u:l.bindType||h,f=(data_priv.get(s,"events")||{})[e.type]&&data_priv.get(s,"handle"),f&&f.apply(s,t),f=a&&s[a],f&&jQuery.acceptData(s)&&f.apply&&f.apply(s,t)===!1&&e.preventDefault();return e.type=h,!r&&!e.isDefaultPrevented()&&(!l._default||l._default.apply(c.pop(),t)===!1)&&jQuery.acceptData(n)&&a&&jQuery.isFunction(n[h])&&!jQuery.isWindow(n)&&(o=n[a],o&&(n[a]=null),jQuery.event.triggered=h,n[h](),jQuery.event.triggered=undefined,o&&(n[a]=o)),e.result},dispatch:function(e){e=jQuery.event.fix(e);var t,n,r,i,s,o=[],u=core_slice.call(arguments),a=(data_priv.get(this,"events")||{})[e.type]||[],f=jQuery.event.special[e.type]||{};u[0]=e,e.delegateTarget=this;if(f.preDispatch&&f.preDispatch.call(this,e)===!1)return;o=jQuery.event.handlers.call(this,e,a),t=0;while((i=o[t++])&&!e.isPropagationStopped()){e.currentTarget=i.elem,n=0;while((s=i.handlers[n++])&&!e.isImmediatePropagationStopped())if(!e.namespace_re||e.namespace_re.test(s.namespace))e.handleObj=s,e.data=s.data,r=((jQuery.event.special[s.origType]||{}).handle||s.handler).apply(i.elem,u),r!==undefined&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation())}return f.postDispatch&&f.postDispatch.call(this,e),e.result},handlers:function(e,t){var n,r,i,s,o=[],u=t.delegateCount,a=e.target;if(u&&a.nodeType&&(!e.button||e.type!=="click"))for(;a!==this;a=a.parentNode||this)if(a.disabled!==!0||e.type!=="click"){r=[];for(n=0;n<u;n++)s=t[n],i=s.selector+" ",r[i]===undefined&&(r[i]=s.needsContext?jQuery(i,this).index(a)>=0:jQuery.find(i,this,null,[a]).length),r[i]&&r.push(s);r.length&&o.push({elem:a,handlers:r})}return u<t.length&&o.push({elem:this,handlers:t.slice(u)}),o},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button;return e.pageX==null&&t.clientX!=null&&(n=e.target.ownerDocument||document,r=n.documentElement,i=n.body,e.pageX=t.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),!e.which&&s!==undefined&&(e.which=s&1?1:s&2?3:s&4?2:0),e}},fix:function(e){if(e[jQuery.expando])return e;var t,n,r,i=e.type,s=e,o=this.fixHooks[i];o||(this.fixHooks[i]=o=rmouseEvent.test(i)?this.mouseHooks:rkeyEvent.test(i)?this.keyHooks:{}),r=o.props?this.props.concat(o.props):this.props,e=new jQuery.Event(s),t=r.length;while(t--)n=r[t],e[n]=s[n];return e.target||(e.target=document),e.target.nodeType===3&&(e.target=e.target.parentNode),o.filter?o.filter(e,s):e},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&jQuery.nodeName(this,"input"))return this.click(),!1},_default:function(e){return jQuery.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==undefined&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=jQuery.extend(new jQuery.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?jQuery.event.trigger(i,null,t):jQuery.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},jQuery.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},jQuery.Event=function(e,t){if(!(this instanceof jQuery.Event))return new jQuery.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.getPreventDefault&&e.getPreventDefault()?returnTrue:returnFalse):this.type=e,t&&jQuery.extend(this,t),this.timeStamp=e&&e.timeStamp||jQuery.now(),this[jQuery.expando]=!0},jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue,this.stopPropagation()}},jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){jQuery.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;if(!i||i!==r&&!jQuery.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),jQuery.support.focusinBubbles||jQuery.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){jQuery.event.simulate(t,e.target,jQuery.event.fix(e),!0)};jQuery.event.special[t]={setup:function(){n++===0&&document.addEventListener(e,r,!0)},teardown:function(){--n===0&&document.removeEventListener(e,r,!0)}}}),jQuery.fn.extend({on:function(e,t,n,r,i){var s,o;if(typeof e=="object"){typeof t!="string"&&(n=n||t,t=undefined);for(o in e)this.on(o,t,n,e[o],i);return this}n==null&&r==null?(r=t,n=t=undefined):r==null&&(typeof t=="string"?(r=n,n=undefined):(r=n,n=t,t=undefined));if(r===!1)r=returnFalse;else if(!r)return this;return i===1&&(s=r,r=function(e){return jQuery().off(e),s.apply(this,arguments)},r.guid=s.guid||(s.guid=jQuery.guid++)),this.each(function(){jQuery.event.add(this,e,r,n,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,jQuery(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if(typeof e=="object"){for(i in e)this.off(i,t,e[i]);return this}if(t===!1||typeof t=="function")n=t,t=undefined;return n===!1&&(n=returnFalse),this.each(function(){jQuery.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){jQuery.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return jQuery.event.trigger(e,t,n,!0)}});var isSimple=/^.[^:#\\[\\.,]*$/,rparentsprev=/^(?:parents|prev(?:Until|All))/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};jQuery.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if(typeof e!="string")return this.pushStack(jQuery(e).filter(function(){for(t=0;t<i;t++)if(jQuery.contains(r[t],this))return!0}));for(t=0;t<i;t++)jQuery.find(e,r[t],n);return n=this.pushStack(i>1?jQuery.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},has:function(e){var t=jQuery(e,this),n=t.length;return this.filter(function(){var e=0;for(;e<n;e++)if(jQuery.contains(this,t[e]))return!0})},not:function(e){return this.pushStack(winnow(this,e||[],!0))},filter:function(e){return this.pushStack(winnow(this,e||[],!1))},is:function(e){return!!winnow(this,typeof e=="string"&&rneedsContext.test(e)?jQuery(e):e||[],!1).length},closest:function(e,t){var n,r=0,i=this.length,s=[],o=rneedsContext.test(e)||typeof e!="string"?jQuery(e,t||this.context):0;for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:n.nodeType===1&&jQuery.find.matchesSelector(n,e))){n=s.push(n);break}return this.pushStack(s.length>1?jQuery.unique(s):s)},index:function(e){return e?typeof e=="string"?core_indexOf.call(jQuery(e),this[0]):core_indexOf.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?jQuery(e,t):jQuery.makeArray(e&&e.nodeType?[e]:e),r=jQuery.merge(this.get(),n);return this.pushStack(jQuery.unique(r))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),jQuery.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return jQuery.dir(e,"parentNode")},parentsUntil:function(e,t,n){return jQuery.dir(e,"parentNode",n)},next:function(e){return sibling(e,"nextSibling")},prev:function(e){return sibling(e,"previousSibling")},nextAll:function(e){return jQuery.dir(e,"nextSibling")},prevAll:function(e){return jQuery.dir(e,"previousSibling")},nextUntil:function(e,t,n){return jQuery.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return jQuery.dir(e,"previousSibling",n)},siblings:function(e){return jQuery.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return jQuery.sibling(e.firstChild)},contents:function(e){return e.contentDocument||jQuery.merge([],e.childNodes)}},function(e,t){jQuery.fn[e]=function(n,r){var i=jQuery.map(this,t,n);return e.slice(-5)!=="Until"&&(r=n),r&&typeof r=="string"&&(i=jQuery.filter(r,i)),this.length>1&&(guaranteedUnique[e]||jQuery.unique(i),rparentsprev.test(e)&&i.reverse()),this.pushStack(i)}}),jQuery.extend({filter:function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),t.length===1&&r.nodeType===1?jQuery.find.matchesSelector(r,e)?[r]:[]:jQuery.find.matches(e,jQuery.grep(t,function(e){return e.nodeType===1}))},dir:function(e,t,n){var r=[],i=n!==undefined;while((e=e[t])&&e.nodeType!==9)if(e.nodeType===1){if(i&&jQuery(e).is(n))break;r.push(e)}return r},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:]+)[^>]*)\\/>/gi,rtagName=/<([\\w:]+)/,rhtml=/<|&#?\\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,manipulation_rcheckableType=/^(?:checkbox|radio)$/i,rchecked=/checked\\s*(?:[^=]|=\\s*.checked.)/i,rscriptType=/^$|\\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\\/(.*)/,rcleanScript=/^\\s*<!(?:\\[CDATA\\[|--)|(?:\\]\\]|--)>\\s*$/g,wrapMap={option:[1,"<select multiple=\'multiple\'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td,jQuery.fn.extend({text:function(e){return jQuery.access(this,function(e){return e===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=manipulationTarget(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var t=manipulationTarget(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=e?jQuery.filter(e,this):this,i=0;for(;(n=r[i])!=null;i++)!t&&n.nodeType===1&&jQuery.cleanData(getAll(n)),n.parentNode&&(t&&jQuery.contains(n.ownerDocument,n)&&setGlobalEval(getAll(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++)e.nodeType===1&&(jQuery.cleanData(getAll(e,!1)),e.textContent="");return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return jQuery.clone(this,e,t)})},html:function(e){return jQuery.access(this,function(e){var t=this[0]||{},n=0,r=this.length;if(e===undefined&&t.nodeType===1)return t.innerHTML;if(typeof e=="string"&&!rnoInnerhtml.test(e)&&!wrapMap[(rtagName.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(rxhtmlTag,"<$1></$2>");try{for(;n<r;n++)t=this[n]||{},t.nodeType===1&&(jQuery.cleanData(getAll(t,!1)),t.innerHTML=e);t=0}catch(i){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=jQuery.map(this,function(e){return[e.nextSibling,e.parentNode]}),t=0;return this.domManip(arguments,function(n){var r=e[t++],s=e[t++];s&&(r&&r.parentNode!==s&&(r=this.nextSibling),jQuery(this).remove(),s.insertBefore(n,r))},!0),t?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t,n){e=core_concat.apply([],e);var r,i,s,o,u,a,f=0,l=this.length,c=this,h=l-1,p=e[0],d=jQuery.isFunction(p);if(d||!(l<=1||typeof p!="string"||jQuery.support.checkClone||!rchecked.test(p)))return this.each(function(r){var i=c.eq(r);d&&(e[0]=p.call(this,r,i.html())),i.domManip(e,t,n)});if(l){r=jQuery.buildFragment(e,this[0].ownerDocument,!1,!n&&this),i=r.firstChild,r.childNodes.length===1&&(r=i);if(i){s=jQuery.map(getAll(r,"script"),disableScript),o=s.length;for(;f<l;f++)u=r,f!==h&&(u=jQuery.clone(u,!0,!0),o&&jQuery.merge(s,getAll(u,"script"))),t.call(this[f],u,f);if(o){a=s[s.length-1].ownerDocument,jQuery.map(s,restoreScript);for(f=0;f<o;f++)u=s[f],rscriptType.test(u.type||"")&&!data_priv.access(u,"globalEval")&&jQuery.contains(a,u)&&(u.src?jQuery._evalUrl(u.src):jQuery.globalEval(u.textContent.replace(rcleanScript,"")))}}}return this}}),jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){jQuery.fn[e]=function(e){var n,r=[],i=jQuery(e),s=i.length-1,o=0;for(;o<=s;o++)n=o===s?this:this.clone(!0),jQuery(i[o])[t](n),core_push.apply(r,n.get());return this.pushStack(r)}}),jQuery.extend({clone:function(e,t,n){var r,i,s,o,u=e.cloneNode(!0),a=jQuery.contains(e.ownerDocument,e);if(!jQuery.support.noCloneChecked&&(e.nodeType===1||e.nodeType===11)&&!jQuery.isXMLDoc(e)){o=getAll(u),s=getAll(e);for(r=0,i=s.length;r<i;r++)fixInput(s[r],o[r])}if(t)if(n){s=s||getAll(e),o=o||getAll(u);for(r=0,i=s.length;r<i;r++)cloneCopyEvent(s[r],o[r])}else cloneCopyEvent(e,u);return o=getAll(u,"script"),o.length>0&&setGlobalEval(o,!a&&getAll(e,"script")),u},buildFragment:function(e,t,n,r){var i,s,o,u,a,f,l=0,c=e.length,h=t.createDocumentFragment(),p=[];for(;l<c;l++){i=e[l];if(i||i===0)if(jQuery.type(i)==="object")jQuery.merge(p,i.nodeType?[i]:i);else if(!rhtml.test(i))p.push(t.createTextNode(i));else{s=s||h.appendChild(t.createElement("div")),o=(rtagName.exec(i)||["",""])[1].toLowerCase(),u=wrapMap[o]||wrapMap._default,s.innerHTML=u[1]+i.replace(rxhtmlTag,"<$1></$2>")+u[2],f=u[0];while(f--)s=s.lastChild;jQuery.merge(p,s.childNodes),s=h.firstChild,s.textContent=""}}h.textContent="",l=0;while(i=p[l++]){if(r&&jQuery.inArray(i,r)!==-1)continue;a=jQuery.contains(i.ownerDocument,i),s=getAll(h.appendChild(i),"script"),a&&setGlobalEval(s);if(n){f=0;while(i=s[f++])rscriptType.test(i.type||"")&&n.push(i)}}return h},cleanData:function(e){var t,n,r,i,s,o,u=jQuery.event.special,a=0;for(;(n=e[a])!==undefined;a++){if(Data.accepts(n)){s=n[data_priv.expando];if(s&&(t=data_priv.cache[s])){r=Object.keys(t.events||{});if(r.length)for(o=0;(i=r[o])!==undefined;o++)u[i]?jQuery.event.remove(n,i):jQuery.removeEvent(n,i,t.handle);data_priv.cache[s]&&delete data_priv.cache[s]}}delete data_user.cache[n[data_user.expando]]}},_evalUrl:function(e){return jQuery.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),jQuery.fn.extend({wrapAll:function(e){var t;return jQuery.isFunction(e)?this.each(function(t){jQuery(this).wrapAll(e.call(this,t))}):(this[0]&&(t=jQuery(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return jQuery.isFunction(e)?this.each(function(t){jQuery(this).wrapInner(e.call(this,t))}):this.each(function(){var t=jQuery(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=jQuery.isFunction(e);return this.each(function(n){jQuery(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){jQuery.nodeName(this,"body")||jQuery(this).replaceWith(this.childNodes)}).end()}});var curCSS,iframe,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([+-])=("+core_pnum+")","i"),elemdisplay={BODY:"block"},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"];jQuery.fn.extend({css:function(e,t){return jQuery.access(this,function(e,t,n){var r,i,s={},o=0;if(jQuery.isArray(t)){r=getStyles(e),i=t.length;for(;o<i;o++)s[t[o]]=jQuery.css(e,t[o],!1,r);return s}return n!==undefined?jQuery.style(e,t,n):jQuery.css(e,t)},e,t,arguments.length>1)},show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(e){return typeof e=="boolean"?e?this.show():this.hide():this.each(function(){isHidden(this)?jQuery(this).show():jQuery(this).hide()})}}),jQuery.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=curCSS(e,"opacity");return n===""?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,n,r){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var i,s,o,u=jQuery.camelCase(t),a=e.style;t=jQuery.cssProps[u]||(jQuery.cssProps[u]=vendorPropName(a,u)),o=jQuery.cssHooks[t]||jQuery.cssHooks[u];if(n===undefined)return o&&"get"in o&&(i=o.get(e,!1,r))!==undefined?i:a[t];s=typeof n,s==="string"&&(i=rrelNum.exec(n))&&(n=(i[1]+1)*i[2]+parseFloat(jQuery.css(e,t)),s="number");if(n==null||s==="number"&&isNaN(n))return;s==="number"&&!jQuery.cssNumber[u]&&(n+="px"),!jQuery.support.clearCloneStyle&&n===""&&t.indexOf("background")===0&&(a[t]="inherit");if(!o||!("set"in o)||(n=o.set(e,n,r))!==undefined)a[t]=n},css:function(e,t,n,r){var i,s,o,u=jQuery.camelCase(t);return t=jQuery.cssProps[u]||(jQuery.cssProps[u]=vendorPropName(e.style,u)),o=jQuery.cssHooks[t]||jQuery.cssHooks[u],o&&"get"in o&&(i=o.get(e,!0,n)),i===undefined&&(i=curCSS(e,t,r)),i==="normal"&&t in cssNormalTransform&&(i=cssNormalTransform[t]),n===""||n?(s=parseFloat(i),n===!0||jQuery.isNumeric(s)?s||0:i):i}}),curCSS=function(e,t,n){var r,i,s,o=n||getStyles(e),u=o?o.getPropertyValue(t)||o[t]:undefined,a=e.style;return o&&(u===""&&!jQuery.contains(e.ownerDocument,e)&&(u=jQuery.style(e,t)),rnumnonpx.test(u)&&rmargin.test(t)&&(r=a.width,i=a.minWidth,s=a.maxWidth,a.minWidth=a.maxWidth=a.width=u,u=o.width,a.width=r,a.minWidth=i,a.maxWidth=s)),u},jQuery.each(["height","width"],function(e,t){jQuery.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth===0&&rdisplayswap.test(jQuery.css(e,"display"))?jQuery.swap(e,cssShow,function(){return getWidthOrHeight(e,t,r)}):getWidthOrHeight(e,t,r)},set:function(e,n,r){var i=r&&getStyles(e);return setPositiveNumber(e,n,r?augmentWidthOrHeight(e,t,r,jQuery.support.boxSizing&&jQuery.css(e,"boxSizing",!1,i)==="border-box",i):0)}}}),jQuery(function(){jQuery.support.reliableMarginRight||(jQuery.cssHooks.marginRight={get:function(e,t){if(t)return jQuery.swap(e,{display:"inline-block"},curCSS,[e,"marginRight"])}}),!jQuery.support.pixelPosition&&jQuery.fn.position&&jQuery.each(["top","left"],function(e,t){jQuery.cssHooks[t]={get:function(e,n){if(n)return n=curCSS(e,t),rnumnonpx.test(n)?jQuery(e).position()[t]+"px":n}}})}),jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},jQuery.expr.filters.visible=function(e){return!jQuery.expr.filters.hidden(e)}),jQuery.each({margin:"",padding:"",border:"Width"},function(e,t){jQuery.cssHooks[e+t]={expand:function(n){var r=0,i={},s=typeof n=="string"?n.split(" "):[n];for(;r<4;r++)i[e+cssExpand[r]+t]=s[r]||s[r-2]||s[0];return i}},rmargin.test(e)||(jQuery.cssHooks[e+t].set=setPositiveNumber)});var r20=/%20/g,rbracket=/\\[\\]$/,rCRLF=/\\r?\\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=jQuery.prop(this,"elements");return e?jQuery.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(e)&&(this.checked||!manipulation_rcheckableType.test(e))}).map(function(e,t){var n=jQuery(this).val();return n==null?null:jQuery.isArray(n)?jQuery.map(n,function(e){return{name:t.name,value:e.replace(rCRLF,"\\r\\n")}}):{name:t.name,value:n.replace(rCRLF,"\\r\\n")}}).get()}}),jQuery.param=function(e,t){var n,r=[],i=function(e,t){t=jQuery.isFunction(t)?t():t==null?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};t===undefined&&(t=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional);if(jQuery.isArray(e)||e.jquery&&!jQuery.isPlainObject(e))jQuery.each(e,function(){i(this.name,this.value)});else for(n in e)buildParams(n,e[n],t,i);return r.join("&").replace(r20,"+")},jQuery.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){jQuery.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),jQuery.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)}});var ajaxLocParts,ajaxLocation,ajax_nonce=jQuery.now(),ajax_rquery=/\\?/,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \\t]*([^\\r\\n]*)$/mg,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\\/\\//,rurl=/^([\\w.+-]+:)(?:\\/\\/([^\\/?#:]*)(?::(\\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a"),ajaxLocation.href="",ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[],jQuery.fn.load=function(e,t,n){if(typeof e!="string"&&_load)return _load.apply(this,arguments);var r,i,s,o=this,u=e.indexOf(" ");return u>=0&&(r=e.slice(u),e=e.slice(0,u)),jQuery.isFunction(t)?(n=t,t=undefined):t&&typeof t=="object"&&(i="POST"),o.length>0&&jQuery.ajax({url:e,type:i,dataType:"html",data:t}).done(function(e){s=arguments,o.html(r?jQuery("<div>").append(jQuery.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){o.each(n,s||[e.responseText,t,e])}),this},jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){jQuery.fn[t]=function(e){return this.on(t,e)}}),jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?ajaxExtend(ajaxExtend(e,jQuery.ajaxSettings),t):ajaxExtend(jQuery.ajaxSettings,e)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(e,t){function S(e,t,s,u){var f,m,g,b,E,S=t;if(y===2)return;y=2,o&&clearTimeout(o),n=undefined,i=u||"",w.readyState=e>0?4:0,f=e>=200&&e<300||e===304,s&&(b=ajaxHandleResponses(l,w,s)),b=ajaxConvert(l,b,w,f);if(f)l.ifModified&&(E=w.getResponseHeader("Last-Modified"),E&&(jQuery.lastModified[r]=E),E=w.getResponseHeader("etag"),E&&(jQuery.etag[r]=E)),e===204||l.type==="HEAD"?S="nocontent":e===304?S="notmodified":(S=b.state,m=b.data,g=b.error,f=!g);else{g=S;if(e||!S)S="error",e<0&&(e=0)}w.status=e,w.statusText=(t||S)+"",f?p.resolveWith(c,[m,S,w]):p.rejectWith(c,[w,S,g]),w.statusCode(v),v=undefined,a&&h.trigger(f?"ajaxSuccess":"ajaxError",[w,l,f?m:g]),d.fireWith(c,[w,S]),a&&(h.trigger("ajaxComplete",[w,l]),--jQuery.active||jQuery.event.trigger("ajaxStop"))}typeof e=="object"&&(t=e,e=undefined),t=t||{};var n,r,i,s,o,u,a,f,l=jQuery.ajaxSetup({},t),c=l.context||l,h=l.context&&(c.nodeType||c.jquery)?jQuery(c):jQuery.event,p=jQuery.Deferred(),d=jQuery.Callbacks("once memory"),v=l.statusCode||{},m={},g={},y=0,b="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(y===2){if(!s){s={};while(t=rheaders.exec(i))s[t[1].toLowerCase()]=t[2]}t=s[e.toLowerCase()]}return t==null?null:t},getAllResponseHeaders:function(){return y===2?i:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return y||(e=g[n]=g[n]||e,m[e]=t),this},overrideMimeType:function(e){return y||(l.mimeType=e),this},statusCode:function(e){var t;if(e)if(y<2)for(t in e)v[t]=[v[t],e[t]];else w.always(e[w.status]);return this},abort:function(e){var t=e||b;return n&&n.abort(t),S(0,t),this}};p.promise(w).complete=d.add,w.success=w.done,w.error=w.fail,l.url=((e||l.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//"),l.type=t.method||t.type||l.method||l.type,l.dataTypes=jQuery.trim(l.dataType||"*").toLowerCase().match(core_rnotwhite)||[""],l.crossDomain==null&&(u=rurl.exec(l.url.toLowerCase()),l.crossDomain=!(!u||u[1]===ajaxLocParts[1]&&u[2]===ajaxLocParts[2]&&(u[3]||(u[1]==="http:"?"80":"443"))===(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443")))),l.data&&l.processData&&typeof l.data!="string"&&(l.data=jQuery.param(l.data,l.traditional)),inspectPrefiltersOrTransports(prefilters,l,t,w);if(y===2)return w;a=l.global,a&&jQuery.active++===0&&jQuery.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!rnoContent.test(l.type),r=l.url,l.hasContent||(l.data&&(r=l.url+=(ajax_rquery.test(r)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=rts.test(r)?r.replace(rts,"$1_="+ajax_nonce++):r+(ajax_rquery.test(r)?"&":"?")+"_="+ajax_nonce++)),l.ifModified&&(jQuery.lastModified[r]&&w.setRequestHeader("If-Modified-Since",jQuery.lastModified[r]),jQuery.etag[r]&&w.setRequestHeader("If-None-Match",jQuery.etag[r])),(l.data&&l.hasContent&&l.contentType!==!1||t.contentType)&&w.setRequestHeader("Content-Type",l.contentType),w.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+(l.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):l.accepts["*"]);for(f in l.headers)w.setRequestHeader(f,l.headers[f]);if(!l.beforeSend||l.beforeSend.call(c,w,l)!==!1&&y!==2){b="abort";for(f in{success:1,error:1,complete:1})w[f](l[f]);n=inspectPrefiltersOrTransports(transports,l,t,w);if(!n)S(-1,"No Transport");else{w.readyState=1,a&&h.trigger("ajaxSend",[w,l]),l.async&&l.timeout>0&&(o=setTimeout(function(){w.abort("timeout")},l.timeout));try{y=1,n.send(m,S)}catch(E){if(!(y<2))throw E;S(-1,E)}}return w}return w.abort()},getJSON:function(e,t,n){return jQuery.get(e,t,n,"json")},getScript:function(e,t){return jQuery.get(e,undefined,t,"script")}}),jQuery.each(["get","post"],function(e,t){jQuery[t]=function(e,n,r,i){return jQuery.isFunction(n)&&(i=i||r,r=n,n=undefined),jQuery.ajax({url:e,type:t,dataType:i,data:n,success:r})}}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return jQuery.globalEval(e),e}}}),jQuery.ajaxPrefilter("script",function(e){e.cache===undefined&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),jQuery.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(r,i){t=jQuery("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&i(e.type==="error"?404:200,e.type)}),document.head.appendChild(t[0])},abort:function(){n&&n()}}}});var oldCallbacks=[],rjsonp=/(=)\\?(?=&|$)|\\?\\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=oldCallbacks.pop()||jQuery.expando+"_"+ajax_nonce++;return this[e]=!0,e}}),jQuery.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,s,o=e.jsonp!==!1&&(rjsonp.test(e.url)?"url":typeof e.data=="string"&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(e.data)&&"data");if(o||e.dataTypes[0]==="jsonp")return r=e.jsonpCallback=jQuery.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,o?e[o]=e[o].replace(rjsonp,"$1"+r):e.jsonp!==!1&&(e.url+=(ajax_rquery.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return s||jQuery.error(r+" was not called"),s[0]},e.dataTypes[0]="json",i=window[r],window[r]=function(){s=arguments},n.always(function(){window[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,oldCallbacks.push(r)),s&&jQuery.isFunction(i)&&i(s[0]),s=i=undefined}),"script"}),jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var xhrSupported=jQuery.ajaxSettings.xhr(),xhrSuccessStatus={0:200,1223:204},xhrId=0,xhrCallbacks={};window.ActiveXObject&&jQuery(window).on("unload",function(){for(var e in xhrCallbacks)xhrCallbacks[e]();xhrCallbacks=undefined}),jQuery.support.cors=!!xhrSupported&&"withCredentials"in xhrSupported,jQuery.support.ajax=xhrSupported=!!xhrSupported,jQuery.ajaxTransport(function(e){var t;if(jQuery.support.cors||xhrSupported&&!e.crossDomain)return{send:function(n,r){var i,s,o=e.xhr();o.open(e.type,e.url,e.async,e.username,e.password);if(e.xhrFields)for(i in e.xhrFields)o[i]=e.xhrFields[i];e.mimeType&&o.overrideMimeType&&o.overrideMimeType(e.mimeType),!e.crossDomain&&!n["X-Requested-With"]&&(n["X-Requested-With"]="XMLHttpRequest");for(i in n)o.setRequestHeader(i,n[i]);t=function(e){return function(){t&&(delete xhrCallbacks[s],t=o.onload=o.onerror=null,e==="abort"?o.abort():e==="error"?r(o.status||404,o.statusText):r(xhrSuccessStatus[o.status]||o.status,o.statusText,typeof o.responseText=="string"?{text:o.responseText}:undefined,o.getAllResponseHeaders()))}},o.onload=t(),o.onerror=t("error"),t=xhrCallbacks[s=xhrId++]=t("abort"),o.send(e.hasContent&&e.data||null)},abort:function(){t&&t()}}});var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=rfxnum.exec(t),s=i&&i[3]||(jQuery.cssNumber[e]?"":"px"),o=(jQuery.cssNumber[e]||s!=="px"&&+r)&&rfxnum.exec(jQuery.css(n.elem,e)),u=1,a=20;if(o&&o[3]!==s){s=s||o[3],i=i||[],o=+r||1;do u=u||".5",o/=u,jQuery.style(n.elem,e,o+s);while(u!==(u=n.cur()/r)&&u!==1&&--a)}return i&&(o=n.start=+o||+r||0,n.unit=s,n.end=i[1]?o+(i[1]+1)*i[2]:+i[2]),n}]};jQuery.Animation=jQuery.extend(Animation,{tweener:function(e,t){jQuery.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],tweeners[n]=tweeners[n]||[],tweeners[n].unshift(t)},prefilter:function(e,t){t?animationPrefilters.unshift(e):animationPrefilters.push(e)}}),jQuery.Tween=Tween,Tween.prototype={constructor:Tween,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(jQuery.cssNumber[n]?"":"px")},cur:function(){var e=Tween.propHooks[this.prop];return e&&e.get?e.get(this):Tween.propHooks._default.get(this)},run:function(e){var t,n=Tween.propHooks[this.prop];return this.options.duration?this.pos=t=jQuery.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Tween.propHooks._default.set(this),this}},Tween.prototype.init.prototype=Tween.prototype,Tween.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=jQuery.css(e.elem,e.prop,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){jQuery.fx.step[e.prop]?jQuery.fx.step[e.prop](e):e.elem.style&&(e.elem.style[jQuery.cssProps[e.prop]]!=null||jQuery.cssHooks[e.prop])?jQuery.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},jQuery.each(["toggle","show","hide"],function(e,t){var n=jQuery.fn[t];jQuery.fn[t]=function(e,r,i){return e==null||typeof e=="boolean"?n.apply(this,arguments):this.animate(genFx(t,!0),e,r,i)}}),jQuery.fn.extend({fadeTo:function(e,t,n,r){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=jQuery.isEmptyObject(e),s=jQuery.speed(t,n,r),o=function(){var t=Animation(this,jQuery.extend({},e),s);(i||data_priv.get(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return typeof e!="string"&&(n=t,t=e,e=undefined),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=e!=null&&e+"queueHooks",s=jQuery.timers,o=data_priv.get(this);if(i)o[i]&&o[i].stop&&r(o[i]);else for(i in o)o[i]&&o[i].stop&&rrun.test(i)&&r(o[i]);for(i=s.length;i--;)s[i].elem===this&&(e==null||s[i].queue===e)&&(s[i].anim.stop(n),t=!1,s.splice(i,1));(t||!n)&&jQuery.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=data_priv.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=jQuery.timers,o=r?r.length:0;n.finish=!0,jQuery.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0);for(t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){jQuery.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),jQuery.speed=function(e,t,n){var r=e&&typeof e=="object"?jQuery.extend({},e):{complete:n||!n&&t||jQuery.isFunction(e)&&e,duration:e,easing:n&&t||t&&!jQuery.isFunction(t)&&t};r.duration=jQuery.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in jQuery.fx.speeds?jQuery.fx.speeds[r.duration]:jQuery.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(){jQuery.isFunction(r.old)&&r.old.call(this),r.queue&&jQuery.dequeue(this,r.queue)},r},jQuery.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},jQuery.timers=[],jQuery.fx=Tween.prototype.init,jQuery.fx.tick=function(){var e,t=jQuery.timers,n=0;fxNow=jQuery.now();for(;n<t.length;n++)e=t[n],!e()&&t[n]===e&&t.splice(n--,1);t.length||jQuery.fx.stop(),fxNow=undefined},jQuery.fx.timer=function(e){e()&&jQuery.timers.push(e)&&jQuery.fx.start()},jQuery.fx.interval=13,jQuery.fx.start=function(){timerId||(timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval))},jQuery.fx.stop=function(){clearInterval(timerId),timerId=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fx.step={},jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.animated=function(e){return jQuery.grep(jQuery.timers,function(t){return e===t.elem}).length}),jQuery.fn.offset=function(e){if(arguments.length)return e===undefined?this:this.each(function(t){jQuery.offset.setOffset(this,e,t)});var t,n,r=this[0],i={top:0,left:0},s=r&&r.ownerDocument;if(!s)return;return t=s.documentElement,jQuery.contains(t,r)?(typeof r.getBoundingClientRect!==core_strundefined&&(i=r.getBoundingClientRect()),n=getWindow(s),{top:i.top+n.pageYOffset-t.clientTop,left:i.left+n.pageXOffset-t.clientLeft}):i},jQuery.offset={setOffset:function(e,t,n){var r,i,s,o,u,a,f,l=jQuery.css(e,"position"),c=jQuery(e),h={};l==="static"&&(e.style.position="relative"),u=c.offset(),s=jQuery.css(e,"top"),a=jQuery.css(e,"left"),f=(l==="absolute"||l==="fixed")&&(s+a).indexOf("auto")>-1,f?(r=c.position(),o=r.top,i=r.left):(o=parseFloat(s)||0,i=parseFloat(a)||0),jQuery.isFunction(t)&&(t=t.call(e,n,u)),t.top!=null&&(h.top=t.top-u.top+o),t.left!=null&&(h.left=t.left-u.left+i),"using"in t?t.using.call(e,h):c.css(h)}},jQuery.fn.extend({position:function(){if(!this[0])return;var e,t,n=this[0],r={top:0,left:0};return jQuery.css(n,"position")==="fixed"?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),jQuery.nodeName(e[0],"html")||(r=e.offset()),r.top+=jQuery.css(e[0],"borderTopWidth",!0),r.left+=jQuery.css(e[0],"borderLeftWidth",!0)),{top:t.top-r.top-jQuery.css(n,"marginTop",!0),left:t.left-r.left-jQuery.css(n,"marginLeft",!0)}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||docElem;while(e&&!jQuery.nodeName(e,"html")&&jQuery.css(e,"position")==="static")e=e.offsetParent;return e||docElem})}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;jQuery.fn[e]=function(r){return jQuery.access(this,function(e,r,i){var s=getWindow(e);if(i===undefined)return s?s[t]:e[r];s?s.scrollTo(n?window.pageXOffset:i,n?i:window.pageYOffset):e[r]=i},e,r,arguments.length,null)}}),jQuery.each({Height:"height",Width:"width"},function(e,t){jQuery.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){jQuery.fn[r]=function(r,i){var s=arguments.length&&(n||typeof r!="boolean"),o=n||(r===!0||i===!0?"margin":"border");return jQuery.access(this,function(t,n,r){var i;return jQuery.isWindow(t)?t.document.documentElement["client"+e]:t.nodeType===9?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):r===undefined?jQuery.css(t,n,o):jQuery.style(t,n,r,o)},t,s?r:undefined,s,null)}})}),jQuery.fn.size=function(){return this.length},jQuery.fn.andSelf=jQuery.fn.addBack,typeof module=="object"&&module&&typeof module.exports=="object"?module.exports=jQuery:typeof define=="function"&&define.amd&&define("jquery",[],function(){return jQuery}),typeof window=="object"&&typeof window.document=="object"&&(window.jQuery=window.$=jQuery)}(window),function(){var e=this,t=e.Backbone,n=[],r=n.push,i=n.slice,s=n.splice,o;typeof exports!="undefined"?o=exports:o=e.Backbone={},o.VERSION="1.1.0";var u=e._;!u&&typeof require!="undefined"&&(u=require("underscore")),o.$=e.jQuery||e.Zepto||e.ender||e.$,o.noConflict=function(){return e.Backbone=t,this},o.emulateHTTP=!1,o.emulateJSON=!1;var a=o.Events={on:function(e,t,n){if(!l(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,n){if(!l(this,"once",e,[t,n])||!t)return this;var r=this,i=u.once(function(){r.off(e,i),t.apply(this,arguments)});return i._callback=t,this.on(e,i,n)},off:function(e,t,n){var r,i,s,o,a,f,c,h;if(!this._events||!l(this,"off",e,[t,n]))return this;if(!e&&!t&&!n)return this._events={},this;o=e?[e]:u.keys(this._events);for(a=0,f=o.length;a<f;a++){e=o[a];if(s=this._events[e]){this._events[e]=r=[];if(t||n)for(c=0,h=s.length;c<h;c++)i=s[c],(t&&t!==i.callback&&t!==i.callback._callback||n&&n!==i.context)&&r.push(i);r.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=i.call(arguments,1);if(!l(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&c(n,t),r&&c(r,arguments),this},stopListening:function(e,t,n){var r=this._listeningTo;if(!r)return this;var i=!t&&!n;!n&&typeof t=="object"&&(n=this),e&&((r={})[e._listenId]=e);for(var s in r)e=r[s],e.off(t,n,this),(i||u.isEmpty(e._events))&&delete this._listeningTo[s];return this}},f=/\\s+/,l=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(f.test(n)){var s=n.split(f);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},c=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},h={listenTo:"on",listenToOnce:"once"};u.each(h,function(e,t){a[t]=function(t,n,r){var i=this._listeningTo||(this._listeningTo={}),s=t._listenId||(t._listenId=u.uniqueId("l"));return i[s]=t,!r&&typeof n=="object"&&(r=this),t[e](n,r,this),this}}),a.bind=a.on,a.unbind=a.off,u.extend(o,a);var p=o.Model=function(e,t){var n=e||{};t||(t={}),this.cid=u.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{}),n=u.defaults({},n,u.result(this,"defaults")),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};u.extend(p.prototype,a,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return u.clone(this.attributes)},sync:function(){return o.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return u.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,n){var r,i,s,o,a,f,l,c;if(e==null)return this;typeof e=="object"?(i=e,n=t):(i={})[e]=t,n||(n={});if(!this._validate(i,n))return!1;s=n.unset,a=n.silent,o=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=u.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in i&&(this.id=i[this.idAttribute]);for(r in i)t=i[r],u.isEqual(c[r],t)||o.push(r),u.isEqual(l[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete c[r]:c[r]=t;if(!a){o.length&&(this._pending=!0);for(var h=0,p=o.length;h<p;h++)this.trigger("change:"+o[h],this,c[o[h]],n)}if(f)return this;if(!a)while(this._pending)this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,u.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,u.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!u.isEmpty(this.changed):u.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?u.clone(this.changed):!1;var t,n=!1,r=this._changing?this._previousAttributes:this.attributes;for(var i in e){if(u.isEqual(r[i],t=e[i]))continue;(n||(n={}))[i]=t}return n},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return u.clone(this._previousAttributes)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,n=e.success;return e.success=function(r){if(!t.set(t.parse(r,e),e))return!1;n&&n(t,r,e),t.trigger("sync",t,r,e)},F(this,e),this.sync("read",this,e)},save:function(e,t,n){var r,i,s,o=this.attributes;e==null||typeof e=="object"?(r=e,n=t):(r={})[e]=t,n=u.extend({validate:!0},n);if(r&&!n.wait){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;r&&n.wait&&(this.attributes=u.extend({},o,r)),n.parse===void 0&&(n.parse=!0);var a=this,f=n.success;return n.success=function(e){a.attributes=o;var t=a.parse(e,n);n.wait&&(t=u.extend(r||{},t));if(u.isObject(t)&&!a.set(t,n))return!1;f&&f(a,e,n),a.trigger("sync",a,e,n)},F(this,n),i=this.isNew()?"create":n.patch?"patch":"update",i==="patch"&&(n.attrs=r),s=this.sync(i,this,n),r&&n.wait&&(this.attributes=o),s},destroy:function(e){e=e?u.clone(e):{};var t=this,n=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(i){(e.wait||t.isNew())&&r(),n&&n(t,i,e),t.isNew()||t.trigger("sync",t,i,e)};if(this.isNew())return e.success(),!1;F(this,e);var i=this.sync("delete",this,e);return e.wait||r(),i},url:function(){var e=u.result(this,"urlRoot")||u.result(this.collection,"url")||j();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(e){return this._validate({},u.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=u.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,u.extend(t,{validationError:n})),!1):!0}});var d=["keys","values","pairs","invert","pick","omit"];u.each(d,function(e){p.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.attributes),u[e].apply(u,t)}});var v=o.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,u.extend({silent:!0},t))},m={add:!0,remove:!0,merge:!0},g={add:!0,remove:!1};u.extend(v.prototype,a,{model:p,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return o.sync.apply(this,arguments)},add:function(e,t){return this.set(e,u.extend({merge:!1},t,g))},remove:function(e,t){var n=!u.isArray(e);e=n?[e]:u.clone(e),t||(t={});var r,i,s,o;for(r=0,i=e.length;r<i;r++){o=e[r]=this.get(e[r]);if(!o)continue;delete this._byId[o.id],delete this._byId[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,t.silent||(t.index=s,o.trigger("remove",o,this,t)),this._removeReference(o)}return n?e[0]:e},set:function(e,t){t=u.defaults({},t,m),t.parse&&(e=this.parse(e,t));var n=!u.isArray(e);e=n?e?[e]:[]:u.clone(e);var r,i,s,o,a,f,l,c=t.at,h=this.model,d=this.comparator&&c==null&&t.sort!==!1,v=u.isString(this.comparator)?this.comparator:null,g=[],y=[],b={},w=t.add,E=t.merge,S=t.remove,x=!d&&w&&S?[]:!1;for(r=0,i=e.length;r<i;r++){a=e[r],a instanceof p?s=o=a:s=a[h.prototype.idAttribute];if(f=this.get(s))S&&(b[f.cid]=!0),E&&(a=a===o?o.attributes:a,t.parse&&(a=f.parse(a,t)),f.set(a,t),d&&!l&&f.hasChanged(v)&&(l=!0)),e[r]=f;else if(w){o=e[r]=this._prepareModel(a,t);if(!o)continue;g.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,o.id!=null&&(this._byId[o.id]=o)}x&&x.push(f||o)}if(S){for(r=0,i=this.length;r<i;++r)b[(o=this.models[r]).cid]||y.push(o);y.length&&this.remove(y,t)}if(g.length||x&&x.length){d&&(l=!0),this.length+=g.length;if(c!=null)for(r=0,i=g.length;r<i;r++)this.models.splice(c+r,0,g[r]);else{x&&(this.models.length=0);var T=x||g;for(r=0,i=T.length;r<i;r++)this.models.push(T[r])}}l&&this.sort({silent:!0});if(!t.silent){for(r=0,i=g.length;r<i;r++)(o=g[r]).trigger("add",o,this,t);(l||x&&x.length)&&this.trigger("sort",this,t)}return n?e[0]:e},reset:function(e,t){t||(t={});for(var n=0,r=this.models.length;n<r;n++)this._removeReference(this.models[n]);return t.previousModels=this.models,this._reset(),e=this.add(e,u.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,u.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,u.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return i.apply(this.models,arguments)},get:function(e){return e==null?void 0:this._byId[e.id]||this._byId[e.cid]||this._byId[e]},at:function(e){return this.models[e]},where:function(e,t){return u.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),u.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(u.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return u.invoke(this.models,"get",e)},fetch:function(e){e=e?u.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,n=this;return e.success=function(r){var i=e.reset?"reset":"set";n[i](r,e),t&&t(n,r,e),n.trigger("sync",n,r,e)},F(this,e),this.sync("read",this,e)},create:function(e,t){t=t?u.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var n=this,r=t.success;return t.success=function(e,t,i){i.wait&&n.add(e,i),r&&r(e,t,i)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof p)return e.collection||(e.collection=this),e;t=t?u.clone(t):{},t.collection=this;var n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var y=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];u.each(y,function(e){v.prototype[e]=function(){var t=i.call(arguments);return t.unshift(this.models),u[e].apply(u,t)}});var b=["groupBy","countBy","sortBy"];u.each(b,function(e){v.prototype[e]=function(t,n){var r=u.isFunction(t)?t:function(e){return e.get(t)};return u[e](this.models,r,n)}});var w=o.View=function(e){this.cid=u.uniqueId("view"),e||(e={}),u.extend(this,u.pick(e,S)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},E=/^(\\S+)\\s*(.*)$/,S=["model","collection","el","id","attributes","className","tagName","events"];u.extend(w.prototype,a,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof o.$?e:o.$(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=u.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var n=e[t];u.isFunction(n)||(n=this[e[t]]);if(!n)continue;var r=t.match(E),i=r[1],s=r[2];n=u.bind(n,this),i+=".delegateEvents"+this.cid,s===""?this.$el.on(i,n):this.$el.on(i,s,n)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(!this.el){var e=u.extend({},u.result(this,"attributes"));this.id&&(e.id=u.result(this,"id")),this.className&&(e["class"]=u.result(this,"className"));var t=o.$("<"+u.result(this,"tagName")+">").attr(e);this.setElement(t,!1)}else this.setElement(u.result(this,"el"),!1)}}),o.sync=function(e,t,n){var r=T[e];u.defaults(n||(n={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var i={type:r,dataType:"json"};n.url||(i.url=u.result(t,"url")||j()),n.data==null&&t&&(e==="create"||e==="update"||e==="patch")&&(i.contentType="application/json",i.data=JSON.stringify(n.attrs||t.toJSON(n))),n.emulateJSON&&(i.contentType="application/x-www-form-urlencoded",i.data=i.data?{model:i.data}:{});if(n.emulateHTTP&&(r==="PUT"||r==="DELETE"||r==="PATCH")){i.type="POST",n.emulateJSON&&(i.data._method=r);var s=n.beforeSend;n.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r);if(s)return s.apply(this,arguments)}}i.type!=="GET"&&!n.emulateJSON&&(i.processData=!1),i.type==="PATCH"&&x&&(i.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=n.xhr=o.ajax(u.extend(i,n));return t.trigger("request",t,a,n),a};var x=typeof window!="undefined"&&!!window.ActiveXObject&&(!window.XMLHttpRequest||!(new XMLHttpRequest).dispatchEvent),T={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};o.ajax=function(){return o.$.ajax.apply(o.$,arguments)};var N=o.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\\((.*?)\\)/g,k=/(\\(\\?)?:\\w+/g,L=/\\*\\w+/g,A=/[\\-{}\\[\\]+?.,\\\\\\^$|#\\s]/g;u.extend(N.prototype,a,{initialize:function(){},route:function(e,t,n){u.isRegExp(e)||(e=this._routeToRegExp(e)),u.isFunction(t)&&(n=t,t=""),n||(n=this[t]);var r=this;return o.history.route(e,function(i){var s=r._extractParameters(e,i);n&&n.apply(r,s),r.trigger.apply(r,["route:"+t].concat(s)),r.trigger("route",t,s),o.history.trigger("route",r,t,s)}),this},navigate:function(e,t){return o.history.navigate(e,t),this},_bindRoutes:function(){if(!this.routes)return;this.routes=u.result(this,"routes");var e,t=u.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(A,"\\\\$&").replace(C,"(?:$1)?").replace(k,function(e,t){return t?e:"([^/]+)"}).replace(L,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return u.map(n,function(e){return e?decodeURIComponent(e):null})}});var O=o.History=function(){this.handlers=[],u.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},M=/^[#\\/]|\\s+$/g,_=/^\\/+|\\/+$/g,D=/msie [\\w.]+/,P=/\\/$/,H=/[?#].*$/;O.started=!1,u.extend(O.prototype,a,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(P,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(M,"")},start:function(e){if(O.started)throw new Error("Backbone.history has already been started");O.started=!0,this.options=u.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var t=this.getFragment(),n=document.documentMode,r=D.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);this.root=("/"+this.root+"/").replace(_,"/"),r&&this._wantsHashChange&&(this.iframe=o.$(\'<iframe src="javascript:0" tabindex="-1" />\').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?o.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?o.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var i=this.location,s=i.pathname.replace(/[^\\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!s)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&s&&i.hash&&(this.fragment=this.getHash().replace(M,""),this.history.replaceState({},document.title,this.root+this.fragment+i.search))}if(!this.options.silent)return this.loadUrl()},stop:function(){o.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),O.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return e=this.fragment=this.getFragment(e),u.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(e,t){if(!O.started)return!1;if(!t||t===!0)t={trigger:!!t};var n=this.root+(e=this.getFragment(e||""));e=e.replace(H,"");if(this.fragment===e)return;this.fragment=e,e===""&&n!=="/"&&(n=n.slice(0,-1));if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}if(t.trigger)return this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),o.history=new O;var B=function(e,t){var n=this,r;e&&u.has(e,"constructor")?r=e.constructor:r=function(){return n.apply(this,arguments)},u.extend(r,n,t);var i=function(){this.constructor=r};return i.prototype=n.prototype,r.prototype=new i,e&&u.extend(r.prototype,e),r.__super__=n.prototype,r};p.extend=v.extend=N.extend=w.extend=O.extend=B;var j=function(){throw new Error(\'A "url" property or function must be specified\')},F=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}}}.call(this),define("backbone",["underscore","jquery"],function(e){return function(){var t,n;return t||e.Backbone}}(this));if(typeof jQuery=="undefined")throw new Error("Bootstrap requires jQuery");+function(e){"use strict";function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in t)if(e.style[n]!==undefined)return{end:t[n]}}e.fn.emulateTransitionEnd=function(t){var n=!1,r=this;e(this).one(e.support.transition.end,function(){n=!0});var i=function(){n||e(r).trigger(e.support.transition.end)};return setTimeout(i,t),this},e(function(){e.support.transition=t()})}(jQuery),+function(e){"use strict";var t=\'[data-dismiss="alert"]\',n=function(n){e(n).on("click",t,this.close)};n.prototype.close=function(t){function s(){i.trigger("closed.bs.alert").remove()}var n=e(this),r=n.attr("data-target");r||(r=n.attr("href"),r=r&&r.replace(/.*(?=#[^\\s]*$)/,""));var i=e(r);t&&t.preventDefault(),i.length||(i=n.hasClass("alert")?n:n.parent()),i.trigger(t=e.Event("close.bs.alert"));if(t.isDefaultPrevented())return;i.removeClass("in"),e.support.transition&&i.hasClass("fade")?i.one(e.support.transition.end,s).emulateTransitionEnd(150):s()};var r=e.fn.alert;e.fn.alert=function(t){return this.each(function(){var r=e(this),i=r.data("bs.alert");i||r.data("bs.alert",i=new n(this)),typeof t=="string"&&i[t].call(r)})},e.fn.alert.Constructor=n,e.fn.alert.noConflict=function(){return e.fn.alert=r,this},e(document).on("click.bs.alert.data-api",t,n.prototype.close)}(jQuery),+function(e){"use strict";var t=function(n,r){this.$element=e(n),this.options=e.extend({},t.DEFAULTS,r)};t.DEFAULTS={loadingText:"loading..."},t.prototype.setState=function(e){var t="disabled",n=this.$element,r=n.is("input")?"val":"html",i=n.data();e+="Text",i.resetText||n.data("resetText",n[r]()),n[r](i[e]||this.options[e]),setTimeout(function(){e=="loadingText"?n.addClass(t).attr(t,t):n.removeClass(t).removeAttr(t)},0)},t.prototype.toggle=function(){var e=this.$element.closest(\'[data-toggle="buttons"]\'),t=!0;if(e.length){var n=this.$element.find("input");n.prop("type")==="radio"&&(n.prop("checked")&&this.$element.hasClass("active")?t=!1:e.find(".active").removeClass("active")),t&&n.prop("checked",!this.$element.hasClass("active")).trigger("change")}t&&this.$element.toggleClass("active")};var n=e.fn.button;e.fn.button=function(n){return this.each(function(){var r=e(this),i=r.data("bs.button"),s=typeof n=="object"&&n;i||r.data("bs.button",i=new t(this,s)),n=="toggle"?i.toggle():n&&i.setState(n)})},e.fn.button.Constructor=t,e.fn.button.noConflict=function(){return e.fn.button=n,this},e(document).on("click.bs.button.data-api","[data-toggle^=button]",function(t){var n=e(t.target);n.hasClass("btn")||(n=n.closest(".btn")),n.button("toggle"),t.preventDefault()})}(jQuery),+function(e){"use strict";var t=function(t,n){this.$element=e(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=n,this.paused=this.sliding=this.interval=this.$active=this.$items=null,this.options.pause=="hover"&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.DEFAULTS={interval:5e3,pause:"hover",wrap:!0},t.prototype.cycle=function(t){return t||(this.paused=!1),t

]]></string> </value>
        </item>
        <item>
            <key> <string>next</string> </key>
            <value>
              <persistent> <string encoding="base64">AAAAAAAAAAM=</string> </persistent>
            </value>
        </item>
      </dictionary>
    </pickle>
  </record>
  <record id="3" aka="AAAAAAAAAAM=">
    <pickle>
      <global name="Pdata" module="OFS.Image"/>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>data</string> </key>
            <value> <string encoding="cdata"><![CDATA[

his.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},t.prototype.getActiveIndex=function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},t.prototype.to=function(t){var n=this,r=this.getActiveIndex();if(t>this.$items.length-1||t<0)return;return this.sliding?this.$element.one("slid.bs.carousel",function(){n.to(t)}):r==t?this.pause().cycle():this.slide(t>r?"next":"prev",e(this.$items[t]))},t.prototype.pause=function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition.end&&(this.$element.trigger(e.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},t.prototype.next=function(){if(this.sliding)return;return this.slide("next")},t.prototype.prev=function(){if(this.sliding)return;return this.slide("prev")},t.prototype.slide=function(t,n){var r=this.$element.find(".item.active"),i=n||r[t](),s=this.interval,o=t=="next"?"left":"right",u=t=="next"?"first":"last",a=this;if(!i.length){if(!this.options.wrap)return;i=this.$element.find(".item")[u]()}this.sliding=!0,s&&this.pause();var f=e.Event("slide.bs.carousel",{relatedTarget:i[0],direction:o});if(i.hasClass("active"))return;this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid.bs.carousel",function(){var t=e(a.$indicators.children()[a.getActiveIndex()]);t&&t.addClass("active")}));if(e.support.transition&&this.$element.hasClass("slide")){this.$element.trigger(f);if(f.isDefaultPrevented())return;i.addClass(t),i[0].offsetWidth,r.addClass(o),i.addClass(o),r.one(e.support.transition.end,function(){i.removeClass([t,o].join(" ")).addClass("active"),r.removeClass(["active",o].join(" ")),a.sliding=!1,setTimeout(function(){a.$element.trigger("slid.bs.carousel")},0)}).emulateTransitionEnd(600)}else{this.$element.trigger(f);if(f.isDefaultPrevented())return;r.removeClass("active"),i.addClass("active"),this.sliding=!1,this.$element.trigger("slid.bs.carousel")}return s&&this.cycle(),this};var n=e.fn.carousel;e.fn.carousel=function(n){return this.each(function(){var r=e(this),i=r.data("bs.carousel"),s=e.extend({},t.DEFAULTS,r.data(),typeof n=="object"&&n),o=typeof n=="string"?n:s.slide;i||r.data("bs.carousel",i=new t(this,s)),typeof n=="number"?i.to(n):o?i[o]():s.interval&&i.pause().cycle()})},e.fn.carousel.Constructor=t,e.fn.carousel.noConflict=function(){return e.fn.carousel=n,this},e(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(t){var n=e(this),r,i=e(n.attr("data-target")||(r=n.attr("href"))&&r.replace(/.*(?=#[^\\s]+$)/,"")),s=e.extend({},i.data(),n.data()),o=n.attr("data-slide-to");o&&(s.interval=!1),i.carousel(s),(o=n.attr("data-slide-to"))&&i.data("bs.carousel").to(o),t.preventDefault()}),e(window).on("load",function(){e(\'[data-ride="carousel"]\').each(function(){var t=e(this);t.carousel(t.data())})})}(jQuery),+function(e){"use strict";var t=function(n,r){this.$element=e(n),this.options=e.extend({},t.DEFAULTS,r),this.transitioning=null,this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};t.DEFAULTS={toggle:!0},t.prototype.dimension=function(){var e=this.$element.hasClass("width");return e?"width":"height"},t.prototype.show=function(){if(this.transitioning||this.$element.hasClass("in"))return;var t=e.Event("show.bs.collapse");this.$element.trigger(t);if(t.isDefaultPrevented())return;var n=this.$parent&&this.$parent.find("> .panel > .in");if(n&&n.length){var r=n.data("bs.collapse");if(r&&r.transitioning)return;n.collapse("hide"),r||n.data("bs.collapse",null)}var i=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[i](0),this.transitioning=1;var s=function(){this.$element.removeClass("collapsing").addClass("in")[i]("auto"),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!e.support.transition)return s.call(this);var o=e.camelCase(["scroll",i].join("-"));this.$element.one(e.support.transition.end,e.proxy(s,this)).emulateTransitionEnd(350)[i](this.$element[0][o])},t.prototype.hide=function(){if(this.transitioning||!this.$element.hasClass("in"))return;var t=e.Event("hide.bs.collapse");this.$element.trigger(t);if(t.isDefaultPrevented())return;var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var r=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};if(!e.support.transition)return r.call(this);this.$element[n](0).one(e.support.transition.end,e.proxy(r,this)).emulateTransitionEnd(350)},t.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var n=e.fn.collapse;e.fn.collapse=function(n){return this.each(function(){var r=e(this),i=r.data("bs.collapse"),s=e.extend({},t.DEFAULTS,r.data(),typeof n=="object"&&n);i||r.data("bs.collapse",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.collapse.Constructor=t,e.fn.collapse.noConflict=function(){return e.fn.collapse=n,this},e(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(t){var n=e(this),r,i=n.attr("data-target")||t.preventDefault()||(r=n.attr("href"))&&r.replace(/.*(?=#[^\\s]+$)/,""),s=e(i),o=s.data("bs.collapse"),u=o?"toggle":n.data(),a=n.attr("data-parent"),f=a&&e(a);if(!o||!o.transitioning)f&&f.find(\'[data-toggle=collapse][data-parent="\'+a+\'"]\').not(n).addClass("collapsed"),n[s.hasClass("in")?"addClass":"removeClass"]("collapsed");s.collapse(u)})}(jQuery),+function(e){"use strict";function i(){e(t).remove(),e(n).each(function(t){var n=s(e(this));if(!n.hasClass("open"))return;n.trigger(t=e.Event("hide.bs.dropdown"));if(t.isDefaultPrevented())return;n.removeClass("open").trigger("hidden.bs.dropdown")})}function s(t){var n=t.attr("data-target");n||(n=t.attr("href"),n=n&&/#/.test(n)&&n.replace(/.*(?=#[^\\s]*$)/,""));var r=n&&e(n);return r&&r.length?r:t.parent()}var t=".dropdown-backdrop",n="[data-toggle=dropdown]",r=function(t){e(t).on("click.bs.dropdown",this.toggle)};r.prototype.toggle=function(t){var n=e(this);if(n.is(".disabled, :disabled"))return;var r=s(n),o=r.hasClass("open");i();if(!o){"ontouchstart"in document.documentElement&&!r.closest(".navbar-nav").length&&e(\'<div class="dropdown-backdrop"/>\').insertAfter(e(this)).on("click",i),r.trigger(t=e.Event("show.bs.dropdown"));if(t.isDefaultPrevented())return;r.toggleClass("open").trigger("shown.bs.dropdown"),n.focus()}return!1},r.prototype.keydown=function(t){if(!/(38|40|27)/.test(t.keyCode))return;var r=e(this);t.preventDefault(),t.stopPropagation();if(r.is(".disabled, :disabled"))return;var i=s(r),o=i.hasClass("open");if(!o||o&&t.keyCode==27)return t.which==27&&i.find(n).focus(),r.click();var u=e("[role=menu] li:not(.divider):visible a",i);if(!u.length)return;var a=u.index(u.filter(":focus"));t.keyCode==38&&a>0&&a--,t.keyCode==40&&a<u.length-1&&a++,~a||(a=0),u.eq(a).focus()};var o=e.fn.dropdown;e.fn.dropdown=function(t){return this.each(function(){var n=e(this),i=n.data("bs.dropdown");i||n.data("bs.dropdown",i=new r(this)),typeof t=="string"&&i[t].call(n)})},e.fn.dropdown.Constructor=r,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=o,this},e(document).on("click.bs.dropdown.data-api",i).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",n,r.prototype.toggle).on("keydown.bs.dropdown.data-api",n+", [role=menu]",r.prototype.keydown)}(jQuery),+function(e){"use strict";var t=function(t,n){this.options=n,this.$element=e(t),this.$backdrop=this.isShown=null,this.options.remote&&this.$element.load(this.options.remote)};t.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},t.prototype.toggle=function(e){return this[this.isShown?"hide":"show"](e)},t.prototype.show=function(t){var n=this,r=e.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(r);if(this.isShown||r.isDefaultPrevented())return;this.isShown=!0,this.escape(),this.$element.on("click.dismiss.modal",\'[data-dismiss="modal"]\',e.proxy(this.hide,this)),this.backdrop(function(){var r=e.support.transition&&n.$element.hasClass("fade");n.$element.parent().length||n.$element.appendTo(document.body),n.$element.show(),r&&n.$element[0].offsetWidth,n.$element.addClass("in").attr("aria-hidden",!1),n.enforceFocus();var i=e.Event("shown.bs.modal",{relatedTarget:t});r?n.$element.find(".modal-dialog").one(e.support.transition.end,function(){n.$element.focus().trigger(i)}).emulateTransitionEnd(300):n.$element.focus().trigger(i)})},t.prototype.hide=function(t){t&&t.preventDefault(),t=e.Event("hide.bs.modal"),this.$element.trigger(t);if(!this.isShown||t.isDefaultPrevented())return;this.isShown=!1,this.escape(),e(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.modal"),e.support.transition&&this.$element.hasClass("fade")?this.$element.one(e.support.transition.end,e.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal()},t.prototype.enforceFocus=function(){e(document).off("focusin.bs.modal").on("focusin.bs.modal",e.proxy(function(e){this.$element[0]!==e.target&&!this.$element.has(e.target).length&&this.$element.focus()},this))},t.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",e.proxy(function(e){e.which==27&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},t.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.removeBackdrop(),e.$element.trigger("hidden.bs.modal")})},t.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},t.prototype.backdrop=function(t){var n=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=e.support.transition&&r;this.$backdrop=e(\'<div class="modal-backdrop \'+r+\'" />\').appendTo(document.body),this.$element.on("click.dismiss.modal",e.proxy(function(e){if(e.target!==e.currentTarget)return;this.options.backdrop=="static"?this.$element[0].focus.call(this.$element[0]):this.hide.call(this)},this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in");if(!t)return;i?this.$backdrop.one(e.support.transition.end,t).emulateTransitionEnd(150):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,t).emulateTransitionEnd(150):t()):t&&t()};var n=e.fn.modal;e.fn.modal=function(n,r){return this.each(function(){var i=e(this),s=i.data("bs.modal"),o=e.extend({},t.DEFAULTS,i.data(),typeof n=="object"&&n);s||i.data("bs.modal",s=new t(this,o)),typeof n=="string"?s[n](r):o.show&&s.show(r)})},e.fn.modal.Constructor=t,e.fn.modal.noConflict=function(){return e.fn.modal=n,this},e(document).on("click.bs.modal.data-api",\'[data-toggle="modal"]\',function(t){var n=e(this),r=n.attr("href"),i=e(n.attr("data-target")||r&&r.replace(/.*(?=#[^\\s]+$)/,"")),s=i.data("modal")?"toggle":e.extend({remote:!/#/.test(r)&&r},i.data(),n.data());t.preventDefault(),i.modal(s,this).one("hide",function(){n.is(":visible")&&n.focus()})}),e(document).on("show.bs.modal",".modal",function(){e(document.body).addClass("modal-open")}).on("hidden.bs.modal",".modal",function(){e(document.body).removeClass("modal-open")})}(jQuery),+function(e){"use strict";var t=function(e,t){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",e,t)};t.DEFAULTS={animation:!0,placement:"top",selector:!1,template:\'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>\',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},t.prototype.init=function(t,n,r){this.enabled=!0,this.type=t,this.$element=e(n),this.options=this.getOptions(r);var i=this.options.trigger.split(" ");for(var s=i.length;s--;){var o=i[s];if(o=="click")this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this));else if(o!="manual"){var u=o=="hover"?"mouseenter":"focus",a=o=="hover"?"mouseleave":"blur";this.$element.on(u+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(a+"."+this.type,this.options.selector,e.proxy(this.leave,this))}}this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},t.prototype.getDefaults=function(){return t.DEFAULTS},t.prototype.getOptions=function(t){return t=e.extend({},this.getDefaults(),this.$element.data(),t),t.delay&&typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),t},t.prototype.getDelegateOptions=function(){var t={},n=this.getDefaults();return this._options&&e.each(this._options,function(e,r){n[e]!=r&&(t[e]=r)}),t},t.prototype.enter=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);clearTimeout(n.timeout),n.hoverState="in";if(!n.options.delay||!n.options.delay.show)return n.show();n.timeout=setTimeout(function(){n.hoverState=="in"&&n.show()},n.options.delay.show)},t.prototype.leave=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);clearTimeout(n.timeout),n.hoverState="out";if(!n.options.delay||!n.options.delay.hide)return n.hide();n.timeout=setTimeout(function(){n.hoverState=="out"&&n.hide()},n.options.delay.hide)},t.prototype.show=function(){var t=e.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(t);if(t.isDefaultPrevented())return;var n=this.tip();this.setContent(),this.options.animation&&n.addClass("fade");var r=typeof this.options.placement=="function"?this.options.placement.call(this,n[0],this.$element[0]):this.options.placement,i=/\\s?auto?\\s?/i,s=i.test(r);s&&(r=r.replace(i,"")||"top"),n.detach().css({top:0,left:0,display:"block"}).addClass(r),this.options.container?n.appendTo(this.options.container):n.insertAfter(this.$element);var o=this.getPosition(),u=n[0].offsetWidth,a=n[0].offsetHeight;if(s){var f=this.$element.parent(),l=r,c=document.documentElement.scrollTop||document.body.scrollTop,h=this.options.container=="body"?window.innerWidth:f.outerWidth(),p=this.options.container=="body"?window.innerHeight:f.outerHeight(),d=this.options.container=="body"?0:f.offset().left;r=r=="bottom"&&o.top+o.height+a-c>p?"top":r=="top"&&o.top-c-a<0?"bottom":r=="right"&&o.right+u>h?"left":r=="left"&&o.left-u<d?"right":r,n.removeClass(l).addClass(r)}var v=this.getCalculatedOffset(r,o,u,a);this.applyPlacement(v,r),this.$element.trigger("shown.bs."+this.type)}},t.prototype.applyPlacement=function(e,t){var n,r=this.tip(),i=r[0].offsetWidth,s=r[0].offsetHeight,o=parseInt(r.css("margin-top"),10),u=parseInt(r.css("margin-left"),10);isNaN(o)&&(o=0),isNaN(u)&&(u=0),e.top=e.top+o,e.left=e.left+u,r.offset(e).addClass("in");var a=r[0].offsetWidth,f=r[0].offsetHeight;t=="top"&&f!=s&&(n=!0,e.top=e.top+s-f);if(/bottom|top/.test(t)){var l=0;e.left<0&&(l=e.left*-2,e.left=0,r.offset(e),a=r[0].offsetWidth,f=r[0].offsetHeight),this.replaceArrow(l-i+a,a,"left")}else this.replaceArrow(f-s,f,"top");n&&r.offset(e)},t.prototype.replaceArrow=function(e,t,n){this.arrow().css(n,e?50*(1-e/t)+"%":"")},t.prototype.setContent=function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},t.prototype.hide=function(){function i(){t.hoverState!="in"&&n.detach()}var t=this,n=this.tip(),r=e.Event("hide.bs."+this.type);this.$element.trigger(r);if(r.isDefaultPrevented())return;return n.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?n.one(e.support.transition.end,i).emulateTransitionEnd(150):i(),this.$element.trigger("hidden.bs."+this.type),this},t.prototype.fixTitle=function(){var e=this.$element;(e.attr("title")||typeof e.attr("data-original-title")!="string")&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},t.prototype.hasContent=function(){return this.getTitle()},t.prototype.getPosition=function(){var t=this.$element[0];return e.extend({},typeof t.getBoundingClientRect=="function"?t.getBoundingClientRect():{width:t.offsetWidth,height:t.offsetHeight},this.$element.offset())},t.prototype.getCalculatedOffset=function(e,t,n,r){return e=="bottom"?{top:t.top+t.height,left:t.left+t.width/2-n/2}:e=="top"?{top:t.top-r,left:t.left+t.width/2-n/2}:e=="left"?{top:t.top+t.height/2-r/2,left:t.left-n}:{top:t.top+t.height/2-r/2,left:t.left+t.width}},t.prototype.getTitle=function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||(typeof n.title=="function"?n.title.call(t[0]):n.title),e},t.prototype.tip=function(){return this.$tip=this.$tip||e(this.options.template)},t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},t.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},t.prototype.enable=function(){this.enabled=!0},t.prototype.disable=function(){this.enabled=!1},t.prototype.toggleEnabled=function(){this.enabled=!this.enabled},t.prototype.toggle=function(t){var n=t?e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type):this;n.tip().hasClass("in")?n.leave(n):n.enter(n)},t.prototype.destroy=function(){this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var n=e.fn.tooltip;e.fn.tooltip=function(n){return this.each(function(){var r=e(this),i=r.data("bs.tooltip"),s=typeof n=="object"&&n;i||r.data("bs.tooltip",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.tooltip.Constructor=t,e.fn.tooltip.noConflict=function(){return e.fn.tooltip=n,this}}(jQuery),+function(e){"use strict";var t=function(e,t){this.init("popover",e,t)};if(!e.fn.tooltip)throw new Error("Popover requires tooltip.js");t.DEFAULTS=e.extend({},e.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:\'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>\'}),t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype),t.prototype.constructor=t,t.prototype.getDefaults=function(){return t.DEFAULTS},t.prototype.setContent=function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content")[this.options.html?"html":"text"](n),e.removeClass("fade top bottom left right in"),e.find(".popover-title").html()||e.find(".popover-title").hide()},t.prototype.hasContent=function(){return this.getTitle()||this.getContent()},t.prototype.getContent=function(){var e=this.$element,t=this.options;return e.attr("data-content")||(typeof t.content=="function"?t.content.call(e[0]):t.content)},t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},t.prototype.tip=function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip};var n=e.fn.popover;e.fn.popover=function(n){return this.each(function(){var r=e(this),i=r.data("bs.popover"),s=typeof n=="object"&&n;i||r.data("bs.popover",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.popover.Constructor=t,e.fn.popover.noConflict=function(){return e.fn.popover=n,this}}(jQuery),+function(e){"use strict";function t(n,r){var i,s=e.proxy(this.process,this);this.$element=e(n).is("body")?e(window):e(n),this.$body=e("body"),this.$scrollElement=this.$element.on("scroll.bs.scroll-spy.data-api",s),this.options=e.extend({},t.DEFAULTS,r),this.selector=(this.options.target||(i=e(n).attr("href"))&&i.replace(/.*(?=#[^\\s]+$)/,"")||"")+" .nav li > a",this.offsets=e([]),this.targets=e([]),this.activeTarget=null,this.refresh(),this.process()}t.DEFAULTS={offset:10},t.prototype.refresh=function(){var t=this.$element[0]==window?"offset":"position";this.offsets=e([]),this.targets=e([]);var n=this,r=this.$body.find(this.selector).map(function(){var r=e(this),i=r.data("target")||r.attr("href"),s=/^#\\w/.test(i)&&e(i);return s&&s.length&&[[s[t]().top+(!e.isWindow(n.$scrollElement.get(0))&&n.$scrollElement.scrollTop()),i]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){n.offsets.push(this[0]),n.targets.push(this[1])})},t.prototype.process=function(){var e=this.$scrollElement.scrollTop()+this.options.offset,t=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,n=t-this.$scrollElement.height(),r=this.offsets,i=this.targets,s=this.activeTarget,o;if(e>=n)return s!=(o=i.last()[0])&&this.activate(o);for(o=r.length;o--;)s!=i[o]&&e>=r[o]&&(!r[o+1]||e<=r[o+1])&&this.activate(i[o])},t.prototype.activate=function(t){this.activeTarget=t,e(this.selector).parents(".active").removeClass("active");var n=this.selector+\'[data-target="\'+t+\'"],\'+this.selector+\'[href="\'+t+\'"]\',r=e(n).parents("li").addClass("active");r.parent(".dropdown-menu").length&&(r=r.closest("li.dropdown").addClass("active")),r.trigger("activate.bs.scrollspy")};var n=e.fn.scrollspy;e.fn.scrollspy=function(n){return this.each(function(){var r=e(this),i=r.data("bs.scrollspy"),s=typeof n=="object"&&n;i||r.data("bs.scrollspy",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.scrollspy.Constructor=t,e.fn.scrollspy.noConflict=function(){return e.fn.scrollspy=n,this},e(window).on("load",function(){e(\'[data-spy="scroll"]\').each(function(){var t=e(this);t.scrollspy(t.data())})})}(jQuery),+function(e){"use strict";var t=function(t){this.element=e(t)};t.prototype.show=function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.data("target");r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\\s]*$)/,""));if(t.parent("li").hasClass("active"))return;var i=n.find(".active:last a")[0],s=e.Event("show.bs.tab",{relatedTarget:i});t.trigger(s);if(s.isDefaultPrevented())return;var o=e(r);this.activate(t.parent("li"),n),this.activate(o,o.parent(),function(){t.trigger({type:"shown.bs.tab",relatedTarget:i})})},t.prototype.activate=function(t,n,r){function o(){i.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),s?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),r&&r()}var i=n.find("> .active"),s=r&&e.support.transition&&i.hasClass("fade");s?i.one(e.support.transition.end,o).emulateTransitionEnd(150):o(),i.removeClass("in")};var n=e.fn.tab;e.fn.tab=function(n){return this.each(function(){var r=e(this),i=r.data("bs.tab");i||r.data("bs.tab",i=new t(this)),typeof n=="string"&&i[n]()})},e.fn.tab.Constructor=t,e.fn.tab.noConflict=function(){return e.fn.tab=n,this},e(document).on("click.bs.tab.data-api",\'[data-toggle="tab"], [data-toggle="pill"]\',function(t){t.preventDefault(),e(this).tab("show")})}(jQuery),+function(e){"use strict";var t=function(n,r){this.options=e.extend({},t.DEFAULTS,r),this.$window=e(window).on("scroll.bs.affix.data-api",e.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",e.proxy(this.checkPositionWithEventLoop,this)),this.$element=e(n),this.affixed=this.unpin=null,this.checkPosition()};t.RESET="affix affix-top affix-bottom",t.DEFAULTS={offset:0},t.prototype.checkPositionWithEventLoop=function(){setTimeout(e.proxy(this.checkPosition,this),1)},t.prototype.checkPosition=function(){if(!this.$element.is(":visible"))return;var n=e(document).height(),r=this.$window.scrollTop(),i=this.$element.offset(),s=this.options.offset,o=s.top,u=s.bottom;typeof s!="object"&&(u=o=s),typeof o=="function"&&(o=s.top()),typeof u=="function"&&(u=s.bottom());var a=this.unpin!=null&&r+this.unpin<=i.top?!1:u!=null&&i.top+this.$element.height()>=n-u?"bottom":o!=null&&r<=o?"top":!1;if(this.affixed===a)return;this.unpin&&this.$element.css("top",""),this.affixed=a,this.unpin=a=="bottom"?i.top-r:null,this.$element.removeClass(t.RESET).addClass("affix"+(a?"-"+a:"")),a=="bottom"&&this.$element.offset({top:document.body.offsetHeight-u-this.$element.height()})};var n=e.fn.affix;e.fn.affix=function(n){return this.each(function(){var r=e(this),i=r.data("bs.affix"),s=typeof n=="object"&&n;i||r.data("bs.affix",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.affix.Constructor=t,e.fn.affix.noConflict=function(){return e.fn.affix=n,this},e(window).on("load",function(){e(\'[data-spy="affix"]\').each(function(){var t=e(this),n=t.data();n.offset=n.offset||{},n.offsetBottom&&(n.offset.bottom=n.offsetBottom),n.offsetTop&&(n.offset.top=n.offsetTop),t.affix(n)})})}(jQuery),define("bootstrap",["jquery"],function(){});if(Common===undefined)var Common={};define("notification",["backbone"],function(e){var t=function(){};_.extend(t.prototype,e.Events);if(typeof Common.NotificationCenter!="undefined")throw"Native Common.NotificationCenter instance already defined.";t.extend=e.Model.extend,Common.NotificationCenter=new t}),function(){var e=function(e,t){var n=e.split("."),r=t||window;for(var i=0,s=n.length;i<s;i++)r=r[n[i]]||{};return r},t=function(e){_.extend(this,e||{}),this.eventbus=new r({application:this}),this.createApplicationNamespace(),this.initialize.apply(this,arguments),this.autoCreate!==!1&&$($.proxy(this.onReady,this))};_.extend(t.prototype,{nameSpace:"Application",models:{},collections:{},controllers:{},allocationMap:{model:"Models",collection:"Collections",controller:"Controllers",view:"Views"},createApplicationNamespace:function(){var e=window;this.nameSpace&&typeof e[this.nameSpace]=="undefined"&&(e[this.nameSpace]={}),e[this.nameSpace]=this,_.each(this.allocationMap,function(e,t){this[e]=this[e]||{}},this)},initialize:function(){},onReady:function(){this.start()},start:function(){this.initializeControllers(this.controllers||{}),this.launchControllers(),this.launch.call(this)},getClasseRefs:function(t,n){var r={},i=this.allocationMap[t],s=this[i];return _.each(n,function(t){r[t]=e(t,t.indexOf(".")>-1?window:s)},this),r},initializeControllers:function(t){this.controllers={},_.each(t,function(t){var n=t.indexOf(".")>-1?window:this[this.allocationMap.controller],r=e(t,n),i=t.split(".").pop(),s=new r({id:t,application:this});s.views=this.getClasseRefs("view",s.views||[]),_.extend(this.models,this.getClasseRefs("model",s.models||[])),_.extend(this.collections,this.getClasseRefs("collection",s.collections||{})),this.buildCollections(),this.controllers[t]=s},this)},launchControllers:function(){_.each(this.controllers,function(e,t){e.onLaunch(this)},this)},launch:function(){},addListeners:function(e,t){this.eventbus.addListeners(e,t)},getController:function(e){return this.controllers[e]},getModel:function(e){this._modelsCache=this._modelsCache||{};var t=this._modelsCache[e],n=this.getModelConstructor(e);return!t&&n&&(t=this.createModel(e),this._modelsCache[e]=t),t||null},getModelConstructor:function(e){return this.models[e]},createModel:function(e,t){var n=this.getModelConstructor(e),r=null;return n&&(r=new n(_.extend(t||{}))),r},getCollection:function(e){this._collectionsCache=this._collectionsCache||{};var t=this._collectionsCache[e],n=this.getCollectionConstructor(e);return!t&&n&&(t=this.createCollection(e),this._collectionsCache[e]=t),t||null},getCollectionConstructor:function(e){return this.collections[e]},createCollection:function(e){var t=this.getCollectionConstructor(e),n=null;return t&&(n=new t),n},buildCollections:function(){_.each(this.collections,function(e,t){this.getCollection(t)},this)}});if(typeof Backbone.Application!="undefined")throw"Native Backbone.Application instance already defined.";Backbone.Application=t,Backbone.Application.extend=Backbone.Model.extend;var n=function(e){_.extend(this,e||{}),this.initialize.apply(this,arguments)};_.extend(n.prototype,{name:null,views:{},models:{},collections:{},initialize:function(e){},addListeners:function(e){this.getApplication().addListeners(e,this)},onLaunch:function(e){},getApplication:function(){return this.application},getView:function(e){return this._viewsCache[e]},getViewConstructor:function(e){return this.views[e]},createView:function(e,t){var n=this.getViewConstructor(e),r=_.extend(t||{},{alias:e});return this._viewsCache=this._viewsCache||{},this._viewsCache[e]=new n(r),this._viewsCache[e].options=_.extend({},r),this._viewsCache[e]},getModel:function(e){return this.application.getModel(e)},getModelConstructor:function(e){return this.application.getModelConstructor(e)},createModel:function(e,t){return this.application.createModel(e)},getCollection:function(e){return this.application.getCollection(e)},getCollectionConstructor:function(e){return this.application.getCollectionConstructor(e)},createCollection:function(e){return this.application.createCollection(e)},fireEvent:function(e,t,n){this.application.eventbus.fireEvent(e,t,n)},bindViewEvents:function(e,t){this.unbindViewEvents(e),t=_.isFunction(t)?t.call(this):t;for(var n in t){var r=t[n];_.isFunction(r)||(r=this[t[n]]);var i=n.match(/^(\\S+)\\s*(.*)$/),s=i[1],o=i[2];r=_.bind(r,this),s+=".bindViewEvents"+e.cid,e.$el.on(s,o,r)}return this},unbindViewEvents:function(e){return e.$el.off(".bindViewEvents"+e.cid),this}});if(typeof Backbone.Controller!="undefined")throw"Native Backbone.Controller instance already defined.";Backbone.Controller=n,Backbone.Controller.extend=Backbone.Model.extend;var r=function(e){var t=this;_.extend(this,e||{}),_.extend(Backbone.View.prototype,{alias:null,hidden:!1,getAlias:function(){return this.options.alias},fireEvent:function(e,n){this.trigger.apply(this,arguments),t.fireEvent(this.getAlias(),e,n)},hide:function(){this.$el.hide(),this.hidden=!0},show:function(){this.$el.show(),this.hidden=!1}})};_.extend(r.prototype,{pool:{},addListeners:function(e,t){this.pool[t.id]=this.pool[t.id]||{};var n=this.pool[t.id];_.isArray(e)?_.each(e,function(e){this.addListeners(e,t)},this):_.isObject(e)&&_.each(e,function(e,t){_.each(e,function(e,r){n[t]=n[t]||{},n[t][r]=n[t][r]||[],n[t][r].push(e)},this)},this)},fireEvent:function(e,t,n){var r=this.getApplication();_.each(this.pool,function(i,s){var o=i[e];if(o){var u=o[t],a=r.getController(s);_.each(u,function(e){e.apply(a,n)})}},this)},getApplication:function(){return this.application}});if(typeof Backbone.EventBus!="undefined")throw"Native Backbone.Application instance already defined.";Backbone.EventBus=r}(),define("core",["backbone","notification"],function(){});if(Common===undefined)var Common={};Common.component=Common.component||{},Common.Analytics=Common.component.Analytics=new function(){var e;return{initialize:function(t,n){if(typeof t=="undefined")throw"Analytics: invalid id.";if(typeof n=="undefined"||Object.prototype.toString.apply(n)!=="[object String]")throw"Analytics: invalid category type.";e=n,$("head").append(\'<script type="text/javascript">var _gaq = _gaq || [];_gaq.push(["_setAccount", "\'+t+\'"]);\'+\'_gaq.push(["_trackPageview"]);\'+"(function() {"+\'var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;\'+\'ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";\'+\'var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);\'+"})();"+"</script>")},trackEvent:function(t,n,r){if(typeof t!="undefined"&&Object.prototype.toString.apply(t)!=="[object String]")throw"Analytics: invalid action type.";if(typeof n!="undefined"&&Object.prototype.toString.apply(n)!=="[object String]")throw"Analytics: invalid label type.";if(typeof r!="undefined"&&(Object.prototype.toString.apply(r)!=="[object Number]"||!isFinite(r)))throw"Analytics: invalid value type.";if(typeof _gaq=="undefined")return;if(e==="undefined")throw"Analytics is not initialized.";_gaq.push(["_trackEvent",e,t,n,r])}}},define("analytics",["jquery"],function(){});if(Common===undefined)var Common={};Common.Gateway=new function(){var e=this,t=$(e),n={init:function(e){t.trigger("init",e)},openDocument:function(e){t.trigger("opendocument",e)},showMessage:function(e){t.trigger("showmessage",e)},applyEditRights:function(e){t.trigger("applyeditrights",e)},processSaveResult:function(e){t.trigger("processsaveresult",e)},processRightsChange:function(e){t.trigger("processrightschange",e)},refreshHistory:function(e){t.trigger("refreshhistory",e)},setHistoryData:function(e){t.trigger("sethistorydata",e)},processMouse:function(e){t.trigger("processmouse",e)},internalCommand:function(e){t.trigger("internalcommand",e)},resetFocus:function(e){t.trigger("resetfocus",e)}},r=function(e){window.parent&&window.JSON&&window.parent.postMessage(window.JSON.stringify(e),"*")},i=function(e){var t=e.data;if(Object.prototype.toString.apply(t)!=="[object String]"||!window.JSON)return;var r,i;try{r=window.JSON.parse(t)}catch(s){r=""}r&&(i=n[r.command],i&&i.call(this,r.data))},s=function(e){i(e)};return window.attachEvent?window.attachEvent("onmessage",s):window.addEventListener("message",s,!1),{ready:function(){r({event:"onReady"})},goBack:function(e){r({event:"onBack",data:e==1})},save:function(e){r({event:"onSave",data:e})},requestEditRights:function(){r({event:"onRequestEditRights"})},requestHistory:function(){r({event:"onRequestHistory"})},requestHistoryData:function(e){r({event:"onRequestHistoryData",data:e})},requestHistoryClose:function(e){r({event:"onRequestHistoryClose"})},reportError:function(e,t){r({event:"onError",data:{errorCode:e,errorDescription:t}})},setDocumentModified:function(e){r({event:"onDocumentStateChange",data:e})},internalMessage:function(e,t){r({event:"onInternalMessage",data:{type:e,data:t}})},updateVersion:function(){r({event:"onOutdatedVersion"})},on:function(n,r){var i=function(t,n){r.call(e,n)};t.on(n,i)}}},define("gateway",["jquery"],function(){});if(Common===undefined)var Common={};Common.Locale=new function(){var l10n={},_createXMLHTTPObject=function(){var e;try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(n){e=!1}}return!e&&typeof XMLHttpRequest!="undefined"&&(e=new XMLHttpRequest),e},_applyLocalization=function(){try{for(var e in l10n){var t=e.split(".");if(t&&t.length>2){var n=window;for(var r=0;r<t.length-1;++r)n[t[r]]===undefined&&(n[t[r]]=new Object),n=n[t[r]];n&&(n[t[t.length-1]]=l10n[e])}}}catch(i){}},_get=function(prop,scope){var res="";return scope&&scope.name&&(res=l10n[scope.name+"."+prop]),res||(scope?eval(scope.name).prototype[prop]:"")},_getUrlParameterByName=function(e){e=e.replace(/[\\[]/,"\\\\[").replace(/[\\]]/,"\\\\]");var t=new RegExp("[\\\\?&]"+e+"=([^&#]*)"),n=t.exec(location.search);return n==null?"":decodeURIComponent(n[1].replace(/\\+/g," "))};try{var langParam=_getUrlParameterByName("lang"),xhrObj=_createXMLHTTPObject();if(xhrObj&&langParam){var lang=langParam.split("-")[0];xhrObj.open("GET","locale/"+lang+".json",!1),xhrObj.send(""),l10n=eval("("+xhrObj.responseText+")")}}catch(e){}return{apply:_applyLocalization,get:_get}},define("locale",function(){}),define("text",["module"],function(e){"use strict";var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\\s*<\\?xml(\\s)+version=[\\\'\\"](\\d)*.(\\d)*[\\\'\\"](\\s)*\\?>/im,a=/<body[^>]*>\\s*([\\s\\S]+)\\s*<\\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.10",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/([\'\\\\])/g,"\\\\$1").replace(/[\\f]/g,"\\\\f").replace(/[\\b]/g,"\\\\b").replace(/[\\n]/g,"\\\\n").replace(/[\\t]/g,"\\\\t").replace(/[\\r]/g,"\\\\r").replace(/[\\u2028]/g,"\\\\u2028").replace(/[\\u2029]/g,"\\\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\\w+)\\:)?\\/\\/([^\\/\\\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText){r();return}d.isBuild=i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return \'"+s+"\';});\\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("﻿")===0&&(i=i.substring(1)),t(i)}catch(s){r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\\//g,"\\\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("text!common/main/lib/template/Header.template",[],function(){return\'<div id="header-container">\\n    <div id="header-logo"></div>\\n    <div id="header-caption"><div><%= headerCaption %></div></div>\\n    <div id="header-documentcaption"><%= documentCaption %></div>\\n    <div id="header-back" style="display: <%= canBack ? \\\'table-cell\\\' : \\\'none\\\' %>;"><div><%= textBack %></div></div>\\n</div>\'});if(Common===undefined)var Common={};Common.Views=Common.Views||{},define("common/main/lib/view/Header",["backbone","text!common/main/lib/template/Header.template","core"],function(e,t){Common.Views.Header=e.View.extend(_.extend({options:{branding:{},headerCaption:"Default Caption",documentCaption:"",canBack:!1},el:"#header",template:_.template(t),events:{"click #header-logo":function(e){var t=!this.branding||!this.branding.logo||!this.branding.logo.url?"http://www.onlyoffice.com":this.branding.logo.url,n=window.open(t);n&&n.focus()}},initialize:function(e){this.options=this.options?_({}).extend(this.options,e):e,this.headerCaption=this.options.headerCaption,this.documentCaption=this.options.documentCaption,this.canBack=this.options.canBack,this.branding=this.options.customization},render:function(){$(this.el).html(this.template({headerCaption:this.headerCaption,documentCaption:Common.Utils.String.htmlEncode(this.documentCaption),canBack:this.canBack,textBack:this.textBack}))},setVisible:function(e){e?this.show():this.hide()},setBranding:function(e){var t;this.branding=e,e&&e.logo&&e.logo.image&&(t=$("#header-logo"),t&&t.css("background-image",\'url("\'+e.logo.image+\'")\'))},setHeaderCaption:function(e){this.headerCaption=e;var t=$("#header-caption > div");return t&&t.html(e),e},getHeaderCaption:function(){return this.headerCaption},setDocumentCaption:function(e,t){_.isUndefined(t)&&(this.documentCaption=e),e||(e="");var n=$("#header-documentcaption");return n&&n.html(Common.Utils.String.htmlEncode(e)),e},getDocumentCaption:function(){return this.documentCaption},setCanBack:function(e){this.canBack=e;var t=$("#header-back");t&&(t.off("click"),t.css("display",e?"table-cell":"none"),e&&t.on("click",_.bind(this.onBackClick,this)))},getCanBack:function(){return this.canBack},onBackClick:function(e){Common.Gateway.goBack(e.which==2),Common.component.Analytics.trackEvent("Back to Folder")},textBack:"Go to Documents"},Common.Views.Header||{}))}),define("text!spreadsheeteditor/main/app/template/Viewport.template",[],function(){return\'<div class="layout-region">\\n    <div id="viewport-vbox-layout" class="layout-ct vbox">\\n        <div id="header" class="layout-item"></div>\\n        <div id="toolbar" class="layout-item"></div>\\n        <div class="layout-item">\\n            <div id="viewport-hbox-layout" class="layout-ct hbox">\\n                <div id="left-menu" class="layout-item" style="width: 40px;"></div>\\n                <div id="file-menu-panel" class="left-menu-full-ct" style="display:none;"></div>\\n                <div id="about-menu-panel" class="left-menu-full-ct" style="display:none;"></div>\\n                <div class="layout-item">\\n                    <div class="layout-ct vbox">\\n                        <div id="cell-editing-box" class="layout-item" style="height:18px;"></div>\\n                        <div id="editor_sdk" class="layout-item" style="min-height: 100px;"></div>\\n                    </div>\\n                </div>\\n                <div id="right-menu" class="layout-item"></div>\\n            </div>\\n        </div>\\n        <div id="statusbar" class="layout-item"></div>\\n    </div>\\n</div>\\n\'});if(Common===undefined)var Common={};define("common/main/lib/component/BaseView",["backbone"],function(e){Common.UI=_.extend(Common.UI||{},{Keys:{BACKSPACE:8,TAB:9,RETURN:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,HOME:36,END:35,SPACE:32,PAGEUP:33,PAGEDOWN:34,INSERT:45,NUM_PLUS:107,NUM_MINUS:109,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,EQUALITY:187,MINUS:189},BaseView:e.View.extend({isSuspendEvents:!1,initialize:function(e){this.options=this.options?_({}).extend(this.options,e):e},setVisible:function(e){return this[e?"show":"hide"]()},isVisible:function(){return $(this.el).is(":visible")},suspendEvents:function(){this.isSuspendEvents=!0},resumeEvents:function(){this.isSuspendEvents=!1}}),getId:function(e){return _.uniqueId(e||"asc-gen")}})});if(Common===undefined)var Common={};define("common/main/lib/component/Layout",["backbone"],function(){var e=function(e){this.box=null,this.panels=[],_.extend(this,e||{})},t=function(){return{width:null,height:null,resize:!1,stretch:!1,rely:!1}};_.extend(e.prototype,Backbone.Events,{initialize:function(e){this.$parent=this.box.parent(),this.resize={eventMove:_.bind(this.resizeMove,this),eventStop:_.bind(this.resizeStop,this)};var n,r,i=!1;e.items.forEach(function(e){e.el instanceof HTMLElement&&(e.el=$(e.el)),n=_.extend(new t,e),n.stretch&&(i=!0,n.rely=!1,n.resize=!1),this.panels.push(n),n.resize&&(r={isresizer:!0,minpos:n.resize.min||0,maxpos:n.resize.max||0},i?(n.resize.el=r.el=n.el.before(\'<div class="layout-resizer before"></div>\').prev(),this.panels.splice(this.panels.length-1,0,r)):(n.resize.el=r.el=n.el.after(\'<div class="layout-resizer after"></div>\').next(),this.panels.push(r)),n.resize.hidden&&r.el.hide())},this)},doLayout:function(){},getElementHeight:function(e){return parseInt(e.css("height"))},getElementWidth:function(e){return parseInt(e.css("width"))},onSelectStart:function(e){return e.preventDefault&&e.preventDefault(),!1},addHandler:function(e,t,n){e.addEventListener?e.addEventListener(t,n):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},removeHandler:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null},clearSelection:function(){if(window.getSelection){var e=window.getSelection();e.empty?e.empty():e.removeAllRanges&&e.removeAllRanges()}else document.selection&&document.selection.empty()},resizeStart:function(e){this.clearSelection(),this.addHandler(window.document,"selectstart",this.onSelectStart),$(document).on({mousemove:this.resize.eventMove,mouseup:this.resize.eventStop});var t=e.data.panel;this.resize.type=e.data.type,this.resize.$el=t.el,this.resize.min=t.minpos,this.resize.$el.addClass("move"),e.data.type=="vertical"?(this.resize.height=parseInt(this.resize.$el.css("height")),this.resize.max=(t.maxpos>0?t.maxpos:this.resize.$el.parent().height()+t.maxpos)-this.resize.height,this.resize.inity=e.pageY-parseInt(e.currentTarget.style.top)):e.data.type=="horizontal"&&(this.resize.width=parseInt(this.resize.$el.css("width")),this.resize.max=(t.maxpos>0?t.maxpos:this.resize.$el.parent().height()+t.maxpos)-this.resize.width,this.resize.initx=e.pageX-parseInt(e.currentTarget.style.left))},resizeMove:function(e){if(this.resize.type=="vertical")var t="top",n=e.pageY-this.resize.inity;else this.resize.type=="horizontal"&&(t="left",n=e.pageX-this.resize.initx);!(n<this.resize.min)&&!(n>this.resize.max)&&(this.resize.$el[0].style[t]=n+"px")},resizeStop:function(e){this.removeHandler(window.document,"selectstart",this.onSelectStart),$(document).off({mousemove:this.resize.eventMove,mouseup:this.resize.eventStop});if(this.resize.type=="vertical")var t="height",n=e.pageY-this.resize.inity;else this.resize.type=="horizontal"&&(t="width",n=e.pageX-this.resize.initx);n<this.resize.min&&(n=this.resize.min),n>this.resize.max&&(n=this.resize.max);if(this.resize.$el.hasClass("after"))var r=this.resize.$el.prev();else r=this.resize.$el.next(),n=r.parent()[t]()-(n+this.resize[t]);r.css(t,n+"px"),this.resize.$el.removeClass("move"),delete this.resize.$el,this.resize.value!=n&&(this.doLayout(),this.trigger("layout:resizedrag",this))}}),!Common.UI&&(Common.UI={}),Common.UI.VBoxLayout=function(t){e.apply(this,arguments),this.initialize.apply(this,arguments)},Common.UI.VBoxLayout.prototype=_.extend(new e,{initialize:function(t){e.prototype.initialize.call(this,t),this.panels.forEach(function(e){!e.stretch&&!e.height&&(e.height=this.getElementHeight(e.el)),e.isresizer&&e.el.on("mousedown",{type:"vertical",panel:e},_.bind(this.resizeStart,this))},this),this.doLayout.call(this)},doLayout:function(){var e=0,t,n;this.panels.forEach(function(r){r.stretch?t=r:(n=r.el.is(":visible"),n&&(e+=r.rely!==!0?r.height:this.getElementHeight(r.el)),r.resize&&r.resize.autohide!==!1&&r.resize.el&&(n?(r.resize.el.show(),t&&(e+=r.resize.height)):(r.resize.el.hide(),t&&(e-=r.resize.height))))},this),t&&(t.height=this.$parent.height()-e),e=0,this.panels.forEach(function(t){t.el.is(":visible")&&(n={top:e},t.rely!==!0&&(n.height=t.height),t.el.css(n),e+=this.getElementHeight(t.el))},this)}}),Common.UI.HBoxLayout=function(t){e.apply(this,arguments),this.initialize.apply(this,arguments)},Common.UI.HBoxLayout.prototype=_.extend(new e,{initialize:function(t){e.prototype.initialize.call(this,t),this.panels.forEach(function(e){!e.stretch&&!e.width&&(e.width=this.getElementWidth(e.el)),e.isresizer&&e.el.on("mousedown",{type:"horizontal",panel:e},_.bind(this.resizeStart,this))},this),this.doLayout.call(this)},doLayout:function(e){var t=0,n,r;this.panels.forEach(function(e){e.stretch?n=e:(r=e.el.is(":visible"),r&&(t+=e.rely!==!0?e.width:this.getElementWidth(e.el)),e.resize&&e.resize.autohide!==!1&&e.resize.el&&(r?(e.resize.el.show(),n&&(t-=e.resize.width)):(e.resize.el.hide(),n&&(t-=e.resize.width))))},this),n&&(n.width=this.$parent.width()-t),t=0,this.panels.forEach(function(e){e.el.is(":visible")&&(r={left:t},e.rely!==!0&&(r.width=e.width),e.el.css(r),t+=this.getElementWidth(e.el))},this)}}),Common.UI.VBoxLayout.prototype.constructor=Common.UI.VBoxLayout,Common.UI.HBoxLayout.prototype.constructor=Common.UI.HBoxLayout}),define("spreadsheeteditor/main/app/view/Viewport",["text!spreadsheeteditor/main/app/template/Viewport.template","jquery","underscore","backbone","common/main/lib/component/BaseView","common/main/lib/component/Layout"],function(e,t,n,r){SSE.Views.Viewport=r.View.extend({el:"#viewport",template:n.template(e),events:{},initialize:function(){},render:function(){var e=t(this.el);e.html(this.template({})),Common.Utils.isSafari?(t("body").addClass("safari"),t("body").mousewheel(function(e){e.preventDefault(),e.stopPropagation()})):Common.Utils.isChrome&&t("body").addClass("chrome");var n=t("#viewport-vbox-layout",e),r=n.find(" > .layout-item");return this.vlayout=new Common.UI.VBoxLayout({box:n,items:[{el:r[0],rely:!0},{el:r[1],rely:!0},{el:r[2],stretch:!0},{el:r[3],height:25}]}),n=t("#viewport-hbox-layout",e),r=n.find(" > .layout-item"),this.hlayout=new Common.UI.HBoxLayout({box:n,items:[{el:r[0],rely:!0,resize:{hidden:!0,autohide:!1,min:300,max:600}},{el:r[1],stretch:!0},{el:t(r[2]).hide(),rely:!0}]}),n=n.find(".layout-ct.vbox"),r=n.find(" > .layout-item"),this.celayout=new Common.UI.VBoxLayout({box:n,items:[{el:r[0],rely:!0,resize:{min:19,max:-100}},{el:r[1],stretch:!0}]}),this},applyEditorMode:function(){var e=this,t=SSE.getController("Toolbar").getView("Toolbar"),n=SSE.getController("RightMenu").getView("RightMenu");e._toolbar=t.render(this.mode.isEditDiagram),e._rightMenu=n.render()},setMode:function(e,t){e.isDisconnected?(n.isUndefined(this.mode)&&(this.mode={}),this.mode.canCoAuthoring=!1):this.mode=e}})}),define("spreadsheeteditor/main/app/controller/Viewport",["core","common/main/lib/view/Header","spreadsheeteditor/main/app/view/Viewport"],function(e){SSE.Controllers.Viewport=Backbone.Controller.extend({models:[],collections:[],views:["Viewport","Common.Views.Header"],initialize:function(){this.addListeners({Viewport:{}})},setApi:function(e){this.api=e},onLaunch:function(){this.viewport=this.createView("Viewport").render(),this.header=this.createView("Common.Views.Header",{headerCaption:"Spreadsheet Editor"}).render(),Common.NotificationCenter.on("layout:changed",_.bind(this.onLayoutChanged,this)),$(window).on("resize",_.bind(this.onWindowResize,this)),this.viewport.celayout.on("layout:resizedrag",function(){this.viewport.fireEvent("layout:resizedrag",[this,"cell:edit"]),this.api.asc_Resize()},this),this.viewport.hlayout.on("layout:resizedrag",function(){this.api.asc_Resize()},this),this.boxSdk=$("#editor_sdk"),this.boxFormula=$("#cell-editing-box"),this.boxSdk.css("border-left","none"),this.boxFormula.css("border-left","none")},onLayoutChanged:function(e){switch(e){default:this.viewport.vlayout.doLayout(),this.viewport.celayout.doLayout();case"rightmenu":this.viewport.hlayout.doLayout();break;case"leftmenu":var t=this.viewport.hlayout.items[0];t.resize.el&&(t.el.width()>40?(this.boxSdk.css("border-left",""),this.boxFormula.css("border-left",""),t.resize.el.show()):(t.resize.el.hide(),this.boxSdk.css("border-left","none"),this.boxFormula.css("border-left","none"))),this.viewport.hlayout.doLayout();break;case"header":case"toolbar":case"status":this.viewport.vlayout.doLayout(),this.viewport.celayout.doLayout();break;case"celleditor":arguments[1]&&this.boxSdk.css("border-top",arguments[1]=="hidden"?"none":""),this.viewport.celayout.doLayout()}this.api.asc_Resize()},onWindowResize:function(e){this.onLayoutChanged("window"),Common.NotificationCenter.trigger("window:resize")}})});if(Common===undefined)var Common={};Common.Utils===undefined&&(Common.Utils={}),Common.Utils=new function(){var e=navigator.userAgent.toLowerCase(),t=function(t){return t.test(e)},n=document.compatMode=="CSS1Compat",r=function(t,n){var r;return t&&(r=n.exec(e))?parseFloat(r[1]):0},i=document.documentMode,s=t(/opera/),o=s&&t(/version\\/10\\.5/),u=t(/\\bchrome\\b/),a=t(/webkit/),f=!u&&t(/safari/),l=f&&t(/applewebkit\\/4/),c=f&&t(/version\\/3/),h=f&&t(/version\\/4/),p=f&&t(/version\\/5\\.0/),d=f&&t(/version\\/5/),v=!s&&(t(/msie/)||t(/trident/)),m=v&&(t(/msie 7/)&&i!=8&&i!=9&&i!=10||i==7),g=v&&(t(/msie 8/)&&i!=7&&i!=9&&i!=10||i==8),y=v&&(t(/msie 9/)&&i!=7&&i!=8&&i!=10||i==9),b=v&&(t(/msie 10/)&&i!=7&&i!=8&&i!=9||i==10),w=v&&(t(/trident\\/7\\.0/)&&i!=7&&i!=8&&i!=9&&i!=10||i==11),E=v&&t(/msie 6/),S=!a&&!v&&t(/gecko/),x=S&&t(/rv:1\\.9/),T=S&&t(/rv:2\\.0/),N=S&&t(/rv:5\\./),C=S&&t(/rv:10\\./),k=x&&t(/rv:1\\.9\\.0/),L=x&&t(/rv:1\\.9\\.1/),A=x&&t(/rv:1\\.9\\.2/),O=t(/windows|win32/),M=t(/macintosh|mac os x/),_=t(/linux/),D=r(!0,/\\bchrome\\/(\\d+\\.\\d+)/),P=r(!0,/\\bfirefox\\/(\\d+\\.\\d+)/),H=r(v,/msie (\\d+\\.\\d+)/),B=r(s,/version\\/(\\d+\\.\\d+)/),j=r(f,/version\\/(\\d+\\.\\d+)/),F=r(a,/webkit\\/(\\d+\\.\\d+)/),I=/^https/i.test(window.location.protocol),q=/^(mailto:)?([a-z0-9\\._-]+@[a-z0-9\\.-]+\\.[a-z]{2,4})([a-яё0-9\\._%+-=\\? :&]*)/i,R=/^(((https?)|(ftps?)):\\/\\/)?([\\-\\wа-яё]*:?[\\-\\wа-яё]*@)?(((1[0-9]{2}|2[0-4][0-9]|25[0-5]|[1-9][0-9]|[0-9])\\.){3}(1[0-9]{2}|2[0-4][0-9]|25[0-5]|[1-9][0-9]|[0-9]))(:\\d+)?(\\/[%\\-\\wа-яё]*(\\.[\\wа-яё]{2,})?(([\\wа-яё\\-\\.\\?\\\\\\/+@&#;`~=%!,]*)(\\.[\\wа-яё]{2,})?)*)*\\/?/i,U=/^(((https?)|(ftps?)):\\/\\/)?([\\-\\wа-яё]*:?[\\-\\wа-яё]*@)?(([\\-\\wа-яё]+\\.)+[\\wа-яё\\-]{2,}(:\\d+)?(\\/[%\\-\\wа-яё]*(\\.[\\wа-яё]{2,})?(([\\wа-яё\\-\\.\\?\\\\\\/+@&#;`~=%!,]*)(\\.[\\wа-яё]{2,})?)*)*\\/?)/i,z=/^(((https?)|(ftps?)):\\/\\/)([\\-\\wа-яё]*:?[\\-\\wа-яё]*@)?(([\\-\\wа-яё]+)(:\\d+)?(\\/[%\\-\\wа-яё]*(\\.[\\wа-яё]{2,})?(([\\wа-яё\\-\\.\\?\\\\\\/+@&#;`~=%!,]*)(\\.[\\wа-яё]{2,})?)*)*\\/?)/i,W=/(mailto:)([a-z0-9\\._-]+@[a-z0-9\\.-]+\\.[a-z]{2,4})([a-яё0-9\\._%+-=\\? :&]*)/ig,X=/(((https?)|(ftps?)):\\/\\/([\\-\\wа-яё]*:?[\\-\\wа-яё]*@)?)(((1[0-9]{2}|2[0-4][0-9]|25[0-5]|[1-9][0-9]|[0-9])\\.){3}(1[0-9]{2}|2[0-4][0-9]|25[0-5]|[1-9][0-9]|[0-9]))(:\\d+)?(\\/[%\\-\\wа-яё]*(\\.[\\wа-яё]{2,})?(([\\wа-яё\\-\\.\\?\\\\\\/+@&#;`~=%!,]*)(\\.[\\wа-яё]{2,})?)*)*\\/?/ig,V=/((((https?)|(ftps?)):\\/\\/([\\-\\wа-яё]*:?[\\-\\wа-яё]*@)?)|(([\\-\\wа-яё]*:?[\\-\\wа-яё]*@)?www\\.))((([\\-\\wа-яё]+\\.)+[\\wа-яё\\-]{2,}|([\\-\\wа-яё]+))(:\\d+)?(\\/[%\\-\\wа-яё]*(\\.[\\wа-яё]{2,})?(([\\wа-яё\\-\\.\\?\\\\\\/+@&#;`~=%!,]*)(\\.[\\wа-яё]{2,})?)*)*\\/?)/ig;return{userAgent:e,isStrict:n,isIEQuirks:v&&!n&&(E||m||g||y),isOpera:s,isOpera10_5:o,isWebKit:a,isChrome:u,isSafari:f,isSafari3:c,isSafari4:h,isSafari5:d,isSafari5_0:p,isSafari2:l,isIE:v,isIE6:E,isIE7:m,isIE7m:E||m,isIE7p:v&&!E,isIE8:g,isIE8m:E||m||g,isIE8p:v&&!E&&!m,isIE9:y,isIE9m:E||m||g||y,isIE9p:v&&!(E||m||g),isIE10:b,isIE10m:E||m||g||y||b,isIE10p:v&&!(E||m||g||y),isIE11:w,isIE11m:E||m||g||y||b||w,isIE11p:v&&!(E||m||g||y||b),isGecko:S,isGecko3:x,isGecko4:T,isGecko5:N,isGecko10:C,isFF3_0:k,isFF3_5:L,isFF3_6:A,isFF4:4<=P&&P<5,isFF5:5<=P&&P<6,isFF10:10<=P&&P<11,isLinux:_,isWindows:O,isMac:M,chromeVersion:D,firefoxVersion:P,ieVersion:H,operaVersion:B,safariVersion:j,webKitVersion:F,isSecure:I,emailRe:q,ipRe:R,hostnameRe:U,localRe:z,emailStrongRe:W,ipStrongRe:X,hostnameStrongRe:V}},Common.Utils.ThemeColor=new function(){return{ThemeValues:[6,15,7,16,0,1,2,3,4,5],setColors:function(e,t){var n,r,i;if(t&&t.length>0){var s=[];for(n=0;n<t.length;n++)i=this.getHexColor(t[n].get_r(),t[n].get_g(),t[n].get_b()),s.push(i);this.standartcolors=s}var o=[];for(n=0;n<6;n++)for(r=0;r<10;r++){var u=n+r*6;i={color:this.getHexColor(e[u].get_r(),e[u].get_g(),e[u].get_b()),effectId:u,effectValue:this.ThemeValues[r]},o.push(i)}this.effectcolors=o},getEffectColors:function(){return this.effectcolors},getStandartColors:function(){return this.standartcolors},getHexColor:function(e,t,n){return e=e.toString(16),t=t.toString(16),n=n.toString(16),e.length==1&&(e="0"+e),t.length==1&&(t="0"+t),n.length==1&&(n="0"+n),e+t+n},getRgbColor:function(e){var t=typeof e=="object"?e.color:e;t=t.replace(/#/,""),t.length==3&&(t=t.replace(/(.)/g,"$1$1")),t=parseInt(t,16);var n=new CAscColor;return n.put_type(typeof e=="object"&&e.effectId!==undefined?c_oAscColor.COLOR_TYPE_SCHEME:c_oAscColor.COLOR_TYPE_SRGB),n.put_r(t>>16),n.put_g((t&65280)>>8),n.put_b(t&255),n.put_a(255),e.effectId!==undefined&&n.put_value(e.effectId),n},colorValue2EffectId:function(e){if(typeof e=="object"&&e.effectValue!==undefined&&this.effectcolors)for(var t=0;t<this.effectcolors.length;t++)if(this.effectcolors[t].effectValue===e.effectValue&&e.color.toUpperCase()===this.effectcolors[t].color.toUpperCase()){e.effectId=this.effectcolors[t].effectId;break}return e}}},Common.Utils.Metric=new function(){var e=this;return e.c_MetricUnits={cm:0,pt:1},e.currentMetric=e.c_MetricUnits.pt,e.metricName=["cm","pt"],{c_MetricUnits:e.c_MetricUnits,metricName:e.metricName,setCurrentMetric:function(t){e.currentMetric=t},getCurrentMetric:function(){return e.currentMetric},fnRecalcToMM:function(t){if(t!==null&&t!==undefined)switch(e.currentMetric){case e.c_MetricUnits.cm:return t*10;case e.c_MetricUnits.pt:return t*25.4/72}return t},fnRecalcFromMM:function(t){switch(e.currentMetric){case e.c_MetricUnits.cm:return parseFloat((t/10).toFixed(4));case e.c_MetricUnits.pt:return parseFloat((t*72/25.4).toFixed(3))}return t}}},Common.Utils.RGBColor=function(e){var t,n,r;e.charAt(0)=="#"&&(e=e.substr(1,6)),e=e.replace(/ /g,""),e=e.toLowerCase();var i=[{re:/^rgb\\((\\d{1,3}),\\s*(\\d{1,3}),\\s*(\\d{1,3})\\)$/,process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^hsb\\((\\d{1,3}),\\s*(\\d{1,3}),\\s*(\\d{1,3})\\)$/,process:function(e){var t={},n=Math.round(e[1]),r=Math.round(e[2]*255/100),i=Math.round(e[3]*255/100);if(r==0)t.r=t.g=t.b=i;else{var s=i,o=(255-r)*i/255,u=(s-o)*(n%60)/60;n==360&&(n=0),n<60?(t.r=s,t.b=o,t.g=o+u):n<120?(t.g=s,t.b=o,t.r=s-u):n<180?(t.g=s,t.r=o,t.b=o+u):n<240?(t.b=s,t.r=o,t.g=s-u):n<300?(t.b=s,t.g=o,t.r=o+u):n<360?(t.r=s,t.g=o,t.b=s-u):(t.r=0,t.g=0,t.b=0)}return[Math.round(t.r),Math.round(t.g),Math.round(t.b)]}},{re:/^(\\w{2})(\\w{2})(\\w{2})$/,process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\\w{1})(\\w{1})(\\w{1})$/,process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}];for(var s=0;s<i.length;s++){var o=i[s].re,u=i[s].process,a=o.exec(e);if(a){var f=u(a);t=f[0],n=f[1],r=f[2]}}t=t<0||isNaN(t)?0:t>255?255:t,n=n<0||isNaN(n)?0:n>255?255:n,r=r<0||isNaN(r)?0:r>255?255:r;var l=function(e){return t==e.r&&n==e.g&&r==e.b},c=function(){return"rgb("+t+", "+n+", "+r+")"},h=function(e){return e===undefined&&(e=1),"rgba("+t+", "+n+", "+r+", "+e+")"},p=function(){var e=t.toString(16),i=n.toString(16),s=r.toString(16);return e.length==1&&(e="0"+e),i.length==1&&(i="0"+i),s.length==1&&(s="0"+s),"#"+e+i+s},d=function(){var e={h:0,s:0,b:0},i=Math.min(t,n,r),s=Math.max(t,n,r),o=s-i;return e.b=s,e.s=s!=0?255*o/s:0,e.s!=0?t==s?e.h=0+(n-r)/o:n==s?e.h=2+(r-t)/o:e.h=4+(t-n)/o:e.h=0,e.h*=60,e.h<0&&(e.h+=360),e.s*=100/255,e.b*=100/255,e.h=parseInt(e.h),e.s=parseInt(e.s),e.b=parseInt(e.b),e};return{r:t,g:n,b:r,isEqual:l,toRGB:c,toRGBA:h,toHex:p,toHSB:d}},Common.Utils.String=new function(){return{format:function(e){var t=_.toArray(arguments).slice(1);return e.replace(/\\{(\\d+)\\}/g,function(e,n){return t[n]})},htmlEncode:function(e){return _.escape(e)},htmlDecode:function(e){return _.unescape(e)},ellipsis:function(e,t,n){if(e&&e.length>t){if(n){var r=e.substr(0,t-2),i=Math.max(r.lastIndexOf(" "),r.lastIndexOf("."),r.lastIndexOf("!"),r.lastIndexOf("?"));if(i!==-1&&i>=t-15)return r.substr(0,i)+"..."}return e.substr(0,t-3)+"..."}return e},platformKey:function(e,t,n){return _.isEmpty(t)&&(t=" ({0})"),Common.Utils.isMac?(_.isFunction(n)&&(e=n.call(this,e)),Common.Utils.String.format(t,e.replace(/\\+(?=\\S)/g,"").replace(/Ctrl|ctrl/g,"⌘").replace(/Alt|alt/g,"⌥").replace(/Shift|shift/g,"⇧"))):Common.Utils.String.format(t,e)}}},Common.Utils.isBrowserSupported=function(){return!(Common.Utils.ieVersion!=0&&Common.Utils.ieVersion<9||Common.Utils.safariVersion!=0&&Common.Utils.safariVersion<5||Common.Utils.firefoxVersion!=0&&Common.Utils.firefoxVersion<4||Common.Utils.chromeVersion!=0&&Common.Utils.chromeVersion<7||Common.Utils.operaVersion!=0&&Common.Utils.operaVersion<10.5)},Common.Utils.showBrowserRestriction=function(){var e=window.DE?"Document":window.SSE?"Spreadsheet":window.PE?"Presentation":"that",t=document.createElement("div");t.innerHTML=\'<div class="application-error-panel"><div class="application-error-message-block"><div class="application-error-message-inner"><div class="application-error-message-title">Your browser is not supported.</div><div class="application-error-message-text">Sorry, \'+e+" Editor is currently only supported in the latest versions of the Chrome, Firefox, Safari or Internet Explorer web browsers.</div>"+"</div>"+"</div>"+\'<div class="application-error-message-auxiliary"></div>\'+"</div>",document.body.appendChild(t),$("#loading-mask").hide().remove(),$("#viewport").hide().remove()},Common.Utils.applyCustomization=function(e,t){for(var n in e){var r;if(!!t[n]){r=$(t[n]);if(r.length){var i=e[n];i===!1||i.visible===!1?r.hide():(!i.text||r.text(i.text),i.visible===!1&&r.hide())}}}},String.prototype.strongMatch=function(e){if(e&&e instanceof RegExp){var t=this.toString().match(e);return!!(t&&t.length>0&&t[0].length==this.length)}return!1},define("common/main/lib/util/utils",function(){});if(Common===undefined)var Common={};define("common/main/lib/component/Window",["common/main/lib/component/BaseView"],function(){Common.UI.Window=Common.UI.BaseView.extend(_.extend(function(){function n(){var e=$(".modals-mask");return e.length==0&&(e=$("<div class=\'modals-mask\'>").appendTo(document.body).hide()),e}function r(e){if(!this.isLocked()&&this.isVisible())switch(e.keyCode){case Common.UI.Keys.ESC:return e.preventDefault(),e.stopPropagation(),this.initConfig.closable!==!1&&(this.initConfig.toolclose=="hide"?this.hide():this.close()),!1;case Common.UI.Keys.RETURN:if(this.$window.find(".btn.primary").length&&(this.initConfig.onprimary||this.onPrimary).call(this)===!1)return e.preventDefault(),!1}}function i(){if(window.innerHeight==undefined)var e=document.documentElement.offsetWidth,t=document.documentElement.offsetHeight;else e=window.innerWidth,t=window.innerHeight;if(this.initConfig.height=="auto"){var n=parseInt(this.$window.find(".body").css("height"));this.initConfig.header&&(n+=parseInt(this.$window.find(".header").css("height")))}else n=this.initConfig.height;var r=Math.floor((parseInt(t)-parseInt(n))/2*.9),i=Math.floor((parseInt(e)-parseInt(this.initConfig.width))/2);this.$window.css("left",i),this.$window.css("top",r)}function s(e){return{"-webkit-transition":"0.3s opacity","-moz-transition":"0.3s opacity","-ms-transition":"0.3s opacity","-o-transition":"0.3s opacity",opacity:e}}function o(e){if($(e.target).hasClass("close"))return;Common.UI.Menu.Manager.hideAll(),this.dragging.enabled=!0,this.dragging.initx=e.pageX-parseInt(this.$window.css("left")),this.dragging.inity=e.pageY-parseInt(this.$window.css("top"));if(window.innerHeight==undefined)var t=document.documentElement.offsetWidth,n=document.documentElement.offsetHeight;else t=window.innerWidth,n=window.innerHeight;this.dragging.maxx=t-parseInt(this.$window.css("width")),this.dragging.maxy=n-parseInt(this.$window.css("height")),$(document).on("mousemove",this.binding.drag),$(document).on("mouseup",this.binding.dragStop),this.fireEvent("drag",[this,"start"])}function u(){$(document).off("mousemove",this.binding.drag),$(document).off("mouseup",this.binding.dragStop),this.dragging.enabled=!1,this.fireEvent("drag",[this,"end"])}function a(e){if(this.dragging.enabled){var t=e.pageX-this.dragging.initx,n=e.pageY-this.dragging.inity;t<0?t=0:t>this.dragging.maxx&&(t=this.dragging.maxx),n<0?n=0:n>this.dragging.maxy&&(n=this.dragging.maxy),this.$window.css({left:t,top:n})}}var e={closable:!0,header:!0,modal:!0,width:300,height:"auto",title:"Title",alias:"Window",cls:"",toolclose:"close"},t=\'<div class="asc-window<%= modal?" modal":"" %><%= cls?" "+cls:"" %>" id="<%= id %>" style="width:<%= width %>px;"><% if (header==true) { %><div class="header"><% if (closable!==false) %><div class="tool close"></div><% %><span class="title"><%= title %></span> </div><% } %><div class="body"><%= tpl %></div></div>\';return Common.UI.alert=function(e){function o(e){var t=e.getChild(".info-box"),n=e.getChild(".info-box span"),r=e.getChild(".footer"),i=e.getChild(".header"),s=e.getChild(".body"),o=e.getChild(".icon");s.css("padding-bottom","10px"),t.height(Math.max(n.height(),o.height())),s.height(parseInt(t.css("height"))+parseInt(r.css("height"))),e.setSize(n.position().left+n.width()+parseInt(t.css("padding-right")),parseInt(s.css("height"))+parseInt(i.css("height")))}function u(t){e.callback&&e.callback.call(s,t.currentTarget.attributes.result.value

]]></string> </value>
        </item>
        <item>
            <key> <string>next</string> </key>
            <value>
              <persistent> <string encoding="base64">AAAAAAAAAAQ=</string> </persistent>
            </value>
        </item>
      </dictionary>
    </pickle>
  </record>
  <record id="4" aka="AAAAAAAAAAQ=">
    <pickle>
      <global name="Pdata" module="OFS.Image"/>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>data</string> </key>
            <value> <string encoding="cdata"><![CDATA[

),s.close(!0)}function a(e){return u({currentTarget:s.getChild(".footer .dlg-btn")[0]}),!1}var t=this.Window.prototype,n={ok:t.okButtonText,cancel:t.cancelButtonText,yes:t.yesButtonText,no:t.noButtonText,close:t.closeButtonText};if(!e.buttons)e.buttons={},e.buttons.ok=n.ok;else if(_.isArray(e.buttons)){var r={};_.each(e.buttons,function(e){r[e]=n[e]}),e.buttons=r}var i=\'<div class="info-box"><div class="icon <%= iconCls %>" /><div class="text"><span><%= msg %></span></div></div><div class="footer"><button class="btn normal dlg-btn primary" result="ok">OK</button><% if (_.size(buttons) > 1) %><button class="btn normal dlg-btn" result="cancel">Cancel</button><% %></div>\',s=new Common.UI.Window({cls:"alert",title:e.title,onprimary:a,tpl:_.template(i,e)});s.on({"render:after":function(e){o(e)},show:function(e){e.getChild(".footer .dlg-btn").focus(),e.getChild(".footer .dlg-btn").on("click",u)},close:function(){e.callback&&e.callback.call(s,"close")}}),s.show()},Common.UI.warning=function(e){e=e||{},!e.title&&(e.title=this.Window.prototype.textWarning),Common.UI.alert(_.extend(e,{iconCls:"warn"}))},Common.UI.error=function(e){e=e||{},!e.title&&(e.title=this.Window.prototype.textError),Common.UI.alert(_.extend(e,{iconCls:"error"}))},Common.UI.confirm=function(e){e=e||{},!e.title&&(e.title=this.Window.prototype.textConfirmation),Common.UI.alert(_.extend(e,{iconCls:"confirm"}))},Common.UI.info=function(e){e=e||{},!e.title&&(e.title=this.Window.prototype.textInformation),Common.UI.alert(_.extend(e,{iconCls:"info"}))},{$window:undefined,$lastmodal:undefined,dragging:{enabled:!1},initialize:function(t){this.initConfig={},this.binding={},_.extend(this.initConfig,e,t||{}),!this.initConfig.id&&(this.initConfig.id="window-"+this.cid),!this.initConfig.tpl&&(this.initConfig.tpl=""),Common.UI.BaseView.prototype.initialize.call(this,this.initConfig)},render:function(){var e=this.initConfig.renderTo||document.body;$(e).append(_.template(t,this.initConfig)),this.$window=$("#"+this.initConfig.id),this.binding.keydown=_.bind(r,this);if(this.initConfig.header){this.binding.drag=_.bind(a,this),this.binding.dragStop=_.bind(u,this),this.binding.dragStart=_.bind(o,this);var n=function(){if(this.$window.find(".tool.close").hasClass("disabled"))return;this.initConfig.toolcallback?this.initConfig.toolcallback.call(this):this.initConfig.toolclose=="hide"?this.hide():this.close()};this.$window.find(".header").on("mousedown",this.binding.dragStart),this.$window.find(".tool.close").on("click",_.bind(n,this))}else this.$window.find(".body").css({top:0,"border-radius":"5px"});if(this.initConfig.height=="auto"){var i=parseInt(this.$window.find("> .body").css("height"));this.initConfig.header&&(i+=parseInt(this.$window.find("> .header").css("height"))),this.$window.height(i)}else this.$window.css("height",this.initConfig.height);return this.fireEvent("render:after",this),this},show:function(e,t){if(this.initConfig.modal){var r=n();if(this.options.animate!==!1){var o=r.css("opacity");r.css("opacity",0),r.show(),setTimeout(function(){r.css(s(o))},1)}else r.show();Common.NotificationCenter.trigger("modal:show",this),this.$lastmodal=$(".asc-window.modal:not(.dethrone):visible").first().addClass("dethrone")}this.$window?this.$window.is(":visible")||this.$window.show():(this.render(),_.isNumber(e)&&_.isNumber(t)?(this.$window.css("left",Math.floor(e)),this.$window.css("top",Math.floor(t))):i.call(this)),$(document).on("keydown."+this.cid,this.binding.keydown);var u=this;this.options.animate!==!1?(this.$window.css({"-webkit-transform":"scale(0.8)","-moz-transform":"scale(0.8)","-ms-transform":"scale(0.8)","-o-transform":"scale(0.8)",opacity:0}),setTimeout(function(){u.$window.css({"-webkit-transition":"0.3s opacity, 0.3s -webkit-transform","-webkit-transform":"scale(1)","-moz-transition":"0.3s opacity, 0.3s -moz-transform","-moz-transform":"scale(1)","-ms-transition":"0.3s opacity, 0.3s -ms-transform","-ms-transform":"scale(1)","-o-transition":"0.3s opacity, 0.3s -o-transform","-o-transform":"scale(1)",opacity:"1"})},1),setTimeout(function(){u.$window.css({"-webkit-transform":"","-moz-transform":"","-ms-transition":"","-ms-transform":"","-o-transform":""}),u.fireEvent("show",u)},350)):this.fireEvent("show",this),Common.NotificationCenter.trigger("window:show")},close:function(e){$(document).off("keydown."+this.cid),this.initConfig.header&&this.$window.find(".header").off("mousedown",this.binding.dragStart);if(this.initConfig.modal){var t=!0;this.$lastmodal.size()>0&&(this.$lastmodal.removeClass("dethrone"),t=!this.$lastmodal.hasClass("modal"));if(t){var n=$(".modals-mask");if(this.options.animate!==!1){var r=n.css("opacity");n.css(s(0)),setTimeout(function(){n.css("opacity",r),n.hide()},300)}else n.hide()}Common.NotificationCenter.trigger("modal:close",this)}this.$window.remove(),e!==!0&&this.fireEvent("close",this)},hide:function(){$(document).off("keydown."+this.cid);if(this.$window){if(this.initConfig.modal){var e=!0;this.$lastmodal.size()>0&&(this.$lastmodal.removeClass("dethrone"),e=!this.$lastmodal.hasClass("modal"));if(e){var t=$(".modals-mask");if(this.options.animate!==!1){var n=t.css("opacity");t.css(s(0)),setTimeout(function(){t.css("opacity",n),t.hide()},300)}else t.hide()}Common.NotificationCenter.trigger("modal:hide",this)}this.$window.hide(),this.fireEvent("hide",this)}},isLocked:function(){return this.$window.hasClass("dethrone")||!this.options.modal&&this.$window.parent().find(".asc-window.modal:visible").length},getChild:function(e){return e?this.$window.find(e):this.$window},setWidth:function(e){if(e>=0){var t=parseInt(this.$window.css("min-width"));e<t&&(e=t),this.$window.width(e)}},getWidth:function(){return parseInt(this.$window.css("width"))},setHeight:function(e){if(e>=0){var t=parseInt(this.$window.css("min-height"));e<t&&(e=t),this.$window.height(e),this.initConfig.header&&(e-=parseInt(this.$window.find("> .header").css("height"))),this.$window.find("> .body").css("height",e)}},getHeight:function(){return parseInt(this.$window.css("height"))},setSize:function(e,t){this.setWidth(e),this.setHeight(t)},getSize:function(){return[this.getWidth(),this.getHeight()]},setTitle:function(e){this.$window.find("> .header > .title").text(e)},getTitle:function(){return this.$window.find("> .header > .title").text()},isVisible:function(){return this.$window&&this.$window.is(":visible")},onPrimary:function(){},cancelButtonText:"Cancel",okButtonText:"OK",yesButtonText:"Yes",noButtonText:"No",closeButtonText:"Close",textWarning:"Warning",textError:"Error",textConfirmation:"Confirmation",textInformation:"Information"}}(),Common.UI.Window||{}))});if(Common===undefined)var Common={};define("common/main/lib/view/CopyWarningDialog",["common/main/lib/component/Window"],function(){Common.Views.CopyWarningDialog=Common.UI.Window.extend(_.extend({options:{width:500,height:325,cls:"modal-dlg copy-warning"},initialize:function(e){_.extend(this.options,{title:this.textTitle},e||{}),this.template=[\'<div class="box">\',\'<p class="message">\'+this.textMsg+"</p>",\'<div class="hotkeys">\',"<div>",\'<p class="hotkey">\'+Common.Utils.String.platformKey("Ctrl+C","{0}")+"</p>",\'<p class="message">\'+this.textToCopy+"</p>","</div>","<div>",\'<p class="hotkey">\'+Common.Utils.String.platformKey("Ctrl+X","{0}")+"</p>",\'<p class="message">\'+this.textToCut+"</p>","</div>","<div>",\'<p class="hotkey">\'+Common.Utils.String.platformKey("Ctrl+V","{0}")+"</p>",\'<p class="message">\'+this.textToPaste+"</p>","</div>","</div>",\'<div id="copy-warning-checkbox" style="margin-top: 20px; text-align: left;"></div>\',"</div>",\'<div class="separator horizontal"/>\',\'<div class="footer center">\',\'<button class="btn normal dlg-btn primary">\'+this.okButtonText+"</button>","</div>"].join(""),this.options.tpl=_.template(this.template,this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this),this.chDontShow=new Common.UI.CheckBox({el:$("#copy-warning-checkbox"),labelText:this.textDontShow}),this.getChild().find(".btn").on("click",_.bind(this.onBtnClick,this)),this.autoSize(),Common.NotificationCenter.trigger("copywarning:show")},autoSize:function(){var e=this.getChild(".box"),t=this.getChild(".footer"),n=this.getChild(".header"),r=this.getChild(".body");r.height(parseInt(e.height())+parseInt(t.css("height"))),this.setHeight(parseInt(r.css("height"))+parseInt(n.css("height")))},onBtnClick:function(e){this.options.handler&&this.options.handler.call(this,this.chDontShow.getValue()=="checked"),this.close()},onKeyPress:function(e){e.keyCode==Common.UI.Keys.RETURN&&(this.options.handler&&this.options.handler.call(this,this.chDontShow.getValue()=="checked"),this.close())},getSettings:function(){return this.chDontShow.getValue()=="checked"},textTitle:"Copy, Cut and Paste Actions",textMsg:"Copy, cut and paste actions using the editor toolbar buttons and context menu actions will be performed within this editor tab only.<br><br>.To copy or paste to or from applications outside the editor tab use the following keyboard combinations:",textToCopy:"for Copy",textToPaste:"for Paste",textToCut:"for Cut",textDontShow:"Don\'t show this message again"},Common.Views.CopyWarningDialog||{}))}),$(document).off("keydown.bs.dropdown.data-api").on("keydown.bs.dropdown.data-api","[data-toggle=dropdown], [role=menu]",onDropDownKeyDown),define("common/main/lib/extend/Bootstrap",function(){});if(Common===undefined)var Common={};define("common/main/lib/component/ToggleManager",["common/main/lib/component/BaseView"],function(){function t(t,n){var r,i,s;if(n){r=e[t.toggleGroup];for(i=0,s=r.length;i<s;i++)r[i]!==t&&(r[i].isActive?r[i].isActive()&&r[i].toggle(!1):r[i].toggle(!1))}}var e={};Common.UI.ToggleManager={register:function(n){if(!n.toggleGroup)return;var r=e[n.toggleGroup];r||(r=e[n.toggleGroup]=[]),r.push(n),n.on("toggle",t)},unregister:function(n){if(!n.toggleGroup)return;var r=e[n.toggleGroup];r&&(_.without(r,n),n.off("toggle",t))},getToggled:function(t){var n=e[t],r=0,i;if(n)for(i=n.length;r<i;r++)if(n[r].pressed===!0||n[r].checked===!0)return n[r];return null}}});if(Common===undefined)var Common={};define("common/main/lib/component/MenuItem",["common/main/lib/component/BaseView","common/main/lib/component/ToggleManager"],function(){Common.UI.MenuItem=Common.UI.BaseView.extend({options:{id:null,cls:"",style:"",hint:!1,checkable:!1,checked:!1,allowDepress:!1,disabled:!1,value:null,toggleGroup:null,iconCls:"",menu:null,canFocused:!0},tagName:"li",template:_.template([\'<a id="<%= id %>" style="<%= style %>" <% if(options.canFocused) { %> tabindex="-1" type="menuitem" <% }; if(!_.isUndefined(options.stopPropagation)) { %> data-stopPropagation="true" <% }; %> >\',"<% if (!_.isEmpty(iconCls)) { %>",\'<span class="menu-item-icon <%= iconCls %>"></span>\',"<% } %>","<%= caption %>","</a>"].join("")),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e);var t=this,n=$(this.el);this.id=t.options.id||Common.UI.getId(),this.cls=t.options.cls,this.style=t.options.style,this.caption=t.options.caption,this.menu=t.options.menu||null,this.checkable=t.options.checkable,this.checked=t.options.checked,t.allowDepress=t.options.allowDepress,this.disabled=t.options.disabled,this.value=t.options.value,this.toggleGroup=t.options.toggleGroup,this.template=t.options.template||this.template,this.iconCls=t.options.iconCls,this.rendered=!1,this.menu!==null&&!(this.menu instanceof Common.UI.Menu)&&(this.menu=new Common.UI.Menu(_.extend({},t.options.menu))),t.options.el&&this.render()},render:function(){var e=this,t=$(this.el);e.trigger("render:before",e);if(e.caption==="--")t.addClass("divider");else if(!this.rendered){t.off("click"),Common.UI.ToggleManager.unregister(e),$(this.el).html(this.template({id:e.id,caption:e.caption,iconCls:e.iconCls,style:e.style,options:e.options})),e.menu&&(t.addClass("dropdown-submenu"),e.menu.render($(this.el)),t.mouseenter(_.bind(e.menu.alignPosition,e.menu)),t.focusout(_.bind(e.onBlurItem,e)),t.hover(_.bind(e.onHoverItem,e),_.bind(e.onUnHoverItem,e)));var n=t.children(":first");this.checkable&&n&&(n.toggleClass("checkable",this.checkable),n.toggleClass("checked",this.checked),_.isEmpty(this.iconCls)||n.css("background-image","none")),this.disabled&&$(this.el).toggleClass("disabled",this.disabled),t.on("click",_.bind(this.onItemClick,this)),t.on("mousedown",_.bind(this.onItemMouseDown,this)),Common.UI.ToggleManager.register(e)}return e.cmpEl=$(this.el),e.rendered=!0,e.trigger("render:after",e),this},setCaption:function(e){this.caption=e,this.rendered&&(this.cmpEl.find("a").contents().last()[0].textContent=Common.Utils.String.htmlEncode(e))},setChecked:function(e,t){this.toggle(e,t)},isChecked:function(){return this.checked},setDisabled:function(e){this.disabled=!!e,this.rendered&&this.cmpEl.toggleClass("disabled",this.disabled)},isDisabled:function(){return this.disabled},toggle:function(e,t){var n=e===undefined?!this.checked:!!e;if(this.checkable){this.checked=n;if(this.rendered){var r=this.cmpEl.children(":first");r&&(r.toggleClass("checked",this.checked),_.isEmpty(this.iconCls)||r.css("background-image","none"))}t||this.trigger("toggle",this,n)}},onItemMouseDown:function(e){if(e.which!=1)return e.preventDefault(),e.stopPropagation(),!1},onItemClick:function(e){if(!(e.which==1||e.which===undefined&&!this.menu))return!1;!this.disabled&&(this.allowDepress||!this.checked||!this.toggleGroup)&&this.setChecked(!this.checked);if(this.menu){if(e.target.id==this.id)return!1;this.menu.isOver||this.cmpEl.removeClass("over");return}if(!!this.disabled)return!1;this.trigger("click",this,e)},onHoverItem:function(e){this._doHover(e)},onUnHoverItem:function(e){this._doUnHover(e)},onBlurItem:function(e){this._doUnHover(e)},_doHover:function(e){var t=this;t.menu&&!t.disabled&&(clearTimeout(t.hideMenuTimer),t.cmpEl.trigger("show.bs.dropdown"),t.expandMenuTimer=_.delay(function(){t.cmpEl.addClass("over"),t.cmpEl.trigger("shown.bs.dropdown")},200))},_doUnHover:function(e){var t=this;t.menu&&!t.disabled&&(clearTimeout(t.expandMenuTimer),t.hideMenuTimer=_.delay(function(){t.menu.isOver||t.cmpEl.removeClass("over")},200))}})}),function(e){typeof define=="function"&&define.amd?define("jmousewheel",["jquery"],e):typeof exports=="object"?module.exports=e:e(jQuery)}(function(e){function a(t){var n=t||window.event,o=r.call(arguments,1),u=0,a=0,c=0,h=0;t=e.event.fix(n),t.type="mousewheel","detail"in n&&(c=n.detail*-1),"wheelDelta"in n&&(c=n.wheelDelta),"wheelDeltaY"in n&&(c=n.wheelDeltaY),"wheelDeltaX"in n&&(a=n.wheelDeltaX*-1),"axis"in n&&n.axis===n.HORIZONTAL_AXIS&&(a=c*-1,c=0),u=c===0?a:c,"deltaY"in n&&(c=n.deltaY*-1,u=c),"deltaX"in n&&(a=n.deltaX,c===0&&(u=a*-1));if(c===0&&a===0)return;if(n.deltaMode===1){var p=e.data(this,"mousewheel-line-height");u*=p,c*=p,a*=p}else if(n.deltaMode===2){var d=e.data(this,"mousewheel-page-height");u*=d,c*=d,a*=d}h=Math.max(Math.abs(c),Math.abs(a));if(!s||h<s)s=h,l(n,h)&&(s/=40);return l(n,h)&&(u/=40,a/=40,c/=40),u=Math[u>=1?"floor":"ceil"](u/s),a=Math[a>=1?"floor":"ceil"](a/s),c=Math[c>=1?"floor":"ceil"](c/s),t.deltaX=a,t.deltaY=c,t.deltaFactor=s,t.deltaMode=0,o.unshift(t,u,a,c),i&&clearTimeout(i),i=setTimeout(f,200),(e.event.dispatch||e.event.handle).apply(this,o)}function f(){s=null}function l(e,t){return u.settings.adjustOldDeltas&&e.type==="mousewheel"&&t%120===0}var t=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],n="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],r=Array.prototype.slice,i,s;if(e.event.fixHooks)for(var o=t.length;o;)e.event.fixHooks[t[--o]]=e.event.mouseHooks;var u=e.event.special.mousewheel={version:"3.1.9",setup:function(){if(this.addEventListener)for(var t=n.length;t;)this.addEventListener(n[--t],a,!1);else this.onmousewheel=a;e.data(this,"mousewheel-line-height",u.getLineHeight(this)),e.data(this,"mousewheel-page-height",u.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var e=n.length;e;)this.removeEventListener(n[--e],a,!1);else this.onmousewheel=null},getLineHeight:function(t){return parseInt(e(t)["offsetParent"in e.fn?"offsetParent":"parent"]().css("fontSize"),10)},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}),function(e){typeof define=="function"&&define.amd?define("perfectscrollbar",["jquery"],e):typeof exports=="object"?e(require("jquery")):e(jQuery)}(function(e){var t={wheelSpeed:10,wheelPropagation:!1,minScrollbarLength:null,useBothWheelAxes:!1,useKeyboard:!0,suppressScrollX:!1,suppressScrollY:!1,scrollXMarginOffset:0,scrollYMarginOffset:0,includePadding:!1,includeMargin:!0},n=function(){var e=0;return function(){var t=e;return e+=1,".perfect-scrollbar-"+t}}();e.fn.perfectScrollbar=function(r,i){return this.each(function(){var s=e.extend(!0,{},t),o=e(this);typeof r=="object"?e.extend(!0,s,r):i=r;if(i==="update")return o.data("perfect-scrollbar-update")&&o.data("perfect-scrollbar-update")(),o;if(i==="destroy")return o.data("perfect-scrollbar-destroy")&&o.data("perfect-scrollbar-destroy")(),o;if(o.data("perfect-scrollbar"))return o.data("perfect-scrollbar");o.addClass("ps-container");var u=e("<div class=\'ps-scrollbar-x-rail\'></div>").appendTo(o),a=e("<div class=\'ps-scrollbar-y-rail\'></div>").appendTo(o),f=e("<div class=\'ps-scrollbar-x\'></div>").appendTo(u),l=e("<div class=\'ps-scrollbar-y\'></div>").appendTo(a),c,h,p,d,v,m,g,y,b=parseInt(u.css("bottom"),10),w,E,S=parseInt(a.css("right"),10),x,T=n(),N=function(e,t){var n=e+t,r=x-w;n<0?E=0:n>r?E=r:E=n;var i=parseInt(E*(m-d)/(x-w),10);o.scrollTop(i),u.css({bottom:b-i})},C=function(e,t){var n=e+t,r=p-g;n<0?y=0:n>r?y=r:y=n;var i=parseInt(y*(v-p)/(p-g),10);o.scrollLeft(i),a.css({right:S-i})},k=function(e){return s.minScrollbarLength&&(e=Math.max(e,s.minScrollbarLength)),e},L=function(){u.css({left:o.scrollLeft(),bottom:b-o.scrollTop(),width:p,display:c?"inherit":"none"}),a.hasClass("in-scrolling")?a.css({right:S-o.scrollLeft(),height:x,display:h?"inherit":"none"}):a.css({top:o.scrollTop(),right:S-o.scrollLeft(),height:x,display:h?"inherit":"none"}),f.css({left:y,width:g}),l.css({top:E,height:w})},A=function(){p=s.includePadding?o.innerWidth():o.width(),d=s.includePadding?o.innerHeight():o.height(),x=d-(s.includeMargin?parseInt(a.css("margin-top"))+parseInt(a.css("margin-bottom")):0),v=o.prop("scrollWidth"),m=o.prop("scrollHeight"),!s.suppressScrollX&&p+s.scrollXMarginOffset<v?(c=!0,g=k(parseInt(p*p/v,10)),y=parseInt(o.scrollLeft()*(p-g)/(v-p),10)):(c=!1,g=0,y=0,o.scrollLeft(0)),!s.suppressScrollY&&d+s.scrollYMarginOffset<m?(h=!0,w=k(parseInt(x*d/m,10)),E=parseInt(o.scrollTop()*(x-w)/(m-d),10)):(h=!1,w=0,E=0,o.scrollTop(0)),E>=x-w&&(E=x-w),y>=p-g&&(y=p-g),L(),s.onChange&&s.onChange(this)},O=function(){var t,n;f.bind("mousedown"+T,function(e){n=e.pageX,t=f.position().left,u.addClass("in-scrolling"),e.stopPropagation(),e.preventDefault()}),e(document).bind("mousemove"+T,function(e){u.hasClass("in-scrolling")&&(C(t,e.pageX-n),e.stopPropagation(),e.preventDefault())}),e(document).bind("mouseup"+T,function(e){u.hasClass("in-scrolling")&&u.removeClass("in-scrolling")}),t=n=null},M=function(){var t,n;l.bind("mousedown"+T,function(e){n=e.pageY,t=l.position().top,a.addClass("in-scrolling");var r=parseInt(a.css("margin-top")),i=a[0].getBoundingClientRect();a.css({position:"fixed",left:i.left,top:i.top-r}),e.stopPropagation(),e.preventDefault()}),e(document).bind("mousemove"+T,function(e){a.hasClass("in-scrolling")&&(N(t,e.pageY-n),e.stopPropagation(),e.preventDefault())}),e(document).bind("mouseup"+T,function(e){a.hasClass("in-scrolling")&&(a.removeClass("in-scrolling"),a.css({position:"",left:"",top:""}),L())}),t=n=null},_=function(e,t){var n=o.scrollTop();if(e===0){if(!h)return!1;if(n===0&&t>0||n>=m-d&&t<0)return!s.wheelPropagation}var r=o.scrollLeft();if(t===0){if(!c)return!1;if(r===0&&e<0||r>=v-p&&e>0)return!s.wheelPropagation}return!0},D=function(){s.wheelSpeed/=10;var t=!1;o.bind("mousewheel"+T,function(n,r,i,u){var a=n.deltaX*n.deltaFactor||i,f=n.deltaY*n.deltaFactor||u;if(n&&n.target&&(n.target.type==="textarea"||n.target.type==="input")){n.stopImmediatePropagation(),n.preventDefault();var l=e(n.target).scrollTop(),p=0;n.originalEvent&&(n.originalEvent.wheelDelta&&(p=n.originalEvent.wheelDelta/-40),n.originalEvent.deltaY&&(p=n.originalEvent.deltaY),n.originalEvent.detail&&(p=n.originalEvent.detail)),e(n.target).scrollTop(l-p);return}t=!1,s.useBothWheelAxes?h&&!c?(f?o.scrollTop(o.scrollTop()-f*s.wheelSpeed):o.scrollTop(o.scrollTop()+a*s.wheelSpeed),t=!0):c&&!h&&(a?o.scrollLeft(o.scrollLeft()+a*s.wheelSpeed):o.scrollLeft(o.scrollLeft()-f*s.wheelSpeed),t=!0):(o.scrollTop(o.scrollTop()-f*s.wheelSpeed),o.scrollLeft(o.scrollLeft()+a*s.wheelSpeed)),A(),t=t||_(a,f),t&&(n.stopPropagation(),n.preventDefault())}),o.bind("MozMousePixelScroll"+T,function(e){t&&e.preventDefault()})},P=function(){var t=!1;o.bind("mouseenter"+T,function(e){t=!0}),o.bind("mouseleave"+T,function(e){t=!1});var n=!1;e(document).bind("keydown"+T,function(r){if(!t||e(document.activeElement).is(":input,[contenteditable]"))return;var i=0,s=0;switch(r.which){case 37:i=-30;break;case 38:s=30;break;case 39:i=30;break;case 40:s=-30;break;case 33:s=90;break;case 32:case 34:s=-90;break;case 35:s=-d;break;case 36:s=d;break;default:return}o.scrollTop(o.scrollTop()-s),o.scrollLeft(o.scrollLeft()+i),n=_(i,s),n&&r.preventDefault()})},H=function(){var e=function(e){e.stopPropagation()};l.bind("click"+T,e),a.bind("click"+T,function(e){var t=parseInt(w/2,10),n=e.pageY-a.offset().top-t,r=x-w,i=n/r;i<0?i=0:i>1&&(i=1),o.scrollTop((m-d)*i)}),f.bind("click"+T,e),u.bind("click"+T,function(e){var t=parseInt(g/2,10),n=e.pageX-u.offset().left-t,r=p-g,i=n/r;i<0?i=0:i>1&&(i=1),o.scrollLeft((v-p)*i)})},B=function(){var t=function(e,t){o.scrollTop(o.scrollTop()-t),o.scrollLeft(o.scrollLeft()-e),A()},n={},r=0,i={},s=null,u=!1;e(window).bind("touchstart"+T,function(e){u=!0}),e(window).bind("touchend"+T,function(e){u=!1}),o.bind("touchstart"+T,function(e){var t=e.originalEvent.targetTouches[0];n.pageX=t.pageX,n.pageY=t.pageY,r=(new Date).getTime(),s!==null&&clearInterval(s),e.stopPropagation()}),o.bind("touchmove"+T,function(e){if(!u&&e.originalEvent.targetTouches.length===1){var s=e.originalEvent.targetTouches[0],o={};o.pageX=s.pageX,o.pageY=s.pageY;var a=o.pageX-n.pageX,f=o.pageY-n.pageY;t(a,f),n=o;var l=(new Date).getTime(),c=l-r;c>0&&(i.x=a/c,i.y=f/c,r=l),e.preventDefault()}}),o.bind("touchend"+T,function(e){clearInterval(s),s=setInterval(function(){if(Math.abs(i.x)<.01&&Math.abs(i.y)<.01){clearInterval(s);return}t(i.x*30,i.y*30),i.x*=.8,i.y*=.8},10)})},j=function(){o.bind("scroll"+T,function(e){A()})},F=function(){o.unbind(T),e(window).unbind(T),e(document).unbind(T),o.data("perfect-scrollbar",null),o.data("perfect-scrollbar-update",null),o.data("perfect-scrollbar-destroy",null),f.remove(),l.remove(),u.remove(),a.remove(),f=l=p=d=v=m=g=y=b=w=E=S=null},I=function(t){o.addClass("ie").addClass("ie"+t);var n=function(){var t=function(){e(this).addClass("hover")},n=function(){e(this).removeClass("hover")};o.bind("mouseenter"+T,t).bind("mouseleave"+T,n),u.bind("mouseenter"+T,t).bind("mouseleave"+T,n),a.bind("mouseenter"+T,t).bind("mouseleave"+T,n),f.bind("mouseenter"+T,t).bind("mouseleave"+T,n),l.bind("mouseenter"+T,t).bind("mouseleave"+T,n)},r=function(){L=function(){f.css({left:y+o.scrollLeft(),bottom:b,width:g}),l.css({top:E+o.scrollTop(),right:S,height:w}),f.hide().show(),l.hide().show()}};t===6&&(n(),r())},q="ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch,R=function(){var e=navigator.userAgent.toLowerCase().match(/(msie) ([\\w.]+)/);e&&e[1]==="msie"&&I(parseInt(e[2],10)),A(),j(),O(),M(),H(),q&&B(),o.mousewheel&&D(),s.useKeyboard&&P(),o.data("perfect-scrollbar",o),o.data("perfect-scrollbar-update",A),o.data("perfect-scrollbar-destroy",F)};return R(),o})}});if(Common===undefined)var Common={};define("common/main/lib/component/Scroller",["jmousewheel","perfectscrollbar","common/main/lib/component/BaseView"],function(){Common.UI.Scroller=function(){var e;return _.extend(Common.UI.BaseView.extend({options:{wheelSpeed:20,wheelPropagation:!1,minScrollbarLength:null,useBothWheelAxes:!1,useKeyboard:!0,suppressScrollX:!1,suppressScrollY:!1,scrollXMarginOffset:5,scrollYMarginOffset:5,includePadding:!0,includeMargin:!0,alwaysVisibleX:!1,alwaysVisibleY:!1},initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e),this.options.el&&this.render()},render:function(){var e=this;return e.cmpEl=$(this.el),e.rendered||(e.cmpEl.perfectScrollbar(_.extend({},e.options)),e.rendered=!0,this.setAlwaysVisibleX(e.options.alwaysVisibleX),this.setAlwaysVisibleY(e.options.alwaysVisibleY)),this},remove:function(){this.destroy(),Backbone.View.prototype.remove.call(this)},update:function(t){var n=this.options;t?(this.destroy(),n=_.extend(this.options,t),this.cmpEl.perfectScrollbar(n)):this.cmpEl.perfectScrollbar("update"),this.setAlwaysVisibleX(n.alwaysVisibleX),this.setAlwaysVisibleY(n.alwaysVisibleY);var r=function(t){e=!0;var n=function(t){$(document).unbind("mouseup",n),_.delay(function(){e=!1},10)};$(document).mouseup(n)};$(".ps-scrollbar-x-rail, .ps-scrollbar-y-rail, .ps-scrollbar-x, .ps-scrollbar-y",this.cmpEl).off("mousedown",r).on("mousedown",r)},destroy:function(){this.cmpEl.perfectScrollbar("destroy")},scrollLeft:function(e){this.cmpEl.scrollLeft(e),this.update()},scrollTop:function(e){this.cmpEl.scrollTop(e),this.update()},getScrollTop:function(){return this.cmpEl.scrollTop()},getScrollLeft:function(){return this.cmpEl.scrollLeft()},setAlwaysVisibleX:function(e){e?($(this.el).find(".ps-scrollbar-x-rail").addClass("always-visible-x"),$(this.el).find(".ps-scrollbar-x").addClass("always-visible-x")):($(this.el).find(".ps-scrollbar-x-rail").removeClass("always-visible-x"),$(this.el).find(".ps-scrollbar-x").addClass("always-visible-x"))},setAlwaysVisibleY:function(e){e?($(this.el).find(".ps-scrollbar-y-rail").addClass("always-visible-y"),$(this.el).find(".ps-scrollbar-y").addClass("always-visible-y")):($(this.el).find(".ps-scrollbar-y-rail").removeClass("always-visible-y"),$(this.el).find(".ps-scrollbar-y").addClass("always-visible-y"))}}),{isMouseCapture:function(){return e}})}()});if(Common===undefined)var Common={};define("common/main/lib/component/Menu",["common/main/lib/extend/Bootstrap","common/main/lib/component/BaseView","common/main/lib/component/MenuItem","common/main/lib/component/Scroller"],function(){Common.UI.Menu=function(){var e=function(){var e=[],t={};return{register:function(n){t[n.id]=n,n.on("show:after",function(t){e.push(t)}).on("hide:after",function(t){var n=e.indexOf(t);n>-1&&e.splice(n,1)})},unregister:function(n){var r=e.indexOf(n);delete t[n.id],r>-1&&e.splice(r,1),n.off("show:after").off("hide:after")},hideAll:function(){return Common.NotificationCenter.trigger("menumanager:hideall"),e&&e.length>0?(_.each(e,function(e){e.hide()}),!0):!1}}}();return _.extend(Common.UI.BaseView.extend({options:{cls:"",style:"",itemTemplate:null,items:[],menuAlign:"tl-bl",menuAlignEl:null,offset:[0,0]},template:_.template([\'<ul class="dropdown-menu <%= options.cls %>" style="<%= options.style %>" role="menu"></ul>\'].join("")),initialize:function(t){Common.UI.BaseView.prototype.initialize.call(this,t);var n=this;this.id=this.options.id||Common.UI.getId(),this.itemTemplate=this.options.itemTemplate||Common.UI.MenuItem.prototype.template,this.rendered=!1,this.items=[],this.offset=[0,0],this.menuAlign=this.options.menuAlign,this.menuAlignEl=this.options.menuAlignEl,_.each(this.options.items,function(e){e instanceof Common.UI.MenuItem?n.items.push(e):n.items.push(new Common.UI.MenuItem(_.extend({tagName:"li",template:n.itemTemplate},e)))}),this.options.el&&this.render(),e.register(this)},remove:function(){e.unregister(this),Common.UI.BaseView.prototype.remove.call(this)},render:function(e){var t=this;this.trigger("render:before",this),this.cmpEl=$(this.el),e?(this.setElement(e,!1),t.rendered||(this.cmpEl=$(this.template({options:t.options})),e.append(this.cmpEl))):t.rendered||(this.cmpEl=this.template({options:t.options}),$(this.el).append(this.cmpEl));var n=this.cmpEl.parent(),r=n.attr("role")==="menu"?n:n.find("[role=menu]");return r&&(t.rendered||_.each(t.items||[],function(e){r.append(e.render().el),e.on("click",_.bind(t.onItemClick,t)),e.on("toggle",_.bind(t.onItemToggle,t))}),r.css({"max-height":t.options.maxHeight||"none",position:"fixed",right:"auto",left:-1e3,top:-1e3}),this.parentEl=r.parent(),this.parentEl.on("show.bs.dropdown",_.bind(t.onBeforeShowMenu,t)),this.parentEl.on("shown.bs.dropdown",_.bind(t.onAfterShowMenu,t)),this.parentEl.on("hide.bs.dropdown",_.bind(t.onBeforeHideMenu,t)),this.parentEl.on("hidden.bs.dropdown",_.bind(t.onAfterHideMenu,t)),this.parentEl.on("keydown.after.bs.dropdown",_.bind(t.onAfterKeydownMenu,t)),r.on("scroll",_.bind(t.onScroll,t)),r.hover(function(e){t.isOver=!0},function(e){t.isOver=!1})),this.rendered=!0,this.trigger("render:after",this),this},isVisible:function(){return this.rendered&&this.cmpEl.is(":visible")},show:function(){this.rendered&&this.parentEl&&!this.parentEl.hasClass("open")&&this.cmpEl.dropdown("toggle")},hide:function(){this.rendered&&this.parentEl&&this.parentEl.hasClass("open")&&this.cmpEl.dropdown("toggle")},insertItem:function(e,t){var n=this,r=this.cmpEl;t instanceof Common.UI.MenuItem||(t=new Common.UI.MenuItem(_.extend({tagName:"li",template:n.itemTemplate},t))),e<0||e>=n.items.length?n.items.push(t):n.items.splice(e,0,t);if(this.rendered){var i=r.attr("role")==="menu"?r:r.find("[role=menu]");i&&(e<0?i.append(t.render().el):e===0?i.prepend(t.render().el):$("li:nth-child("+e+")",i).before(t.render().el),t.on("click",_.bind(n.onItemClick,n)),t.on("toggle",_.bind(n.onItemToggle,n)))}},doLayout:function(){if(this.options.maxHeight>0){if(!this.rendered){this.mustLayout=!0;return}var e=this,t=this.cmpEl,n=t.attr("role")==="menu"?t:t.find("[role=menu]");if(!n.is(":visible")){var r=[n.css("left"),n.css("top")];n.css({left:"-1000px",top:"-1000px",display:"block"})}var i=n.find("li");if(i.height()*i.length>this.options.maxHeight){var s=\'<div class="menu-scroll top"></div>\';n.prepend(s),s=\'<div class="menu-scroll bottom"></div>\',n.append(s),n.css({"box-shadow":"none","overflow-y":"hidden","padding-top":"18px"}),n.find("> li:last-of-type").css("margin-bottom",18);var o=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},u=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";o(n[0],u,_.bind(this.onMouseWheel,this)),n.find(".menu-scroll").on("click",_.bind(this.onScrollClick,this))}r&&n.css({display:"",left:r[0],top:r[1]})}},addItem:function(e){this.insertItem(-1,e)},removeItem:function(e){var t=this,n=t.items.indexOf(e);n>-1&&(t.items.splice(n,1),e.off("click").off("toggle"),e.remove())},removeAll:function(){var e=this;_.each(e.items,function(e){e.off("click").off("toggle"),e.remove()}),e.items=[]},onBeforeShowMenu:function(e){this.mustLayout&&(delete this.mustLayout,this.doLayout.call(this)),this.trigger("show:before",this,e),this.alignPosition()},onAfterShowMenu:function(e){this.trigger("show:after",this,e);if(this.$el.find("> ul > .menu-scroll").length){var t=this.$el.find("li .checked")[0];if(t){var n=t.offsetTop-this.options.maxHeight/2;this.scrollMenu(n<0?0:n)}}},onBeforeHideMenu:function(e){this.trigger("hide:before",this,e),Common.UI.Scroller.isMouseCapture()&&e.preventDefault()},onAfterHideMenu:function(e){this.trigger("hide:after",this,e)},onAfterKeydownMenu:function(e){if(e.keyCode==Common.UI.Keys.RETURN){var t=$(e.target).closest("li");t.length<=0&&(t=$(e.target).parent().find("li .dataview")),t.length>0&&t.click()}else if(e.keyCode==Common.UI.Keys.UP||e.keyCode==Common.UI.Keys.DOWN)this.fromKeyDown=!0},onScroll:function(e,t){if(this.fromKeyDown){var n=this.cmpEl.attr("role")==="menu"?this.cmpEl:this.cmpEl.find("[role=menu]");n.find(".menu-scroll.top").css("top",n.scrollTop()+"px"),n.find(".menu-scroll.bottom").css("bottom",-n.scrollTop()+"px")}},onItemClick:function(e,t){e.menu||(this.isOver=!1);if(e.options.stopPropagation){t.stopPropagation();var n=this;_.delay(function(){n.$el.parent().parent().find("[data-toggle=dropdown]").focus()},10);return}this.trigger("item:click",this,e,t)},onItemToggle:function(e,t,n){this.trigger("item:toggle",this,e,t,n)},onScrollClick:function(e){return this.scrollMenu(/top/.test(e.currentTarget.className)),!1},onMouseWheel:function(e){this.scrollMenu((e.detail&&-e.detail||e.wheelDelta)>0)},scrollMenu:function(e){this.fromKeyDown=!1;var t=this.cmpEl.attr("role")==="menu"?this.cmpEl:this.cmpEl.find("[role=menu]"),n=typeof e=="boolean"?t.scrollTop()+(e?-20:20):e;t.scrollTop(n),t.find(".menu-scroll.top").css("top",t.scrollTop()+"px"),t.find(".menu-scroll.bottom").css("bottom",-t.scrollTop()+"px")},setOffset:function(e,t){this.offset[0]=_.isUndefined(e)?this.offset[0]:e,this.offset[1]=_.isUndefined(t)?this.offset[1]:t,this.alignPosition()},getOffset:function(){return this.offset},alignPosition:function(){var e=this.cmpEl.attr("role")==="menu"?this.cmpEl:this.cmpEl.find("[role=menu]"),t=this.menuAlignEl||e.parent(),n=this.menuAlign.match(/^([a-z]+)-([a-z]+)/),r=t.offset(),i=Math.min($(document).width(),$("body").width()),s=$(document).height()-10,o=e.outerWidth(),u=e.outerHeight(),a=t.outerWidth(),f=t.outerHeight(),l={tl:[0,0],bl:[0,u],tr:[o,0],br:[o,u]},c={tl:[0,0],tr:[a,0],bl:[0,f],br:[a,f]},h=r.left-l[n[1]][0]+c[n[2]][0]+this.offset[0],p=r.top-l[n[1]][1]+c[n[2]][1]+this.offset[1];h+o>i&&(t.is("li.dropdown-submenu")?h=r.left-o+2:h=i-o),p+u>s&&(p=s-u),p<0&&(p=0),e.css({left:h,top:p})}}),{Manager:function(){return e}()})}()}),define("spreadsheeteditor/main/app/view/DocumentHolder",["jquery","underscore","backbone","gateway","common/main/lib/component/Menu"],function(e,t,n,r){SSE.Views.DocumentHolder=n.View.extend(t.extend({el:"#editor_sdk",template:null,events:{},initialize:function(){var e=this;this.setApi=function(t){return e.api=t,e};var t=window.localStorage.getItem("sse-settings-livecomment");e.isLiveCommenting=t===null||parseInt(t)!=0},render:function(){return this.fireEvent("render:before",this),this.cmpEl=e(this.el),this.fireEvent("render:after",this),this},focus:function(){var e=this;t.defer(function(){e.cmpEl.focus()},50)},createDelayedElements:function(){var e=this;e.pmiCut=new Common.UI.MenuItem({caption:e.txtCut,value:"cut"}),e.pmiCopy=new Common.UI.MenuItem({caption:e.txtCopy,value:"copy"}),e.pmiPaste=new Common.UI.MenuItem({caption:e.txtPaste,value:"paste"}),e.pmiInsertEntire=new Common.UI.MenuItem({caption:e.txtInsert}),e.pmiInsertCells=new Common.UI.MenuItem({caption:e.txtInsert,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:e.txtShiftRight,value:c_oAscInsertOptions.InsertCellsAndShiftRight},{caption:e.txtShiftDown,value:c_oAscInsertOptions.InsertCellsAndShiftDown},{caption:e.txtRow,value:c_oAscInsertOptions.InsertRows},{caption:e.txtColumn,value:c_oAscInsertOptions.InsertColumns}]})}),e.pmiDeleteEntire=new Common.UI.MenuItem({caption:e.txtDelete}),e.pmiDeleteCells=new Common.UI.MenuItem({caption:e.txtDelete,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:e.txtShiftLeft,value:c_oAscDeleteOptions.DeleteCellsAndShiftLeft},{caption:e.txtShiftUp,value:c_oAscDeleteOptions.DeleteCellsAndShiftTop},{caption:e.txtRow,value:c_oAscDeleteOptions.DeleteRows},{caption:e.txtColumn,value:c_oAscDeleteOptions.DeleteColumns}]})}),e.pmiClear=new Common.UI.MenuItem({caption:e.txtClear,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:e.txtClearAll,value:c_oAscCleanOptions.All},{caption:e.txtClearText,value:c_oAscCleanOptions.Text},{caption:e.txtClearFormat,value:c_oAscCleanOptions.Format},{caption:e.txtClearComments,value:c_oAscCleanOptions.Comments},{caption:e.txtClearHyper,value:c_oAscCleanOptions.Hyperlinks}]})}),e.pmiSortCells=new Common.UI.MenuItem({caption:e.txtSort,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:e.txtAscending,value:"ascending"},{caption:e.txtDescending,value:"descending"}]})}),e.pmiInsFunction=new Common.UI.MenuItem({caption:e.txtFormula}),e.menuAddHyperlink=new Common.UI.MenuItem({caption:e.txtInsHyperlink,inCell:!0}),e.menuEditHyperlink=new Common.UI.MenuItem({caption:e.editHyperlinkText,inCell:!0}),e.menuRemoveHyperlink=new Common.UI.MenuItem({caption:e.removeHyperlinkText}),e.menuHyperlink=new Common.UI.MenuItem({caption:e.txtInsHyperlink,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[e.menuEditHyperlink,e.menuRemoveHyperlink]})}),e.pmiRowHeight=new Common.UI.MenuItem({caption:e.txtRowHeight,action:"row-height"}),e.pmiColumnWidth=new Common.UI.MenuItem({caption:e.txtColumnWidth,action:"column-width"}),e.pmiEntireHide=new Common.UI.MenuItem({caption:e.txtHide}),e.pmiEntireShow=new Common.UI.MenuItem({caption:e.txtShow}),e.pmiAddComment=new Common.UI.MenuItem({id:"id-context-menu-item-add-comment",caption:e.txtAddComment}),e.pmiCellMenuSeparator=new Common.UI.MenuItem({caption:"--"}),e.ssMenu=new Common.UI.Menu({id:"id-context-menu-cell",items:[e.pmiCut,e.pmiCopy,e.pmiPaste,{caption:"--"},e.pmiInsertEntire,e.pmiInsertCells,e.pmiDeleteEntire,e.pmiDeleteCells,e.pmiClear,e.pmiSortCells,{caption:"--"},e.pmiAddComment,e.pmiCellMenuSeparator,e.pmiInsFunction,e.menuAddHyperlink,e.menuHyperlink,e.pmiRowHeight,e.pmiColumnWidth,e.pmiEntireHide,e.pmiEntireShow]}),e.mnuGroupImg=new Common.UI.MenuItem({caption:this.txtGroup,iconCls:"mnu-group",type:"group",value:"grouping"}),e.mnuUnGroupImg=new Common.UI.MenuItem({caption:this.txtUngroup,iconCls:"mnu-ungroup",type:"group",value:"ungrouping"}),e.mnuShapeSeparator=new Common.UI.MenuItem({caption:"--"}),e.mnuShapeAdvanced=new Common.UI.MenuItem({caption:e.advancedShapeText}),e.mnuChartEdit=new Common.UI.MenuItem({caption:e.chartText}),e.pmiImgCut=new Common.UI.MenuItem({caption:e.txtCut,value:"cut"}),e.pmiImgCopy=new Common.UI.MenuItem({caption:e.txtCopy,value:"copy"}),e.pmiImgPaste=new Common.UI.MenuItem({caption:e.txtPaste,value:"paste"}),this.imgMenu=new Common.UI.Menu({items:[e.pmiImgCut,e.pmiImgCopy,e.pmiImgPaste,{caption:"--"},{caption:this.textArrangeFront,iconCls:"mnu-arrange-front",type:"arrange",value:c_oAscDrawingLayerType.BringToFront},{caption:this.textArrangeBack,iconCls:"mnu-arrange-back",type:"arrange",value:c_oAscDrawingLayerType.SendToBack},{caption:this.textArrangeForward,iconCls:"mnu-arrange-forward",type:"arrange",value:c_oAscDrawingLayerType.BringForward},{caption:this.textArrangeBackward,iconCls:"mnu-arrange-backward",type:"arrange",value:c_oAscDrawingLayerType.SendBackward},{caption:"--"},e.mnuGroupImg,e.mnuUnGroupImg,e.mnuShapeSeparator,e.mnuChartEdit,e.mnuShapeAdvanced]}),this.menuParagraphVAlign=new Common.UI.MenuItem({caption:this.vertAlignText,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[e.menuParagraphTop=new Common.UI.MenuItem({caption:e.topCellText,checkable:!0,toggleGroup:"popupparagraphvalign",value:c_oAscVerticalTextAlign.TEXT_ALIGN_TOP}),e.menuParagraphCenter=new Common.UI.MenuItem({caption:e.centerCellText,checkable:!0,toggleGroup:"popupparagraphvalign",value:c_oAscVerticalTextAlign.TEXT_ALIGN_CTR}),this.menuParagraphBottom=new Common.UI.MenuItem({caption:e.bottomCellText,checkable:!0,toggleGroup:"popupparagraphvalign",value:c_oAscVerticalTextAlign.TEXT_ALIGN_BOTTOM})]})}),e.menuAddHyperlinkShape=new Common.UI.MenuItem({caption:e.txtInsHyperlink}),e.menuEditHyperlinkShape=new Common.UI.MenuItem({caption:e.editHyperlinkText}),e.menuRemoveHyperlinkShape=new Common.UI.MenuItem({caption:e.removeHyperlinkText}),e.menuHyperlinkShape=new Common.UI.MenuItem({caption:e.txtInsHyperlink,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[e.menuEditHyperlinkShape,e.menuRemoveHyperlinkShape]})}),this.pmiTextAdvanced=new Common.UI.MenuItem({caption:e.txtTextAdvanced}),e.pmiTextCut=new Common.UI.MenuItem({caption:e.txtCut,value:"cut"}),e.pmiTextCopy=new Common.UI.MenuItem({caption:e.txtCopy,value:"copy"}),e.pmiTextPaste=new Common.UI.MenuItem({caption:e.txtPaste,value:"paste"}),this.textInShapeMenu=new Common.UI.Menu({items:[e.pmiTextCut,e.pmiTextCopy,e.pmiTextPaste,{caption:"--"},e.menuParagraphVAlign,e.menuAddHyperlinkShape,e.menuHyperlinkShape,{caption:"--"},e.pmiTextAdvanced]}),this.funcMenu=new Common.UI.Menu({items:[{caption:"item 1"},{caption:"item 2"},{caption:"item 3"},{caption:"item 4"},{caption:"item 5"}]}),e.fireEvent("createdelayedelements",[e])},setMenuItemCommentCaptionMode:function(e){e?this.pmiAddComment.setCaption(this.txtEditComment):this.pmiAddComment.setCaption(this.txtAddComment)},setLiveCommenting:function(e){this.isLiveCommenting=e},txtSort:"Sort",txtAscending:"Ascending",txtDescending:"Descending",txtFormula:"Insert Function",txtInsHyperlink:"Hyperlink",txtCut:"Cut",txtCopy:"Copy",txtPaste:"Paste",txtInsert:"Insert",txtDelete:"Delete",txtClear:"Clear",txtClearAll:"All",txtClearText:"Text",txtClearFormat:"Format",txtClearHyper:"Hyperlink",txtClearComments:"Comments",txtShiftRight:"Shift cells right",txtShiftLeft:"Shift cells left",txtShiftUp:"Shift cells up",txtShiftDown:"Shift cells down",txtRow:"Entire Row",txtColumn:"Entire Column",txtColumnWidth:"Column Width",txtRowHeight:"Row Height",txtWidth:"Width",txtHide:"Hide",txtShow:"Show",textArrangeFront:"Bring To Front",textArrangeBack:"Send To Back",textArrangeForward:"Bring Forward",textArrangeBackward:"Send Backward",txtArrange:"Arrange",txtAddComment:"Add Comment",txtEditComment:"Edit Comment",txtUngroup:"Ungroup",txtGroup:"Group",topCellText:"Align Top",centerCellText:"Align Center",bottomCellText:"Align Bottom",vertAlignText:"Vertical Alignment",txtTextAdvanced:"Text Advanced Settings",editHyperlinkText:"Edit Hyperlink",removeHyperlinkText:"Remove Hyperlink",editChartText:"Edit Data",advancedShapeText:"Shape Advanced Settings",chartText:"Chart Advanced Settings"},SSE.Views.DocumentHolder||{}))});if(Common===undefined)var Common={};define("common/main/lib/component/ComboBox",["common/main/lib/component/BaseView","common/main/lib/component/Scroller"],function(){Common.UI.ComboBoxModel=Backbone.Model.extend({defaults:function(){return{id:Common.UI.getId(),value:null,displayValue:null}}}),Common.UI.ComboBoxStore=Backbone.Collection.extend({model:Common.UI.ComboBoxModel}),Common.UI.ComboBox=Common.UI.BaseView.extend(function(){return{options:{id:null,cls:"",style:"",hint:!1,editable:!0,disabled:!1,menuCls:"",menuStyle:"",displayField:"displayValue",valueField:"value"},template:_.template([\'<span class="input-group combobox <%= cls %>" id="<%= id %>" style="<%= style %>">\',\'<input type="text" class="form-control">\',\'<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>\',\'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">\',"<% _.each(items, function(item) { %>",\'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem"><%= scope.getDisplayValue(item) %></a></li>\',"<% }); %>","</ul>","</span>"].join("")),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e);var t=this,n=$(this.el);this.id=t.options.id||Common.UI.getId(),this.cls=t.options.cls,this.style=t.options.style,this.menuCls=t.options.menuCls,this.menuStyle=t.options.menuStyle,this.template=t.options.template||t.template,this.hint=t.options.hint,this.editable=t.options.editable,this.disabled=t.options.disabled,this.store=t.options.store||new Common.UI.ComboBoxStore,this.displayField=t.options.displayField,this.valueField=t.options.valueField,t.rendered=t.options.rendered||!1,this.lastValue=null,t.store.add(t.options.data),t.options.el&&t.render()},render:function(e){var t=this;t.rendered?this.cmpEl=$(this.el):(this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,menuCls:this.menuCls,menuStyle:this.menuStyle,items:this.store.toJSON(),scope:t})),e?(this.setElement(e,!1),e.html(this.cmpEl)):$(this.el).html(this.cmpEl));if(!t.rendered){var n=this.cmpEl;this._input=n.find("input"),this._button=n.find(".btn"),n.on("click","a",_.bind(this.itemClicked,this)),n.on("mousedown","a",_.bind(this.itemMouseDown,this)),this.editable?(n.on("change","input",_.bind(this.onInputChanged,this)),n.on("keydown","input",_.bind(this.onInputKeyDown,this)),n.on("click",".form-control",_.bind(this.onEditableInputClick,this))):(n.on("click",".form-control",_.bind(this.onInputClick,this)),this._input.attr("readonly","readonly"),this._input.attr("data-can-copy",!1)),t.options.hint&&(n.attr("data-toggle","tooltip"),n.tooltip({title:t.options.hint,placement:t.options.hintAnchor||"cursor"})),n.on("show.bs.dropdown",_.bind(t.onBeforeShowMenu,t)),n.on("shown.bs.dropdown",_.bind(t.onAfterShowMenu,t)),n.on("hide.bs.dropdown",_.bind(t.onBeforeHideMenu,t)),n.on("hidden.bs.dropdown",_.bind(t.onAfterHideMenu,t)),n.on("keydown.after.bs.dropdown",_.bind(t.onAfterKeydownMenu,t)),Common.NotificationCenter.on("menumanager:hideall",_.bind(t.closeMenu,t)),this.scroller=new Common.UI.Scroller({el:$(".dropdown-menu",t.cmpEl),minScrollbarLength:40,scrollYMarginOffset:30,includePadding:!0}),this.setDefaultSelection(),this.listenTo(this.store,"reset",this.onResetItems)}return t.rendered=!0,t.disabled&&t.setDisabled(t.disabled),this},setData:function(e){this.store.reset([]),this.store.add(e),this.setRawValue(""),this.onResetItems()},openMenu:function(e){var t=this;_.delay(function(){t.cmpEl.addClass("open")},e||0)},closeMenu:function(){this.cmpEl.removeClass("open")},isMenuOpen:function(){return this.cmpEl.hasClass("open")},onBeforeShowMenu:function(e){this.trigger("show:before",this,e);if(this.options.hint){var t=this.cmpEl.data("bs.tooltip");t&&(t.dontShow===undefined&&(t.dontShow=!0),t.hide())}},onAfterShowMenu:function(e){var t=$(this.el).find("ul"),n=t.find("> li.selected");if(n.length){var r=n.position().top,i=n.height(),s=t.height();(r<0||r+i>s)&&t.scrollTop(t.scrollTop()+r+i-s/2)}this.scroller&&this.scroller.update(),this.trigger("show:after",this,e)},onBeforeHideMenu:function(e){this.trigger("hide:before",this,e),Common.UI.Scroller.isMouseCapture()&&e.preventDefault()},onAfterHideMenu:function(e){this.cmpEl.find(".dropdown-toggle").blur(),this.trigger("hide:after",this,e)},onAfterKeydownMenu:function(e){if(e.keyCode==Common.UI.Keys.RETURN){$(e.target).click();var t=this;return this.rendered&&(Common.Utils.isIE?this._input.trigger("change",{onkeydown:!0}):this._input.blur()),!1}if(e.keyCode==Common.UI.Keys.ESC&&this.isMenuOpen())return this.closeMenu(),this.onAfterHideMenu(e),!1},onInputKeyDown:function(e){var t=this;e.keyCode==Common.UI.Keys.ESC?(this.closeMenu(),this.onAfterHideMenu(e)):e.keyCode==Common.UI.Keys.UP||e.keyCode==Common.UI.Keys.DOWN?(this.isMenuOpen()||this.openMenu(),_.delay(function(){t._skipInputChange=!0,t.cmpEl.find("ul li:first a").focus()},10)):t._skipInputChange=!1},onInputChanged:function(e,t){if(t&&t.synthetic)return;if(this._skipInputChange){this._skipInputChange=!1;return}var n=$(e.target).val(),r={};if(this.lastValue===n){t&&t.onkeydown&&this.trigger("combo:blur",this,e);return}r[this.valueField]=n,this.trigger("changed:before",this,r,e);if(e.isDefaultPrevented())return;var i;this._selectedItem=this.store.findWhere((i={},i[this.displayField]=n,i)),this._selectedItem&&(r=this._selectedItem.toJSON(),$(".selected",$(this.el)).removeClass("selected"),$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected")),this.trigger("changed:after",this,r,e)},onInputClick:function(e){this._button&&this._button.dropdown("toggle"),e.preventDefault(),e.stopPropagation()},onEditableInputClick:function(e){if(this.options.hint){var t=this.cmpEl.data("bs.tooltip");t&&(t.dontShow===undefined&&(t.dontShow=!0),t.hide())}this.isMenuOpen()&&e.which==1&&e.stopPropagation()},setDefaultSelection:function(){if(!this.rendered)return;var e=this._input.val(),t;e&&(this._selectedItem=this.store.findWhere((t={},t[this.displayField]=e,t)),this._selectedItem&&($(".selected",$(this.el)).removeClass("selected"),$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected")))},setDisabled:function(e){this.disabled=e;if(!this.rendered)return;e?this._input.attr("disabled",!0):this._input.removeAttr("disabled"),this.cmpEl.toggleClass("disabled",e),this._button.toggleClass("disabled",e)},isDisabled:function(){return this.disabled},setRawValue:function(e){this.rendered&&(this._input.val(e).trigger("change",{synthetic:!0}),this.lastValue=e!==null&&e!==undefined?e.toString():e)},getRawValue:function(){return this.rendered?this._input.val():null},setValue:function(e){if(!this.rendered)return;var t;this._selectedItem=this.store.findWhere((t={},t[this.valueField]=e,t)),$(".selected",$(this.el)).removeClass("selected"),this._selectedItem?(this.setRawValue(this._selectedItem.get(this.displayField)),$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected")):this.setRawValue(e)},getValue:function(){return this.rendered?this._selectedItem&&!_.isUndefined(this._selectedItem.get(this.valueField))?this._selectedItem.get(this.valueField):this._input.val():null},getDisplayValue:function(e){return Common.Utils.String.htmlEncode(e[this.displayField])},getSelectedRecord:function(){return this.rendered?this._selectedItem&&!_.isUndefined(this._selectedItem.get(this.valueField))?_.extend({},this._selectedItem.toJSON()):null:null},selectRecord:function(e){if(!this.rendered||!e)return;this._selectedItem=e,$(".selected",$(this.el)).removeClass("selected"),this.setRawValue(this._selectedItem.get(this.displayField)),$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected")},itemClicked:function(e){var t=$(e.target).closest("li");this._selectedItem=this.store.findWhere({id:t.attr("id")}),this._selectedItem&&(this.lastValue=this._selectedItem.get(this.displayField),this._input.val(this.lastValue).trigger("change",{synthetic:!0}),$(".selected",$(this.el)).removeClass("selected"),t.addClass("selected"),this.trigger("selected",this,_.extend({},this._selectedItem.toJSON()),e),e.preventDefault()),this._isMouseDownMenu=!1},itemMouseDown:function(e){if(e.which!=1)return e.preventDefault(),e.stopPropagation(),!1;this._isMouseDownMenu=!0},onResetItems:function(){$(this.el).find("ul").html(_.template(["<% _.each(items, function(item) { %>",\'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem"><%= scope.getDisplayValue(item) %></a></li>\',"<% }); %>"].join(""),{items:this.store.toJSON(),scope:this})),_.isUndefined(this.scroller)||(this.scroller.destroy(),delete this.scroller),this.scroller=new Common.UI.Scroller({el:$(".dropdown-menu",this.cmpEl),minScrollbarLength:40,scrollYMarginOffset:30,includePadding:!0})}}}())}),function(e){var t=e.fn.tooltip;t.prototype=e.fn.tooltip.Constructor.prototype,e.extend(e.fn.tooltip.Constructor.DEFAULTS,{container:"body",delay:{show:500},arrow:!1});var n=function(e,t){this.init("tooltip",e,t)};n.prototype=e.extend({},e.fn.tooltip.Constructor.prototype,{constructor:n,init:function(){t.prototype.init.apply(this,arguments),this.options.placement=="cursor"&&/hover/.exec(this.options.trigger)&&this.$element.on("mousemove.tooltip",this.options.selector,e.proxy(this.mousemove,this)),this.options.zIndex&&this.tip().css("z-index",this.options.zIndex);var n=this;Common.NotificationCenter.on({"layout:changed":function(e){!n.options.hideonclick&&n.tip().is(":visible")&&n.hide()}})},mousemove:function(e){this.targetXY=[e.clientX,e.clientY]},leave:function(e){t.prototype.leave.apply(this,arguments),this.dontShow=undefined},show:function(n){if(this.hasContent()&&this.enabled&&!this.dontShow){if(!this.$element.is(":visible")&&this.$element.closest("[role=menu]").length>0)return;var r=this.tip(),i=typeof this.options.placement=="function"?this.options.placement.call(this,r[0],this.$element[0]):this.options.placement;this.options.arrow===!1&&r.addClass("arrow-free"),this.options.cls&&r.addClass(this.options.cls);var s=/^([a-zA-Z]+)-?([a-zA-Z]*)$/.exec(i);if(!n&&!s[2].length)t.prototype.show.apply(this,arguments);else{var o=e.Event("show.bs.tooltip");this.$element.trigger(o);if(o.isDefaultPrevented())return;this.setContent(),this.options.animation&&r.addClass("fade"),r.detach().css({top:0,left:0,display:"block"}),this.options.container?r.appendTo(this.options.container):r.insertAfter(this.$element);if(typeof n=="object"){var u={top:n[1]+15,left:n[0]+18};u.left+r.width()>window.innerWidth&&(u.left=window.innerWidth-r.width()-30),r.offset(u).addClass("in")}else{var a=this.getPosition(),f=r[0].offsetWidth,l=r[0].offsetHeight;switch(s[1]){case"bottom":u={top:a.top+a.height+10};break;case"top":u={top:a.top-l-10}}switch(s[2]){case"left":u.left=a.left,this.$element.outerWidth()<=18&&(u.left-=4);break;case"right":u.left=a.left+a.width-f,this.$element.outerWidth()<=18&&(u.left+=4)}this.applyPlacement(u,s[1]),this.moveArrow(),r.addClass(s[1]).addClass(s[0])}this.$element.trigger("shown.bs.tooltip")}var c=this;clearTimeout(c.timeout),c.timeout=setTimeout(function(){c.hoverState=="in"&&c.hide(),c.dontShow=!1},5e3)}},moveArrow:function(){var e=this.tip().find(".tooltip-arrow, .arrow"),t=10;switch(this.options.placement){case"top-left":case"bottom-left":e.css("left",t);break;case"top-right":case"bottom-right":e.css("right",t)}},enter:function(t){if(t.type!=="mouseenter")return;var n=e(t.target);if(n.is("[role=menu]")||n.parentsUntil(t.currentTarget,"[role=menu]").length||this.tip().is(":visible"))return;var r=t instanceof this.constructor?t:e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs.tooltip");clearTimeout(r.timeout),r.hoverState="in",!r.options.delay||!r.options.delay.show?r.show():r.timeout=setTimeout(function(){r.hoverState=="in"&&r.show(r.options.placement=="cursor"?r.targetXY:undefined)},r.options.delay.show)},replaceArrow:function(e,n,r){this.options.arrow===!1?this.arrow().hide():t.prototype.replaceArrow.apply(this,arguments)},getCalculatedOffset:function(e,n,r,i){var s=t.prototype.getCalculatedOffset.apply(this,arguments);if(this.options.offset>0||this.options.offset<0)switch(/(bottom|top)/.exec(e)[1]){case"bottom":s.top+=this.options.offset;break;case"top":s.top-=this.options.offset}return s}});var r=e.fn.tooltip;e.fn.tooltip=function(t){return this.each(function(){var r=e(this),i=r.data("bs.tooltip"),s=typeof t=="object"&&t;i||r.data("bs.tooltip",i=new n(this,s)),typeof t=="string"&&i[t]()})},e.fn.tooltip.Constructor=n,e.fn.tooltip.noConflict=function(){return e.fn.tooltip=r,this}}(window.jQuery),define("tip",function(){}),define("common/main/lib/component/Tooltip",["tip","backbone"],function(){var e=function(e){this.$element=this.placement=undefined,this.init.call(this,e)};_.extend(e.prototype,Backbone.Events,{init:function(e){this.$element=e.owner instanceof Backbone.View?e.owner.$el:$(e.owner),this.placement=e.placement,this.$element.data("bs.tooltip")&&this.$element.removeData("bs.tooltip"),this.$element.tooltip({title:e.title,trigger:"manual",placement:e.placement,offset:e.offset,cls:e.cls,html:e.html,hideonclick:e.hideonclick});if(e.hideonclick){var t=this.$element.data("bs.tooltip");t.tip().on("click",function(){t.hide()})}this.$element.on("shown.bs.tooltip",_.bind(this.onTipShown,this)),this.$element.on("hidden.bs.tooltip",_.bind(this.onTipHidden,this))},show:function(e){this.getBSTip().show(e)},hide:function(){this.getBSTip().hide()},setTitle:function(e){var t=this.getBSTip();t.options.title=e},updateTitle:function(){var e=this.getBSTip();e.$tip.find(".tooltip-inner")[e.options.html?"html":"text"](e.options.title)},getBSTip:function(){return this.$element.data("bs.tooltip")},onTipShown:function(){this.trigger("tooltip:show",this)},onTipHidden:function(){this.trigger("tooltip:hide",this)},isVisible:function(){return this.getBSTip().tip().is(":visible")}}),Common.UI=Common.UI||{},Common.UI.Tooltip=e});if(Common===undefined)var Common={};define("common/main/lib/component/InputField",["common/main/lib/component/BaseView","common/main/lib/component/Tooltip"],function(){Common.UI.InputField=Common.UI.BaseView.extend(function(){return{options:{id:null,cls:"",style:"",value:"",type:"text",name:"",validation:null,allowBlank:!0,placeHolder:"",blankError:null,spellcheck:!1,maskExp:"",validateOnChange:!1,validateOnBlur:!0,disabled:!1},template:_.template([\'<div class="input-field" style="<%= style %>">\',"<input ",\'type="<%= type %>" \',\'name="<%= name %>" \',\'spellcheck="<%= spellcheck %>" \',\'class="form-control <%= cls %>" \',\'placeholder="<%= placeHolder %>" \',\'value="<%= value %>"\',">",\'<span class="input-error"/>\',"</div>"].join("")),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e);var t=this,n=$(this.el);this.id=t.options.id||Common.UI.getId(),this.cls=t.options.cls,this.style=t.options.style,this.value=t.options.value,this.type=t.options.type,this.name=t.options.name,this.validation=t.options.validation,this.allowBlank=t.options.allowBlank,this.placeHolder=t.options.placeHolder,this.template=t.options.template||t.template,this.editable=t.options.editable||!0,this.disabled=t.options.disabled,this.spellcheck=t.options.spellcheck,this.blankError=t.options.blankError||"This field is required",this.validateOnChange=t.options.validateOnChange,this.validateOnBlur=t.options.validateOnBlur,t.rendered=t.options.rendered||!1,t.options.el&&t.render()},render:function(e){var t=this;t.rendered?this.cmpEl=$(this.el):(this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,value:this.value,type:this.type,name:this.name,placeHolder:this.placeHolder,spellcheck:this.spellcheck,scope:t})),e?(this.setElement(e,!1),e.html(this.cmpEl)):$(this.el).html(this.cmpEl));if(!t.rendered){var n=this.cmpEl;this._input=this.cmpEl.find("input").andSelf().filter("input"),this.editable&&(this._input.on("blur",_.bind(this.onInputChanged,this)),this._input.on("keypress",_.bind(this.onKeyPress,this)),this._input.on("keyup",_.bind(this.onKeyUp,this)),this.validateOnChange&&this._input.on("input",_.bind(this.onInputChanging,this))),this.setEditable(this.editable),this.disabled&&this.setDisabled(this.disabled)}return t.rendered=!0,this},_doChange:function(e,t){if(t&&t.synthetic)return;var n=$(e.target).val(),r=this.value;this.trigger("changed:before",this,n,r,e);if(e.isDefaultPrevented())return;this.value=n,this.validateOnBlur&&this.checkValidate(),this.trigger("changed:after",this,n,r,e)},onInputChanged:function(e,t){this._doChange(e,t)},onInputChanging:function(e,t){var n=$(e.target).val(),r=this.value;if(e.isDefaultPrevented())return;this.value=n,this.validateOnBlur&&this.checkValidate(),this.trigger("changing",this,n,r,e)},onKeyPress:function(e){this.trigger("keypress:before",this,e);if(e.isDefaultPrevented())return;if(e.keyCode===Common.UI.Keys.RETURN)this._doChange(e);else if(this.options.maskExp&&!_.isEmpty(this.options.maskExp.source)){var t=String.fromCharCode(e.which);!this.options.maskExp.test(t)&&!e.ctrlKey&&e.keyCode!==Common.UI.Keys.DELETE&&e.keyCode!==Common.UI.Keys.BACKSPACE&&e.keyCode!==Common.UI.Keys.LEFT&&e.keyCode!==Common.UI.Keys.RIGHT&&e.keyCode!==Common.UI.Keys.HOME&&e.keyCode!==Common.UI.Keys.END&&e.keyCode!==Common.UI.Keys.ESC&&e.keyCode!==Common.UI.Keys.INSERT&&(e.preventDefault(),e.stopPropagation())}this.trigger("keypress:after",this,e)},onKeyUp:function(e){this.trigger("keyup:before",this,e);if(e.isDefaultPrevented())return;this.trigger("keyup:after",this,e)},setEditable:function(e){var t=this._input;this.editable=e,e&&t?(t.removeAttr("readonly"),t.removeAttr("data-can-copy")):(t.attr("readonly","readonly"),t.attr("data-can-copy",!1))},isEditable:function(){return this.editable},setDisabled:function(e){this.disabled=e,$(this.el).toggleClass("disabled",e),e?this._input.attr("disabled",!0):this._input.removeAttr("disabled")},isDisabled:function(){return this.disabled},setValue:function(e){this.value=e,this.rendered&&this._input.val(e)},getValue:function(){return this.value},focus:function(){this._input.focus()},checkValidate:function(){var e=this,t=[];!e.allowBlank&&_.isEmpty(e.value)&&t.push(e.blankError);if(_.isFunction(e.validation)){var n=e.validation.call(e,e.value);n!==!0&&(t=_.flatten(t.concat(n)))}if(!_.isEmpty(t)){e.cmpEl.addClass("error");var r=e.cmpEl.find(".input-error"),i=r.closest(".asc-window");return r.attr("data-toggle","tooltip"),r.removeData("bs.tooltip"),r.tooltip({title:t.join("\\n"),placement:"cursor"}),i.length>0&&r.data("bs.tooltip").tip().css("z-index",parseInt(i.css("z-index"))+10),t}return e.cmpEl.removeClass("error"),!0},showError:function(e){var t=this;if(!_.isEmpty(e)){t.cmpEl.addClass("error");var n=t.cmpEl.find(".input-error"),r=n.closest(".asc-window");n.attr("data-toggle","tooltip"),n.removeData("bs.tooltip"),n.tooltip({title:e.join("\\n"),placement:"cursor"}),r.length>0&&n.data("bs.tooltip").tip().css("z-index",parseInt(r.css("z-index"))+10)}else t.cmpEl.removeClass("error")}}}())});if(Common===undefined)var Common={};define("spreadsheeteditor/main/app/view/HyperlinkSettingsDialog",["common/main/lib/util/utils","common/main/lib/component/ComboBox","common/main/lib/component/InputField","common/main/lib/component/Window"],function(){SSE.Views.HyperlinkSettingsDialog=Common.UI.Window.extend(_.extend({options:{width:350,style:"min-width: 230px;",cls:"modal-dlg"},initialize:function(e){_.extend(this.options,{title:this.textTitle},e||{}),this.template=[\'<div class="box">\',\'<div class="input-row">\',"<label>"+this.textLinkType+"</label>","</div>",\'<div class="input-row" id="id-dlg-hyperlink-type" style="margin-bottom: 5px;">\',"</div>",\'<div id="id-dlg-hyperlink-external">\',\'<div class="input-row">\',"<label>"+this.strLinkTo+" *</label>","</div>",\'<div id="id-dlg-hyperlink-url" class="input-row" style="margin-bottom: 5px;"></div>\',"</div>",\'<div id="id-dlg-hyperlink-internal" style="display: none;">\',\'<div class="input-row">\',\'<label style="width: 50%;">\'+this.strSheet+"</label>",\'<label style="width: 50%;">\'+this.strRange+" *</label>","</div>",\'<div class="input-row" style="margin-bottom: 5px;">\',\'<div id="id-dlg-hyperlink-sheet" style="display: inline-block; width: 50%; padding-right: 10px; float: left;"></div>\',\'<div id="id-dlg-hyperlink-range" style="display: inline-block; width: 50%;"></div>\',"</div>","</div>",\'<div class="input-row">\',"<label>"+this.strDisplay+"</label>","</div>",\'<div id="id-dlg-hyperlink-display" class="input-row" style="margin-bottom: 5px;"></div>\',\'<div class="input-row">\',"<label>"+this.textTipText+"</label>","</div>",\'<div id="id-dlg-hyperlink-tip" class="input-row" style="margin-bottom: 5px;"></div>\',"</div>",\'<div class="footer right">\',\'<button class="btn normal dlg-btn primary" result="ok" style="margin-right: 10px;">\'+this.okButtonText+"</button>",\'<button class="btn normal dlg-btn" result="cancel">\'+this.cancelButtonText+"</button>","</div>"].join(""),this.options.tpl=_.template(this.template,this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var e=this.getChild(),t=this;t.cmbLinkType=(new Common.UI.ComboBox({el:$("#id-dlg-hyperlink-type"),cls:"input-group-nr",editable:!1,menuStyle:"min-width: 100%;",data:[{displayValue:this.textInternalLink,value:c_oAscHyperlinkType.RangeLink},{displayValue:this.textExternalLink,value:c_oAscHyperlinkType.WebLink}]})).on("selected",function(e,t){$("#id-dlg-hyperlink-external")[t.value==c_oAscHyperlinkType.WebLink?"show":"hide"](),$("#id-dlg-hyperlink-internal")[t.value!=c_oAscHyperlinkType.WebLink?"show":"hide"]()}),t.cmbLinkType.setValue(c_oAscHyperlinkType.WebLink),t.cmbSheets=new Common.UI.ComboBox({el:$("#id-dlg-hyperlink-sheet"),cls:"input-group-nr",editable:!1,menuStyle:"min-width: 100%;max-height: 150px;"}),t.inputUrl=new Common.UI.InputField({el:$("#id-dlg-hyperlink-url"),allowBlank:!1,blankError:t.txtEmpty,validateOnBlur:!1,style:"width: 100%;",validation:function(e){t.isEmail=!1;var n=e.strongMatch(Common.Utils.hostnameRe);return!n&&(t.isEmail=n=e.strongMatch(Common.Utils.emailRe)),!n&&(n=e.strongMatch(Common.Utils.ipRe)),!n&&(n=e.strongMatch(Common.Utils.localRe)),n?!0:t.txtNotUrl}}),t.inputRange=new Common.UI.InputField({el:$("#id-dlg-hyperlink-range"),allowBlank:!1,blankError:t.txtEmpty,style:"width: 100%;",validateOnChange:!0,validateOnBlur:!1,validation:function(e){var n=/^[A-Z]+[1-9]\\d*:[A-Z]+[1-9]\\d*$/.test(e);return n||(n=/^[A-Z]+[1-9]\\d*$/.test(e)),n?!0:t.textInvalidRange}}),t.inputDisplay=new Common.UI.InputField({el:$("#id-dlg-hyperlink-display"),allowBlank:!0,validateOnBlur:!1,style:"width: 100%;"}),t.inputTip=new Common.UI.InputField({el:$("#id-dlg-hyperlink-tip"),style:"width: 100%;"}),e.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),e.find("input").on("keypress",_.bind(this.onKeyPress,this))},show:function(){Common.UI.Window.prototype.show.apply(this,arguments);var e=this;_.delay(function(){e.focusedInput&&e.focusedInput.focus()},500)},setSettings:function(e){if(e){var t=this;this.cmbSheets.setData(e.sheets),e.props?(this.cmbLinkType.setValue(e.props.asc_getType()),this.cmbLinkType.setDisabled(!e.allowInternal),e.props.asc_getType()==c_oAscHyperlinkType.RangeLink?($("#id-dlg-hyperlink-external").hide(),$("#id-dlg-hyperlink-internal").show(),this.cmbSheets.setValue(e.props.asc_getSheet()),this.inputRange.setValue(e.props.asc_getRange()),this.focusedInput=this.inputRange.cmpEl.find("input")):(this.inputUrl.setValue(e.props.asc_getHyperlinkUrl()),this.focusedInput=this.inputUrl.cmpEl.find("input"),this.cmbSheets.setValue(e.currentSheet)),this.inp

]]></string> </value>
        </item>
        <item>
            <key> <string>next</string> </key>
            <value>
              <persistent> <string encoding="base64">AAAAAAAAAAU=</string> </persistent>
            </value>
        </item>
      </dictionary>
    </pickle>
  </record>
  <record id="5" aka="AAAAAAAAAAU=">
    <pickle>
      <global name="Pdata" module="OFS.Image"/>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>data</string> </key>
            <value> <string encoding="cdata"><![CDATA[

utDisplay.setValue(e.isLock?this.textDefault:e.props.asc_getText()),this.inputTip.setValue(e.props.asc_getTooltip())):(this.cmbLinkType.setValue(c_oAscHyperlinkType.WebLink),this.cmbLinkType.setDisabled(!e.allowInternal),this.inputDisplay.setValue(e.isLock?this.textDefault:e.text),this.focusedInput=this.inputUrl.cmpEl.find("input"),this.cmbSheets.setValue(e.currentSheet)),this.inputDisplay.setDisabled(e.isLock)}},getSettings:function(){var e=new Asc.asc_CHyperlink,t="";e.asc_setType(this.cmbLinkType.getValue());if(this.cmbLinkType.getValue()==c_oAscHyperlinkType.RangeLink)e.asc_setSheet(this.cmbSheets.getValue()),e.asc_setRange(this.inputRange.getValue()),t=this.cmbSheets.getValue()+"!"+this.inputRange.getValue();else{var n=this.inputUrl.getValue().replace(/^\\s+|\\s+$/g,"");/(((^https?)|(^ftp)):\\/\\/)|(^mailto:)/i.test(n)||(n=(this.isEmail?"mailto:":"http://")+n),e.asc_setHyperlinkUrl(n),t=n}return this.inputDisplay.isDisabled()?e.asc_setText(null):(_.isEmpty(this.inputDisplay.getValue())&&this.inputDisplay.setValue(t),e.asc_setText(this.inputDisplay.getValue())),e.asc_setTooltip(this.inputTip.getValue()),e},onBtnClick:function(e){this._handleInput(e.currentTarget.attributes.result.value)},onKeyPress:function(e){if(e.keyCode==Common.UI.Keys.RETURN)return this._handleInput("ok"),!1},_handleInput:function(e){if(this.options.handler){if(e=="ok"){var t=this.cmbLinkType.getValue()===c_oAscHyperlinkType.WebLink?this.inputUrl.checkValidate():!0,n=this.cmbLinkType.getValue()===c_oAscHyperlinkType.RangeLink?this.inputRange.checkValidate():!0,r=this.inputDisplay.checkValidate();if(t!==!0){this.inputUrl.cmpEl.find("input").focus();return}if(n!==!0){this.inputRange.cmpEl.find("input").focus();return}if(r!==!0){this.inputDisplay.cmpEl.find("input").focus();return}}this.options.handler.call(this,this,e)}this.close()},textTitle:"Hyperlink Settings",textInternalLink:"Internal Data Range",textExternalLink:"Web Link",textEmptyLink:"Enter link here",textEmptyDesc:"Enter caption here",textEmptyTooltip:"Enter tooltip here",strSheet:"Sheet",strRange:"Range",textLinkType:"Link Type",strDisplay:"Display",textTipText:"Screen Tip Text",strLinkTo:"Link To",txtEmpty:"This field is required",textInvalidRange:"ERROR! Invalid cells range",txtNotUrl:\'This field should be a URL in the format "http://www.example.com"\',cancelButtonText:"Cancel",textDefault:"Selected range"},SSE.Views.HyperlinkSettingsDialog||{}))}),define("text!spreadsheeteditor/main/app/template/ParagraphSettingsAdvanced.template",[],function(){return\'<div id="id-adv-paragraph-indents" class="settings-panel active">\\r\\n    <div class="inner-content">\\r\\n        <table cols="3" style="width: 100%;">\\r\\n            <tr>\\r\\n                <td class="padding-large">\\r\\n                    <label class="input-label"><%= scope.strIndentsFirstLine %></label>\\r\\n                    <div id="paragraphadv-spin-first-line" style="width: 85px;"></div>\\r\\n                </td>\\r\\n                <td class="padding-large">\\r\\n                    <label class="input-label"><%= scope.strIndentsLeftText %></label>\\r\\n                    <div id="paragraphadv-spin-indent-left"></div>\\r\\n                </td>\\r\\n                <td class="padding-large">\\r\\n                    <label class="input-label"><%= scope.strIndentsRightText %></label>\\r\\n                    <div id="paragraphadv-spin-indent-right"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n        </table>\\r\\n    </div>\\r\\n</div>\\r\\n<div id="id-adv-paragraph-font" class="settings-panel">\\r\\n    <div class="inner-content">\\r\\n        <table cols="2" style="width: 100%;">\\r\\n            <tr>\\r\\n                <td colspan=2 class="padding-small">\\r\\n                    <label class="header"><%= scope.textEffects %></label>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-small">\\r\\n                    <div id="paragraphadv-checkbox-strike"></div>\\r\\n                </td>\\r\\n                <td class="padding-small">\\r\\n                    <div id="paragraphadv-checkbox-subscript"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-small">\\r\\n                    <div id="paragraphadv-checkbox-double-strike"></div>\\r\\n                </td>\\r\\n                <td class="padding-small">\\r\\n                    <div id="paragraphadv-checkbox-small-caps"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-large">\\r\\n                    <div id="paragraphadv-checkbox-superscript"></div>\\r\\n                </td>\\r\\n                <td class="padding-large">\\r\\n                    <div id="paragraphadv-checkbox-all-caps"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td colspan=2 class="padding-small">\\r\\n                    <label class="header"><%= scope.textCharacterSpacing %></label>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td colspan=2 class="padding-large" width="50%">\\r\\n                    <div id="paragraphadv-spin-spacing"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td colspan=2>\\r\\n                    <div style="border: 1px solid #cbcbcb;">\\r\\n                        <div id="paragraphadv-font-img" style="width: 300px; height: 80px; position: relative;"></div>\\r\\n                    </div>\\r\\n                </td>\\r\\n            </tr>\\r\\n        </table>\\r\\n    </div>\\r\\n</div>\\r\\n<div id="id-adv-paragraph-tabs" class="settings-panel">\\r\\n    <div class="inner-content">\\r\\n        <div class="padding-small" style="display: inline-block;">\\r\\n            <label class="input-label"><%= scope.textTabPosition %></label>\\r\\n            <div id="paraadv-spin-tab"></div>\\r\\n        </div>\\r\\n        <div class="padding-small" style="display: inline-block; float: right;">\\r\\n            <label class="input-label"><%= scope.textDefault %></label>\\r\\n            <div id="paraadv-spin-default-tab"></div>\\r\\n        </div>\\r\\n        <div class="padding-large">\\r\\n            <div id="paraadv-list-tabs" style="width:180px; height: 90px;"></div>\\r\\n        </div>\\r\\n        <div class="padding-large" >\\r\\n            <label class="input-label padding-small" style="display: block;"><%= scope.textAlign %></label>\\r\\n            <div id="paragraphadv-radio-left" class="padding-small" style="display: block;"></div>\\r\\n            <div id="paragraphadv-radio-center" class="padding-small" style="display: block;"></div>\\r\\n            <div id="paragraphadv-radio-right" style="display: block;"></div>\\r\\n        </div>\\r\\n        <div>\\r\\n            <button type="button" class="btn btn-text-default" id="paraadv-button-add-tab" style="width:90px;margin-right: 4px;"><%= scope.textSet %></button>\\r\\n            <button type="button" class="btn btn-text-default" id="paraadv-button-remove-tab" style="width:90px;margin-right: 4px;"><%= scope.textRemove %></button>\\r\\n            <button type="button" class="btn btn-text-default" id="paraadv-button-remove-all" style="width:90px;margin-right: 4px;"><%= scope.textRemoveAll %></button>\\r\\n        </div>\\r\\n    </div>\\r\\n</div>\'}),define("common/main/lib/view/AdvancedSettingsWindow",["common/main/lib/component/Window"],function(){Common.Views.AdvancedSettingsWindow=Common.UI.Window.extend(_.extend({initialize:function(e){var t={};_.extend(t,{height:200,header:!0,cls:"advanced-settings-dlg",toggleGroup:"advanced-settings-group",contentTemplate:"",items:[]},e),this.template=e.template||[\'<div class="box" style="height:\'+(t.height-85)+\'px;">\',\'<div class="menu-panel">\',"<% _.each(items, function(item) { %>",\'<button class="btn btn-category" style="margin-bottom: 2px;" content-target="<%= item.panelId %>"><span class=""><%= item.panelCaption %></span></button>\',"<% }); %>","</div>",\'<div class="separator"/>\',\'<div class="content-panel" >\'+t.contentTemplate+"</div>","</div>",\'<div class="separator horizontal"/>\',\'<div class="footer center">\',\'<button class="btn normal dlg-btn primary" result="ok" style="margin-right: 10px;">\'+this.okButtonText+"</button>",\'<button class="btn normal dlg-btn" result="cancel">\'+this.cancelButtonText+"</button>","</div>"].join(""),t.tpl=_.template(this.template,t),this.handler=t.handler,this.toggleGroup=t.toggleGroup,this.contentWidth=t.contentWidth,Common.UI.Window.prototype.initialize.call(this,t)},render:function(){Common.UI.Window.prototype.render.call(this);var e=this,t=this.getChild();t.find(".dlg-btn").on("click",_.bind(this.onDlgBtnClick,this)),this.btnsCategory=[],_.each(t.find(".btn-category"),function(t,n){var r=$(t),i=new Common.UI.Button({el:r,enableToggle:!0,toggleGroup:e.toggleGroup,allowDepress:!1,contentTarget:r.attr("content-target")});i.on("click",_.bind(e.onCategoryClick,e)),e.btnsCategory.push(i)});var n=t.find(".content-panel");n.width(this.contentWidth),t.width(t.find(".menu-panel").width()+n.outerWidth()+1),this.content_panels=t.find(".settings-panel"),this.btnsCategory.length>0&&this.btnsCategory[0].toggle(!0,!0)},setHeight:function(e){Common.UI.Window.prototype.setHeight.call(this,e);var t=this.getChild(),n=t.find(".body > .box");n.css("height",e-85)},onDlgBtnClick:function(e){var t=e.currentTarget.attributes.result.value;if(this.handler&&this.handler.call(this,t,t=="ok"?this.getSettings():undefined))return;this.close()},onCategoryClick:function(e,t){this.content_panels.filter(".active").removeClass("active"),$("#"+e.options.contentTarget).addClass("active")},getSettings:function(){return},onPrimary:function(){if(this.handler&&this.handler.call(this,"ok",this.getSettings()))return;return this.close(),!1},cancelButtonText:"Cancel",okButtonText:"Ok"},Common.Views.AdvancedSettingsWindow||{}))});if(Common===undefined)var Common={};define("common/main/lib/component/MetricSpinner",["common/main/lib/component/BaseView"],function(){Common.UI.MetricSpinner=Common.UI.BaseView.extend({options:{minValue:0,maxValue:100,step:1,defaultUnit:"px",allowAuto:!1,autoText:"Auto",hold:!0,speed:"medium",width:90,allowDecimal:!0},disabled:!1,value:"0 px",rendered:!1,template:\'<input type="text" class="form-control"><div class="spinner-buttons"><button type="button" class="spinner-up"><i></i></button><button type="button" class="spinner-down"><i></i></button></div>\',initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e);var t=this,n=$(this.el);n.addClass("spinner"),n.on("mousedown",".spinner-up",_.bind(this.onMouseDown,this,!0)),n.on("mousedown",".spinner-down",_.bind(this.onMouseDown,this,!1)),n.on("mouseup",".spinner-up",_.bind(this.onMouseUp,this,!0)),n.on("mouseup",".spinner-down",_.bind(this.onMouseUp,this,!1)),n.on("mouseover",".spinner-up, .spinner-down",_.bind(this.onMouseOver,this)),n.on("mouseout",".spinner-up, .spinner-down",_.bind(this.onMouseOut,this)),n.on("keydown",".form-control",_.bind(this.onKeyDown,this)),n.on("keyup",".form-control",_.bind(this.onKeyUp,this)),n.on("blur",".form-control",_.bind(this.onBlur,this)),n.on("input",".form-control",_.bind(this.onInput,this)),this.options.allowDecimal||n.on("keypress",".form-control",_.bind(this.onKeyPress,this)),this.switches={count:1,enabled:!0,fromKeyDown:!1},this.options.speed==="medium"?this.switches.speed=300:this.options.speed==="fast"?this.switches.speed=100:this.switches.speed=500,this.render(),this.options.disabled&&this.setDisabled(this.options.disabled),this.options.value!==undefined&&(this.value=this.options.value),this.setRawValue(this.value),this.options.width&&$(this.el).width(this.options.width),this.options.defaultValue===undefined&&(this.options.defaultValue=this.options.minValue),this.oldValue=this.options.minValue,this.lastValue=null},render:function(){var e=$(this.el);return e.html(this.template),this.$input=e.find(".form-control"),this.rendered=!0,this.options.tabindex!=undefined&&this.$input.attr("tabindex",this.options.tabindex),this},setDisabled:function(e){var t=$(this.el);e!==this.disabled&&(t.find("button").toggleClass("disabled",e),t.toggleClass("disabled",e),e?this.$input.attr({disabled:e}):this.$input.removeAttr("disabled")),this.disabled=e},isDisabled:function(){return this.disabled},setDefaultUnit:function(e){if(this.options.defaultUnit!=e){var t=this.options.defaultUnit;this.options.defaultUnit=e,this.setMinValue(this._recalcUnits(this.options.minValue,t)),this.setMaxValue(this._recalcUnits(this.options.maxValue,t)),this.setValue(this._recalcUnits(this.getNumberValue(),t),!0)}},setMinValue:function(e){this.options.minValue=e},setMaxValue:function(e){this.options.maxValue=e},setStep:function(e){this.options.step=e},getNumberValue:function(){return this.options.allowAuto&&this.value==this.options.autoText?-1:parseFloat(this.value)},getUnitValue:function(){return this.options.defaultUnit},getValue:function(){return this.value},setRawValue:function(e){this.$input&&this.$input.val(e)},setValue:function(e,t){var n=!1;this._fromKeyDown=!1,this.lastValue=this.value;if(typeof e=="undefined"||e==="")this.value="";else if(this.options.allowAuto&&(Math.abs(parseFloat(e)+1)<1e-4||e==this.options.autoText))this.value=this.options.autoText;else{var r=this._add(parseFloat(e),0,this.options.allowDecimal?3:0);if(typeof e=="undefined"||isNaN(r))r=this.oldValue,n=!0;var i=this.options.defaultUnit;if(typeof e.match!="undefined"){var s=e.match(/(px|em|%|en|ex|pt|in|cm|mm|pc|s|ms)$/i);null!==s&&s[0]!=="undefined"&&(i=s[0].toLowerCase())}this.options.defaultUnit!==i&&(r=this._recalcUnits(r,i)),r>this.options.maxValue&&(r=this.options.maxValue,n=!0),r<this.options.minValue&&(r=this.options.minValue,n=!0),this.value=(r+" "+this.options.defaultUnit).trim(),this.oldValue=r}t!==!0&&this.lastValue!==this.value&&this.trigger("change",this,this.value,this.lastValue),t!==!0&&n&&this.trigger("inputerror",this,this.value),this.rendered?this.setRawValue(this.value):this.options.value=this.value},onMouseDown:function(e,t){if(this.disabled)return;t&&$(t.currentTarget).addClass("active"),this.options.hold&&(this.switches.fromKeyDown=!1,this._startSpin(e,t))},onMouseUp:function(e,t){if(this.disabled)return;$(t.currentTarget).removeClass("active"),this.options.hold?this._stopSpin():this._step(e)},onMouseOver:function(e){if(this.disabled)return;$(e.currentTarget).addClass("over")},onMouseOut:function(e){if(this.disabled)return;$(e.currentTarget).removeClass("active over"),this.options.hold&&this._stopSpin()},onKeyDown:function(e){if(this.disabled)return;if(!this.options.hold||e.keyCode!=Common.UI.Keys.UP&&e.keyCode!=Common.UI.Keys.DOWN)if(e.keyCode==Common.UI.Keys.RETURN)if(this.options.defaultUnit&&this.options.defaultUnit.length){var t=this.$input.val();if(this.value!=t)return this.onEnterValue(),!1}else this.onEnterValue();else this._fromKeyDown=!0;else e.preventDefault(),e.stopPropagation(),this.switches.timeout===undefined&&(this.switches.fromKeyDown=!0,this._startSpin(e.keyCode==Common.UI.Keys.UP,e))},onKeyUp:function(e){if(this.disabled)return;if(e.keyCode==Common.UI.Keys.UP||e.keyCode==Common.UI.Keys.DOWN)e.stopPropagation(),e.preventDefault(),this.options.hold?this._stopSpin():this._step(e.keyCode==Common.UI.Keys.UP)},onKeyPress:function(e){if(this.disabled)return;var t=String.fromCharCode(e.charCode);t=="."||t==","?(e.preventDefault(),e.stopPropagation()):this.options.maskExp&&!this.options.maskExp.test(t)&&!e.ctrlKey&&e.keyCode!==Common.UI.Keys.DELETE&&e.keyCode!==Common.UI.Keys.BACKSPACE&&e.keyCode!==Common.UI.Keys.LEFT&&e.keyCode!==Common.UI.Keys.RIGHT&&e.keyCode!==Common.UI.Keys.HOME&&e.keyCode!==Common.UI.Keys.END&&e.keyCode!==Common.UI.Keys.ESC&&e.keyCode!==Common.UI.Keys.RETURN&&e.keyCode!==Common.UI.Keys.INSERT&&e.keyCode!==Common.UI.Keys.TAB&&(e.preventDefault(),e.stopPropagation())},onInput:function(e,t){if(this.disabled||e.isDefaultPrevented())return;this.trigger("changing",this,$(e.target).val(),e)},onEnterValue:function(){if(this.$input){var e=this.$input.val();this.setValue(e===""?this.value:e),this.trigger("entervalue",this)}},onBlur:function(e){if(this.$input){var t=this.$input.val();this.setValue(t===""?this.value:t),this.options.hold&&this.switches.fromKeyDown&&this._stopSpin()}},_startSpin:function(e,t){if(!this.disabled){var n=this.switches.count;n===1?(this._step(e,!0),n=1):n<3?n=1.5:n<8?n=2.5:n=6,this.switches.timeout=setTimeout($.proxy(function(){this._step(e,!0),this._startSpin(e)},this),this.switches.speed/n),this.switches.count++}},_stopSpin:function(e){this.switches.timeout!==undefined&&(clearTimeout(this.switches.timeout),this.switches.timeout=undefined,this.switches.count=1,this.trigger("change",this,this.value,this.lastValue))},_increase:function(e){var t=this;if(!t.readOnly){var n=t.options.step;t._fromKeyDown?(n=this.$input.val(),n=_.isEmpty(n)?t.oldValue:parseFloat(n)):t.getValue()!==""?(t.options.allowAuto&&t.getValue()==t.options.autoText?n=t.options.minValue-t.options.step:n=parseFloat(t.getValue()),isNaN(n)&&(n=this.oldValue)):n=t.options.defaultValue,t.setValue((this._add(n,t.options.step,t.options.allowDecimal?3:0)+" "+this.options.defaultUnit).trim(),e)}},_decrease:function(e){var t=this;if(!t.readOnly){var n=t.options.step;if(t._fromKeyDown)n=this.$input.val(),n=_.isEmpty(n)?t.oldValue:parseFloat(n);else if(t.getValue()!==""){t.options.allowAuto&&t.getValue()==t.options.autoText?n=t.options.minValue:n=parseFloat(t.getValue()),isNaN(n)&&(n=this.oldValue);if(t.options.allowAuto&&this._add(n,-t.options.step,t.options.allowDecimal?3:0)<t.options.minValue){t.setValue(t.options.autoText,!0);return}}else n=t.options.defaultValue;t.setValue((this._add(n,-t.options.step,t.options.allowDecimal?3:0)+" "+this.options.defaultUnit).trim(),e)}},_step:function(e,t){e?this._increase(t):this._decrease(t)},_add:function(e,t,n){var r=Math.pow(10,n||this.options.allowDecimal?2:0);return(Math.round(e*r)+Math.round(t*r))/r},_recalcUnits:function(e,t){if(t.match(/(s|ms)$/i)&&this.options.defaultUnit.match(/(s|ms)$/i)){var n=e;return t=="ms"&&(n/=1e3),this.options.defaultUnit=="ms"&&(n*=1e3),n}if(t.match(/(pt|in|cm|mm|pc)$/i)===null||this.options.defaultUnit.match(/(pt|in|cm|mm|pc)$/i)===null)return e;var n=e;return t=="cm"?n*=10:t=="pt"?n=n*25.4/72:t=="in"?n*=25.4:t=="pc"&&(n=n*25.4/6),this.options.defaultUnit=="cm"?n/=10:this.options.defaultUnit=="pt"?n=parseFloat((n*72/25.4).toFixed(3)):this.options.defaultUnit=="in"?n/=25.4:this.options.defaultUnit=="pc"&&(n=n*6/25.4),n}})});if(Common===undefined)var Common={};define("common/main/lib/component/CheckBox",["common/main/lib/component/BaseView","underscore"],function(e,t){Common.UI.CheckBox=Common.UI.BaseView.extend({options:{labelText:""},disabled:!1,rendered:!1,indeterminate:!1,checked:!1,value:"unchecked",template:t.template(\'<label class="checkbox-indeterminate"><input type="button"><%= labelText %></label>\'),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e);var n=this,r=$(this.el);this.render(),this.options.disabled&&this.setDisabled(this.options.disabled),this.options.value!==undefined&&this.setValue(this.options.value,!0),this.$chk.on("click",t.bind(this.onItemCheck,this))},render:function(){var e=$(this.el);return e.html(this.template({labelText:this.options.labelText})),this.$chk=e.find("input[type=button]"),this.$label=e.find("label"),this.rendered=!0,this},setDisabled:function(e){e!==this.disabled&&(this.$label.toggleClass("disabled",e),e?this.$chk.attr({disabled:e}):this.$chk.removeAttr("disabled")),this.disabled=e},isDisabled:function(){return this.disabled},onItemCheck:function(e){this.disabled||(this.indeterminate?(this.indeterminate=!1,this.setValue(!1)):this.setValue(!this.checked))},setRawValue:function(e){this.checked=e===!0||e==="true"||e==="1"||e===1||e==="checked",this.indeterminate=e==="indeterminate",this.$chk.toggleClass("checked",this.checked),this.$chk.toggleClass("indeterminate",this.indeterminate),this.value=this.indeterminate?"indeterminate":this.checked?"checked":"unchecked"},setValue:function(e,t){this.rendered?(this.lastValue=this.value,this.setRawValue(e),t!==!0&&this.lastValue!==e&&this.trigger("change",this,this.value,this.lastValue)):this.options.value=e},getValue:function(){return this.value},isChecked:function(){return this.checked}})});if(Common===undefined)var Common={};define("common/main/lib/component/RadioBox",["common/main/lib/component/BaseView","underscore"],function(e,t){Common.UI.RadioBox=Common.UI.BaseView.extend({options:{labelText:""},disabled:!1,rendered:!1,template:t.template(\'<label class="radiobox"><input type="button" name="<%= name %>"><%= labelText %></label>\'),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e);var n=this,r=$(this.el);this.name=this.options.name||Common.UI.getId(),this.render(),this.options.disabled&&this.setDisabled(this.options.disabled),this.options.checked!==undefined&&this.setValue(this.options.checked,!0),this.$radio.on("click",t.bind(this.onItemCheck,this))},render:function(){var e=$(this.el);return e.html(this.template({labelText:this.options.labelText,name:this.name})),this.$radio=e.find("input[type=button]"),this.rendered=!0,this},setDisabled:function(e){e!==this.disabled&&(this.$radio.toggleClass("disabled",e),e?this.$radio.attr({disabled:e}):this.$radio.removeAttr("disabled")),this.disabled=e},isDisabled:function(){return this.disabled},onItemCheck:function(e){this.disabled||this.setValue(!0)},setRawValue:function(e){var e=e===!0||e==="true"||e==="1"||e===1;$("input[type=button][name="+this.name+"]").removeClass("checked"),this.$radio.toggleClass("checked",e)},setValue:function(e,t){if(this.rendered){var n=this.$radio.hasClass("checked");this.setRawValue(e),t!==!0&&n!==e&&this.trigger("change",this,this.$radio.hasClass("checked"))}else this.options.checked=e},getValue:function(){return this.$radio.hasClass("checked")}})});if(Common===undefined)var Common={};define("common/main/lib/component/DataView",["common/main/lib/component/BaseView","common/main/lib/component/Scroller"],function(){Common.UI.DataViewGroupModel=Backbone.Model.extend({defaults:function(){return{id:Common.UI.getId(),caption:""}}}),Common.UI.DataViewGroupStore=Backbone.Collection.extend({model:Common.UI.DataViewGroupModel}),Common.UI.DataViewModel=Backbone.Model.extend({defaults:function(){return{id:Common.UI.getId(),selected:!1,allowSelected:!0,value:null}}}),Common.UI.DataViewStore=Backbone.Collection.extend({model:Common.UI.DataViewModel}),Common.UI.DataViewItem=Common.UI.BaseView.extend({options:{},template:_.template([\'<div id="<%= id %>"><%= value %></div>\'].join("")),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e);var t=this;t.template=t.options.template||t.template,t.listenTo(t.model,"change",t.render),t.listenTo(t.model,"change:selected",t.onSelectChange),t.listenTo(t.model,"remove",t.remove)},render:function(){if(_.isUndefined(this.model.id))return this;var e=$(this.el);return e.html(this.template(this.model.toJSON())),e.toggleClass("selected",this.model.get("selected")&&this.model.get("allowSelected")),e.off("click").on("click",_.bind(this.onClick,this)),e.off("dblclick").on("dblclick",_.bind(this.onDblClick,this)),_.isUndefined(this.model.get("cls"))||e.addClass(this.model.get("cls")),this.trigger("change",this,this.model),this},remove:function(){this.stopListening(this.model),this.trigger("remove",this,this.model),Common.UI.BaseView.prototype.remove.call(this)},onClick:function(e){this.trigger("click",this,this.model,e)},onDblClick:function(e){this.trigger("dblclick",this,this.model,e)},onSelectChange:function(e,t){this.trigger("select",this,e,t)}}),Common.UI.DataView=Common.UI.BaseView.extend({options:{multiSelect:!1,handleSelect:!0,enableKeyEvents:!0,keyMoveDirection:"both",restoreHeight:0,emptyText:"",listenStoreEvents:!0,allowScrollbar:!0},template:_.template([\'<div class="dataview inner" style="<%= style %>">\',"<% _.each(groups, function(group) { %>",\'<div class="grouped-data" id="<%= group.id %>">\',\'<div class="group-description">\',"<span><b><%= group.caption %></b></span>","</div>",\'<div class="group-items-container">\',"</div>","</div>","<% }); %>","</div>"].join("")),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e);var t=this;t.template=t.options.template||t.template,t.store=t.options.store||new Common.UI.DataViewStore,t.groups=t.options.groups||null,t.itemTemplate=t.options.itemTemplate||null,t.multiSelect=t.options.multiSelect,t.handleSelect=t.options.handleSelect,t.parentMenu=t.options.parentMenu,t.enableKeyEvents=t.options.enableKeyEvents,t.style=t.options.style||"",t.emptyText=t.options.emptyText||"",t.listenStoreEvents=t.options.listenStoreEvents!==undefined?t.options.listenStoreEvents:!0,t.allowScrollbar=t.options.allowScrollbar!==undefined?t.options.allowScrollbar:!0,t.rendered=!1,t.dataViewItems=[],t.options.keyMoveDirection=="vertical"?t.moveKeys=[Common.UI.Keys.UP,Common.UI.Keys.DOWN]:t.options.keyMoveDirection=="horizontal"?t.moveKeys=[Common.UI.Keys.LEFT,Common.UI.Keys.RIGHT]:t.moveKeys=[Common.UI.Keys.UP,Common.UI.Keys.DOWN,Common.UI.Keys.LEFT,Common.UI.Keys.RIGHT],t.options.el&&t.render()},render:function(e){var t=this;this.trigger("render:before",this),this.cmpEl=$(this.el),e?(this.setElement(e,!1),this.cmpEl=$(this.template({groups:t.groups?t.groups.toJSON():null,style:t.style})),e.html(this.cmpEl)):this.cmpEl.html(this.template({groups:t.groups?t.groups.toJSON():null,style:t.style})),this.rendered||(this.listenStoreEvents&&(this.listenTo(this.store,"add",this.onAddItem),this.listenTo(this.store,"reset",this.onResetItems)),this.onResetItems(),this.parentMenu&&(this.cmpEl.closest("li").css("height","100%"),this.cmpEl.css("height","100%"),this.parentMenu.on("show:after",_.bind(this.alignPosition,this))),this.enableKeyEvents&&this.parentMenu&&this.handleSelect&&(this.parentMenu.on("show:after",function(){t.showLastSelected(),Common.NotificationCenter.trigger("dataview:focus")}),this.parentMenu.on("hide:after",function(){Common.NotificationCenter.trigger("dataview:blur")}))),_.isUndefined(this.scroller)&&this.allowScrollbar&&(this.scroller=new Common.UI.Scroller({el:$(this.el).find(".inner").andSelf().filter(".inner"),useKeyboard:this.enableKeyEvents&&!this.handleSelect,minScrollbarLength:40}));var n=this.cmpEl.closest(".asc-window");return n.length>0&&(this.tipZIndex=parseInt(n.css("z-index"))+10),this.rendered=!0,this.cmpEl.on("click",function(e){if(/dataview/.test(e.target.className))return!1}),this.trigger("render:after",this),this},setStore:function(e){e&&(this.stopListening(this.store),this.store=e,this.listenStoreEvents&&(this.listenTo(this.store,"add",this.onAddItem),this.listenTo(this.store,"reset",this.onResetItems)))},selectRecord:function(e,t){if(!this.handleSelect)return;t&&this.suspendEvents(),this.multiSelect?e&&e.set({selected:!e.get("selected")}):(_.each(this.store.where({selected:!0}),function(e){e.set({selected:!1})}),e&&e.set({selected:!0})),t&&this.resumeEvents()},selectByIndex:function(e,t){this.store.length>0&&e>-1&&e<this.store.length&&this.selectRecord(this.store.at(e),t)},deselectAll:function(e){e&&this.suspendEvents(),_.each(this.store.where({selected:!0}),function(e){e.set({selected:!1})}),e&&this.resumeEvents()},getSelectedRec:function(){if(this.multiSelect){var e=[];return _.each(this.store.where({selected:!0}),function(t){e.push(t)}),e}return this.store.where({selected:!0})},onAddItem:function(e,t,n){var r=new Common.UI.DataViewItem({template:this.itemTemplate,model:e});if(r){var i=$(this.el).find(".inner").andSelf().filter(".inner");if(this.groups&&this.groups.length>0){var s=this.groups.findWhere({id:e.get("group")});s&&(i=i.find("#"+s.id+" "+".group-items-container"))}if(i){n&&n.at==0?i.prepend(r.render().el):i.append(r.render().el),i.find(".empty-text").remove(),this.dataViewItems.push(r);if(e.get("tip")){var o=$(r.el);o.attr("data-toggle","tooltip"),o.tooltip({title:e.get("tip"),placement:"cursor",zIndex:this.tipZIndex})}this.listenTo(r,"change",this.onChangeItem),this.listenTo(r,"remove",this.onRemoveItem),this.listenTo(r,"click",this.onClickItem),this.listenTo(r,"dblclick",this.onDblClickItem),this.listenTo(r,"select",this.onSelectItem),this.isSuspendEvents||this.trigger("item:add",this,r,e)}}},onResetItems:function(){$(this.el).html(this.template({groups:this.groups?this.groups.toJSON():null,style:this.style})),_.isUndefined(this.scroller)||(this.scroller.destroy(),delete this.scroller),this.store.length<1&&this.emptyText.length>0&&$(this.el).find(".inner").andSelf().filter(".inner").append(\'<table class="empty-text"><tr><td>\'+this.emptyText+"</td></tr></table>"),_.each(this.dataViewItems,function(e){this.stopListening(e),e.stopListening(e.model)},this),this.dataViewItems=[],this.store.each(this.onAddItem,this),this.allowScrollbar&&(this.scroller=new Common.UI.Scroller({el:$(this.el).find(".inner").andSelf().filter(".inner"),useKeyboard:this.enableKeyEvents&&!this.handleSelect,minScrollbarLength:40})),this.attachKeyEvents()},onChangeItem:function(e,t){this.isSuspendEvents||this.trigger("item:change",this,e,t)},onRemoveItem:function(e,t){this.stopListening(e),e.stopListening();if(this.store.length<1&&this.emptyText.length>0){var n=$(this.el).find(".inner").andSelf().filter(".inner");n.find(".empty-text").length<=0&&n.append(\'<table class="empty-text"><tr><td>\'+this.emptyText+"</td></tr></table>")}for(var r=0;r<this.dataViewItems.length;r++)if(_.isEqual(e,this.dataViewItems[r])){this.dataViewItems.splice(r,1);break}this.isSuspendEvents||this.trigger("item:remove",this,e,t)},onClickItem:function(e,t,n){if(this.disabled)return;window._event=n,this.selectRecord(t),this.lastSelectedRec=undefined;var r=e.$el.data("bs.tooltip");r&&r.hide(),this.isSuspendEvents||this.trigger("item:click",this,e,t,n)},onDblClickItem:function(e,t,n){if(this.disabled)return;window._event=n,this.selectRecord(t),this.lastSelectedRec=undefined,this.isSuspendEvents||this.trigger("item:dblclick",this,e,t,n)},onSelectItem:function(e,t,n){this.isSuspendEvents||this.trigger(n?"item:select":"item:deselect",this,e,t)},scrollToRecord:function(e){var t=$(this.el).find(".inner"),n=t.offset().top,r=t.find("#"+e.get("id")),i=r.offset().top;if(i<n||i+r.height()>n+t.height())this.scroller&&this.allowScrollbar?this.scroller.scrollTop(t.scrollTop()+i-n,0):t.scrollTop(t.scrollTop()+i-n)},onKeyDown:function(e,t){if(this.disabled)return;t===undefined&&(t=e);if(_.indexOf(this.moveKeys,t.keyCode)>-1||t.keyCode==Common.UI.Keys.RETURN){t.preventDefault(),t.stopPropagation();var n=this.getSelectedRec()[0];this.lastSelectedRec===undefined&&(this.lastSelectedRec=n);if(t.keyCode==Common.UI.Keys.RETURN)this.lastSelectedRec=undefined,this.trigger("item:click",this,this,n,e),this.trigger("item:select",this,this,n,e),this.trigger("entervalue",this,n,e);else{var r=_.indexOf(this.store.models,n);r=t.keyCode==Common.UI.Keys.UP||t.keyCode==Common.UI.Keys.LEFT?Math.max(0,r-1):Math.min(this.store.length-1,r+1),n=this.store.at(r),n&&(this.selectRecord(n),this.scrollToRecord(n))}}},attachKeyEvents:function(){if(this.enableKeyEvents&&this.handleSelect){var e=$(this.el).find(".inner").andSelf().filter(".inner");e.addClass("canfocused"),e.attr("tabindex","0"),e.on(this.parentMenu?"dataview:keydown":"keydown",_.bind(this.onKeyDown,this))}},showLastSelected:function(){this.lastSelectedRec&&(this.selectRecord(this.lastSelectedRec,!0),this.scrollToRecord(this.lastSelectedRec),this.lastSelectedRec=undefined)},setDisabled:function(e){this.disabled=e,$(this.el).find(".inner").andSelf().filter(".inner").toggleClass("disabled",e)},isDisabled:function(){return this.disabled},alignPosition:function(){var e=this.parentMenu.cmpEl.attr("role")==="menu"?this.parentMenu.cmpEl:this.parentMenu.cmpEl.find("[role=menu]"),t=$(this.el).find(".inner").andSelf().filter(".inner"),n=$(document).height(),r=e.outerHeight(),i=parseInt(e.css("top"));r>n?(t.css("max-height",n-parseInt(e.css("padding-top"))-parseInt(e.css("padding-bottom"))-5+"px"),this.allowScrollbar&&this.scroller.update({minScrollbarLength:40})):t.height()<this.options.restoreHeight&&(t.css("max-height",Math.min(n-parseInt(e.css("padding-top"))-parseInt(e.css("padding-bottom"))-5,this.options.restoreHeight)+"px"),r=e.outerHeight(),i+r>n&&e.css("top",0),this.allowScrollbar&&this.scroller.update({minScrollbarLength:40}))}}),$(document).on("keydown.bs.dropdown.data-api","[data-toggle=dropdown], [role=menu]",function(e){if(e.keyCode!==Common.UI.Keys.UP&&e.keyCode!==Common.UI.Keys.DOWN&&e.keyCode!==Common.UI.Keys.LEFT&&e.keyCode!==Common.UI.Keys.RIGHT&&e.keyCode!==Common.UI.Keys.RETURN)return;_.defer(function(){var t=$(e.target).closest(".dropdown-toggle");t.parent().find(".inner.canfocused").trigger("dataview:keydown",e)},100)})});if(Common===undefined)var Common={};define("common/main/lib/component/ListView",["common/main/lib/component/DataView"],function(){Common.UI.ListView=Common.UI.DataView.extend(function(){return{options:{handleSelect:!0,enableKeyEvents:!0,showLast:!0,keyMoveDirection:"vertical",itemTemplate:_.template(\'<div id="<%= id %>" class="list-item" style=""><%= value %></div>\')},template:_.template([\'<div class="listview inner"></div>\'].join("")),onAddItem:function(e,t){var n=new Common.UI.DataViewItem({template:this.itemTemplate,model:e}),r=_.indexOf(this.store.models,e);if(n){var i=$(this.el).find(".inner");if(i){var s=i.find("> div");i.find(".empty-text").remove(),r>0?$(s.get(r-1)).after(n.render().el):s.length>0?$(s[r]).before(n.render().el):i.append(n.render().el),this.dataViewItems.push(n),this.listenTo(n,"change",this.onChangeItem),this.listenTo(n,"remove",this.onRemoveItem),this.listenTo(n,"click",this.onClickItem),this.listenTo(n,"dblclick",this.onDblClickItem),this.listenTo(n,"select",this.onSelectItem),this.isSuspendEvents||this.trigger("item:add",this,n,e)}}}}}())}),define("spreadsheeteditor/main/app/view/ParagraphSettingsAdvanced",["text!spreadsheeteditor/main/app/template/ParagraphSettingsAdvanced.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/MetricSpinner","common/main/lib/component/CheckBox","common/main/lib/component/RadioBox","common/main/lib/component/ListView"],function(e){SSE.Views.ParagraphSettingsAdvanced=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:320,height:390,toggleGroup:"paragraph-adv-settings-group"},initialize:function(t){_.extend(this.options,{title:this.textTitle,items:[{panelId:"id-adv-paragraph-indents",panelCaption:this.strParagraphIndents},{panelId:"id-adv-paragraph-font",panelCaption:this.strParagraphFont},{panelId:"id-adv-paragraph-tabs",panelCaption:this.strTabs}],contentTemplate:_.template(e)({scope:this})},t),Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options),this._changedProps=null,this.checkGroup=0,this._noApply=!0,this._tabListChanged=!1,this.spinners=[],this.api=this.options.api,this._originalProps=new Asc.asc_CParagraphProperty(this.options.paragraphProps)},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var e=this;this.numFirstLine=new Common.UI.MetricSpinner({el:$("#paragraphadv-spin-first-line"),step:.1,width:85,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:55.87,minValue:-55.87}),this.numFirstLine.on("change",_.bind(function(e,t,n,r){this._changedProps&&((this._changedProps.asc_getInd()===null||this._changedProps.asc_getInd()===undefined)&&this._changedProps.asc_putInd(new Asc.asc_CParagraphInd),this._changedProps.asc_getInd().asc_putFirstLine(Common.Utils.Metric.fnRecalcToMM(e.getNumberValue())))},this)),this.spinners.push(this.numFirstLine),this.numIndentsLeft=new Common.UI.MetricSpinner({el:$("#paragraphadv-spin-indent-left"),step:.1,width:85,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:55.87,minValue:-55.87}),this.numIndentsLeft.on("change",_.bind(function(e,t,n,r){this._changedProps&&((this._changedProps.asc_getInd()===null||this._changedProps.asc_getInd()===undefined)&&this._changedProps.asc_putInd(new Asc.asc_CParagraphInd),this._changedProps.asc_getInd().asc_putLeft(Common.Utils.Metric.fnRecalcToMM(e.getNumberValue())))},this)),this.spinners.push(this.numIndentsLeft),this.numIndentsRight=new Common.UI.MetricSpinner({el:$("#paragraphadv-spin-indent-right"),step:.1,width:85,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:55.87,minValue:-55.87}),this.numIndentsRight.on("change",_.bind(function(e,t,n,r){this._changedProps&&((this._changedProps.asc_getInd()===null||this._changedProps.asc_getInd()===undefined)&&this._changedProps.asc_putInd(new Asc.asc_CParagraphInd),this._changedProps.asc_getInd().asc_putRight(Common.Utils.Metric.fnRecalcToMM(e.getNumberValue())))},this)),this.spinners.push(this.numIndentsRight),this.chStrike=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-strike"),labelText:this.strStrike}),this.chStrike.on("change",_.bind(this.onStrikeChange,this)),this.chDoubleStrike=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-double-strike"),labelText:this.strDoubleStrike}),this.chDoubleStrike.on("change",_.bind(this.onDoubleStrikeChange,this)),this.chSuperscript=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-superscript"),labelText:this.strSuperscript}),this.chSuperscript.on("change",_.bind(this.onSuperscriptChange,this)),this.chSubscript=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-subscript"),labelText:this.strSubscript}),this.chSubscript.on("change",_.bind(this.onSubscriptChange,this)),this.chSmallCaps=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-small-caps"),labelText:this.strSmallCaps}),this.chSmallCaps.on("change",_.bind(this.onSmallCapsChange,this)),this.chAllCaps=new Common.UI.CheckBox({el:$("#paragraphadv-checkbox-all-caps"),labelText:this.strAllCaps}),this.chAllCaps.on("change",_.bind(this.onAllCapsChange,this)),this.numSpacing=new Common.UI.MetricSpinner({el:$("#paragraphadv-spin-spacing"),step:.01,width:100,defaultUnit:"cm",defaultValue:0,value:"0 cm",maxValue:55.87,minValue:-55.87}),this.numSpacing.on("change",_.bind(function(e,t,n,r){this._changedProps&&this._changedProps.asc_putTextSpacing(Common.Utils.Metric.fnRecalcToMM(e.getNumberValue()));if(this.api&&!this._noApply){var i=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;i.asc_putTextSpacing(Common.Utils.Metric.fnRecalcToMM(e.getNumberValue())),this.api.asc_setDrawImagePlaceParagraph("paragraphadv-font-img",i)}},this)),this.spinners.push(this.numSpacing),this.numTab=new Common.UI.MetricSpinner({el:$("#paraadv-spin-tab"),step:.1,width:180,defaultUnit:"cm",value:"1.25 cm",maxValue:55.87,minValue:0}),this.spinners.push(this.numTab),this.numDefaultTab=new Common.UI.MetricSpinner({el:$("#paraadv-spin-default-tab"),step:.1,width:107,defaultUnit:"cm",value:"1.25 cm",maxValue:55.87,minValue:0}),this.numDefaultTab.on("change",_.bind(function(e,t,n,r){this._changedProps&&this._changedProps.asc_putDefaultTab(parseFloat(Common.Utils.Metric.fnRecalcToMM(e.getNumberValue()).toFixed(1)))},this)),this.spinners.push(this.numDefaultTab),this.tabList=new Common.UI.ListView({el:$("#paraadv-list-tabs"),emptyText:this.noTabs,store:new Common.UI.DataViewStore}),this.tabList.store.comparator=function(e){return e.get("tabPos")},this.tabList.on("item:select",_.bind(this.onSelectTab,this));var t=function(){e._noApply||(e._tabListChanged=!0)};this.listenTo(this.tabList.store,"add",t),this.listenTo(this.tabList.store,"remove",t),this.listenTo(this.tabList.store,"reset",t),this.radioLeft=new Common.UI.RadioBox({el:$("#paragraphadv-radio-left"),labelText:this.textTabLeft,name:"asc-radio-tab",checked:!0}),this.radioCenter=new Common.UI.RadioBox({el:$("#paragraphadv-radio-center"),labelText:this.textTabCenter,name:"asc-radio-tab"}),this.radioRight=new Common.UI.RadioBox({el:$("#paragraphadv-radio-right"),labelText:this.textTabRight,name:"asc-radio-tab"}),this.btnAddTab=new Common.UI.Button({el:$("#paraadv-button-add-tab")}),this.btnAddTab.on("click",_.bind(this.addTab,this)),this.btnRemoveTab=new Common.UI.Button({el:$("#paraadv-button-remove-tab")}),this.btnRemoveTab.on("click",_.bind(this.removeTab,this)),this.btnRemoveAll=new Common.UI.Button({el:$("#paraadv-button-remove-all")}),this.btnRemoveAll.on("click",_.bind(this.removeAllTabs,this)),this.afterRender()},getSettings:function(){return this._tabListChanged&&((this._changedProps.asc_getTabs()===null||this._changedProps.asc_getTabs()===undefined)&&this._changedProps.asc_putTabs(new Asc.asc_CParagraphTabs),this.tabList.store.each(function(e,t){var n=new Asc.asc_CParagraphTab(Common.Utils.Metric.fnRecalcToMM(e.get("tabPos")),e.get("tabAlign"));this._changedProps.asc_getTabs().add_Tab(n)},this)),{paragraphProps:this._changedProps}},_setDefaults:function(e){if(e){this._originalProps=new Asc.asc_CParagraphProperty(e),this.numFirstLine.setValue(e.asc_getInd()!==null&&e.asc_getInd().asc_getFirstLine()!==null?Common.Utils.Metric.fnRecalcFromMM(e.asc_getInd().asc_getFirstLine()):"",!0),this.numIndentsLeft.setValue(e.asc_getInd()!==null&&e.asc_getInd().asc_getLeft()!==null?Common.Utils.Metric.fnRecalcFromMM(e.asc_getInd().asc_getLeft()):"",!0),this.numIndentsRight.setValue(e.asc_getInd()!==null&&e.asc_getInd().asc_getRight()!==null?Common.Utils.Metric.fnRecalcFromMM(e.asc_getInd().asc_getRight()):"",!0),this._noApply=!0,this.chStrike.setValue(e.asc_getStrikeout()!==null&&e.asc_getStrikeout()!==undefined?e.asc_getStrikeout():"indeterminate",!0),this.chDoubleStrike.setValue(e.asc_getDStrikeout()!==null&&e.asc_getDStrikeout()!==undefined?e.asc_getDStrikeout():"indeterminate",!0),this.chSubscript.setValue(e.asc_getSubscript()!==null&&e.asc_getSubscript()!==undefined?e.asc_getSubscript():"indeterminate",!0),this.chSuperscript.setValue(e.asc_getSuperscript()!==null&&e.asc_getSuperscript()!==undefined?e.asc_getSuperscript():"indeterminate",!0),this.chSmallCaps.setValue(e.asc_getSmallCaps()!==null&&e.asc_getSmallCaps()!==undefined?e.asc_getSmallCaps():"indeterminate",!0),this.chAllCaps.setValue(e.asc_getAllCaps()!==null&&e.asc_getAllCaps()!==undefined?e.asc_getAllCaps():"indeterminate",!0),this.numSpacing.setValue(e.asc_getTextSpacing()!==null&&e.asc_getTextSpacing()!==undefined?Common.Utils.Metric.fnRecalcFromMM(e.asc_getTextSpacing()):"",!0),this.api.asc_setDrawImagePlaceParagraph("paragraphadv-font-img",this._originalProps),this.numDefaultTab.setValue(e.asc_getDefaultTab()!==null&&e.asc_getDefaultTab()!==undefined?Common.Utils.Metric.fnRecalcFromMM(parseFloat(e.asc_getDefaultTab().toFixed(1))):"",!0);var t=this.tabList.store,n=e.asc_getTabs();if(n){var r=[],i=n.asc_getCount();for(var s=0;s<i;s++){var o=n.asc_getTab(s),u=Common.Utils.Metric.fnRecalcFromMM(parseFloat(o.asc_getPos().toFixed(1))),a=new Common.UI.DataViewModel;a.set({tabPos:u,value:parseFloat(u.toFixed(3))+" "+Common.Utils.Metric.metricName[Common.Utils.Metric.getCurrentMetric()],tabAlign:o.asc_getValue()}),r.push(a)}t.reset(r,{silent:!1}),this.tabList.selectByIndex(0)}this._noApply=!1,this._changedProps=new Asc.asc_CParagraphProperty}},updateMetricUnit:function(){if(this.spinners)for(var e=0;e<this.spinners.length;e++){var t=this.spinners[e];t.setDefaultUnit(Common.Utils.Metric.metricName[Common.Utils.Metric.getCurrentMetric()]),t.el.id=="paragraphadv-spin-spacing"||t.el.id=="paragraphadv-spin-position"?t.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.cm?.01:1):t.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.cm?.1:1)}},afterRender:function(){this.updateMetricUnit(),this._setDefaults(this._originalProps)},onStrikeChange:function(e,t,n,r){this._changedProps&&this.checkGroup!=1&&this._changedProps.asc_putStrikeout(e.getValue()=="checked"),this.checkGroup=0,e.getValue()=="checked"&&(this.checkGroup=1,this.chDoubleStrike.setValue(0),this._changedProps&&this._changedProps.asc_putDStrikeout(!1),this.checkGroup=0);if(this.api&&!this._noApply){var i=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;i.asc_putStrikeout(e.getValue()=="checked"),i.asc_putDStrikeout(this.chDoubleStrike.getValue()=="checked"),this.api.asc_setDrawImagePlaceParagraph("paragraphadv-font-img",i)}},onDoubleStrikeChange:function(e,t,n,r){this._changedProps&&this.checkGroup!=1&&this._changedProps.asc_putDStrikeout(e.getValue()=="checked"),this.checkGroup=0,e.getValue()=="checked"&&(this.checkGroup=1,this.chStrike.setValue(0),this._changedProps&&this._changedProps.asc_putStrikeout(!1),this.checkGroup=0);if(this.api&&!this._noApply){var i=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;i.asc_putDStrikeout(e.getValue()=="checked"),i.asc_putStrikeout(this.chStrike.getValue()=="checked"),this.api.asc_setDrawImagePlaceParagraph("paragraphadv-font-img",i)}},onSuperscriptChange:function(e,t,n,r){this._changedProps&&this.checkGroup!=2&&this._changedProps.asc_putSuperscript(e.getValue()=="checked"),this.checkGroup=0,e.getValue()=="checked"&&(this.checkGroup=2,this.chSubscript.setValue(0),this._changedProps&&this._changedProps.asc_putSubscript(!1),this.checkGroup=0);if(this.api&&!this._noApply){var i=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;i.asc_putSuperscript(e.getValue()=="checked"),i.asc_putSubscript(this.chSubscript.getValue()=="checked"),this.api.asc_setDrawImagePlaceParagraph("paragraphadv-font-img",i)}},onSubscriptChange:function(e,t,n,r){this._changedProps&&this.checkGroup!=2&&this._changedProps.asc_putSubscript(e.getValue()=="checked"),this.checkGroup=0,e.getValue()=="checked"&&(this.checkGroup=2,this.chSuperscript.setValue(0),this._changedProps&&this._changedProps.asc_putSuperscript(!1),this.checkGroup=0);if(this.api&&!this._noApply){var i=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;i.asc_putSubscript(e.getValue()=="checked"),i.asc_putSuperscript(this.chSuperscript.getValue()=="checked"),this.api.asc_setDrawImagePlaceParagraph("paragraphadv-font-img",i)}},onSmallCapsChange:function(e,t,n,r){this._changedProps&&this.checkGroup!=3&&this._changedProps.asc_putSmallCaps(e.getValue()=="checked"),this.checkGroup=0,e.getValue()=="checked"&&(this.checkGroup=3,this.chAllCaps.setValue(0),this._changedProps&&this._changedProps.asc_putAllCaps(!1),this.checkGroup=0);if(this.api&&!this._noApply){var i=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;i.asc_putSmallCaps(e.getValue()=="checked"),i.asc_putAllCaps(this.chAllCaps.getValue()=="checked"),this.api.asc_setDrawImagePlaceParagraph("paragraphadv-font-img",i)}},onAllCapsChange:function(e,t,n,r){this._changedProps&&this.checkGroup!=3&&this._changedProps.asc_putAllCaps(e.getValue()=="checked"),this.checkGroup=0,e.getValue()=="checked"&&(this.checkGroup=3,this.chSmallCaps.setValue(0),this._changedProps&&this._changedProps.asc_putSmallCaps(!1),this.checkGroup=0);if(this.api&&!this._noApply){var i=this._originalProps?this._originalProps:new Asc.asc_CParagraphProperty;i.asc_putAllCaps(e.getValue()=="checked"),i.asc_putSmallCaps(this.chSmallCaps.getValue()=="checked"),this.api.asc_setDrawImagePlaceParagraph("paragraphadv-font-img",i)}},addTab:function(e,t){var n=this.numTab.getNumberValue(),r=this.radioLeft.getValue()?1:this.radioCenter.getValue()?3:2,i=this.tabList.store,s=i.find(function(e){return Math.abs(e.get("tabPos")-n)<.001});s?s.set("tabAlign",r):(s=new Common.UI.DataViewModel,s.set({tabPos:n,value:n+" "+Common.Utils.Metric.metricName[Common.Utils.Metric.getCurrentMetric()],tabAlign:r}),i.add(s)),this.tabList.selectRecord(s),this.tabList.scrollToRecord(s)},removeTab:function(e,t){var n=this.tabList.getSelectedRec();if(n.length>0){var r=this.tabList.store,i=_.indexOf(r.models,n[0]);r.remove(n[0]),i>r.length-1&&(i=r.length-1),r.length>0&&(this.tabList.selectByIndex(i),this.tabList.scrollToRecord(r.at(i)))}},removeAllTabs:function(e,t){this.tabList.store.reset()},onSelectTab:function(e,t,n){var r={},i=_.isFunction(n.toJSON);if(i){if(!n.get("selected"))return;r=n.toJSON()}else r=n;this.numTab.setValue(r.tabPos),r.tabAlign==1?this.radioLeft.setValue(!0):r.tabAlign==3?this.radioCenter.setValue(!0):this.radioRight.setValue(!0)},textTitle:"Paragraph - Advanced Settings",strIndentsFirstLine:"First line",strIndentsLeftText:"Left",strIndentsRightText:"Right",strParagraphIndents:"Indents & Placement",strParagraphFont:"Font",cancelButtonText:"Cancel",okButtonText:"Ok",textEffects:"Effects",textCharacterSpacing:"Character Spacing",strDoubleStrike:"Double strikethrough",strStrike:"Strikethrough",strSuperscript:"Superscript",strSubscript:"Subscript",strSmallCaps:"Small caps",strAllCaps:"All caps",strTabs:"Tab",textSet:"Specify",textRemove:"Remove",textRemoveAll:"Remove All",textTabLeft:"Left",textTabRight:"Right",textTabCenter:"Center",textAlign:"Alignment",textTabPosition:"Tab Position",textDefault:"Default Tab",noTabs:"The specified tabs will appear in this field"},SSE.Views.ParagraphSettingsAdvanced||{}))}),define("spreadsheeteditor/main/app/view/SetValueDialog",["common/main/lib/component/Window","common/main/lib/component/ComboBox"],function(){SSE.Views.SetValueDialog=Common.UI.Window.extend(_.extend({options:{width:214,header:!0,style:"min-width: 214px;",cls:"modal-dlg"},initialize:function(e){_.extend(this.options,{title:this.textTitle},e||{}),this.template=[\'<div class="box">\',\'<div class="input-row">\',\'<div id="id-spin-set-value"></div>\',"</div>",\'<div class="footer center">\',\'<button class="btn normal dlg-btn primary" result="ok" style="margin-right: 10px;">\'+this.okButtonText+"</button>",\'<button class="btn normal dlg-btn" result="cancel">\'+this.cancelButtonText+"</button>","</div>"].join(""),this.options.tpl=_.template(this.template,this.options),this.startvalue=this.options.startvalue,this.maxvalue=this.options.maxvalue,this.defaultUnit=this.options.defaultUnit,this.step=this.options.step,Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this),this.spnSize=new Common.UI.MetricSpinner({el:$("#id-spin-set-value"),width:182,step:this.step,defaultUnit:this.defaultUnit,minValue:0,maxValue:this.maxvalue,value:this.startvalue+" "+this.defaultUnit});var e=this.getChild();e.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.spnSize.on("entervalue",_.bind(this.onEnterValue,this)),this.spnSize.on("change",_.bind(this.onChange,this)),this.spnSize.$el.find("input").focus()},_handleInput:function(e){this.options.handler&&this.options.handler.call(this,this,e),this.close()},onBtnClick:function(e){this._handleInput(e.currentTarget.attributes.result.value)},onEnterValue:function(e){this._handleInput("ok")},onChange:function(){var e=this.spnSize.getNumberValue();e/=this.step,e=(e|e)*this.step,this.spnSize.setValue(e,!0)},getSettings:function(){return this.spnSize.getNumberValue()},cancelButtonText:"Cancel",okButtonText:"Ok",txtMinText:"The minimum value for this field is {0}",txtMaxText:"The maximum value for this field is {0}"},SSE.Views.SetValueDialog||{}))}),define("spreadsheeteditor/main/app/view/AutoFilterDialog",["common/main/lib/component/Window"],function(){SSE.Views=SSE.Views||{},SSE.Views.DigitalFilterDialog=Common.UI.Window.extend(_.extend({initialize:function(e){var t=this,n={};_.extend(n,{width:500,height:230,contentWidth:180,header:!0,cls:"filter-dlg",contentTemplate:"",title:t.txtTitle,items:[]},e),this.template=e.template||[\'<div class="box" style="height:\'+(n.height-85)+\'px;">\',\'<div class="content-panel" >\',\'<label class="header">\',t.textShowRows,"</label>",\'<div style="margin-top:15px;">\',\'<div id="id-search-begin-digital-combo" class="input-group-nr" style="vertical-align:top;width:225px;display:inline-block;"></div>\',\'<div id="id-sd-cell-search-begin" class="" style="width:225px;display:inline-block;margin-left:18px;"></div>\',"</div>","<div>",\'<div id="id-and-radio" class="padding-small" style="display: inline-block; margin-top:10px;"></div>\',\'<div id="id-or-radio" class="padding-small" style="display: inline-block; margin-left:25px;"></div>\',"</div>",\'<div style="margin-top:10px;">\',\'<div id="id-search-end-digital-combo" class="input-group-nr" style="vertical-align:top;width:225px;display:inline-block;"></div>\',\'<div id="id-sd-cell-search-end" class="" style="width:225px;display:inline-block;margin-left:18px;"></div>\',"</div>","</div>","</div>",\'<div class="separator horizontal" style="width:100%"></div>\',\'<div class="footer right" style="margin-left:-15px;">\',\'<button class="btn normal dlg-btn primary" result="ok" style="margin-right:10px;">\',t.okButtonText,"</button>",\'<button class="btn normal dlg-btn" result="cancel">\',t.cancelButtonText,"</button>","</div>"].join(""),this.api=e.api,this.handler=e.handler,n.tpl=_.template(this.template,n),Common.UI.Window.prototype.initialize.call(this,n)},render:function(){Common.UI.Window.prototype.render.call(this);var e=[{value:c_oAscCustomAutoFilter.equals,displayValue:this.capCondition1},{value:c_oAscCustomAutoFilter.doesNotEqual,displayValue:this.capCondition2},{value:c_oAscCustomAutoFilter.isGreaterThan,displayValue:this.capCondition3},{value:c_oAscCustomAutoFilter.isGreaterThanOrEqualTo,displayValue:this.capCondition4},{value:c_oAscCustomAutoFilter.isLessThan,displayValue:this.capCondition5},{value:c_oAscCustomAutoFilter.isLessThanOrEqualTo,displayValue:this.capCondition6},{value:c_oAscCustomAutoFilter.beginsWith,displayValue:this.capCondition7},{value:c_oAscCustomAutoFilter.doesNotBeginWith,displayValue:this.capCondition8},{value:c_oAscCustomAutoFilter.endsWith,displayValue:this.capCondition9},{value:c_oAscCustomAutoFilter.doesNotEndWith,displayValue:this.capCondition10},{value:c_oAscCustomAutoFilter.contains,displayValue:this.capCondition11},{value:c_oAscCustomAutoFilter.doesNotContain,displayValue:this.capCondition12}];this.cmbCondition1=new Common.UI.ComboBox({el:$("#id-search-begin-digital-combo",this.$window),menuStyle:"min-width: 225px;",cls:"input-group-nr",data:e,editable:!1}),this.cmbCondition1.setValue(c_oAscCustomAutoFilter.equals),e.splice(0,0,{value:0,displayValue:this.textNoFilter}),this.cmbCondition2=new Common.UI.ComboBox({el:$("#id-search-end-digital-combo",this.$window),menuStyle:"min-width: 225px;",cls:"input-group-nr",data:e,editable:!1}),this.cmbCondition2.setValue(0),this.rbAnd=new Common.UI.RadioBox({el:$("#id-and-radio",this.$window),labelText:this.capAnd,name:"asc-radio-filter-tab",checked:!0}),this.rbOr=new Common.UI.RadioBox({el:$("#id-or-radio",this.$window),labelText:this.capOr,name:"asc-radio-filter-tab"}),this.txtValue1=new Common.UI.InputField({el:$("#id-sd-cell-search-begin",this.$window),template:_.template([\'<div class="input-field" style="<%= style %>">\',"<input ",\'type="<%= type %>" \',\'name="<%= name %>" \',\'class="form-control <%= cls %>" style="float:none" \',\'placeholder="<%= placeHolder %>" \',\'value="<%= value %>"\',">","</div>"].join("")),allowBlank:!0,validation:function(){return!0}}),this.txtValue2=new Common.UI.InputField({el:$("#id-sd-cell-search-end",this.$window),template:_.template([\'<div class="input-field" style="<%= style %>">\',"<input ",\'type="<%= type %>" \',\'name="<%= name %>" \',\'class="form-control <%= cls %>" style="float:none" \',\'placeholder="<%= placeHolder %>" \',\'value="<%= value %>"\',">","</div>"].join("")),allowBlank:!0,validation:function(){return!0}}),this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.loadDefaults()},show:function(){Common.UI.Window.prototype.show.call(this);var e=this;_.defer(function(){e.txtValue1&&e.txtValue1.focus()},500)},close:function(){this.api&&this.api.asc_enableKeyEvents(!0),Common.UI.Window.prototype.close.call(this)},onBtnClick:function(e){e.currentTarget.attributes&&e.currentTarget.attributes.result&&("ok"===e.currentTarget.attributes.result.value&&this.save(),this.close())},setSettings:function(e){this.properties=e},loadDefaults:function(){this.properties&&this.rbOr&&this.rbAnd&&this.cmbCondition1&&this.cmbCondition2&&this.txtValue1&&this.txtValue2&&(this.properties.asc_getIsChecked()?this.rbOr.setValue(!0):this.rbAnd.setValue(!0),this.cmbCondition1.setValue(this.properties.asc_getFilter1()||c_oAscCustomAutoFilter.equals),this.cmbCondition2.setValue(this.properties.asc_getFilter2()||0),this.txtValue1.setValue(null===this.properties.asc_getValFilter1()?"":this.properties.asc_getValFilter1()),this.txtValue2.setValue(null===this.properties.asc_getValFilter2()?"":this.properties.asc_getValFilter2()))},save:function(){if(this.api&&this.properties&&this.rbOr&&this.rbAnd&&this.cmbCondition1&&this.cmbCondition2&&this.txtValue1&&this.txtValue2){var e=new Asc.AutoFiltersOptions;e&&(e.asc_setCellId(this.properties.asc_getCellId()),e.asc_setIsChecked(this.rbOr.getValue()),e.asc_setFilter1(this.cmbCondition1.getValue()),e.asc_setFilter2(this.cmbCondition2.getValue()||undefined),e.asc_setValFilter1(this.txtValue1.getValue()),e.asc_setValFilter2(this.txtValue2.getValue()),this.api.asc_applyAutoFilter("digitalFilter",e))}},onPrimary:function(){return this.save(),this.close(),!1},cancelButtonText:"Cancel",capAnd:"And",capCondition1:"equals",capCondition10:"does not end with",capCondition11:"contains",capCondition12:"does not contain",capCondition2:"does not equal",capCondition3:"is greater than",capCondition4:"is greater than or equal to",capCondition5:"is less than",capCondition6:"is less than or equal to",capCondition7:"begins with",capCondition8:"does not begin with",capCondition9:"ends with",capOr:"Or",textNoFilter:"no filter",textShowRows:"Show rows where",textUse1:"Use ? to present any single character",textUse2:"Use * to present any series of character",txtTitle:"Custom Filter"},SSE.Views.DigitalFilterDialog||{})),SSE.Views.AutoFilterDialog=Common.UI.Window.extend(_.extend({initialize:function(e){var t=this,n={};_.extend(n,{width:270,height:450,contentWidth:400,header:!0,cls:"filter-dlg",contentTemplate:"",title:t.txtTitle,items:[]},e),this.template=e.template||[\'<div class="box" style="height:\'+(n.height-85)+\'px;">\',\'<div class="content-panel">\',\'<div class="">\',\'<div id="id-btn-sort-down" class="btn-placeholder border"></div>\',\'<div id="id-btn-sort-up" class="btn-placeholder border"></div>\',\'<div id="id-checkbox-custom-filter" style="max-width:50px;margin-left:50px;display:inline-block;"></div>\',\'<button class="btn normal dlg-btn primary" result="custom" id="id-btn-custom-filter" style="min-width:120px;">\',t.btnCustomFilter,"</button>",\'<div id="id-sd-cell-search" class="input-row" style="margin-bottom:10px;"></div>\',\'<div class="border-values" style="margin-top:45px;">\',\'<div id="id-dlg-filter-values" class="combo-values"/>\',"</div>","</div>","</div>","</div>",\'<div class="separator horizontal"></div>\',\'<div class="footer center">\',\'<div id="id-apply-filter" style="display: inline-block;"></div>\',\'<button class="btn normal dlg-btn" result="cancel">\',t.cancelButtonText,"</button>","</div>"].join(""),this.api=e.api,this.handler=e.handler,this.throughIndexes=[],n.tpl=_.template(this.template,n),Common.UI.Window.prototype.initialize.call(this,n)},render:function(){var e=this;Common.UI.Window.prototype.render.call(this),this.$window.find(".btn").on("click",_.bind(this.onBtnClick,this)),this.btnOk=new Common.UI.Button({cls:"btn normal dlg-btn primary",caption:this.okButtonText,style:"margin-right:10px;",enableToggle:!1,allowDepress:!1}),this.btnOk&&(this.btnOk.render($("#id-apply-filter",this.$window)),this.btnOk.on("click",_.bind(this.onApplyFilter,this))),this.btnSortDown=new Common.UI.Button({cls:"btn-toolbar btn-toolbar-default border",iconCls:"btn-icon btn-sort-down",pressed:!0,enableToggle:!0,allowDepress:!1}),this.btnSortDown&&(this.btnSortDown.render($("#id-btn-sort-down",this.$window)),this.btnSortDown.on("click",_.bind(this.onSortType,this,"ascending"))),this.btnSortUp=new Common.UI.Button({cls:"btn-toolbar btn-toolbar-default border",iconCls:"btn-icon btn-sort-up",pressed:!0,enableToggle:!0,allowDepress:!1}),this.btnSortUp&&(this.btnSortUp.render($("#id-btn-sort-up",this.$window)),this.btnSortUp.on("click",_.bind(this.onSortType,this,"descending"))),this.chCustomFilter=new Common.UI.CheckBox({el:$("#id-checkbox-custom-filter",this.$window)}),this.chCustomFilter.setDisabled(!0),this.btnCustomFilter=(new Common.UI.Button({el:$("#id-btn-custom-filter",this.$window)})).on("click",_.bind(this.onShowCustomFilterDialog,this)),this.input=(new Common.UI.InputField({el:$("#id-sd-cell-search",this.$window),allowBlank:!0,placeHolder:this.txtEmpty,style:"margin-top: 10px;",validateOnChange:!0,validation:function(){return!0}})).on("changing",function(t,n){n.length?(n=n.replace(/([.?*+^$[\\]\\\\(){}|-])/g,"\\\\$1"),e.filter=new RegExp(n,"ig")):e.filter=undefined,e.setupDataCells()}),this.cells=new Common.UI.DataViewStore,this.filterExcludeCells=new Common.UI.DataViewStore,this.cells&&(this.cellsList=new Common.UI.ListView({el:$("#id-dlg-filter-values",this.$window),store:this.cells,template:_.template([\'<div class="listview inner" style="border:none;"></div>\'].join("")),itemTemplate:_.template(["<div>",\'<label class="checkbox-indeterminate" style="position:absolute;">\',"<% if (!check) { %>",\'<input type="button"/>\',"<% } else { %>",\'<input type="button" class="checked"/>\',"<% } %>","</label>",\'<div id="<%= id %>" class="list-item" style="pointer-events:none;margin-left:20px;display:inline-block;"><%= value %></div>\',"</div>"].join(""))}),this.cellsList.on("item:select",_.bind(this.onCellCheck,this)),this.cellsList.onKeyDown=_.bind(this.onListKeyDown,this)),this.setupListCells()},show:function(){Common.UI.Window.prototype.show.call(this);var e=this;this.input&&_.delay(function(){e.input.$el.find("input").focus()},500,this)},onBtnClick:function(e){e.currentTarget.attributes&&e.currentTarget.attributes.result&&"cancel"===e.currentTarget.attributes.result.value&&this.close()},onApplyFilter:function(){this.testFilter()&&(this.save(),this.close())},onSortType:function(e){this.api&&this.configTo&&this.api.asc_sortColFilter(e,this.configTo.asc_getCellId()),this.close()},onShowCustomFilterDialog:function(){var e=this,t=(new SSE.Views.DigitalFilterDialog({api:this.api})).on({close:function(){e.close()}});t.setSettings(this.configTo),t.show(),this.close()},onCellCheck:function(e,t,n){if(this.checkCellTrigerBlock)return;var r="",i="",s=!1,o=null,u=window.event?window.event:window._event;if(u){i=u.target.type,r=$(u.currentTarget).find(".list-item"),r.length&&(o=r.get(0).getBoundingClientRect(),o.left<u.clientX&&u.clientX<o.right&&o.top<u.clientY&&u.clientY<o.bottom&&(s=!0));if(i==="button"||s)this.updateCellCheck(e,n),_.delay(function(){e.$el.find(".listview").focus()},100,this)}},onListKeyDown:function(e,t){var n=null,r=this.cellsList;if(r.disabled)return;_.isUndefined(undefined)&&(t=e),t.keyCode==Common.UI.Keys.SPACE?(t.preventDefault(),t.stopPropagation(),this.updateCellCheck(r,r.getSelectedRec()[0])):Common.UI.DataView.prototype.onKeyDown.call(this.cellsList,e,t)},updateCellCheck:function(e,t){if(t&&e){e.isSuspendEvents=!0;if("1"!==t.get("groupid")){var n=!t.get("check");this.cells.each(function(e){e.set("check",n)})}else t.set("check",!t.get("check"));this.chCustomFilter.setValue(!1),this.btnOk.setDisabled(!1),e.isSuspendEvents=!1,e.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})}},setSettings:function(e){this.config=e,this.configTo=e},setupListCells:function(){function e(e){return!isNaN(parseFloat(e))&&isFinite(e)}var t=this,n,r,i=0,s=!1,o=1,u=this.configTo.asc_getIsCustomFilter()===!0;if(_.isUndefined(this.config))return;this.cells.reset(),this.filterExcludeCells.reset(),t.cells.push(new Common.UI.DataViewModel({id:++i,selected:!1,allowSelected:!0,value:this.textSelectAll,groupid:"0",check:!0,throughIndex:0})),this.throughIndexes.push(!0),this.config.asc_getResult().forEach(function(u){r=u.asc_getVal(),n=e(r),"hidden"!==u.asc_getVisible()&&(t.cells.push(new Common.UI.DataViewModel({id:++i,selected:!1,allowSelected:!0,cellvalue:r,value:n?r:r.length>0?r:t.textEmptyItem,rowvisible:u.asc_getVisible(),intval:n?parseFloat(r):undefined,strval:n?"":r,groupid:"1",check:u.asc_getVisible(),throughIndex:o})),u.asc_getVisible()||(s=!0),t.throughIndexes.push(u.asc_getVisible()),++o)}),this.checkCellTrigerBlock=!0,this.cells.at(0).set("check",!s),this.checkCellTrigerBlock=undefined,this.btnSortDown.toggle(!1,!1),this.btnSortUp.toggle(!1,!1);var a=this.config.asc_getSortState();a&&("ascending"===a?this.btnSortDown.toggle(!0,!1):this.btnSortUp.toggle(!0,!1)),this.chCustomFilter.setValue(u),this.btnOk.setDisabled(u),this.cellsList.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0}),this.config=undefined},setupDataCells:function(){function e(e){return!isNaN(parseFloat(e))&&isFinite(e)}var t=this,n,r,i=0,s=!0,o=1;this.cells.forEach(function(e){r=e.get("check"),_.isUndefined(r)&&(r=!1),t.throughIndexes[parseInt(e.get("throughIndex"))]=e.get("check")}),this.cells.reset(),this.filterExcludeCells.reset(),t.filter||t.cells.push(new Common.UI.DataViewModel({id:++i,selected:!1,allowSelected:!0,value:this.textSelectAll,groupid:"0",check:t.throughIndexes[0],throughIndex:0})),this.configTo.asc_getResult().forEach(function(u){r=u.asc_getVal(),n=e(r),s=!0,t.filter&&null===r.match(t.filter)&&(s=!1),"hidden"!==u.asc_getVisible()&&(s?t.cells.push(new Common.UI.DataViewModel({id:++i,selected:!1,allowSelected:!0,cellvalue:r,value:n?r:r.length>0?r:t.textEmptyItem,rowvisible:u.asc_getVisible(),intval:n?parseFloat(r):undefined,strval:n?"":r,groupid:"1",check:t.throughIndexes[o],throughIndex:o})):t.filterExcludeCells.push(new Common.UI.DataViewModel({cellvalue:r})),++o)}),this.cells.length&&this.chCustomFilter.setValue(this.configTo.asc_getIsCustomFilter()===!0),this.cellsL

]]></string> </value>
        </item>
        <item>
            <key> <string>next</string> </key>
            <value>
              <persistent> <string encoding="base64">AAAAAAAAAAY=</string> </persistent>
            </value>
        </item>
      </dictionary>
    </pickle>
  </record>
  <record id="6" aka="AAAAAAAAAAY=">
    <pickle>
      <global name="Pdata" module="OFS.Image"/>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>data</string> </key>
            <value> <string encoding="cdata"><![CDATA[

ist.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})},testFilter:function(){var e=this,t=!1;return this.cells&&this.cells.forEach(function(e){"1"===e.get("groupid")&&e.get("check")&&(t=!0)}),t||Common.UI.warning({title:this.textWarning,msg:this.warnNoSelected,callback:function(){_.delay(function(){e.input.$el.find("input").focus()},100,this)}}),t},save:function(){if(this.api&&this.configTo&&this.cells&&this.filterExcludeCells){var e=new Asc.AutoFiltersOptions;if(e){e.asc_setCellId(this.configTo.asc_getCellId());var t=this,n=[],r;this.cells.forEach(function(e){"1"===e.get("groupid")&&(r=e.get("rowvisible"))!=="hidden"&&(r=e.get("check"),n.push(new Asc.AutoFiltersOptionsElements(e.get("cellvalue"),r)))}),this.filterExcludeCells.forEach(function(e){n.push(new Asc.AutoFiltersOptionsElements(e.get("cellvalue"),!1))}),e.asc_setResult(n),e.sortState=this.configTo.asc_getSortState(),this.api.asc_applyAutoFilter("mainFilter",e)}}},onPrimary:function(){return this.save(),this.close(),!1},okButtonText:"Ok",btnCustomFilter:"Custom Filter",textSelectAll:"Select All",txtTitle:"Filter",warnNoSelected:"You must choose at least one value",textWarning:"Warning",cancelButtonText:"Cancel",textEmptyItem:"{Blanks}",txtEmpty:"Enter cell\'s filter"},SSE.Views.AutoFilterDialog||{}))}),define("spreadsheeteditor/main/app/controller/DocumentHolder",["core","common/main/lib/util/utils","common/main/lib/view/CopyWarningDialog","spreadsheeteditor/main/app/view/DocumentHolder","spreadsheeteditor/main/app/view/HyperlinkSettingsDialog","spreadsheeteditor/main/app/view/ParagraphSettingsAdvanced","spreadsheeteditor/main/app/view/SetValueDialog","spreadsheeteditor/main/app/view/AutoFilterDialog"],function(){SSE.Controllers.DocumentHolder=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["DocumentHolder"],initialize:function(){var e=this;e.tooltips={hyperlink:{},comment:{},coauth:{ttHeight:20},row_column:{ttHeight:20}},e.mouse={},e.popupmenu=!1,e.rangeSelectionMode=!1,e.show_copywarning=!0,this.wrapEvents={apiHideComment:_.bind(this.onApiHideComment,this)},this.addListeners({DocumentHolder:{createdelayedelements:this.onCreateDelayedElements}});var t={};this.hkComments="command+alt+h,ctrl+alt+h",t[this.hkComments]=function(){e.onAddComment()},Common.util.Shortcuts.delegateShortcuts({shortcuts:t})},onLaunch:function(){var e=this;e.documentHolder=this.createView("DocumentHolder"),e.documentHolder.render(),e.documentHolder.el.tabIndex=-1,$(document).on("mousewheel",_.bind(e.onDocumentWheel,e)),$(document).on("mousedown",_.bind(e.onDocumentRightDown,e)),$(document).on("mouseup",_.bind(e.onDocumentRightUp,e)),$(document).on("keydown",_.bind(e.onDocumentKeyDown,e)),$(window).on("resize",_.bind(e.onDocumentResize,e));var t=SSE.getController("Viewport").getView("Viewport");t.hlayout.on("layout:resizedrag",_.bind(e.onDocumentResize,e)),Common.NotificationCenter.on({"window:show":function(t){e.hideHyperlinkTip()},"modal:show":function(t){e.hideCoAuthTips()},"layout:changed":function(t){e.hideHyperlinkTip(),e.hideCoAuthTips(),e.onDocumentResize()},"cells:range":function(t){e.onCellsRange(t)},"copywarning:show":function(){e.show_copywarning=!1}})},onCreateDelayedElements:function(e){var t=this;e.pmiCut.on("click",_.bind(t.onCopyPaste,t)),e.pmiCopy.on("click",_.bind(t.onCopyPaste,t)),e.pmiPaste.on("click",_.bind(t.onCopyPaste,t)),e.pmiImgCut.on("click",_.bind(t.onCopyPaste,t)),e.pmiImgCopy.on("click",_.bind(t.onCopyPaste,t)),e.pmiImgPaste.on("click",_.bind(t.onCopyPaste,t)),e.pmiTextCut.on("click",_.bind(t.onCopyPaste,t)),e.pmiTextCopy.on("click",_.bind(t.onCopyPaste,t)),e.pmiTextPaste.on("click",_.bind(t.onCopyPaste,t)),e.pmiInsertEntire.on("click",_.bind(t.onInsertEntire,t)),e.pmiDeleteEntire.on("click",_.bind(t.onDeleteEntire,t)),e.pmiInsertCells.menu.on("item:click",_.bind(t.onInsertCells,t)),e.pmiDeleteCells.menu.on("item:click",_.bind(t.onDeleteCells,t)),e.pmiSortCells.menu.on("item:click",_.bind(t.onSortCells,t)),e.pmiClear.menu.on("item:click",_.bind(t.onClear,t)),e.pmiInsFunction.on("click",_.bind(t.onInsFunction,t)),e.menuAddHyperlink.on("click",_.bind(t.onInsHyperlink,t)),e.menuEditHyperlink.on("click",_.bind(t.onInsHyperlink,t)),e.menuRemoveHyperlink.on("click",_.bind(t.onDelHyperlink,t)),e.pmiRowHeight.on("click",_.bind(t.onSetSize,t)),e.pmiColumnWidth.on("click",_.bind(t.onSetSize,t)),e.pmiEntireHide.on("click",_.bind(t.onEntireHide,t)),e.pmiEntireShow.on("click",_.bind(t.onEntireShow,t)),e.pmiAddComment.on("click",_.bind(t.onAddComment,t)),e.imgMenu.on("item:click",_.bind(t.onImgMenu,t)),e.menuParagraphVAlign.menu.on("item:click",_.bind(t.onParagraphVAlign,t)),e.menuAddHyperlinkShape.on("click",_.bind(t.onInsHyperlink,t)),e.menuEditHyperlinkShape.on("click",_.bind(t.onInsHyperlink,t)),e.menuRemoveHyperlinkShape.on("click",_.bind(t.onRemoveHyperlinkShape,t)),e.pmiTextAdvanced.on("click",_.bind(t.onTextAdvanced,t)),e.mnuShapeAdvanced.on("click",_.bind(t.onShapeAdvanced,t)),e.mnuChartEdit.on("click",_.bind(t.onChartEdit,t));var n=e.cmpEl;if(n){n.on({keydown:function(e){e.keyCode==e.F10&&e.shiftKey&&(e.stopEvent(),t.showObjectMenu(e))},mousedown:function(e){e.target.localName=="canvas"&&e.button!=2&&Common.UI.Menu.Manager.hideAll()},click:function(e){t.api&&(t.api.isTextAreaBlur=!1,e.target.localName=="canvas"&&n.focus())}});var r=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},i=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";r(e.el,i,_.bind(this.onDocumentWheel,this))}},loadConfig:function(e){this.editorConfig=e.config},setMode:function(e){this.permissions=e,this.permissions.canCoAuthoring&&this.permissions.isEdit&&this.permissions.canComments?Common.util.Shortcuts.resumeEvents(this.hkComments):Common.util.Shortcuts.suspendEvents(this.hkComments)},setApi:function(e){return this.api=e,this.api.asc_registerCallback("asc_onContextMenu",_.bind(this.onApiContextMenu,this)),this.api.asc_registerCallback("asc_onMouseMove",_.bind(this.onApiMouseMove,this)),this.api.asc_registerCallback("asc_onHideComment",this.wrapEvents.apiHideComment),this.api.asc_registerCallback("asc_onHyperlinkClick",_.bind(this.onApiHyperlinkClick,this)),this.api.asc_registerCallback("asc_onSetAFDialog",_.bind(this.onApiAutofilter,this)),this.api.asc_registerCallback("asc_onСoAuthoringDisconnect",_.bind(this.onApiCoAuthoringDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onApiCoAuthoringDisconnect,this)),this},resetApi:function(e){this.api.asc_unregisterCallback("asc_onHideComment",this.wrapEvents.apiHideComment),this.api.asc_registerCallback("asc_onHideComment",this.wrapEvents.apiHideComment)},onCopyPaste:function(e){var t=this;if(t.api)if(typeof window["AscDesktopEditor"]=="object")e.value=="cut"?t.api.asc_Cut():e.value=="copy"?t.api.asc_Copy():t.api.asc_Paste();else{var n=window.localStorage.getItem("sse-hide-copywarning");(!n||parseInt(n)!=1)&&t.show_copywarning?(new Common.Views.CopyWarningDialog({handler:function(n){e.value=="cut"?t.api.asc_Cut():e.value=="copy"?t.api.asc_Copy():t.api.asc_Paste(),n&&window.localStorage.setItem("sse-hide-copywarning",1),Common.NotificationCenter.trigger("edit:complete",t.documentHolder)}})).show():(e.value=="cut"?t.api.asc_Cut():e.value=="copy"?t.api.asc_Copy():t.api.asc_Paste(),Common.NotificationCenter.trigger("edit:complete",t.documentHolder)),Common.component.Analytics.trackEvent("ToolBar","Copy Warning")}},onInsertEntire:function(e){if(this.api){switch(this.api.asc_getCellInfo().asc_getFlags().asc_getSelectionType()){case c_oAscSelectionType.RangeRow:this.api.asc_insertCells(c_oAscInsertOptions.InsertRows);break;case c_oAscSelectionType.RangeCol:this.api.asc_insertCells(c_oAscInsertOptions.InsertColumns)}Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Insert Entire")}},onInsertCells:function(e,t){this.api&&(this.api.asc_insertCells(t.value),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Insert Cells"))},onDeleteEntire:function(e){if(this.api){switch(this.api.asc_getCellInfo().asc_getFlags().asc_getSelectionType()){case c_oAscSelectionType.RangeRow:this.api.asc_deleteCells(c_oAscDeleteOptions.DeleteRows);break;case c_oAscSelectionType.RangeCol:this.api.asc_deleteCells(c_oAscDeleteOptions.DeleteColumns)}Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Delete Entire")}},onDeleteCells:function(e,t){this.api&&(this.api.asc_deleteCells(t.value),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Delete Cells"))},onSortCells:function(e,t){this.api&&(this.api.asc_sortColFilter(t.value,""),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Sort Cells"))},onClear:function(e,t){this.api&&(this.api.asc_emptyCells(t.value),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Clear"))},onInsFunction:function(e){var t=this.getApplication().getController("FormulaDialog");t&&this.api&&(this.api.asc_enableKeyEvents(!1),t.showDialog())},onInsHyperlink:function(e){var t=this,n,r;if(t.api){var i=t.api.asc_getWorksheetsCount(),s=-1,o=[];while(++s<i)this.api.asc_isWorksheetHidden(s)||o.push({displayValue:t.api.asc_getWorksheetName(s),value:t.api.asc_getWorksheetName(s)});var u=function(e,n){n=="ok"&&(r=e.getSettings(),t.api.asc_insertHyperlink(r)),Common.NotificationCenter.trigger("edit:complete",t.documentHolder)},a=t.api.asc_getCellInfo();r=a.asc_getHyperlink(),n=new SSE.Views.HyperlinkSettingsDialog({handler:u}),n.show(),n.setSettings({sheets:o,currentSheet:t.api.asc_getWorksheetName(t.api.asc_getActiveWorksheetIndex()),props:r,text:a.asc_getText(),isLock:a.asc_getFlags().asc_getLockText(),allowInternal:e.options.inCell})}Common.component.Analytics.trackEvent("DocumentHolder","Add Hyperlink")},onDelHyperlink:function(e){this.api&&(this.api.asc_removeHyperlink(),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Remove Hyperlink"))},onSetSize:function(e){var t=this;(new SSE.Views.SetValueDialog({title:e.caption,startvalue:e.options.action=="row-height"?t.api.asc_getRowHeight():t.api.asc_getColumnWidth(),maxvalue:409,step:e.options.action=="row-height"?.75:1,defaultUnit:e.options.action=="row-height"?"pt":"sym",handler:function(n,r){if(r=="ok"){var i=n.getSettings();e.options.action=="row-height"?t.api.asc_setRowHeight(i):t.api.asc_setColumnWidth(i)}Common.NotificationCenter.trigger("edit:complete",t.documentHolder)}})).show()},onEntireHide:function(e){this.api&&this.api[e.isrowmenu?"asc_hideRows":"asc_hideColumns"]()},onEntireShow:function(e){this.api&&this.api[e.isrowmenu?"asc_showRows":"asc_showColumns"]()},onAddComment:function(e){if(this.api&&this.permissions.canCoAuthoring&&this.permissions.isEdit&&this.permissions.canComments){this.api.asc_enableKeyEvents(!1);var t=SSE.getController("Common.Controllers.Comments"),n=this.api.asc_getCellInfo();if(t){var r=n.asc_getComments();r.length?t.onEditComments(r):t.addDummyComment()}}},onImgMenu:function(e,t){this.api&&(t.options.type=="arrange"?(this.api.asc_setSelectedDrawingObjectLayer(t.value),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Arrange")):t.options.type=="group"&&(this.api[t.value=="grouping"?"asc_groupGraphicsObjects":"asc_unGroupGraphicsObjects"](),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder",t.value=="grouping"?"Grouping":"Ungrouping")))},onParagraphVAlign:function(e,t){if(this.api){var n=new Asc.asc_CImgProperty;n.asc_putVerticalTextAlign(t.value),this.api.asc_setGraphicObjectProps(n),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Paragraph Vertical Align")}},onRemoveHyperlinkShape:function(e){this.api&&(this.api.asc_removeHyperlink(),Common.NotificationCenter.trigger("edit:complete",this.documentHolder),Common.component.Analytics.trackEvent("DocumentHolder","Remove Hyperlink"))},onTextAdvanced:function(e){var t=this;(new SSE.Views.ParagraphSettingsAdvanced({paragraphProps:e.textInfo,api:t.api,handler:function(e,n){e=="ok"&&t.api&&(t.api.asc_setGraphicObjectProps(n.paragraphProps),Common.component.Analytics.trackEvent("DocumentHolder","Apply advanced paragraph settings")),Common.NotificationCenter.trigger("edit:complete",t)}})).show()},onShapeAdvanced:function(e){var t=this;(new SSE.Views.ShapeSettingsAdvanced({shapeProps:e.shapeInfo,api:t.api,handler:function(e,n){e=="ok"&&t.api&&(t.api.asc_setGraphicObjectProps(n.shapeProps),Common.component.Analytics.trackEvent("DocumentHolder","Apply advanced shape settings")),Common.NotificationCenter.trigger("edit:complete",t)}})).show()},onChartEdit:function(e){var t=this,n,r;t.api&&(r=t.api.asc_getChartObject(),r&&(new SSE.Views.ChartSettingsDlg({chartSettings:r,api:t.api,handler:function(e,n){e=="ok"&&t.api&&t.api.asc_editChartDrawingObject(n.chartSettings),Common.NotificationCenter.trigger("edit:complete",t)}})).show())},onApiCoAuthoringDisconnect:function(){this.permissions.isEdit=!1},hideCoAuthTips:function(){this.tooltips.coauth.ref&&($(this.tooltips.coauth.ref).remove(),this.tooltips.coauth.ref=undefined,this.tooltips.coauth.x_point=undefined,this.tooltips.coauth.y_point=undefined)},hideHyperlinkTip:function(){!this.tooltips.hyperlink.isHidden&&this.tooltips.hyperlink.ref&&(this.tooltips.hyperlink.ref.hide(),this.tooltips.hyperlink.isHidden=!0)},onApiMouseMove:function(e){if(!this._isFullscreenMenu&&e.length){var t,n,r,i,s;for(var o=e.length;o>0;o--)switch(e[o-1].asc_getType()){case c_oAscMouseMoveType.Hyperlink:t=o;break;case c_oAscMouseMoveType.Comment:n=o;break;case c_oAscMouseMoveType.LockedObject:r=o;break;case c_oAscMouseMoveType.ResizeColumn:i=o;break;case c_oAscMouseMoveType.ResizeRow:s=o}var u=this,a=[0,0],f=u.tooltips.coauth,l=u.tooltips.comment,c=u.tooltips.hyperlink,h=u.tooltips.row_column,p=[u.documentHolder.cmpEl.offset().left-$(window).scrollLeft(),u.documentHolder.cmpEl.offset().top-$(window).scrollTop()];c.isHidden=!1,h.isHidden=!1;var d=function(e){var t=SSE.getCollection("Common.Collections.Users");if(t){var n=t.findUser(e);if(n)return n.get("username")}return u.guestText};if(t){var v=e[t-1],m=v.asc_getHyperlink();if(m.asc_getType()==c_oAscHyperlinkType.WebLink){var g=m.asc_getTooltip();g?g=Common.Utils.String.htmlEncode(g)+"<br><b>"+u.textCtrlClick+"</b>":g=m.asc_getHyperlinkUrl()+"<br><b>"+u.textCtrlClick+"</b>"}else g=m.asc_getTooltip()||m.asc_getSheet()+"!"+m.asc_getRange();c.ref&&c.ref.isVisible()&&c.text!=g&&(c.ref.hide(),c.isHidden=!0);if(!c.ref||!c.ref.isVisible())c.text=g,c.ref=(new Common.UI.Tooltip({owner:u.documentHolder,html:!0,title:g})).on("tooltip:hide",function(e){c.ref=undefined,c.text=""}),c.ref.show([-1e4,-1e4]),c.isHidden=!1;a=[v.asc_getX(),v.asc_getY()],a[0]+=p[0]+6,a[1]+=p[1]-20,a[1]-=c.ref.getBSTip().$tip.height();var y=c.ref.getBSTip().$tip.width();a[0]+y>u.tooltips.coauth.bodyWidth&&(a[0]=u.tooltips.coauth.bodyWidth-y),c.ref.getBSTip().$tip.css({top:a[1]+"px",left:a[0]+"px"})}else u.hideHyperlinkTip();if(i!==undefined||s!==undefined){var v=e[i!==undefined?i-1:s-1],b=Common.Utils.String.format(i!==undefined?this.textChangeColumnWidth:this.textChangeRowHeight,v.asc_getSizeCCOrPt().toFixed(2),v.asc_getSizePx());h.ref&&h.ref.isVisible()&&h.text!=b&&(h.text=b,h.ref.setTitle(b),h.ref.updateTitle());if(!h.ref||!h.ref.isVisible()){h.text=b,h.ref=(new Common.UI.Tooltip({owner:u.documentHolder,html:!0,title:b})).on("tooltip:hide",function(e){h.ref=undefined,h.text=""}),h.ref.show([-1e4,-1e4]),h.isHidden=!1,a=[v.asc_getX(),v.asc_getY()],a[0]+=p[0]+6,a[1]+=p[1]-20-h.ttHeight;var y=h.ref.getBSTip().$tip.width();a[0]+y>u.tooltips.coauth.bodyWidth&&(a[0]=u.tooltips.coauth.bodyWidth-y-20),h.ref.getBSTip().$tip.css({top:a[1]+"px",left:a[0]+"px"})}}else!h.isHidden&&h.ref&&(h.ref.hide(),h.isHidden=!0);if(u.permissions.isEdit){if(n&&!this.popupmenu){v=e[n-1];if(!l.editCommentId&&l.moveCommentId!=v.asc_getCommentIndexes()[0]){l.moveCommentId=v.asc_getCommentIndexes()[0],l.moveCommentTimer&&clearTimeout(l.moveCommentTimer);var w=v.asc_getCommentIndexes(),E=v.asc_getX(),S=v.asc_getY(),x=v.asc_getReverseX();l.moveCommentTimer=setTimeout(function(){if(l.moveCommentId&&!l.editCommentId){l.viewCommentId=l.moveCommentId;var e=u.getApplication().getController("Common.Controllers.Comments");e&&(e.isSelectedComment||e.onApiShowComment(w,E,S,x,!1,!0))}},400)}}else{l.moveCommentId=undefined;if(l.viewCommentId!=undefined){l={};var T=this.getApplication().getController("Common.Controllers.Comments");T&&T.onApiHideComment(!0)}}if(r){v=e[r-1],f.XY||u.onDocumentResize();if(f.x_point!=v.asc_getX()||f.y_point!=v.asc_getY()){u.hideCoAuthTips(),f.x_point=v.asc_getX(),f.y_point=v.asc_getY();var N=$(document.createElement("div")),C=v.asc_getLockedObjectType()==c_oAscMouseMoveLockedObjectType.Sheet||v.asc_getLockedObjectType()==c_oAscMouseMoveLockedObjectType.TableProperties;f.ref=N,N.addClass("username-tip"),N.css({height:f.ttHeight+"px",position:"absolute",zIndex:"900",visibility:"visible"}),$(document.body).append(N),a=[f.x_point+f.XY[0],f.y_point+f.XY[1]],!C&&(a[0]=f.bodyWidth-a[0]),a[1]>f.XY[1]&&a[1]+f.ttHeight<f.XY[1]+f.apiHeight&&(N.text(d(v.asc_getUserId())),f.bodyWidth-a[0]<f.ref.width()?N.css({visibility:"visible",left:"0px",top:a[1]-f.ttHeight+"px"}):N.css({visibility:"visible",right:a[0]+"px",top:a[1]+"px"}))}}else u.hideCoAuthTips()}}},onApiHideComment:function(){this.tooltips.comment.viewCommentId=this.tooltips.comment.editCommentId=this.tooltips.comment.moveCommentId=undefined},onApiHyperlinkClick:function(e){if(e){var t=e.strongMatch(Common.Utils.hostnameRe);!t&&(t=e.strongMatch(Common.Utils.emailRe)),!t&&(t=e.strongMatch(Common.Utils.ipRe)),!t&&(t=e.strongMatch(Common.Utils.localRe));if(t){var n=window.open(e,"_blank");n&&n.focus()}}},onApiAutofilter:function(e){var t=this;if(t.permissions.isEdit){var n=(new SSE.Views.AutoFilterDialog({api:this.api})).on({close:function(){t.api&&t.api.asc_enableKeyEvents(!0)}});t.api&&t.api.asc_enableKeyEvents(!1),Common.UI.Menu.Manager.hideAll(),n.setSettings(e),n.show()}},onApiContextMenu:function(e){var t=this;_.delay(function(){t.showObjectMenu.call(t,e)},10)},onAfterRender:function(e){},onDocumentResize:function(e){var t=this;t.documentHolder&&(t.tooltips.coauth.XY=[t.documentHolder.cmpEl.offset().left-$(window).scrollLeft(),t.documentHolder.cmpEl.offset().top-$(window).scrollTop()],t.tooltips.coauth.apiHeight=t.documentHolder.cmpEl.height(),t.tooltips.coauth.bodyWidth=$(window).width())},onDocumentWheel:function(e){if(this.api){var t=_.isUndefined(e.originalEvent)?e.wheelDelta:e.originalEvent.wheelDelta;_.isUndefined(t)&&(t=e.deltaY);if(e.ctrlKey||e.metaKey){var n=this.api.asc_getZoom();t<0?(n-=.1,n<.5||this.api.asc_setZoom(n)):t>0&&(n+=.1,n>0&&!(n>2)&&this.api.asc_setZoom(n)),e.preventDefault(),e.stopPropagation()}}},onDocumentKeyDown:function(e){if(this.api){var t=e.keyCode;if((e.ctrlKey||e.metaKey)&&!e.shiftKey){if(t===Common.UI.Keys.NUM_PLUS||t===Common.UI.Keys.EQUALITY||Common.Utils.isOpera&&t==43){if(!this.api.isCellEdited){var n=this.api.asc_getZoom()+.1;return n>0&&!(n>2)&&this.api.asc_setZoom(n),e.preventDefault(),e.stopPropagation(),!1}}else if(t===Common.UI.Keys.NUM_MINUS||t===Common.UI.Keys.MINUS||Common.Utils.isOpera&&t==45)if(!this.api.isCellEdited)return n=this.api.asc_getZoom()-.1,n<.5||this.api.asc_setZoom(n),e.preventDefault(),e.stopPropagation(),!1}else if(t==Common.UI.Keys.F10&&e.shiftKey)return this.showObjectMenu(e),e.preventDefault(),e.stopPropagation(),!1}},onDocumentRightDown:function(e){e.button==0&&(this.mouse.isLeftButtonDown=!0)},onDocumentRightUp:function(e){e.button==0&&(this.mouse.isLeftButtonDown=!1)},showObjectMenu:function(e){if(this.api&&this.permissions.isEdit&&!this.mouse.isLeftButtonDown&&!this.rangeSelectionMode){var t,n,r,i,s,o,u,a,f,l=this.documentHolder,c=this.api.asc_getCellInfo(),h=c.asc_getFlags().asc_getSelectionType(),p=c.asc_getLocked(),d=!1,v=this.getApplication().getController("Common.Controllers.Comments");if(!this.permissions.isEditDiagram)switch(h){case c_oAscSelectionType.RangeCells:t=!0;break;case c_oAscSelectionType.RangeRow:n=!0;break;case c_oAscSelectionType.RangeCol:r=!0;break;case c_oAscSelectionType.RangeMax:i=!0;break;case c_oAscSelectionType.RangeImage:o=!0;break;case c_oAscSelectionType.RangeShape:a=!0;break;case c_oAscSelectionType.RangeChart:s=!0;break;case c_oAscSelectionType.RangeChartText:f=!0;break;case c_oAscSelectionType.RangeShapeText:u=!0}else var m=h==c_oAscSelectionType.RangeCells;if(o||a||s){o=a=s=!1;var g=!1,y=this.api.asc_getGraphicObjectProps();for(var b=0;b<y.length;b++)if(y[b].asc_getObjectType()==c_oAscTypeSelectElement.Image){var w=y[b].asc_getObjectValue();d=d||w.asc_getLocked();var E=w.asc_getShapeProperties();E?E.asc_getFromChart()?s=!0:(l.mnuShapeAdvanced.shapeInfo=w,a=!0):w.asc_getChartProperties()?(s=!0,g=!0):o=!0}l.mnuUnGroupImg.setDisabled(d||!this.api.asc_canUnGroupGraphicsObjects()),l.mnuGroupImg.setDisabled(d||!this.api.asc_canGroupGraphicsObjects()),l.mnuShapeAdvanced.setVisible(a&&!o&&!s),l.mnuShapeAdvanced.setDisabled(d),l.mnuChartEdit.setVisible(s&&!o&&!a&&g),l.mnuChartEdit.setDisabled(d),l.pmiImgCut.setDisabled(d),l.pmiImgPaste.setDisabled(d),this.showPopupMenu(l.imgMenu,{},e),l.mnuShapeSeparator.setVisible(l.mnuShapeAdvanced.isVisible()||l.mnuChartEdit.isVisible())}else if(u||f){l.pmiTextAdvanced.textInfo=undefined;var y=this.api.asc_getGraphicObjectProps();for(var b=0;b<y.length;b++){var S=y[b].asc_getObjectType();if(S==c_oAscTypeSelectElement.Image){var x=y[b].asc_getObjectValue(),T=x.asc_getVerticalTextAlign();d=d||x.asc_getLocked(),l.menuParagraphTop.setChecked(T==c_oAscVerticalTextAlign.TEXT_ALIGN_TOP),l.menuParagraphCenter.setChecked(T==c_oAscVerticalTextAlign.TEXT_ALIGN_CTR),l.menuParagraphBottom.setChecked(T==c_oAscVerticalTextAlign.TEXT_ALIGN_BOTTOM)}else S==c_oAscTypeSelectElement.Paragraph&&(l.pmiTextAdvanced.textInfo=y[b].asc_getObjectValue(),d=d||l.pmiTextAdvanced.textInfo.asc_getLocked())}var N=c.asc_getHyperlink(),C=this.api.asc_canAddShapeHyperlink();l.menuHyperlinkShape.setVisible(u&&C!==!1&&N),l.menuAddHyperlinkShape.setVisible(u&&C!==!1&&!N),l.menuParagraphVAlign.setVisible(f!==!0),l.pmiTextAdvanced.setVisible(l.pmiTextAdvanced.textInfo!==undefined),_.each(l.textInShapeMenu.items,function(e){e.setDisabled(d)}),l.pmiTextCopy.setDisabled(!1),this.showPopupMenu(l.textInShapeMenu,{},e),l.textInShapeMenu.items[3].setVisible(l.menuHyperlinkShape.isVisible()||l.menuAddHyperlinkShape.isVisible()||l.menuParagraphVAlign.isVisible())}else if(!this.permissions.isEditDiagram||h!==c_oAscSelectionType.RangeImage&&h!==c_oAscSelectionType.RangeShape&&h!==c_oAscSelectionType.RangeChart&&h!==c_oAscSelectionType.RangeChartText&&h!==c_oAscSelectionType.RangeShapeText){var k=this.api.isCellEdited;l.pmiInsertEntire.setVisible(n||r),l.pmiDeleteEntire.setVisible(n||r),l.pmiInsertCells.setVisible(t&&!k),l.pmiDeleteCells.setVisible(t&&!k),l.pmiSortCells.setVisible((t||i)&&!k),l.pmiInsFunction.setVisible(t||m);var N=c.asc_getHyperlink();l.menuHyperlink.setVisible(t&&N&&!k),l.menuAddHyperlink.setVisible(t&&!N&&!k),l.pmiRowHeight.setVisible(n||i),l.pmiColumnWidth.setVisible(r||i),l.pmiEntireHide.setVisible(r||n),l.pmiEntireShow.setVisible(r||n),l.ssMenu.items[10].setVisible(t&&!k&&this.permissions.canCoAuthoring&&this.permissions.canComments),l.pmiAddComment.setVisible(t&&!k&&this.permissions.canCoAuthoring&&this.permissions.canComments),l.pmiCellMenuSeparator.setVisible(t||n||r||i||m),l.pmiEntireHide.isrowmenu=n,l.pmiEntireShow.isrowmenu=n,l.setMenuItemCommentCaptionMode(c.asc_getComments().length>0),v&&v.blockPopover(!0),l.pmiClear.menu.items[1].setDisabled(k),l.pmiClear.menu.items[2].setDisabled(k),l.pmiClear.menu.items[3].setDisabled(k),l.pmiClear.menu.items[4].setDisabled(k),_.each(l.ssMenu.items,function(e){e.setDisabled(p)}),l.pmiCopy.setDisabled(!1),this.showPopupMenu(l.ssMenu,{},e)}}},showPopupMenu:function(e,t,n){if(!_.isUndefined(e)&&e!==null){Common.UI.Menu.Manager.hideAll();var r=this,i=r.documentHolder,s=[n.pageX-i.cmpEl.offset().left,n.pageY-i.cmpEl.offset().top],o=i.cmpEl.find(Common.Utils.String.format("#menu-container-{0}",e.id));e.rendered||(o.length<1&&(o=$(Common.Utils.String.format(\'<div id="menu-container-{0}" style="position: absolute; z-index: 10000;"><div class="dropdown-toggle" data-toggle="dropdown"></div></div>\',e.id)),i.cmpEl.append(o)),e.render(o),e.cmpEl.attr({tabindex:"-1"}));if(n.button!==2){var u=r.api.asc_getActiveCellCoord(),a={left:0,top:0};s[0]=u.asc_getX()+u.asc_getWidth()+a.left,s[1]=(u.asc_getY()<0?0:u.asc_getY())+u.asc_getHeight()+a.top}o.css({left:s[0],top:s[1]}),_.isFunction(e.options.initMenu)&&(e.options.initMenu(t),e.alignPosition()),_.delay(function(){e.cmpEl.focus()},10),e.show()}},onCellsRange:function(e){this.rangeSelectionMode=e!=c_oAscSelectionDialogType.None},guestText:"Guest",textCtrlClick:"Press CTRL and click link",txtRowHeight:"Row Height",txtHeight:"Height",txtWidth:"Width",tipIsLocked:"This element is being edited by another user.",textChangeColumnWidth:"Column Width {0} symbols ({1} pixels)",textChangeRowHeight:"Row Height {0} points ({1} pixels)"},SSE.Controllers.DocumentHolder||{}))}),define("text!spreadsheeteditor/main/app/template/CellEditor.template",[],function(){return\'<div class="ce-group-name">\\r\\n    <input id="ce-cell-name" class="aslabel form-control" type="text">\\r\\n    <button id="ce-func-label" type="button" class="btn small btn-toolbar btn-toolbar-default"><span class="btn-icon">&nbsp;</span></button>\\r\\n</div>\\r\\n<div class="ce-group-expand">\\r\\n    <button id="ce-btn-expand" type="button" class="btn"><span class="caret">&nbsp;</span></button>\\r\\n</div>\\r\\n<div class="ce-group-content">\\r\\n    <textarea id="ce-cell-content" class="form-control" spellcheck="false" rows="1" cols="20"></textarea>\\r\\n</div>\\r\\n\'}),define("spreadsheeteditor/main/app/view/CellEditor",["text!spreadsheeteditor/main/app/template/CellEditor.template","common/main/lib/component/BaseView"],function(e){SSE.Views.CellEditor=Common.UI.BaseView.extend({template:_.template(e),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e)},render:function(){return $(this.el).html(this.template()),this.$cellname=$("#ce-cell-name",this.el),this.$btnexpand=$("#ce-btn-expand",this.el),this.$btnfunc=$("#ce-func-label",this.el),this.$btnfunc.addClass("disabled"),this.$btnfunc.tooltip({title:this.tipFormula,placement:"cursor"}),this},updateCellInfo:function(e){e&&this.$cellname.val(typeof e=="string"?e:e.asc_getName())},tipFormula:"Insert Function"},SSE.Views.CellEditor||{})}),define("spreadsheeteditor/main/app/controller/CellEditor",["core","spreadsheeteditor/main/app/view/CellEditor"],function(e){SSE.Controllers.CellEditor=Backbone.Controller.extend({views:["CellEditor"],events:function(){return{"keyup input#ce-cell-name":_.bind(this.onCellName,this),"keyup textarea#ce-cell-content":_.bind(this.onKeyupCellEditor,this),"blur textarea#ce-cell-content":_.bind(this.onBlurCellEditor,this),"click button#ce-btn-expand":_.bind(this.expandEditorField,this),"click button#ce-func-label":_.bind(this.onInsertFunction,this)}},initialize:function(){this.addListeners({CellEditor:{},Viewport:{"layout:resizedrag":_.bind(this.onLayoutResize,this)}})},setApi:function(e){return this.api=e,this.api.isCEditorFocused=!1,this.api.asc_registerCallback("asc_onSelectionNameChanged",_.bind(this.onApiCellSelection,this)),this.api.asc_registerCallback("asc_onEditCell",_.bind(this.onApiEditCell,this)),this.api.asc_registerCallback("asc_onСoAuthoringDisconnect",_.bind(this.onApiDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onApiDisconnect,this)),Common.NotificationCenter.on("cells:range",_.bind(this.onCellsRange,this)),this},setMode:function(e){this.mode=e,this.editor.$btnfunc[this.mode.isEdit?"removeClass":"addClass"]("disabled")},onLaunch:function(){this.editor=this.createView("CellEditor",{el:"#cell-editing-box"}).render(),this.bindViewEvents(this.editor,this.events),this.editor.$el.parent().find(".after").css({zIndex:"4"});var e=this;$("#ce-cell-content").keydown(function(t){(Common.UI.Keys.RETURN===t.keyCode||Common.UI.Keys.ESC===t.keyCode)&&e.api.asc_enableKeyEvents(!0)})},onApiEditCell:function(e){e==c_oAscCellEditorState.editStart?this.api.isCellEdited=!0:e==c_oAscCellEditorState.editEnd&&(this.api.isCellEdited=!1,this.api.isCEditorFocused=!1)},onApiCellSelection:function(e){this.editor.updateCellInfo(e)},onApiDisconnect:function(){this.mode.isEdit=!1;var e=this.getApplication().getController("FormulaDialog");e&&e.hideDialog(),this.mode.isEdit||$("#ce-func-label",this.editor.el).addClass("disabled")},onCellsRange:function(e){var t=e!=c_oAscSelectionDialogType.None;t?(this.editor.$cellname.attr("disabled","disabled"),this.editor.$btnfunc.addClass("disabled")):(this.editor.$cellname.removeAttr("disabled"),this.editor.$btnfunc.removeClass("disabled"))},onLayoutResize:function(e,t){t=="cell:edit"&&(this.editor.$el.height()>19?this.editor.$btnexpand.hasClass("btn-collapse")||this.editor.$btnexpand.addClass("btn-collapse"):this.editor.$btnexpand.removeClass("btn-collapse"))},onCellName:function(e){if(e.keyCode==Common.UI.Keys.RETURN){var t=this.editor.$cellname.val();t&&t.length&&this.api.asc_findCell(t),Common.NotificationCenter.trigger("edit:complete",this.editor)}},onBlurCellEditor:function(){this.api.isCEditorFocused=="clear"?this.api.isCEditorFocused=undefined:this.api.isCellEdited&&(this.api.isCEditorFocused=!0)},onKeyupCellEditor:function(e){e.keyCode==Common.UI.Keys.RETURN&&!e.altKey&&(this.api.isCEditorFocused="clear")},expandEditorField:function(){this.editor.$el.height()>19?(this.editor.keep_height=this.editor.$el.height(),this.editor.$el.height(19),this.editor.$btnexpand.removeClass("btn-collapse")):(this.editor.$el.height(this.editor.keep_height||74),this.editor.$btnexpand.addClass("btn-collapse")),Common.NotificationCenter.trigger("layout:changed","celleditor"),Common.NotificationCenter.trigger("edit:complete",this.editor,{restorefocus:!0})},onInsertFunction:function(){if(this.mode.isEdit&&!this.editor.$btnfunc.hasClass("disabled")){var e=this.getApplication().getController("FormulaDialog");e&&($("#ce-func-label",this.editor.el).blur(),this.api.asc_enableKeyEvents(!1),e.showDialog())}}})}),define("common/main/lib/view/ImageFromUrlDialog",["common/main/lib/component/Window"],function(){Common.Views.ImageFromUrlDialog=Common.UI.Window.extend(_.extend({options:{width:330,header:!1,cls:"modal-dlg"},initialize:function(e){_.extend(this.options,e||{}),this.template=[\'<div class="box">\',\'<div class="input-row">\',"<label>"+this.textUrl+"</label>","</div>",\'<div id="id-dlg-url" class="input-row"></div>\',"</div>",\'<div class="footer right">\',\'<button class="btn normal dlg-btn primary" result="ok" style="margin-right: 10px;">\'+this.okButtonText+"</button>",\'<button class="btn normal dlg-btn" result="cancel">\'+this.cancelButtonText+"</button>","</div>"].join(""),this.options.tpl=_.template(this.template,this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var e=this;e.inputUrl=new Common.UI.InputField({el:$("#id-dlg-url"),allowBlank:!1,blankError:e.txtEmpty,style:"width: 100%;",validateOnBlur:!1,validation:function(t){return/((^https?)|(^ftp)):\\/\\/.+/i.test(t)?!0:e.txtNotUrl}});var t=this.getChild();t.find(".btn").on("click",_.bind(this.onBtnClick,this)),t.find("input").on("keypress",_.bind(this.onKeyPress,this))},show:function(){Common.UI.Window.prototype.show.apply(this,arguments);var e=this;_.delay(function(){e.getChild("input").focus()},500)},onKeyPress:function(e){e.keyCode==Common.UI.Keys.RETURN&&this._handleInput("ok")},onBtnClick:function(e){this._handleInput(e.currentTarget.attributes.result.value)},_handleInput:function(e){if(this.options.handler){if(e=="ok"&&this.inputUrl.checkValidate()!==!0){this.inputUrl.cmpEl.find("input").focus();return}this.options.handler.call(this,e,this.inputUrl.getValue())}this.close()},textUrl:"Paste an image URL:",cancelButtonText:"Cancel",okButtonText:"Ok",txtEmpty:"This field is required",txtNotUrl:\'This field should be a URL in the format "http://www.example.com"\'},Common.Views.ImageFromUrlDialog||{}))}),define("text!spreadsheeteditor/main/app/template/Toolbar.template",[],function(){return\'<div class="toolbar" style="<%= (isCompactView || isEditDiagram) ? \\\'height: 41px;\\\' : \\\'height: 67px;\\\' %>">\\n    <!----------------------->\\n    <!-- Edit diagram mode -->\\n    <!----------------------->\\n    <div id="id-toolbar-diagramm" style="<%= isEditDiagram ? \\\'display: table;\\\' : \\\'display: none;\\\' %> width: 100%;" >\\n        <div class="toolbar-group">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-diagram-placeholder-btn-copy"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-diagram-placeholder-btn-paste"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-diagram-placeholder-btn-undo"></span>\\n                <span class="btn-placeholder" id="id-toolbar-diagram-placeholder-btn-redo"></span>\\n            </div>\\n        </div>\\n        <div class="separator short"></div>\\n        <div class="toolbar-group">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-diagram-placeholder-btn-formula"></span>\\n            </div>\\n        </div>\\n        <div class="separator short" style="margin-left: 5px;"></div>\\n        <div class="toolbar-group">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-diagram-placeholder-btn-digit-dec"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-diagram-placeholder-btn-digit-inc"></span>\\n                <span class="btn-placeholder border" id="id-toolbar-diagram-placeholder-btn-format" style="width: 84px; margin-left: 10px;"></span>\\n            </div>\\n        </div>\\n        <div class="separator short"></div>\\n        <div class="toolbar-group">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder border" id="id-toolbar-diagram-placeholder-btn-chart" style="width: auto;"></span>\\n            </div>\\n        </div>\\n        <div class="toolbar-group" style="width: 100%;"></div>\\n    </div>\\n    <!------------------------>\\n    <!-- Short view toolbar -->\\n    <!------------------------>\\n    <div id="id-toolbar-short" style="<%= (!isCompactView || isEditDiagram) ? \\\'display: none;\\\' : \\\'display: table;\\\' %> width: 100%;" >\\n        <div class="toolbar-group no-mask">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-print"></span>\\n                <span class="btn-placeholder" id="id-toolbar-short-placeholder-btn-save"></span>\\n            </div>\\n        </div>\\n        <div class="separator short"></div>\\n        <div class="toolbar-group">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-undo"></span>\\n                <span class="btn-placeholder" id="id-toolbar-short-placeholder-btn-redo"></span>\\n            </div>\\n        </div>\\n        <div class="separator short"></div>\\n        <div class="toolbar-group">\\n            <div class="toolbar-row" style="width: 140px; margin-top: -1px;">\\n                <span class="btn-placeholder" style="float: left; width: 90px;" id="id-toolbar-short-placeholder-field-fontname"></span>\\n                <span class="btn-placeholder" style="float: left; width: 45px; margin-left: 2px;" id="id-toolbar-short-placeholder-field-fontsize"></span>\\n            </div>\\n        </div>\\n        <div class="toolbar-group">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-bold"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-italic"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-underline"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-fontcolor"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-fillparag"></span>\\n            </div>\\n        </div>\\n        <div class="separator short" style="margin-left: 5px;"></div>\\n        <div class="toolbar-group">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-borders"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-halign"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-valign"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-merge"></span>\\n                <span class="btn-placeholder" id="id-toolbar-short-placeholder-btn-wrap"></span>\\n            </div>\\n        </div>\\n        <div class="separator short"></div>\\n        <div class="toolbar-group">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-insertimage"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-inserthyperlink"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-insertchart"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-insertshape"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-formula"></span>\\n            </div>\\n        </div>\\n        <div class="separator short" style="margin-left: 5px;"></div>\\n        <div class="toolbar-group">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-filter"></span>\\n                <span class="btn-placeholder border" id="id-toolbar-short-placeholder-btn-format" style="width: 84px; margin-left: 7px;"></span>\\n            </div>\\n        </div>\\n        <div class="separator short"></div>\\n        <div class="toolbar-group">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder" id="id-toolbar-short-placeholder-btn-copystyle"></span>\\n            </div>\\n        </div>\\n        <!--<div class="separator short"></div>-->\\n        <!--<div class="toolbar-group">-->\\n            <!--<div class="toolbar-row">-->\\n                <!--<span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-cell-ins"></span>-->\\n                <!--<span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-cell-del"></span>-->\\n            <!--</div>-->\\n        <!--</div>-->\\n        <div class="toolbar-group" style="width: 100%;"></div>\\n        <div class="toolbar-group no-mask" style="padding-left:0;">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-short-placeholder-btn-hidebars"></span>\\n            </div>\\n        </div>\\n    </div>\\n    <!------------------------>\\n    <!-- Fully view toolbar -->\\n    <!------------------------>\\n    <div id="id-toolbar-full" style="<%= (isCompactView || isEditDiagram)? \\\'display: none;\\\' : \\\'display: table;\\\' %> width: 100%;" >\\n        <div class="toolbar-group toolbar-group-native">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder" id="id-toolbar-full-placeholder-btn-newdocument"></span>\\n            </div>\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder" id="id-toolbar-full-placeholder-btn-opendocument"></span>\\n            </div>\\n        </div>\\n        <div class="toolbar-group no-mask">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-print"></span>\\n            </div>\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder" id="id-toolbar-full-placeholder-btn-save"></span>\\n            </div>\\n        </div>\\n        <div class="separator long" style="margin-left: 5px;"></div>\\n        <div class="toolbar-group">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-copy"></span>\\n                <span class="btn-placeholder" id="id-toolbar-full-placeholder-btn-paste"></span>\\n            </div>\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-undo"></span>\\n                <span class="btn-placeholder" id="id-toolbar-full-placeholder-btn-redo"></span>\\n            </div>\\n        </div>\\n        <div class="separator long"></div>\\n        <div class="toolbar-group">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder" style="float: left; width: 90px;" id="id-toolbar-full-placeholder-field-fontname"></span>\\n                <span class="btn-placeholder" style="float: left; width: 45px; margin-left: 2px;" id="id-toolbar-full-placeholder-field-fontsize"></span>\\n                <span class="btn-placeholder border" id="id-toolbar-full-placeholder-btn-incfont" style="margin-left: 2px;"></span>\\n                <span class="btn-placeholder border" id="id-toolbar-full-placeholder-btn-decfont" style="margin-left: 2px;"></span>\\n            </div>\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-bold"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-italic"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-underline"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-fontcolor"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-fillparag"></span>\\n                <div class="separator short" style="margin: 0 6px;"></div>\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-borders"></span>\\n            </div>\\n        </div>\\n        <div class="separator long"></div>\\n        <div class="toolbar-group">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-top"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-middle"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-bottom"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-wrap"></span>\\n                <span class="btn-placeholder" id="id-toolbar-full-placeholder-btn-text-orient"></span>\\n            </div>\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-align-left"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-align-center"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-align-right"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-align-just"></span>\\n                <span class="btn-placeholder" id="id-toolbar-full-placeholder-btn-merge"></span>\\n            </div>\\n        </div>\\n        <div class="separator long"></div>\\n        <div class="toolbar-group">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-insertimage"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-insertchart"></span>\\n                <span class="btn-placeholder" id="id-toolbar-full-placeholder-btn-text"></span>\\n            </div>\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-formula"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-inserthyperlink"></span>\\n                <span class="btn-placeholder " id="id-toolbar-full-placeholder-btn-insertshape"></span>\\n            </div>\\n        </div>\\n        <div class="separator long"></div>\\n        <div class="toolbar-group">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-sortdesc"></span>\\n                <span class="btn-placeholder" id="id-toolbar-full-placeholder-btn-sortasc"></span>\\n            </div>\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-setfilter"></span>\\n                <span class="btn-placeholder" id="id-toolbar-full-placeholder-btn-clear-filter"></span>\\n            </div>\\n        </div>\\n        <div class="separator long"></div>\\n        <div class="toolbar-group">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder border" id="id-toolbar-full-placeholder-btn-format" style="width: 100%;"></span>\\n            </div>\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-percents"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-currency"></span>\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-digit-dec"></span>\\n                <span class="btn-placeholder" id="id-toolbar-full-placeholder-btn-digit-inc"></span>\\n            </div>\\n        </div>\\n        <div class="separator long"></div>\\n        <div class="toolbar-group">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder" id="id-toolbar-full-placeholder-btn-cell-ins"></span>\\n            </div>\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder" id="id-toolbar-full-placeholder-btn-cell-del"></span>\\n            </div>\\n        </div>\\n        <div class="separator long"></div>\\n        <div class="toolbar-group">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder" id="id-toolbar-full-placeholder-btn-clear"></span>\\n            </div>\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder" id="id-toolbar-full-placeholder-btn-copystyle"></span>\\n            </div>\\n        </div>\\n        <div class="toolbar-group">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-colorschemas"></span>\\n            </div>\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder" id="id-toolbar-full-placeholder-btn-table-tpl"></span>\\n            </div>\\n        </div>\\n        <div class="toolbar-group" id="id-toolbar-full-placeholder-field-styles" style="width: 100%; min-width: 100px;">\\n        </div>\\n        <div class="toolbar-group no-mask">\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder split" id="id-toolbar-full-placeholder-btn-hidebars"></span>\\n            </div>\\n            <div class="toolbar-row">\\n                <span class="btn-placeholder" id="id-toolbar-full-placeholder-btn-settings"></span>\\n            </div>\\n        </div>\\n    </div>\\n</div>\'});if(Common===undefined)var Common={};Common.Models=Common.Models||{},define("common/main/lib/model/Font",["backbone"],function(e){Common.Models.Font=e.Model.extend({defaults:function(){return{id:Common.UI.getId(),name:null,cloneid:null,imgidx:0,type:0}}})});if(Common===undefined)var Common={};Common.Collections=Common.Collections||{},define("common/main/lib/collection/Fonts",["backbone","common/main/lib/model/Font"],function(e){Common.Collections.Fonts=e.Collection.extend({model:Common.Models.Font})});if(Common===undefined)var Common={};define("common/main/lib/component/Button",["common/main/lib/component/BaseView","common/main/lib/component/ToggleManager"],function(){Common.UI.Button=Common.UI.BaseView.extend({options:{id:null,hint:!1,enableToggle:!1,allowDepress:!0,toggleGroup:null,cls:"",iconCls:"",caption:"",menu:null,disabled:!1,pressed:!1,split:!1},template:_.template(["<% if (menu == null) { %>",\'<button type="button" class="btn <%= cls %>" id="<%= id %>" style="<%= style %>">\',\'<span class="caption"><%= caption %></span>\',\'<% if (iconCls != "") { %>\',\'<span class="btn-icon <%= iconCls %>">&nbsp;</span>\',"<% } %>","</button>","<% } else if (split == false) {%>",\'<div class="btn-group" id="<%= id %>" style="<%= style %>">\',\'<button type="button" class="btn dropdown-toggle <%= cls %>" data-toggle="dropdown">\',\'<span class="caption"><%= caption %></span>\',\'<% if (iconCls != "") { %>\',\'<span class="btn-icon <%= iconCls %>">&nbsp;</span>\',"<% } %>",\'<span class="caret"></span>\',"</button>","</div>","<% } else { %>",\'<div class="btn-group split" id="<%= id %>" style="<%= style %>">\',\'<button type="button" class="btn <%= cls %>">\',\'<span class="caption"><%= caption %></span>\',\'<% if (iconCls != "") { %>\',\'<span class="btn-icon <%= iconCls %>">&nbsp;</span>\',"<% } %>","</button>",\'<button type="button" class="btn <%= cls %> dropdown-toggle" data-toggle="dropdown">\',\'<span class="caret"></span>\',\'<span class="sr-only"></span>\',"</button>","</div>","<% } %>"].join("")),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e);var t=this;t.id=t.options.id||Common.UI.getId(),t.hint=t.options.hint,t.enableToggle=t.options.enableToggle,t.allowDepress=t.options.allowDepress,t.cls=t.options.cls,t.iconCls=t.options.iconCls,t.menu=t.options.menu,t.split=t.options.split,t.toggleGroup=t.options.toggleGroup,t.disabled=t.options.disabled,t.pressed=t.options.pressed,t.caption=t.options.caption,t.template=t.options.template||t.template,t.style=t.options.style,t.rendered=!1,t.options.el&&t.render()},render:function(e){var t=this;t.trigger("render:before",t),t.cmpEl=$(t.el),e&&(t.setElement(e,!1),t.rendered||(t.cmpEl=$(this.template({id:t.id,cls:t.cls,iconCls:t.iconCls,menu:t.menu,split:t.split,disabled:t.disabled,pressed:t.pressed,caption:t.caption,style:t.style})),t.menu&&_.isFunction(t.menu.render)&&t.menu.render(t.cmpEl),e.html(t.cmpEl)));if(!t.rendered){var n=t.cmpEl,r=n.hasClass("btn-group"),i=n.hasClass("split");if(t.options.hint){var s=t.cmpEl.closest(".asc-window");t.cmpEl.attr("data-toggle","tooltip"),t.cmpEl.tooltip({title:t.options.hint,placement:t.options.hintAnchor||"cursor"}),s.length>0&&t.cmpEl.data("bs.tooltip").tip().css("z-index",parseInt(s.css("z-index"))+10)}_.isString(t.toggleGroup)&&(t.enableToggle=!0);var o=function(e){if(!t.disabled&&e.which==1){t.doToggle();if(t.options.hint){var n=t.cmpEl.data("bs.tooltip");n&&(n.dontShow===undefined&&(n.dontShow=!0),n.hide())}t.trigger("click",t,e)}},u=function(e,r){if(!e){var s=!1;_.each($("button",n),function(e){if($(e).is(":hover"))return s=!0,!1}),s||(n.removeClass("over"),$("button",n).removeClass("over"))}if(!e&&t.enableToggle&&t.allowDepress&&t.pressed)return;if(e&&!i&&t.enableToggle&&t.allowDepress&&!t.pressed){r.preventDefault();return}$("button:first",n).toggleClass("active",e),$("[data-toggle^=dropdown]",n).toggleClass("active",e),n.toggleClass("active",e)},a=function(e){if(!t.disabled&&e.which==1&&i){if(t.options.hint){var r=t.cmpEl.data("bs.tooltip");r&&(r.dontShow===undefined&&(r.dontShow=!0),r.hide())}var s=n.hasClass("open");u(!s,e)}},f=function(e,t){i?u(t,e):(n.toggleClass("active",t),$("button",n).toggleClass("active",t))},l=function(e){u(!0,e),$(document).on("mouseup",c)},c=function(e){u(!1,e),$(document).off("mouseup",c)},h=function(e){t.cmpEl.find(".dropdown-toggle").blur()};r?(i&&($("[data-toggle^=dropdown]",n).on("mousedown",_.bind(a,this)),$("button",n).on("mousedown",_.bind(l,this))),n.on("hide.bs.dropdown",_.bind(u,t,!1)),n.on("show.bs.dropdown",_.bind(u,t,!0)),n.on("hidden.bs.dropdown",_.bind(h,t)),$("button:first",n).on("click",o)):n.on("click",o),n.on("button.internal.active",_.bind(f,t)),n.on("mouseover",function(e){t.disabled||(t.cmpEl.addClass("over"),t.trigger("mouseover",t,e))}),n.on("mouseout",function(e){t.disabled||(t.cmpEl.removeClass("over"),t.trigger("mouseout",t,e))}),Common.UI.ToggleManager.register(t)}return t.rendered=!0,t.pressed&&t.toggle(t.pressed,!0),t.disabled&&t.setDisabled(t.disabled),t.trigger("render:after",t),this},doToggle:function(){var e=this;e.enableToggle&&(e.allowDepress!==!1||!e.pressed)&&e.toggle()},toggle:function(e,t){var n=e===undefined?!this.pressed:!!e;this.pressed=n,this.cmpEl&&this.cmpEl.trigger("button.internal.active",[n]),t||this.trigger("toggle",this,n)},isActive:function(){return this.enableToggle?this.pressed:this.cmpEl.hasClass("active")},setDisabled:function(e){if(this.rendered){var t=this.cmpEl,n=t.hasClass("btn-group");e=e===!0;if(e!==t.hasClass("disabled")){var r=function(t){t.toggleClass("disabled",e),e?t.attr({disabled:e}):t.removeAttr("disabled")};r(t),n&&r(t.children("button"))}if(e){var i=this.cmpEl.data("bs.tooltip");i&&i.hide()}}this.disabled=e},isDisabled:function(){return this.disabled},setIconCls:function(e){var t=$(this.el).find("span.btn-icon"),n=this.iconCls;this.iconCls=e,t.removeClass(n),t.addClass(e||"")},setVisible:function(e){this.cmpEl.toggleClass("hidden",!e)},updateHint:function(e){this.options.hint=e;var t=this.cmpEl,n=t.closest(".asc-window");t.attr("data-toggle","tooltip"),t.tooltip("destroy").tooltip({title:e,placement:this.options.hintAnchor||"cursor"}),n.length>0&&t.data("bs.tooltip").tip().css("z-index",parseInt(n.css("z-index"))+10)},setCaption:function(e){if(this.caption!=e){this.caption=e;if(this.rendered){var t=this.cmpEl.find("button:first > .caption").andSelf().filter("button > .caption");t.length>0?t.text(e):this.cmpEl.find("button:first").andSelf().filter("button").text(e)}}}})});if(Common===undefined)var Common={};define("common/main/lib/component/ColorPalette",["common/main/lib/component/BaseView"],function(){Common.UI.ColorPalette=Common.UI.BaseView.extend({options:{allowReselect:!0,cls:"",style:""},template:_.template([\'<div class="palette-color">\',"<% _.each(colors, function(color, index) { %>",\'<span class="color-item" data-color="<%= color %>" style="background-color: #<%= color %>;"></span>\',"<% }) %>","</div>"].join("")),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e);var t=this;this.id=t.options.id,this.cls=t.options.cls,this.style=t.options.style,this.colors=t.options.colors||[],this.value=t.options.value,t.options.el&&t.render()},render:function(e){var t=this;t.rendered?this.cmpEl=$(this.el):(this.cmpEl=$(this.template({id:this.id,cls:this.cls,style:this.style,colors:this.colors})),e?(this.setElement(e,!1),e.html(this.cmpEl)):$(this.el).html(this.cmpEl));if(!t.rendered){var n=this.cmpEl;n.on("click","span.color-item",_.bind(this.itemClick,this))}return t.rendered=!0,this},itemClick:function(e){var t=$(e.target);this.select(t.attr("data-color"))},select:function(e,t){if(this.value!=e){var n=this;$("span.color-item",this.cmpEl).removeClass("selected"),this.value=e,e&&/#?[a-fA-F0-9]{6}/.test(e)&&(e=/#?([a-fA-F0-9]{6})/.exec(e)[1].toUpperCase(),$("span[data-color="+e+"]",this.cmpEl).addClass("selected"),t||n.trigger("select",n,this.value))}}})}),define("text!common/main/lib/template/ExtendedColorDialog.template",[],function(){return\'<div class="color-box">\\r\\n    <div id="id-hsb-colorpicker" style="vertical-align:top;">\\r\\n    </div>\\r\\n    <div class="color-info" style="">\\r\\n        <div style="margin-left:15px;">\\r\\n            <label class="color-label"><%= txtNew %></label>\\r\\n            <div id="field-new-color" class="color-cnt top"></div>\\r\\n            <div id="field-start-color" class="color-cnt bottom"></div>\\r\\n            <label class="color-label"><%= txtCurrent %></label>\\r\\n        </div>\\r\\n        <div style="padding:13px 0 2px 0;">\\r\\n            <label class="input-label">R:</label>\\r\\n            <div id="extended-spin-r" class="color-spin"></div>\\r\\n        </div>\\r\\n        <div style="padding:2px 0;">\\r\\n            <label class="input-label">G:</label>\\r\\n            <div id="extended-spin-g" class="color-spin"></div>\\r\\n        </div>\\r\\n        <div style="padding:2px 0;">\\r\\n            <label class="input-label">B:</label>\\r\\n            <div id="extended-spin-b" class="color-spin"></div>\\r\\n        </div>\\r\\n        <div style="padding:11px 0 0 0;">\\r\\n            <label class="input-label" style="width:12px;">#:</label>\\r\\n            <input id="extended-text-color" type="text" role="textbox" style="width:62px; height: 22px;">\\r\\n        </div>\\r\\n    </div>\\r\\n</div>\\r\\n<div class="footer center">\\r\\n    <button class="btn normal dlg-btn primary" result="1"><%= txtAdd %></button>\\r\\n    <button class="btn normal dlg-btn" result="0"><%= txtCancel %></button>\\r\\n</div>\\r\\n\'});if(Common===undefined)var Common={};define("common/main/lib/component/HSBColorPicker",["common/main/lib/component/BaseView","common/main/lib/util/utils"],function(){Common.UI.HSBColorPicker=Common.UI.BaseView.extend({template:_.template(\'<div class="hsb-colorpicker"><% if (this.showCurrentColor) { %><div class="top-panel"><span class="color-value"><span class="transparent-color"></span></span><div class="color-text"></div></div><% } %><div><div class="cnt-hb"><div class="cnt-hb-arrow"></div></div><% if (this.changeSaturation) { %><div class="cnt-root"><div class="cnt-sat"><div class="cnt-sat-arrow"></div></div></div><% } %></div><% if (this.allowEmptyColor) { %><div class="empty-color"><%= this.textNoColor %></div><% } %></div>\'),color:"#ff0000",options:{allowEmptyColor:!1,changeSaturation:!0,showCurrentColor:!0},initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e);var t=this,n=$(this.el),r,i,s,o,u,a,f,l,c=0,h=100,p=100;t.allowEmptyColor=t.options.allowEmptyColor,t.changeSaturation=t.options.changeSaturation,t.showCurrentColor=t.options.showCurrentColor;var d=function(e,n){var r=new Common.Utils.RGBColor("hsb("+e.h+","+e.s+","+e.b+")"),i=r.toHex();t.color=n?"transparent":i,v(),t.trigger("changecolor",t,t.color)},v=function(){u.length>0&&a.length>0&&(t.color=="transparent"?a.show():(u.css("background-color",t.color),a.hide())),s.length>0&&s.css("background-color",(new Common.Utils.RGBColor("hsb("+c+", 100, 100)")).toHex()),f.length>0&&(f[0].innerHTML=t.color=="transparent"?t.textNoColor:t.color.toUpperCase()),r.length>0&&i.length>0&&(r.css("left",h+"%"),r.css("top",100-p+"%"),i.css("top",parseInt(c*100/360)+"%"))},m=function(e,t,n){if(r.length>0&&s.length>0){var i=[Math.max(0,Math.min(100,parseInt((e.pageX-s.offset().left)/s.width()*100))),Math.max(0,Math.min(100,parseInt((e.pageY-s.offset().top)/s.height()*100)))];r.css("left",i[0]+"%"),r.css("top",i[1]+"%"),h=i[0],p=100-i[1],d({h:c,s:h,b:p})}},g=function(e,t,n){if(i&&o){var r=Math.max(0,Math.min(100,parseInt((e.pageY-o.offset().top)/o.height()*100)));i.css("top",r+"%"),c=parseInt(360*r/100),d({h:c,s:h,b:p})}},y=function(e,t,n){$(document).on("mouseup",b),$(document).on("mousemove",m)},b=function(e,t,n){$(document).off("mouseup",b),$(document).off("mousemove",m),m(e,t,n)},w=function(e,t,n){$(document).on("mouseup",E),$(document).on("mousemove",g),g(e,t,n)},E=function(e,t,n){$(document).off("mouseup",E),$(document).off("mousemove",g)},S=function(e){var n=(new Common.util.RGBColor(t.color)).toHSB();d(n,!0)},x=function(e){var n=$(t.el),d;n&&(r=n.find(".cnt-hb-arrow"),i=n.find(".cnt-sat-arrow"),s=n.find(".cnt-hb"),o=n.find(".cnt-sat"),u=n.find(".color-value"),f=n.find(".color-text"),l=n.find(".empty-color"),u.length>0&&(a=u.find(".transparent-color")),s.length>0&&(s.off("mousedown"),s.on("mousedown",y)),o.length>0&&(o.off("mousedown"),o.on("mousedown",w)),l.length>0&&(l.off("click"),l.on("click",S)),t.color=="transparent"?d={h:0,s:100,b:100}:d=(new Common.Utils.RGBColor(t.color)).toHSB(),c=d.h,h=d.s,p=d.b,c==h&&c==p&&c==0&&(h=100),v())};t.setColor=function(e){if(t.color==e)return;var n;e=="transparent"?n={h:0,s:100,b:100}:n=(new Common.Utils.RGBColor(e)).toHSB(),c=n.h,h=n.s,p=n.b,c==h&&c==p&&c==0&&(h=100),t.color=e,v()},t.getColor=function(){return t.color},t.on("render:after",x),t.render()},render:function(){return $(this.el).html(this.template()),this.trigger("render:after",this),this},textNoColor:"No Color"})});if(Common===undefined)var Common={};define("common/main/lib/component/MaskedField",["common/main/lib/component/BaseView"],function(){Common.UI.MaskedField=Common.UI.BaseView.extend({options:{maskExp:"",maxLength:999},initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e);var t=this,n=$(this.el);n.addClass("masked-field"),n.attr("maxlength",t.options.maxLength),n.on("keypress",function(e){var r=String.fromCharCode(e.which);!t.options.maskExp.test(r)&&!e.ctrlKey&&e.keyCode!==Common.UI.Keys.DELETE&&e.keyCode!==Common.UI.Keys.BACKSPACE&&e.keyCode!==Common.UI.Keys.LEFT&&e.keyCode!==Common.UI.Keys.RIGHT&&e.keyCode!==Common.UI.Keys.HOME&&e.keyCode!==Common.UI.Keys.END&&e.keyCode!==Common.UI.Keys.ESC&&e.keyCode!==Common.UI.Keys.INSERT&&e.keyCode!==Common.UI.Keys.TAB&&(e.keyCode==Common.UI.Keys.RETURN&&t.trigger("changed",t,n.val()),e.preventDefault(),e.stopPropagation())}),n.on("input",function(e){t.trigger("change",t,n.val())}),n.on("blur",function(e){t.trigger("changed",t,n.val())})},render:function(){return this},setValue:function(e){this.options.maskExp.test(e)&&e.length<=this.options.maxLength&&$(this.el).val(e)},getValue:function(){$(this.el).val()}})});if(Common===undefined)var Common={};define("common/main/lib/view/ExtendedColorDialog",["text!common/main/lib/template/ExtendedColorDialog.template","common/main/lib/component/HSBColorPicker","common/main/lib/component/MetricSpinner","common/main/lib/component/MaskedField","common/main/lib/component/Window"],function(e){Common.UI.ExtendedColorDialog=Common.UI.Window.extend(_.extend({tpl:_.template(e),options:{},rendered:!1,initialize:function(e){Common.UI.Window.prototype.initialize.call(this,{cls:"extended-color-dlg",tpl:this.tpl({txtNew:this.textNew,txtCurrent:this.textCurrent,txtAdd:this.addButtonText,txtCancel:this.cancelButtonText}),header:!1,width:340,height:272}),this.hexRe=/\\s*#?([0-9a-fA-F][0-9a-fA-F]?)([0-9a-fA-F][0-9a-fA-F]?)([0-9a-fA-F][0-9a-fA-F]?)\\s*/},render:function(){function t(t){e.trigger("onmodalresult",parseInt(t.currentTarget.attributes.result.value)),e.close(!0)}var e=this;return Common.UI.Window.prototype.render.call(this),this.colorsPicker=new Common.UI.HSBColorPicker({el:$("#id-hsb-colorpicker"),showCurrentColor:!1}),this.colorsPicker.on("changecolor",_.bind(this.onChangeColor,this)),this.colorNew=$("#field-new-color"),this.colorSaved=$("#field-start-color"),this.spinR=new Common.UI.MetricSpinner({el:$("#extended-spin-r"),step:1,width:63,value:"0",defaultUnit:"",maxValue:255,minValue:0,tabindex:1,maskExp:/[0-9]/,allowDecimal:!1}),this.spinG=new Common.UI.MetricSpinner({el:$("#extended-spin-g"),step:1,width:63,value:"0",defaultUnit:"",maxValue:255,minValue:0,tabindex:2,maskExp:/[0-9]/,allowDecimal:!1}),this.spinB=new Common.UI.MetricSpinner({el:$("#extended-spin-b"),step:1,width:63,value:"0",defaultUnit:"",maxValue:255,minValue:0,tabindex:3,maskExp:/[0-9]/,allowDecimal:!1}),this.textColor=new Common.UI.MaskedField({el:$("#extended-text-color"),width:55,maskExp:/[a-fA-F0-9]/,maxLength:6}),this.spinR.on("change",_.bind(this.showColor,this,null,!0)).on("changing",_.bind(this.onChangingRGB,this,1)),this.spinG.on("change",_.bind(this.showColor,this,null,!0)).on("changing",_.bind(this.onChangingRGB,this,2)),this.spinB.on("change",_.bind(this.showColor,this,null,!0)).on("changing",_.bind(this.onChangingRGB,this,3)),this.textColor.on("change",_.bind(this.onChangeMaskedField,this)),this.textColor.on("changed",_.bind(this.onChangedMaskedField,this)),this.textColor.$el.attr("tabindex",4),this.spinR.$el.find("input").attr("maxlength",3),this.spinG.$el.find("input").attr("maxlength",3),this.spinB.$el.find("input").attr("maxlength",3),this.on("close",function(){e.trigger("onmodalresult",0)}),$(this)[0].getChild(".footer .dlg-btn").on("click",t),this.rendered=!0,this.color!==undefined&&this.setColor(this.color),this},onChangeColor:function(e,t){this.colorNew.css({"background-color":t}),this.stopevents=!0;var n=t.match(this.hexRe);this.spinR.setValue(parseInt(n[1],16)),this.spinG.setValue(parseInt(n[2],16)),this.spinB.setValue(parseInt(n[3],16)),this.textColor.setValue((n[1]+n[2]+n[3]).toUpperCase()),this.stopevents=!1},showColor:function(e,t){if(!this.stopevents){var n=this.spinR.getNumberValue(),r=n==null||n<0?0:n>255?255:n;t&&this.spinR.setValue(r,!0),r=r.toString(16),n=this.spinG.getNumberValue();var i=n==null||n<0?0:n>255?255:n;t&&this.spin

]]></string> </value>
        </item>
        <item>
            <key> <string>next</string> </key>
            <value>
              <persistent> <string encoding="base64">AAAAAAAAAAc=</string> </persistent>
            </value>
        </item>
      </dictionary>
    </pickle>
  </record>
  <record id="7" aka="AAAAAAAAAAc=">
    <pickle>
      <global name="Pdata" module="OFS.Image"/>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>data</string> </key>
            <value> <string encoding="cdata"><![CDATA[

G.setValue(i,!0),i=i.toString(16),n=this.spinB.getNumberValue();var s=n==null||n<0?0:n>255?255:n;t&&this.spinB.setValue(s,!0),s=s.toString(16);var o=(r.length==1?"0"+r:r)+(i.length==1?"0"+i:i)+(s.length==1?"0"+s:s);this.colorsPicker.setColor("#"+o),e!="hex"&&this.textColor.setValue(o.toUpperCase()),this.colorNew.css("background-color","#"+o)}},onChangingRGB:function(e,t,n,r){if(!this.stopevents){var i,s,o,u;n=_.isEmpty(n)||isNaN(parseInt(n))?parseInt(t.getValue()):parseInt(n);switch(e){case 1:i=(n==null||isNaN(n)||n<0?0:n>255?255:n).toString(16),u=this.spinG.getNumberValue(),s=(u==null||u<0?0:u>255?255:u).toString(16),u=this.spinB.getNumberValue(),o=(u==null||u<0?0:u>255?255:u).toString(16);break;case 2:u=this.spinR.getNumberValue(),i=(u==null||u<0?0:u>255?255:u).toString(16),s=(n==null||isNaN(n)||n<0?0:n>255?255:n).toString(16),u=this.spinB.getNumberValue(),o=(u==null||u<0?0:u>255?255:u).toString(16);break;case 3:u=this.spinR.getNumberValue(),i=(u==null||u<0?0:u>255?255:u).toString(16),u=this.spinG.getNumberValue(),s=(u==null||u<0?0:u>255?255:u).toString(16),o=(n==null||isNaN(n)||n<0?0:n>255?255:n).toString(16)}var a=(i.length==1?"0"+i:i)+(s.length==1?"0"+s:s)+(o.length==1?"0"+o:o);this.colorsPicker.setColor("#"+a),this.textColor.setValue(a.toUpperCase()),this.colorNew.css("background-color","#"+a)}},onChangeMaskedField:function(e,t){t=/^[a-fA-F0-9]{0,6}$/.test(t)?t:"000000",t="000000"+t;var n=t.match(/([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/i);this.stopevents=!0,this.spinR.setValue(parseInt(n[1],16)),this.spinG.setValue(parseInt(n[2],16)),this.spinB.setValue(parseInt(n[3],16)),this.stopevents=!1,this.rendered&&this.showColor("hex")},onChangedMaskedField:function(e,t){var n=this;(!/^[a-fA-F0-9]{0,6}$/.test(t)||_.isEmpty(t))&&e.setValue("000000"),this.rendered&&this.showColor("",!0)},getColor:function(){var e=/#?([a-fA-F0-9]{6})/.exec(this.colorsPicker.getColor());return e?e[1]:null},setColor:function(e){function r(){e=="transparent"?t.colorSaved.addClass("color-transparent"):(t.colorSaved.removeClass("color-transparent"),t.colorSaved.css("background-color","#"+e)),t.colorNew.css("background-color","#"+n)}var t=this;if(this.rendered!==!0){this.color=e;return}var n=/#?([a-fA-F0-9]{6})/.test(e)?e:"ff0000";t.colorsPicker.setColor("#"+n),r(),t.stopevents=!0;var i=t.hexRe.exec(n);t.spinR.setValue(parseInt(i[1],16)),t.spinG.setValue(parseInt(i[2],16)),t.spinB.setValue(parseInt(i[3],16)),t.textColor.setValue((i[1]+i[2]+i[3]).toUpperCase()),t.stopevents=!1},show:function(){Common.UI.Window.prototype.show.apply(this,arguments);var e=this;_.delay(function(){e.getChild("#extended-text-color").focus()},50)},cancelButtonText:"Cancel",addButtonText:"Add",textNew:"New",textCurrent:"Current",textRGBErr:"The entered value is incorrect.<br>Please enter a numeric value between 0 and 255.",textHexErr:"The entered value is incorrect.<br>Please enter a value between 000000 and FFFFFF."},Common.UI.ExtendedColorDialog||{}))});if(Common===undefined)var Common={};define("common/main/lib/component/ThemeColorPalette",["common/main/lib/component/BaseView","common/main/lib/view/ExtendedColorDialog"],function(){Common.UI.ThemeColorPalette=Common.UI.BaseView.extend({options:{dynamiccolors:10,allowReselect:!0,value:"000000"},template:_.template(\'<div style="padding: 12px;"><% var me = this; %><% $(colors).each(function(num, item) { %><% if (me.isBlankSeparator(item)) { %> <div class="palette-color-spacer" style="width:100%;height:8px;float:left;"></div><% } else if (me.isSeparator(item)) { %> </div><div class="palette-color-separator" style="width:100%;height:1px;float:left;border-bottom: 1px solid #E0E0E0"></div><div style="padding: 12px;"><% } else if (me.isColor(item)) { %> <a class="palette-color color-<%=item%>" style="background:#<%=item%>" hidefocus="on"><em><span style="background:#<%=item%>;" unselectable="on">&#160;</span></em></a><% } else if (me.isTransparent(item)) { %><a class="color-<%=item%>" hidefocus="on"><em><span unselectable="on">&#160;</span></em></a><% } else if (me.isEffect(item)) { %><a effectid="<%=item.effectId%>" effectvalue="<%=item.effectValue%>" class="palette-color-effect color-<%=item.color%>" style="background:#<%=item.color%>" hidefocus="on"><em><span style="background:#<%=item.color%>;" unselectable="on">&#160;</span></em></a><% } else if (me.isCaption(item)) { %><div class="palette-color-caption" style="width:100%;float:left;font-size: 11px;"><%=item%></div><% } %><% }); %></div><% if (me.options.dynamiccolors!==undefined) { %><div class="palette-color-spacer" style="width:100%;height:8px;float:left;"></div><div style="padding: 12px;"><% for (var i=0; i<me.options.dynamiccolors; i++) { %><a class="color-dynamic-<%=i%> dynamic-empty-color" style="background:#ffffff" color="" hidefocus="on"><em><span unselectable="on">&#160;</span></em></a><% } %><% } %></div>\'),colorRe:/(?:^|\\s)color-(.{6})(?:\\s|$)/,selectedCls:"selected",initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e);var t=this,n=$(this.el);this.colors=t.options.colors||[{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:3},{color:"FFFFFF",effectId:4},{color:"000000",effectId:5},{color:"FF0000",effectId:1},{color:"FF6600",effectId:1},{color:"FFFF00",effectId:2},{color:"CCFFCC",effectId:3},{color:"008000",effectId:4},"-","--","-","000000","5301B3","980ABD","B2275F","F83D26","F86A1D","F7AC16","F7CA12","FAFF44","D6EF39"],n.addClass("theme-colorpalette"),this.render(),this.options.updateColorsArr&&this.updateColors(this.options.updateColorsArr[0],this.options.updateColorsArr[1]),this.options.value&&this.select(this.options.value,!0),this.updateCustomColors(),n.closest(".btn-group").on("show.bs.dropdown",_.bind(this.updateCustomColors,this)),n.closest(".dropdown-submenu").on("show.bs.dropdown",_.bind(this.updateCustomColors,this)),n.on("click",_.bind(this.handleClick,this))},render:function(){return $(this.el).html(this.template({colors:this.colors})),this},isBlankSeparator:function(e){return typeof e=="string"&&e=="-"},isSeparator:function(e){return typeof e=="string"&&e=="--"},isColor:function(e){return typeof e=="string"&&/[0-9A-F]{6}/.test(e)},isTransparent:function(e){return typeof e=="string"&&e=="transparent"},isCaption:function(e){return typeof e=="string"&&e!="-"&&e!="--"&&!/[0-9A-F]{6}|transparent/.test(e)},isEffect:function(e){return typeof e=="object"&&e.effectId!==undefined},getColor:function(){return this.value},updateCustomColors:function(){var e=$(this.el);if(e){var t=localStorage["asc."+window.storagename+".colors.custom"];t=t?t.split(","):[];var n=-1,r,i=t.length<this.options.dynamiccolors?t.length:this.options.dynamiccolors;while(++n<i)r=e.find(".color-dynamic-"+n),r.removeClass("dynamic-empty-color").attr("color",t[n]),r.find("span").css({"background-color":"#"+t[n]})}},handleClick:function(e){var t=this,n=$(e.target).closest("a"),r,i;if(n.length==0)return;if(n.hasClass("color-transparent"))$(t.el).find("a."+t.selectedCls).removeClass(t.selectedCls),n.addClass(t.selectedCls),t.value="transparent",t.trigger("select",t,"transparent");else if(n[0].className.search("color-dynamic")<0){if(!/^[a-fA-F0-9]{6}$/.test(t.value)||_.indexOf(t.colors,t.value)<0)t.value=!1;$(t.el).find("a."+t.selectedCls).removeClass(t.selectedCls),n.addClass(t.selectedCls),r=n[0].className.match(t.colorRe)[1];if(n.hasClass("palette-color-effect")){var s=parseInt(n.attr("effectid"));r&&(t.value=r.toUpperCase(),t.trigger("select",t,{color:r,effectId:s}))}else/#?[a-fA-F0-9]{6}/.test(r)&&(r=/#?([a-fA-F0-9]{6})/.exec(r)[1].toUpperCase(),t.value=r,t.trigger("select",t,r))}else/dynamic-empty-color/.test(n[0].className)?setTimeout(function(){t.addNewColor()},10):($(t.el).find("a."+t.selectedCls).removeClass(t.selectedCls),n.addClass(t.selectedCls),r=n.attr("color"),r&&t.trigger("select",t,r),t.value=r.toUpperCase())},setCustomColor:function(e){var t=$(this.el);e=/#?([a-fA-F0-9]{6})/.exec(e);if(e){this.saveCustomColor(e[1]),t.find("a."+this.selectedCls).removeClass(this.selectedCls);var n=t.find(".dynamic-empty-color");n.length==0&&(this.updateCustomColors(),n=t.find(".color-dynamic-"+(this.options.dynamiccolors-1))),n.first().removeClass("dynamic-empty-color").addClass(this.selectedCls).attr("color",e[1]),n.first().find("span").css({"background-color":"#"+e[1]}),this.select(e[1],!0)}},saveCustomColor:function(e){var t=localStorage["asc."+window.storagename+".colors.custom"];t=t?t.split(","):[],t.push(e)>this.options.dynamiccolors&&t.shift(),localStorage["asc."+window.storagename+".colors.custom"]=t.join().toUpperCase()},addNewColor:function(e){var t=this,n=new Common.UI.ExtendedColorDialog({});n.on("onmodalresult",function(e){t._isdlgopen=!1,e==1&&(t.setCustomColor(n.getColor()),t.fireEvent("select",t,n.getColor()))}),t._isdlgopen=!0,n.setColor(t.value!==undefined&&t.value!==!1?t.value:e!==undefined?e:"000000"),n.show()},isDialogOpen:function(){return this._isdlgopen==1},select:function(e,t){var n=$(this.el);n.find("a."+this.selectedCls).removeClass(this.selectedCls);if(typeof e=="object"){var r;e.effectId!==undefined?(r=n.find(\'a[effectid="\'+e.effectId+\'"]\').first(),r.length>0?(r.addClass(this.selectedCls),this.value=r[0].className.match(this.colorRe)[1].toUpperCase()):this.value=!1):e.effectValue!==undefined&&(r=n.find(\'a[effectvalue="\'+e.effectValue+\'"].color-\'+e.color.toUpperCase()).first(),r.length>0?(r.addClass(this.selectedCls),this.value=r[0].className.match(this.colorRe)[1].toUpperCase()):this.value=!1)}else{/#?[a-fA-F0-9]{6}/.test(e)&&(e=/#?([a-fA-F0-9]{6})/.exec(e)[1].toUpperCase(),this.value=e);if(/^[a-fA-F0-9]{6}|transparent$/.test(e)&&_.indexOf(this.colors,e)>=0){_.indexOf(this.colors,this.value)<0&&(this.value=!1);if(e!=this.value||this.options.allowReselect)e=="transparent"?n.find("a.color-transparent").addClass(this.selectedCls):n.find("a.palette-color.color-"+e).first().addClass(this.selectedCls),this.value=e,t!==!0&&this.fireEvent("select",this,e)}else{var i=n.find("#"+e).first();i.length==0&&(i=n.find(\'a[color="\'+e+\'"]\').first()),i.length>0&&(i.addClass(this.selectedCls),this.value=e.toUpperCase())}}},updateColors:function(e,t){if(e===undefined||t===undefined)return;var n=this,r=$(this.el);n.aColorElements===undefined&&(n.aColorElements=r.find("a.palette-color")),n.aEffectElements===undefined&&(n.aEffectElements=r.find("a.palette-color-effect"));var i,s=0,o=0;for(var u=0;u<n.colors.length;u++)if(typeof n.colors[u]=="string"&&/[0-9A-F]{6}/.test(n.colors[u])){if(s>=t.length)continue;i=$(n.aColorElements[s]),i.removeClass("color-"+n.colors[u]),n.colors[u]=t[s].toUpperCase(),i.addClass("color-"+n.colors[u]),i.css({background:"#"+n.colors[u]}),i.find("span").first().css({background:"#"+n.colors[u]}),s++}else if(typeof n.colors[u]=="object"&&n.colors[u].effectId!==undefined){if(o>=e.length)continue;i=$(n.aEffectElements[o]),e[o].color=e[o].color.toUpperCase(),n.colors[u].color!==e[o].color&&(i.removeClass("color-"+n.colors[u].color),i.addClass("color-"+e[o].color),i.css({background:"#"+e[o].color}),i.find("span").first().css({background:"#"+e[o].color})),n.colors[u].effectId!==e[o].effectId&&i.attr("effectid",""+e[o].effectId),n.colors[u].effectValue!==e[o].effectValue&&i.attr("effectvalue",""+e[o].effectValue),n.colors[u]=e[o],o++}this.options.updateColorsArr=undefined},clearSelection:function(e){$(this.el).find("a."+this.selectedCls).removeClass(this.selectedCls),this.value=undefined}})});if(Common===undefined)var Common={};define("common/main/lib/component/DimensionPicker",["common/main/lib/component/BaseView"],function(){Common.UI.DimensionPicker=Common.UI.BaseView.extend(function(){var e,t,n,r,i,s,o=0,u=0,a=function(t){e.setTableSize(Math.ceil((t.offsetX===undefined?t.originalEvent.layerX:t.offsetX)/e.itemSize),Math.ceil((t.offsetY===undefined?t.originalEvent.layerY:t.offsetY)/e.itemSize),t)},f=function(t){e.setTableSize(0,0,t)},l=function(t){e.trigger("select",e,o,u,t)};return{options:{itemSize:18,minRows:5,minColumns:5,maxRows:20,maxColumns:20},template:_.template([\'<div style="width: 100%; height: 100%;">\',\'<div class="dimension-picker-status">0x0</div>\',\'<div class="dimension-picker-observecontainer">\',\'<div class="dimension-picker-mousecatcher"></div>\',\'<div class="dimension-picker-unhighlighted"></div>\',\'<div class="dimension-picker-highlighted"></div>\',"</div>","</div>"].join("")),initialize:function(c){Common.UI.BaseView.prototype.initialize.call(this,c),e=this,t=$(this.el),e.itemSize=e.options.itemSize,e.minRows=e.options.minRows,e.minColumns=e.options.minColumns,e.maxRows=e.options.maxRows,e.maxColumns=e.options.maxColumns,this.render(),t&&(n=t.find(".dimension-picker-mousecatcher"),r=t.find(".dimension-picker-unhighlighted"),i=t.find(".dimension-picker-highlighted"),s=t.find(".dimension-picker-status"),t.css({width:e.minColumns+"em"}),n.css("z-index",1),n.width(e.maxColumns+"em").height(e.maxRows+"em"),r.width(e.minColumns+"em").height(e.minRows+"em"),s.html(o+" x "+u),s.width(r.width())),n.on("mousemove",a),i.on("mousemove",a),r.on("mousemove",a),n.on("mouseleave",f),i.on("mouseleave",f),r.on("mouseleave",f),n.on("click",l),i.on("click",l),r.on("click",l)},render:function(){return $(this.el).html(this.template()),this},setTableSize:function(n,a,f){n>this.maxColumns&&(n=this.maxColumns),a>this.maxRows&&(a=this.maxRows);if(o!=n||u!=a)o=n,u=a,i.width(o+"em").height(u+"em"),r.width((o<e.minColumns?e.minColumns:o+1>e.maxColumns?e.maxColumns:o+1)+"em").height((u<e.minRows?e.minRows:u+1>e.maxRows?e.maxRows:u+1)+"em"),t.width(r.width()),s.html(o+" x "+u),s.width(r.width()),e.trigger("change",e,o,u,f)},getColumnsCount:function(){return o},getRowsCount:function(){return u}}}())});if(Common===undefined)var Common={};var FONT_TYPE_RECENT=4;define("common/main/lib/component/ComboBoxFonts",["common/main/lib/component/ComboBox"],function(){Common.UI.ComboBoxFonts=Common.UI.ComboBox.extend(function(){var e=302,t=FONT_THUMBNAIL_HEIGHT||26,n=window.devicePixelRatio>1,r=document.createElement("canvas"),i=r.getContext("2d"),s="../../../sdk/Common/Images/fonts_thumbnail.png",o="../../../sdk/Common/Images/fonts_thumbnail@2x.png",u=36;return typeof window["AscDesktopEditor"]=="object"&&(s=window.AscDesktopEditor.getFontsSprite(),o=window.AscDesktopEditor.getFontsSprite(!0)),r.height=n?t*2:t,r.width=n?e*2:e,{template:_.template([\'<div class="input-group combobox fonts <%= cls %>" id="<%= id %>" style="<%= style %>">\',\'<input type="text" class="form-control">\',\'<div style="display: table-cell;"></div>\',\'<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>\',\'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">\',\'<li class="divider">\',"<% _.each(items, function(item) { %>",\'<li id="<%= item.id %>">\',\'<a class="font-item" tabindex="-1" type="menuitem" style="vertical-align:middle; margin: 0 0 0 -10px; height:<%=scope.getListItemHeight()%>px;"/>\',"</li>","<% }); %>","</ul>","</div>"].join("")),initialize:function(e){Common.UI.ComboBox.prototype.initialize.call(this,_.extend(e,{displayField:"name"})),this.recent=_.isNumber(e.recent)?e.recent:3,this.bindUpdateVisibleFontsTiles=_.bind(this.updateVisibleFontsTiles,this),Common.NotificationCenter.on("fonts:change",_.bind(this.onApiChangeFont,this)),Common.NotificationCenter.on("fonts:load",_.bind(this.fillFonts,this))},render:function(e){var t=null;return _.isUndefined(this._input)||(t=this._input.val()),Common.UI.ComboBox.prototype.render.call(this,e),this.setRawValue(t),this._input.on("keyup",_.bind(this.onInputKeyUp,this)),this._input.on("keydown",_.bind(this.onInputKeyDown,this)),this.scroller.update({alwaysVisibleY:!0,onChange:this.bindUpdateVisibleFontsTiles}),this},onAfterKeydownMenu:function(e){var t=this;if(e.keyCode==Common.UI.Keys.RETURN)return $(e.target).closest("input").length?this.lastValue!==this._input.val()&&this._input.trigger("change"):($(e.target).click(),this.rendered&&(Common.Utils.isIE?this._input.trigger("change",{onkeydown:!0}):this._input.blur())),!1;if(e.keyCode==Common.UI.Keys.ESC&&this.isMenuOpen())return this._input.val(this.lastValue),setTimeout(function(){t.closeMenu(),t.onAfterHideMenu(e)},10),!1;(e.keyCode==Common.UI.Keys.HOME||e.keyCode==Common.UI.Keys.END||e.keyCode==Common.UI.Keys.BACKSPACE)&&this.isMenuOpen()&&setTimeout(function(){t._input.focus()},10),this.updateVisibleFontsTiles()},onInputKeyUp:function(e){if(e.keyCode!=Common.UI.Keys.RETURN&&e.keyCode!==Common.UI.Keys.SHIFT&&e.keyCode!==Common.UI.Keys.CTRL&&e.keyCode!==Common.UI.Keys.ALT&&e.keyCode!==Common.UI.Keys.LEFT&&e.keyCode!==Common.UI.Keys.RIGHT&&e.keyCode!==Common.UI.Keys.HOME&&e.keyCode!==Common.UI.Keys.END&&e.keyCode!==Common.UI.Keys.ESC&&e.keyCode!==Common.UI.Keys.INSERT&&e.keyCode!==Common.UI.Keys.TAB){e.stopPropagation(),this.selectCandidate(e.keyCode==Common.UI.Keys.DELETE||e.keyCode==Common.UI.Keys.BACKSPACE);if(this._selectedItem){var t=this;setTimeout(function(){var e=t._input[0],n=t._selectedItem.get(t.displayField),r=e.value;if(t.rendered)if(document.selection)document.selection.createRange().text=n;else if(e.selectionStart||e.selectionStart=="0")e.value=n,e.selectionStart=r.length,e.selectionEnd=n.length},10)}}},onInputKeyDown:function(e){var t=this;e.keyCode==Common.UI.Keys.ESC?(this._input.val(this.lastValue),setTimeout(function(){t.closeMenu(),t.onAfterHideMenu(e)},10)):e.keyCode!=Common.UI.Keys.RETURN&&e.keyCode!=Common.UI.Keys.CTRL&&e.keyCode!=Common.UI.Keys.SHIFT&&e.keyCode!=Common.UI.Keys.ALT&&(this.isMenuOpen()||this.openMenu(),e.keyCode==Common.UI.Keys.UP||e.keyCode==Common.UI.Keys.DOWN?_.delay(function(){var e=t.cmpEl.find("ul li.selected a");e.length<=0&&(e=t.cmpEl.find("ul li:not(.divider):first a")),t._skipInputChange=!0,e.focus(),t.updateVisibleFontsTiles()},10):t._skipInputChange=!1)},onInputChanged:function(e,t){if(t&&t.synthetic)return;if(this._skipInputChange){this._skipInputChange=!1;return}if(this._isMouseDownMenu){this._isMouseDownMenu=!1;return}var n=$(e.target).val(),r={};if(this.lastValue===n){t&&t.onkeydown&&this.trigger("combo:blur",this,e);return}r[this.valueField]=n,r[this.displayField]=n,this.trigger("changed:before",this,r,e);if(e.isDefaultPrevented())return;this._selectedItem?(r[this.valueField]=this._selectedItem.get(this.displayField),this.setRawValue(r[this.valueField]),this.trigger("selected",this,_.extend({},this._selectedItem.toJSON()),e),this.addItemToRecent(this._selectedItem),this.closeMenu()):(this.setRawValue(r[this.valueField]),r.isNewFont=!0,this.trigger("selected",this,r,e),this.closeMenu()),this.trigger("changed:after",this,r,e)},getImageUri:function(s){if(s.cloneid){var o=$(this.el).find("ul > li#"+s.cloneid+" img");return o!=null?o[0].src:undefined}return n?(i.clearRect(0,0,e*2,t*2),i.drawImage(this.spriteThumbs,0,-FONT_THUMBNAIL_HEIGHT*2*s.imgidx)):(i.clearRect(0,0,e,t),i.drawImage(this.spriteThumbs,0,-FONT_THUMBNAIL_HEIGHT*s.imgidx)),r.toDataURL()},getImageWidth:function(){return e},getImageHeight:function(){return t},getListItemHeight:function(){return u},loadSprite:function(e){e&&(this.spriteThumbs=new Image,this.spriteThumbs.onload=e,this.spriteThumbs.src=window.devicePixelRatio>1?o:s)},fillFonts:function(e,t){var n=this;this.loadSprite(function(){n.store.set(e.toJSON()),n.rendered=!1,n.render($(n.el)),n._fontsArray=n.store.toJSON(),n.recent>0&&(n.store.on("add",n.onInsertItem,n),n.store.on("remove",n.onRemoveItem,n))})},onApiChangeFont:function(e){var t=_.isFunction(e.get_Name)?e.get_Name():e.asc_getName();if(this.getRawValue()!==t){var n=this.store.findWhere({name:t});$(".selected",$(this.el)).removeClass("selected");if(n){this.setRawValue(n.get(this.displayField));var r=$("#"+n.get("id"),$(this.el)),i=$("ul.dropdown-menu",this.cmpEl);r&&i&&(r.addClass("selected"),this.recent<=0&&i.scrollTop(r.offset().top-i.offset().top))}else this.setRawValue(t)}},itemClicked:function(e){var t=$(e.target).closest("li"),n=this.store.findWhere({id:t.attr("id")});this.addItemToRecent(n),Common.UI.ComboBox.prototype.itemClicked.apply(this,arguments)},onInsertItem:function(e){$(this.el).find("ul").prepend(_.template([\'<li id="<%= item.id %>">\',\'<a class="font-item" tabindex="-1" type="menuitem" style="vertical-align:middle; margin: 0 0 0 -10px; height:<%=scope.getListItemHeight()%>px;"/>\',"</li>"].join(""),{item:e.attributes,scope:this}))},onRemoveItem:function(e,t,n){$(this.el).find("ul > li#"+e.id).remove()},onBeforeShowMenu:function(e){Common.UI.ComboBox.prototype.onBeforeShowMenu.apply(this,arguments);if(!this.getSelectedRecord()&&!!this.getRawValue()){var t=this.store.where({name:this.getRawValue()});t&&t.length&&this.selectRecord(t[t.length-1])}},onAfterShowMenu:function(e){this.recent>0?(this.scroller&&!this._scrollerIsInited&&(this.scroller.update(),this._scrollerIsInited=!0),$(this.el).find("ul").scrollTop(0),this.trigger("show:after",this,e)):Common.UI.ComboBox.prototype.onAfterShowMenu.apply(this,arguments),this.flushVisibleFontsTiles(),this.updateVisibleFontsTiles(null,0)},onAfterHideMenu:function(e){this.lastValue!==this._input.val()&&this._input.val(this.lastValue),Common.UI.ComboBox.prototype.onAfterHideMenu.apply(this,arguments)},addItemToRecent:function(e){if(e.get("type")!=FONT_TYPE_RECENT&&!this.store.findWhere({name:e.get("name"),type:FONT_TYPE_RECENT})){var t=this.store.where({type:FONT_TYPE_RECENT});t.length<this.recent||this.store.remove(t[this.recent-1]);var n=e.clone();n.set({type:FONT_TYPE_RECENT,id:Common.UI.getId(),cloneid:e.id}),this.store.add(n,{at:0})}},selectCandidate:function(e){var t=this,n=this._input.val().toLowerCase();this._fontsArray||(this._fontsArray=this.store.toJSON());var r=_.find(this._fontsArray,function(r){return e?r[t.displayField].toLowerCase()==n:r[t.displayField].toLowerCase().indexOf(n)==0});r?this._selectedItem=this.store.findWhere({id:r.id}):this._selectedItem=null,$(".selected",$(this.el)).removeClass("selected");if(this._selectedItem){var i=$("#"+this._selectedItem.get("id"),$(this.el)),s=$("ul[role=menu]",$(this.el));if(i.length>0&&s.length>0){i.addClass("selected");var o=i.position().top,u=s.scrollTop();o!=0&&s.scrollTop(u+o)}}},updateVisibleFontsTiles:function(r,i){var s=this,o=0,a=s.store.length,f=0;s.tiles||(s.tiles=[]);if(a!==s.tiles.length)for(o=s.tiles.length;o<a;++o)s.tiles.push(null);_.isUndefined(i)&&(i=parseInt($(s.el).find(".ps-scrollbar-x-rail").css("bottom")));var l=$(s.el).find(".dropdown-menu").height(),c=Math.max(Math.floor(l/u)+3,0),h=Math.max(Math.floor(-(i/u))-1,0),p=h+c,d=$(s.el).find("a");for(o=0;o<a;++o)if(h<=o&&o<p){if(null===s.tiles[o]){var v=document.createElement("canvas"),m=v.getContext("2d");v.height=n?t*2:t,v.width=n?e*2:e,v.style.width=e+"px",v.style.height=t+"px",f=s.store.at(o).get("imgidx"),n?(m.clearRect(0,0,e*2,t*2),m.drawImage(s.spriteThumbs,0,-FONT_THUMBNAIL_HEIGHT*2*f)):(m.clearRect(0,0,e,t),m.drawImage(s.spriteThumbs,0,-FONT_THUMBNAIL_HEIGHT*f)),s.tiles[o]=v,$(d[o]).get(0).appendChild(v)}}else s.tiles[o]&&(s.tiles[o].parentNode.removeChild(s.tiles[o]),s.tiles[o]=null)},flushVisibleFontsTiles:function(){for(var e=this.tiles.length-1;e>=0;--e)this.tiles[e]&&(this.tiles[e].parentNode.removeChild(this.tiles[e]),this.tiles[e]=null)}}}())});if(Common===undefined)var Common={};define("common/main/lib/component/ComboDataView",["common/main/lib/component/BaseView","common/main/lib/component/DataView"],function(){Common.UI.ComboDataView=Common.UI.BaseView.extend({options:{id:null,cls:"",style:"",hint:!1,itemWidth:80,itemHeight:40,menuMaxHeight:300,enableKeyEvents:!1,beforeOpenHandler:null},template:_.template([\'<div id="<%= id %>" class="combo-dataview <%= cls %>" style="<%= style %>">\',\'<div class="view"></div> \',\'<div class="button"></div> \',"</div>"].join("")),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e),this.id=this.options.id||Common.UI.getId(),this.cls=this.options.cls,this.style=this.options.style,this.hint=this.options.hint,this.store=this.options.store||new Common.UI.DataViewStore,this.itemWidth=this.options.itemWidth,this.itemHeight=this.options.itemHeight,this.menuMaxHeight=this.options.menuMaxHeight,this.beforeOpenHandler=this.options.beforeOpenHandler,this.rootWidth=0,this.rootHeight=0,this.rendered=!1,this.fieldPicker=new Common.UI.DataView({cls:"field-picker",allowScrollbar:!1,itemTemplate:_.template([\'<div class="style" id="<%= id %>">\',\'<img src="<%= imageUrl %>" width="\'+this.itemWidth+\'" height="\'+this.itemHeight+\'"/>\',\'<% if (typeof title !== "undefined") {%>\',\'<span class="title"><%= title %></span>\',"<% } %>","</div>"].join(""))}),this.openButton=new Common.UI.Button({cls:"open-menu",menu:new Common.UI.Menu({menuAlign:"tl-bl",offset:[0,3],items:[{template:_.template(\'<div class="menu-picker-container"></div>\')}]})}),this.menuPicker=new Common.UI.DataView({cls:"menu-picker",parentMenu:this.openButton.menu,restoreHeight:this.menuMaxHeight,style:"max-height: "+this.menuMaxHeight+"px;",enableKeyEvents:this.options.enableKeyEvents,itemTemplate:_.template([\'<div class="style" id="<%= id %>">\',\'<img src="<%= imageUrl %>" width="\'+this.itemWidth+\'" height="\'+this.itemHeight+\'"/>\',\'<% if (typeof title !== "undefined") {%>\',\'<span class="title"><%= title %></span>\',"<% } %>","</div>"].join(""))}),setInterval(_.bind(this.checkSize,this),500),this.options.el&&this.render()},render:function(e){if(!this.rendered){var t=this;t.trigger("render:before",t),t.cmpEl=$(t.el);var n=t.template({id:t.id,cls:t.cls,style:t.style});e?(t.setElement(e,!1),t.cmpEl=$(n),e.html(t.cmpEl)):t.cmpEl.html(n),t.rootWidth=t.cmpEl.width(),t.rootHeight=t.cmpEl.height(),t.fieldPicker.render($(".view",t.cmpEl)),t.openButton.render($(".button",t.cmpEl)),t.menuPicker.render($(".menu-picker-container",t.cmpEl)),t.openButton.menu.cmpEl&&t.openButton.menu.cmpEl&&(t.openButton.menu.menuAlignEl=t.cmpEl,t.openButton.menu.cmpEl.css("min-width",t.itemWidth),t.openButton.menu.on("show:before",_.bind(t.onBeforeShowMenu,t)),t.openButton.menu.on("show:after",_.bind(t.onAfterShowMenu,t)),t.openButton.cmpEl.on("hide.bs.dropdown",_.bind(t.onBeforeHideMenu,t)),t.openButton.cmpEl.on("hidden.bs.dropdown",_.bind(t.onAfterHideMenu,t))),t.options.hint&&(t.cmpEl.attr("data-toggle","tooltip"),t.cmpEl.tooltip({title:t.options.hint,placement:t.options.hintAnchor||"cursor"})),t.fieldPicker.on("item:select",_.bind(t.onFieldPickerSelect,t)),t.menuPicker.on("item:select",_.bind(t.onMenuPickerSelect,t)),t.fieldPicker.on("item:click",_.bind(t.onFieldPickerClick,t)),t.menuPicker.on("item:click",_.bind(t.onMenuPickerClick,t)),t.onResize(),t.rendered=!0,t.trigger("render:after",t)}return this},checkSize:function(){if(this.cmpEl){var e=this.cmpEl.width(),t=this.cmpEl.height();if(this.rootWidth!=e||this.rootHeight!=t)this.rootWidth=e,this.rootHeight=t,this.onResize()}},onResize:function(){if(this.openButton){var e=$("button",this.openButton.cmpEl);e&&e.css({width:$(".button",this.cmpEl).width(),height:$(".button",this.cmpEl).height()}),this.openButton.menu.hide();var t=this.menuPicker;if(t){var n=t.getSelectedRec();n&&(n=n[0],this.fillComboView(n||t.store.at(0),!!n,!0))}}this.isSuspendEvents||this.trigger("resize",this)},onBeforeShowMenu:function(e){var t=this;if(_.isFunction(t.beforeOpenHandler))t.beforeOpenHandler(t,e);else if(t.openButton.menu.cmpEl){var n=0;try{var r=$($(".dropdown-menu .dataview.inner .style",t.cmpEl)[0]);n=r?parseInt(r.css("margin-left"))+parseInt(r.css("margin-right")):0}catch(e){}t.openButton.menu.cmpEl.css({width:Math.round((t.cmpEl.width()+n*t.fieldPicker.store.length)/t.itemWidth-.2)*(t.itemWidth+n),"min-height":this.cmpEl.height()})}if(t.options.hint){var i=t.cmpEl.data("bs.tooltip");i&&(i.dontShow===undefined&&(i.dontShow=!0),i.hide())}},onBeforeHideMenu:function(e){this.trigger("hide:before",this,e),Common.UI.Scroller.isMouseCapture()&&e.preventDefault()},onAfterShowMenu:function(e){var t=this;t.menuPicker.scroller&&t.menuPicker.scroller.update({includePadding:!0,suppressScrollX:!0,alwaysVisibleY:!0})},onAfterHideMenu:function(e){this.trigger("hide:after",this,e)},onFieldPickerSelect:function(e,t,n){},onMenuPickerSelect:function(e,t,n){if(this.disabled)return;this.fillComboView(n,!1),n&&!this.isSuspendEvents&&this.trigger("select",this,n)},onFieldPickerClick:function(e,t,n){if(this.disabled)return;this.isSuspendEvents||this.trigger("click",this,n);if(this.options.hint){var r=this.cmpEl.data("bs.tooltip");r&&(r.dontShow===undefined&&(r.dontShow=!0),r.hide())}},onMenuPickerClick:function(e,t,n){if(this.disabled)return;this.isSuspendEvents||this.trigger("click",this,n)},setDisabled:function(e){this.disabled=e;if(!this.rendered)return;this.cmpEl.toggleClass("disabled",e),$("button",this.openButton.cmpEl).toggleClass("disabled",e),this.fieldPicker.setDisabled(e)},isDisabled:function(){return this.disabled},fillComboView:function(e,t,n){if(!_.isUndefined(e)&&e instanceof Backbone.Model){var r=this,i=r.menuPicker.store,s=$(r.fieldPicker.el);if(i){if(n||!r.fieldPicker.store.findWhere({id:e.get("id")})){if(r.itemMarginLeft===undefined){var o=$($(this.menuPicker.el).find(".inner > div:not(.grouped-data):not(.ps-scrollbar-x-rail):not(.ps-scrollbar-y-rail)")[0]);o.length>0&&(r.itemMarginLeft=parseInt(o.css("margin-left")),r.itemMarginRight=parseInt(o.css("margin-right")),r.itemPaddingLeft=parseInt(o.css("padding-left")),r.itemPaddingRight=parseInt(o.css("padding-right")),r.itemBorderLeft=parseInt(o.css("border-left-width")),r.itemBorderRight=parseInt(o.css("border-right-width")))}r.fieldPicker.store.reset([]);var u=i.indexOf(e),a=i.length,f=Math.floor(s.width()/(r.itemWidth+(r.itemMarginLeft||0)+(r.itemMarginRight||0)+(r.itemPaddingLeft||0)+(r.itemPaddingRight||0)+(r.itemBorderLeft||0)+(r.itemBorderRight||0))),l=[];s.height()/r.itemHeight>2&&(f*=Math.floor(s.height()/r.itemHeight));if(u<0)return;u=Math.floor(u/f)*f;for(var c=u,h=0;c<a&&h<f;c++,h++)l.push(i.at(c));r.fieldPicker.store.add(l)}if(t){var p=r.fieldPicker.store.findWhere({id:e.get("id")});p&&(r.suspendEvents(),r.fieldPicker.selectRecord(p,!0),r.resumeEvents())}}}},selectByIndex:function(e){e<0&&this.fieldPicker.deselectAll(),this.menuPicker.selectByIndex(e)},setItemWidth:function(e){this.itemWidth!=e&&(this.itemWidth=window.devicePixelRatio>1?e/2:e)},setItemHeight:function(e){this.itemHeight!=e&&(this.itemHeight=window.devicePixelRatio>1?e/2:e)}})});if(Common===undefined)var Common={};define("common/main/lib/component/SynchronizeTip",["common/main/lib/component/BaseView"],function(){Common.UI.SynchronizeTip=Common.UI.BaseView.extend(_.extend(function(){var e;return{options:{target:$(document.body)},template:_.template([\'<div class="synch-tip-root">\',\'<div class="asc-synchronizetip">\',\'<div class="tip-arrow"></div>\',"<div>",\'<div style="width: 260px;"><%= scope.textSynchronize %></div>\',\'<div class="close"></div>\',"</div>",\'<div class="show-link"><label><%= scope.textDontShow %></label></div>\',"</div>","</div>"].join("")),initialize:function(e){this.textSynchronize+=Common.Utils.String.platformKey("Ctrl+S"),Common.UI.BaseView.prototype.initialize.call(this,e),this.target=this.options.target},render:function(){return e=$(this.template({scope:this})),e.find(".close").on("click",_.bind(function(){this.trigger("closeclick")},this)),e.find(".show-link label").on("click",_.bind(function(){this.trigger("dontshowclick")},this)),$(document.body).append(e),this.applyPlacement(),this},show:function(){e?(this.applyPlacement(),e.show()):this.render()},hide:function(){e&&e.hide()},applyPlacement:function(){var t=this.target.offset();e.css({top:t.top+this.target.height()/2+"px",left:t.left+this.target.width()+"px"})},textDontShow:"Don\'t show this message again",textSynchronize:"The document has been changed by another user.<br/>Please click to save your changes and reload the updates."}}(),Common.UI.SynchronizeTip||{}))}),define("spreadsheeteditor/main/app/view/Toolbar",["jquery","underscore","backbone","text!spreadsheeteditor/main/app/template/Toolbar.template","common/main/lib/collection/Fonts","common/main/lib/component/Button","common/main/lib/component/ComboBox","common/main/lib/component/DataView","common/main/lib/component/ColorPalette","common/main/lib/component/ThemeColorPalette","common/main/lib/component/Menu","common/main/lib/component/DimensionPicker","common/main/lib/component/Window","common/main/lib/component/ComboBoxFonts","common/main/lib/component/ComboDataView","common/main/lib/component/SynchronizeTip"],function(e,t,n,r){SSE.enumLock={editCell:"cell-editing",editFormula:"is-formula",editText:"is-text",selImage:"sel-image",selShape:"sel-shape",selShapeText:"sel-shape-txt",selChart:"sel-chart",selChartText:"sel-chart-txt",selRange:"sel-range",lostConnect:"disconnect",coAuth:"co-auth",ruleMerge:"rule-btn-merge",ruleFilter:"rule-filter",ruleDelFilter:"rule-clear-filter",menuFileOpen:"menu-file-open"},SSE.Views.Toolbar=n.View.extend(t.extend({el:"#toolbar",template:t.template(r),events:{},initialize:function(){function i(){return{isDummy:!0,on:function(){}}}var n=this,r={};JSON.parse(window.localStorage.getItem("sse-hidden-title"))&&(r.title=!0),JSON.parse(window.localStorage.getItem("sse-hidden-formula"))&&(r.formula=!0),JSON.parse(window.localStorage.getItem("sse-hidden-headings"))&&(r.headings=!0),n.isCompactView=!!JSON.parse(window.localStorage.getItem("sse-toolbar-compact")),n.SchemeNames=[n.txtScheme1,n.txtScheme2,n.txtScheme3,n.txtScheme4,n.txtScheme5,n.txtScheme6,n.txtScheme7,n.txtScheme8,n.txtScheme9,n.txtScheme10,n.txtScheme11,n.txtScheme12,n.txtScheme13,n.txtScheme14,n.txtScheme15,n.txtScheme16,n.txtScheme17,n.txtScheme18,n.txtScheme19,n.txtScheme20,n.txtScheme21],n._state={hasCollaborativeChanges:undefined},n.btnSaveCls="btn-save",n.btnSaveTip=this.tipSave+Common.Utils.String.platformKey("Ctrl+S"),n.ascFormatOptions={General:"General",Number:"0.00",Currency:"$#,##0.00",Accounting:\'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)\',DateShort:"m/d/yyyy",DateLong:"[$-F800]dddd, mmmm dd, yyyy",Time:"[$-F400]h:mm:ss AM/PM",Percentage:"0.00%",Percent:"0%",Fraction:"# ?/?",Scientific:"0.00E+00",Text:"@"},n.numFormatTypes={},n.numFormatTypes[c_oAscNumFormatType.General]=n.txtGeneral,n.numFormatTypes[c_oAscNumFormatType.Custom]=n.txtCustom,n.numFormatTypes[c_oAscNumFormatType.Text]=n.txtText,n.numFormatTypes[c_oAscNumFormatType.Number]=n.txtNumber,n.numFormatTypes[c_oAscNumFormatType.Integer]=n.txtInteger,n.numFormatTypes[c_oAscNumFormatType.Scientific]=n.txtScientific,n.numFormatTypes[c_oAscNumFormatType.Currency]=n.txtCurrency,n.numFormatTypes[c_oAscNumFormatType.Accounting]=n.txtAccounting,n.numFormatTypes[c_oAscNumFormatType.Date]=n.txtDate,n.numFormatTypes[c_oAscNumFormatType.Time]=n.txtTime,n.numFormatTypes[c_oAscNumFormatType.Percent]=n.txtPercentage,n.numFormatTypes[c_oAscNumFormatType.Fraction]="Fraction";var s=SSE.enumLock;n.cmbFontSize=new Common.UI.ComboBox({cls:"input-group-nr",menuStyle:"min-width: 55px;",hint:n.tipFontSize,lock:[s.selImage,s.editFormula,s.selRange,s.coAuth,s.lostConnect],data:[{value:8,displayValue:"8"},{value:9,displayValue:"9"},{value:10,displayValue:"10"},{value:11,displayValue:"11"},{value:12,displayValue:"12"},{value:14,displayValue:"14"},{value:16,displayValue:"16"},{value:18,displayValue:"18"},{value:20,displayValue:"20"},{value:22,displayValue:"22"},{value:24,displayValue:"24"},{value:26,displayValue:"26"},{value:28,displayValue:"28"},{value:36,displayValue:"36"},{value:48,displayValue:"48"},{value:72,displayValue:"72"}]}),n.btnNewDocument=new Common.UI.Button({id:"id-toolbar-btn-newdocument",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-newdocument",lock:[s.lostConnect],hint:n.tipNewDocument}),n.btnOpenDocument=new Common.UI.Button({id:"id-toolbar-btn-opendocument",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-opendocument",lock:[s.lostConnect],hint:n.tipOpenDocument}),n.cmbFontName=new Common.UI.ComboBoxFonts({cls:"input-group-nr",menuCls:"scrollable-menu",menuStyle:"min-width: 325px;",hint:n.tipFontName,lock:[s.selImage,s.editFormula,s.selRange,s.coAuth,s.lostConnect],store:new Common.Collections.Fonts}),n.btnPrint=new Common.UI.Button({id:"id-toolbar-btn-print",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-print",split:!0,hint:n.tipPrint+Common.Utils.String.platformKey("Ctrl+P"),lock:[s.editCell],menu:new Common.UI.Menu({items:[{caption:n.textPrint,value:"print"},{caption:n.textPrintOptions,value:"options"}]})}),n.btnSave=new Common.UI.Button({id:"id-toolbar-btn-save",cls:"btn-toolbar btn-toolbar-default",iconCls:n.btnSaveCls,hint:n.btnSaveTip}),n.btnCopy=new Common.UI.Button({id:"id-toolbar-btn-copy",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-copy",hint:n.tipCopy+Common.Utils.String.platformKey("Ctrl+C")}),n.btnPaste=new Common.UI.Button({id:"id-toolbar-btn-paste",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-paste",lock:[s.coAuth,s.lostConnect],hint:n.tipPaste+Common.Utils.String.platformKey("Ctrl+V")}),n.btnUndo=new Common.UI.Button({id:"id-toolbar-btn-undo",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-undo",disabled:!0,lock:[s.lostConnect],hint:n.tipUndo+Common.Utils.String.platformKey("Ctrl+Z")}),n.btnRedo=new Common.UI.Button({id:"id-toolbar-btn-redo",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-redo",disabled:!0,lock:[s.lostConnect],hint:n.tipRedo+Common.Utils.String.platformKey("Ctrl+Y")}),n.btnIncFontSize=new Common.UI.Button({id:"id-toolbar-btn-incfont",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-incfont",lock:[s.selImage,s.editFormula,s.selRange,s.coAuth,s.lostConnect],hint:n.tipIncFont}),n.btnDecFontSize=new Common.UI.Button({id:"id-toolbar-btn-decfont",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-decfont",lock:[s.selImage,s.editFormula,s.selRange,s.coAuth,s.lostConnect],hint:n.tipDecFont}),n.btnBold=new Common.UI.Button({id:"id-toolbar-btn-bold",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-bold",lock:[s.selImage,s.editFormula,s.selRange,s.coAuth,s.lostConnect],hint:n.textBold+Common.Utils.String.platformKey("Ctrl+B"),enableToggle:!0}),n.btnItalic=new Common.UI.Button({id:"id-toolbar-btn-italic",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-italic",lock:[s.selImage,s.editFormula,s.selRange,s.coAuth,s.lostConnect],hint:n.textItalic+Common.Utils.String.platformKey("Ctrl+I"),enableToggle:!0}),n.btnUnderline=new Common.UI.Button({id:"id-toolbar-btn-underline",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-underline",lock:[s.selImage,s.editFormula,s.selRange,s.coAuth,s.lostConnect],hint:n.textUnderline+Common.Utils.String.platformKey("Ctrl+U"),enableToggle:!0}),n.mnuTextColorPicker=i(),n.btnTextColor=(new Common.UI.Button({id:"id-toolbar-btn-fontcolor",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-fontcolor",hint:n.tipFontColor,split:!0,lock:[s.selImage,s.editFormula,s.selRange,s.coAuth,s.lostConnect],menu:new Common.UI.Menu({items:[{template:t.template(\'<div id="id-toolbar-menu-fontcolor" style="width: 165px; height: 220px; margin: 10px;"></div>\')},{template:t.template(\'<a id="id-toolbar-menu-new-fontcolor" style="padding-left:12px;">\'+n.textNewColor+"</a>")}]})})).on("render:after",function(t){var r=e(\'<div class="btn-color-value-line"></div>\');e("button:first-child",t.cmpEl).append(r),r.css("background-color",t.currentColor||"transparent"),n.mnuTextColorPicker=new Common.UI.ThemeColorPalette({el:e("#id-toolbar-menu-fontcolor"),dynamiccolors:10,colors:[n.textThemeColors,"-",{color:"3366FF",effectId:1},{color:"0000FF",effectId:2},{color:"000090",effectId:3},{color:"660066",effectId:4},{color:"800000",effectId:5},{color:"FF0000",effectId:1},{color:"FF6600",effectId:1},{color:"FFFF00",effectId:2},{color:"CCFFCC",effectId:3},{color:"008000",effectId:4},"-",{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:3},{color:"FFFFFF",effectId:4},{color:"000000",effectId:5},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},"-","--","-",n.textStandartColors,"-","3D55FE","5301B3","980ABD","B2275F","F83D26","F86A1D","F7AC16","F7CA12","FAFF44","D6EF39","-","--"]})}),n.mnuBackColorPicker=i(),n.btnBackColor=(new Common.UI.Button({id:"id-toolbar-btn-fillparag",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-fillparag",hint:n.tipPrColor,split:!0,lock:[s.selImage,s.editCell,s.coAuth,s.lostConnect],menu:new Common.UI.Menu({items:[{template:t.template(\'<div id="id-toolbar-menu-paracolor" style="width: 165px; height: 220px; margin: 10px;"></div>\')},{template:t.template(\'<a id="id-toolbar-menu-new-paracolor" style="padding-left:12px;">\'+n.textNewColor+"</a>")}]})})).on("render:after",function(t){var r=e(\'<div class="btn-color-value-line"></div>\');e("button:first-child",t.cmpEl).append(r),r.css("background-color",t.currentColor||"transparent"),n.mnuBackColorPicker=new Common.UI.ThemeColorPalette({el:e("#id-toolbar-menu-paracolor"),dynamiccolors:10,colors:[n.textThemeColors,"-",{color:"3366FF",effectId:1},{color:"0000FF",effectId:2},{color:"000090",effectId:3},{color:"660066",effectId:4},{color:"800000",effectId:5},{color:"FF0000",effectId:1},{color:"FF6600",effectId:1},{color:"FFFF00",effectId:2},{color:"CCFFCC",effectId:3},{color:"008000",effectId:4},"-",{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:3},{color:"FFFFFF",effectId:4},{color:"000000",effectId:5},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},"-","--","-",n.textStandartColors,"-","transparent","5301B3","980ABD","B2275F","F83D26","F86A1D","F7AC16","F7CA12","FAFF44","D6EF39","-","--"]})}),n.mnuBorderColorPicker=i(),n.btnBorders=(new Common.UI.Button({id:"id-toolbar-btn-borders",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-border-out",icls:"btn-border-out",borderId:"outer",borderswidth:"thin",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth],hint:n.tipBorders,split:!0,menu:new Common.UI.Menu({items:[{caption:n.textOutBorders,iconCls:"mnu-border-out",icls:"btn-border-out",borderId:"outer"},{caption:n.textAllBorders,iconCls:"mnu-border-all",icls:"btn-border-all",borderId:"all"},{caption:n.textTopBorders,iconCls:"mnu-border-top",icls:"btn-border-top",borderId:c_oAscBorderOptions.Top},{caption:n.textBottomBorders,iconCls:"mnu-border-bottom",icls:"btn-border-bottom",borderId:c_oAscBorderOptions.Bottom},{caption:n.textLeftBorders,iconCls:"mnu-border-left",icls:"btn-border-left",borderId:c_oAscBorderOptions.Left},{caption:n.textRightBorders,iconCls:"mnu-border-right",icls:"btn-border-right",borderId:c_oAscBorderOptions.Right},{caption:n.textNoBorders,iconCls:"mnu-border-no",icls:"btn-border-no",borderId:"none"},{caption:"--"},{caption:n.textInsideBorders,iconCls:"mnu-border-center",icls:"btn-border-center",borderId:"inner"},{caption:n.textCenterBorders,iconCls:"mnu-border-vmiddle",icls:"btn-border-vmiddle",borderId:c_oAscBorderOptions.InnerV},{caption:n.textMiddleBorders,iconCls:"mnu-border-hmiddle",icls:"btn-border-hmiddle",borderId:c_oAscBorderOptions.InnerH},{caption:n.textDiagUpBorder,iconCls:"mnu-border-diagup",icls:"btn-border-diagup",borderId:c_oAscBorderOptions.DiagU},{caption:n.textDiagDownBorder,iconCls:"mnu-border-diagdown",icls:"btn-border-diagdown",borderId:c_oAscBorderOptions.DiagD},{caption:"--"},{id:"id-toolbar-mnu-item-border-width",caption:n.textBordersWidth,iconCls:"mnu-icon-item mnu-border-width",template:t.template(\'<a id="<%= id %>" tabindex="-1" type="menuitem"><span class="menu-item-icon" style="background-image: none; width: 11px; height: 11px; margin: 2px 7px 0 -9px; border-style: solid; border-width: 1px; border-color: #000;"></span><%= caption %></a>\'),menu:function(){var e=t.template(\'<a id="<%= id %>" tabindex="-1" type="menuitem"><div class="border-size-item" style="background-position: 0 -<%= options.offsety %>px;"></div></a>\');return n.mnuBorderWidth=new Common.UI.Menu({style:"min-width: 100px;",menuAlign:"tl-tr",id:"toolbar-menu-borders-width",items:[{template:e,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:"thin",offsety:0,checked:!0},{template:e,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:"medium",offsety:20},{template:e,stopPropagation:!0,checkable:!0,toggleGroup:"border-width",value:"thick",offsety:40}]}),n.mnuBorderWidth}()},{id:"id-toolbar-mnu-item-border-color",caption:n.textBordersColor,iconCls:"mnu-icon-item mnu-border-color",template:t.template(\'<a id="<%= id %>"tabindex="-1" type="menuitem"><span class="menu-item-icon" style="background-image: none; width: 11px; height: 11px; margin: 2px 7px 0 -9px; border-style: solid; border-width: 3px; border-color: #000;"></span><%= caption %></a>\'),menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{template:t.template(\'<div id="id-toolbar-menu-bordercolor" style="width: 165px; height: 220px; margin: 10px;"></div>\'),stopPropagation:!0},{template:t.template(\'<a id="id-toolbar-menu-new-bordercolor" style="padding-left:12px;">\'+n.textNewColor+"</a>"),stopPropagation:!0}]})}]})})).on("render:after",function(t){var r=e(\'<div class="btn-color-value-line"></div>\');e("button:first-child",t.cmpEl).append(r),r.css("background-color",t.currentColor||"transparent"),n.mnuBorderColorPicker=new Common.UI.ThemeColorPalette({el:e("#id-toolbar-menu-bordercolor"),dynamiccolors:10,colors:[n.textThemeColors,"-",{color:"3366FF",effectId:1},{color:"0000FF",effectId:2},{color:"000090",effectId:3},{color:"660066",effectId:4},{color:"800000",effectId:5},{color:"FF0000",effectId:1},{color:"FF6600",effectId:1},{color:"FFFF00",effectId:2},{color:"CCFFCC",effectId:3},{color:"008000",effectId:4},"-",{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:3},{color:"FFFFFF",effectId:4},{color:"000000",effectId:5},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},"-","--","-",n.textStandartColors,"-","3D55FE","5301B3","980ABD","B2275F","F83D26","F86A1D","F7AC16","F7CA12","FAFF44","D6EF39","-","--"]})}),n.btnAlignLeft=new Common.UI.Button({id:"id-toolbar-btn-align-left",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-align-left",hint:n.tipAlignLeft,enableToggle:!0,lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.lostConnect,s.coAuth],toggleGroup:"alignGroup"}),n.btnAlignCenter=new Common.UI.Button({id:"id-toolbar-btn-align-center",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-align-center",hint:n.tipAlignCenter,enableToggle:!0,lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.lostConnect,s.coAuth],toggleGroup:"alignGroup"}),n.btnAlignRight=new Common.UI.Button({id:"id-toolbar-btn-align-right",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-align-right",hint:n.tipAlignRight,enableToggle:!0,lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.lostConnect,s.coAuth],toggleGroup:"alignGroup"}),n.btnAlignJust=new Common.UI.Button({id:"id-toolbar-btn-align-just",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-align-just",hint:n.tipAlignJust,enableToggle:!0,lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.lostConnect,s.coAuth],toggleGroup:"alignGroup"}),n.btnMerge=new Common.UI.Button({id:"id-toolbar-rtn-merge",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-merge",hint:n.tipMerge,enableToggle:!0,allowDepress:!0,split:!0,lock:[s.editCell,s.selShape,s.selShapeText,s.selChart,s.selChartText,s.selImage,s.lostConnect,s.coAuth,s.ruleMerge],menu:new Common.UI.Menu({items:[{caption:n.txtMergeCenter,value:c_oAscMergeOptions.MergeCenter},{caption:n.txtMergeAcross,value:c_oAscMergeOptions.MergeAcross},{caption:n.txtMergeCells,value:c_oAscMergeOptions.Merge},{caption:n.txtUnmerge,value:c_oAscMergeOptions.Unmerge}]})}),n.btnAlignTop=new Common.UI.Button({id:"id-toolbar-rtn-valign-top",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-valign-top",hint:n.tipAlignTop,lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.lostConnect,s.coAuth],enableToggle:!0,toggleGroup:"vAlignGroup"}),n.btnAlignMiddle=new Common.UI.Button({id:"id-toolbar-rtn-valign-middle",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-valign-middle",hint:n.tipAlignMiddle,enableToggle:!0,lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.lostConnect,s.coAuth],toggleGroup:"vAlignGroup"}),n.btnAlignBottom=new Common.UI.Button({id:"id-toolbar-rtn-valign-bottom",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-valign-bottom",hint:n.tipAlignBottom,lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.lostConnect,s.coAuth],enableToggle:!0,toggleGroup:"vAlignGroup"}),n.btnWrap=new Common.UI.Button({id:"id-toolbar-rtn-wrap",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-wrap",hint:n.tipWrap,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth],enableToggle:!0,allowDepress:!0}),n.btnTextOrient=new Common.UI.Button({id:"id-toolbar-rtn-textorient",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-text-orient",hint:n.tipTextOrientation,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth],menu:new Common.UI.Menu({items:[{caption:n.textHorizontal,iconCls:"mnu-direct-horiz",checkable:!0,toggleGroup:"textorientgroup",value:"horiz"},{caption:n.textCounterCw,iconCls:"mnu-direct-ccw",checkable:!0,toggleGroup:"textorientgroup",value:"countcw"},{caption:n.textClockwise,iconCls:"mnu-direct-cw",checkable:!0,toggleGroup:"textorientgroup",value:"clockwise"},{caption:n.textRotateUp,iconCls:"mnu-direct-rup",checkable:!0,toggleGroup:"textorientgroup",value:"rotateup"},{caption:n.textRotateDown,iconCls:"mnu-direct-rdown",checkable:!0,toggleGroup:"textorientgroup",value:"rotatedown"}]})}),n.btnInsertImage=new Common.UI.Button({id:"id-toolbar-btn-insertimage",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-insertimage",hint:n.tipInsertImage,lock:[s.editCell,s.selChartText,s.selImage,s.lostConnect,s.coAuth],menu:new Common.UI.Menu({items:[{caption:n.mniImageFromFile,value:"file"},{caption:n.mniImageFromUrl,value:"url"}]})}),n.btnInsertHyperlink=new Common.UI.Button({id:"id-toolbar-btn-inserthyperlink",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-inserthyperlink",lock:[s.editCell,s.selChart,s.selChartText,s.selImage,s.selShape,s.lostConnect,s.coAuth],hint:n.tipInsertHyperlink+Common.Utils.String.platformKey("Ctrl+K")}),n.btnInsertChart=new Common.UI.Button({id:"id-toolbar-btn-insertchart",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-insertchart",lock:[s.editCell,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth],hint:n.tipInsertChart}),n.btnEditChart=new Common.UI.Button({id:"id-toolbar-rtn-edit-chart",cls:"btn-toolbar btn-toolbar-default btn-text-value",caption:n.tipEditChart,lock:[s.lostConnect],style:"width: 120px;"}),n.btnInsertShape=new Common.UI.Button({id:"id-toolbar-btn-insertshape",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-insertshape",hint:n.tipInsertShape,enableToggle:!0,lock:[s.editCell,s.selChartText,s.selImage,s.lostConnect,s.coAuth],menu:new Common.UI.Menu({cls:"menu-shapes"})}),n.btnInsertText=new Common.UI.Button({id:"id-toolbar-btn-inserttext",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-text",hint:n.tipInsertText,lock:[s.editCell,s.selChartText,s.selImage,s.lostConnect,s.coAuth],enableToggle:!0}),n.btnSortDown=new Common.UI.Button({id:"id-toolbar-btn-sort-down",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-sort-down",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.ruleFilter],hint:n.txtSortAZ}),n.btnSortUp=new Common.UI.Button({id:"id-toolbar-btn-sort-up",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-sort-up",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.ruleFilter],hint:n.txtSortZA}),n.btnSetAutofilter=new Common.UI.Button({id:"id-toolbar-btn-setautofilter",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-autofilter",hint:n.txtFilter+" (Ctrl+Shift+L)",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.ruleFilter],enableToggle:!0}),n.btnClearAutofilter=new Common.UI.Button({id:"id-toolbar-btn-clearfilter",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-clear-filter",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.ruleDelFilter],hint:n.txtClearFilter}),n.btnTableTemplate=new Common.UI.Button({id:"id-toolbar-btn-ttempl",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-ttempl",hint:n.txtTableTemplate,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.ruleFilter],menu:new Common.UI.Menu({items:[{template:t.template(\'<div id="id-toolbar-menu-table-templates" style="width: 285px; height: 300px; margin: 3px 10px;"></div>\')}]})}),n.listStyles=new Common.UI.ComboDataView({cls:"combo-styles",enableKeyEvents:!0,itemWidth:104,itemHeight:38,hint:this.tipCellStyle,menuMaxHeight:226,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth],beforeOpenHandler:function(t){var n=this,r=n.openButton.menu,i=6;if(r.cmpEl){var s=e(n.cmpEl.find(".dataview.inner .style").get(0)).parent(),o=-1,u=s.is(":visible")?parseInt(s.css("width")):112,a=n.menuPicker.store.length>=i?i:n.menuPicker.store.length,f=Math.min(n.menuPicker.store.length,Math.round(e(".dataview",e(n.fieldPicker.el)).width()/(o+u)+.5));f=f<a?a:f,r.menuAlignEl=n.cmpEl,r.menuAlign="tl-tl",r.setOffset(n.cmpEl.width()-n.openButton.$el.width()-f*(o+u)-1),r.cmpEl.css({width:f*(u+o),"min-height":n.cmpEl.height()})}}});var o=t.template(\'<a id="<%= id %>" style="white-space: normal;"><%= caption %><span style="float: right; color: silver;"><%= options.tplval ? options.tplval : options.value %></span></a>\');n.btnNumberFormat=new Common.UI.Button({id:"id-toolbar-btn-num-format",cls:"btn-toolbar btn-toolbar-default btn-text-value",hint:n.tipNumFormat,caption:n.txtGeneral,style:"width: 100%;",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selRange,s.lostConnect,s.coAuth],menu:new Common.UI.Menu({style:"margin-left: -1px;",items:[{caption:n.txtGeneral,value:n.ascFormatOptions.General},{caption:n.txtNumber,value:n.ascFormatOptions.Number},{caption:n.txtInteger,value:"#0"},{caption:n.txtScientific,value:n.ascFormatOptions.Scientific},{caption:n.txtAccounting,menu:new Common.UI.Menu({style:"min-width: 120px;",menuAlign:"tl-tr",items:[{caption:n.txtDollar,value:n.ascFormatOptions.Accounting},{caption:n.txtEuro,value:\'_(€* #,##0.00_);_(€* (#,##0.00);_(€* "-"??_);_(@_)\'},{caption:n.txtPound,value:\'_(£* #,##0.00_);_(£* (#,##0.00);_(£* "-"??_);_(@_)\'},{caption:n.txtRouble,value:\'_-* #,##0.00[$р.-419]_-;-* #,##0.00[$р.-419]_-;_-* "-"??[$р.-419]_-;_-@_-\'},{caption:n.txtYen,value:\'_(¥* #,##0.00_);_(¥* (#,##0.00);_(¥* "-"??_);_(@_)\'}]})},{caption:n.txtCurrency,menu:new Common.UI.Menu({style:"min-width: 120px;",menuAlign:"tl-tr",items:[{caption:n.txtDollar,value:n.ascFormatOptions.Currency},{caption:n.txtEuro,value:"€#,##0.00"},{caption:n.txtPound,value:"£#,##0.00"},{caption:n.txtRouble,value:"#,##0.00р."},{caption:n.txtYen,value:"¥#,##0.00"}]})},{caption:n.txtDate,menu:new Common.UI.Menu({style:"min-width: 200px;",menuAlign:"tl-tr",items:[{caption:"07-24-88",value:"MM-dd-yy",template:o},{caption:"07-24-1988",value:"MM-dd-yyyy",template:o},{caption:"24-07-88",value:"dd-MM-yy",template:o},{caption:"24-07-1988",value:"dd-MM-yyyy",template:o},{caption:"24-Jul-1988",value:"dd-MMM-yyyy",template:o},{caption:"24-Jul",value:"dd-MMM",template:o},{caption:"Jul-88",value:"MMM-yy",template:o}]})},{caption:n.txtTime,menu:new Common.UI.Menu({style:"min-width: 200px;",menuAlign:"tl-tr",showSeparator:!1,items:[{caption:"10:56",value:"HH:mm",template:o},{caption:"21:56:00",value:"HH:MM:ss",template:o},{caption:"05:56 AM",tplval:"hh:mm tt",value:"hh:mm AM/PM",template:o},{caption:"05:56:00 AM",tplval:"hh:mm:ss tt",value:"hh:mm:ss AM/PM",template:o},{caption:"38:56:00",value:"[h]:mm:ss",template:o}]})},{caption:n.txtPercentage,value:n.ascFormatOptions.Percentage},{caption:n.txtText,value:n.ascFormatOptions.Text}]})}),n.btnPercentStyle=new Common.UI.Button({id:"id-toolbar-btn-percent-style",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-percent-style",hint:n.tipDigStylePercent,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth],formatId:n.ascFormatOptions.Percent}),n.btnCurrencyStyle=new Common.UI.Button({id:"id-toolbar-btn-accounting-style",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-currency-style",hint:n.tipDigStyleAccounting,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth],formatId:n.ascFormatOptions.Accounting,split:!0,menu:new Common.UI.Menu({style:"min-width: 120px;",items:[{caption:n.txtDollar,value:n.ascFormatOptions.Accounting},{caption:n.txtEuro,value:\'_(€* #,##0.00_);_(€* (#,##0.00);_(€* "-"??_);_(@_)\'},{caption:n.txtPound,value:\'_(£* #,##0.00_);_(£* (#,##0.00);_(£* "-"??_);_(@_)\'},{caption:n.txtRouble,value:\'_-* #,##0.00[$р.-419]_-;-* #,##0.00[$р.-419]_-;_-* "-"??[$р.-419]_-;_-@_-\'},{caption:n.txtYen,value:\'_(¥* #,##0.00_);_(¥* (#,##0.00);_(¥* "-"??_);_(@_)\'}]})}),n.btnDecDecimal=new Common.UI.Button({id:"id-toolbar-btn-decdecimal",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-decdecimal",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth],hint:n.tipDecDecimal}),n.btnIncDecimal=new Common.UI.Button({id:"id-toolbar-btn-incdecimal",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-incdecimal",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth],hint:n.tipIncDecimal}),n.btnInsertFormula=new Common.UI.Button({id:"id-toolbar-btn-insertformula",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-formula",hint:n.txtFormula,split:!0,lock:[s.editText,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.selRange,s.lostConnect,s.coAuth],menu:new Common.UI.Menu({style:"min-width: 110px",items:[{caption:"SUM",value:"SUM"},{caption:"MIN",value:"MIN"},{caption:"MAX",value:"MAX"},{caption:"COUNT",value:"COUNT"},{caption:"--"},{caption:n.txtAdditional,value:"more"}]})}),n.btnClearStyle=new Common.UI.Button({id:"id-toolbar-btn-clear",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-clearstyle",hint:n.tipClearStyle,lock:[s.lostConnect,s.coAuth,s.selRange],menu:new Common.UI.Menu({style:"min-width: 110px",items:[{caption:n.txtClearAll,value:c_oAscCleanOptions.All},{caption:n.txtClearText,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.coAuth],value:c_oAscCleanOptions.Text},{caption:n.txtClearFormat,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.coAuth],value:c_oAscCleanOptions.Format},{caption:n.txtClearComments,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.coAuth],value:c_oAscCleanOptions.Comments},{caption:n.txtClearHyper,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.coAuth],value:c_oAscCleanOptions.Hyperlinks}]})}),n.btnCopyStyle=new Common.UI.Button({id:"id-toolbar-btn-copystyle",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-copystyle",hint:this.tipCopyStyle,lock:[s.editCell,s.lostConnect,s.coAuth,s.selChart],enableToggle:!0}),n.btnAddCell=new Common.UI.Button({id:"id-toolbar-btn-addcell",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-addcell",hint:n.tipInsertOpt,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth],menu:new Common.UI.Menu({items:[{caption:n.textInsRight,value:c_oAscInsertOptions.InsertCellsAndShiftRight},{caption:n.textInsDown,value:c_oAscInsertOptions.InsertCellsAndShiftDown},{caption:n.textEntireRow,value:c_oAscInsertOptions.InsertRows},{caption:n.textEntireCol,value:c_oAscInsertOptions.InsertColumns}]})}),n.btnDeleteCell=new Common.UI.Button({id:"id-toolbar-btn-delcell",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-delcell",hint:n.tipDeleteOpt,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth],menu:new Common.UI.Menu({items:[{caption:n.textDelLeft,value:c_oAscDeleteOptions.DeleteCellsAndShiftLeft},{caption:n.textDelUp,value:c_oAscDeleteOptions.DeleteCellsAndShiftTop},{caption:n.textEntireRow,value:c_oAscDeleteOptions.DeleteRows},{caption:n.textEntireCol,value:c_oAscDeleteOptions.DeleteColumns}]})}),n.btnColorSchemas=new Common.UI.Button({id:"id-toolbar-btn-colorschemas",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-colorschemas",hint:n.tipColorSchemas,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth],menu:(new Common.UI.Menu({items:[],maxHeight:600,restoreHeight:600})).on("render:after",function(t){this.scroller=new Common.UI.Scroller({el:e(this.el).find(".dropdown-menu "),useKeyboard:this.enableKeyEvents&&!this.handleSelect,minScrollbarLength:40,alwaysVisibleY:!0})}).on("show:after",function(t,n){var r=e(this.el).find(".dropdown-menu "),i=e(document).height(),s=r.outerHeight(),o=parseInt(r.css("top"));s>i?(r.css("max-height",i-parseInt(r.css("padding-top"))-parseInt(r.css("padding-bottom"))-5+"px"),this.scroller.update({minScrollbarLength:40})):r.height()<this.options.restoreHeight&&(r.css("max-height",Math.min(i-parseInt(r.css("padding-top"))-parseInt(r.css("padding-bottom"))-5,this.options.restoreHeight)+"px"),s=r.outerHeight(),o+s>i&&r.css("top",0),this.scroller.update({minScrollbarLength:40}))})}),n.mnuZoomIn=i(),n.mnuZoomOut=i(),n.btnShowMode=(new Common.UI.Button({id:"id-toolbar-btn-showmode",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-showmode",hint:n.tipViewSettings,lock:[s.menuFileOpen,s.editCell],menu:new Common.UI.Menu({items:[n.mnuitemCompactToolbar=new Common.UI.MenuItem({caption:n.textCompactToolbar,checkable:!0,checked:n.isCompactView,value:"compact"}),n.mnuitemHideTitleBar=new Common.UI.MenuItem({caption:n.textHideTBar,checkable:!0,checked:!!r.title,value:"title"}),{caption:n.textHideFBar,checkable:!0,checked:!!r.formula,value:"formula"},{caption:n.textHi

]]></string> </value>
        </item>
        <item>
            <key> <string>next</string> </key>
            <value>
              <persistent> <string encoding="base64">AAAAAAAAAAg=</string> </persistent>
            </value>
        </item>
      </dictionary>
    </pickle>
  </record>
  <record id="8" aka="AAAAAAAAAAg=">
    <pickle>
      <global name="Pdata" module="OFS.Image"/>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>data</string> </key>
            <value> <string encoding="cdata"><![CDATA[

deHeadings,checkable:!0,checked:!!r.headings,value:"headings"},{caption:n.textHideGridlines,checkable:!0,checked:!1,value:"gridlines"},{caption:this.textFreezePanes,checkable:!0,checked:!1,value:"freezepanes"},{caption:"--"},new Common.UI.MenuItem({template:t.template([\'<div id="id-toolbar-menu-zoom" class="menu-zoom" style="height: 25px;" \',"<% if(!_.isUndefined(options.stopPropagation)) { %>",\'data-stopPropagation="true"\',"<% } %>",">",\'<label class="title">\'+n.textZoom+"</label>",\'<button id="id-menu-zoom-in" type="button" style="float:right; margin: 2px 5px 0 0;" class="btn small btn-toolbar btn-toolbar-default"><span class="btn-icon btn-zoomin">&nbsp;</span></button>\',\'<label class="zoom">100%</label>\',\'<button id="id-menu-zoom-out" type="button" style="float:right; margin-top: 2px;" class="btn small btn-toolbar btn-toolbar-default"><span class="btn-icon btn-zoomout">&nbsp;</span></button>\',"</div>"].join("")),stopPropagation:!0})]})})).on("render:after",t.bind(function(t){n.mnuZoomOut=new Common.UI.Button({el:e("#id-menu-zoom-out"),cls:"btn-toolbar btn-toolbar-default"}),n.mnuZoomIn=new Common.UI.Button({el:e("#id-menu-zoom-in"),cls:"btn-toolbar btn-toolbar-default"})}),n),n.btnSettings=new Common.UI.Button({id:"id-toolbar-btn-settings",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-settings",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.coAuth],hint:n.tipAdvSettings}),n.btnHorizontalAlign=new Common.UI.Button({id:"id-toolbar-btn-halign",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-align-left",hint:n.tipHAligh,icls:"btn-align-left",lock:[s.editCell,s.selChart,s.selChartText,s.lostConnect,s.coAuth],menu:new Common.UI.Menu({items:[{caption:n.tipAlignLeft,iconCls:"mnu-align-left",icls:"btn-align-left",checkable:!0,allowDepress:!0,toggleGroup:"halignGroup",checked:!0,value:"left"},{caption:n.tipAlignCenter,iconCls:"mnu-align-center",icls:"btn-align-center",checkable:!0,allowDepress:!0,toggleGroup:"halignGroup",value:"center"},{caption:n.tipAlignRight,iconCls:"mnu-align-right",icls:"btn-align-right",checkable:!0,allowDepress:!0,toggleGroup:"halignGroup",value:"right"},{caption:n.tipAlignJust,iconCls:"mnu-align-just",icls:"btn-align-just",checkable:!0,allowDepress:!0,toggleGroup:"halignGroup",value:"justify"}]})}),n.btnVerticalAlign=new Common.UI.Button({id:"id-toolbar-btn-valign",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-valign-bottom",hint:n.tipVAligh,icls:"btn-valign-bottom",lock:[s.editCell,s.selChart,s.selChartText,s.lostConnect,s.coAuth],menu:new Common.UI.Menu({items:[{caption:n.tipAlignTop,iconCls:"mnu-valign-top",icls:"btn-valign-top",checkable:!0,allowDepress:!0,toggleGroup:"valignGroup",value:"top"},{caption:n.tipAlignCenter,iconCls:"mnu-valign-middle",icls:"btn-valign-middle",checkable:!0,allowDepress:!0,toggleGroup:"valignGroup",value:"center"},{caption:n.tipAlignBottom,iconCls:"mnu-valign-bottom",icls:"btn-valign-bottom",checkable:!0,allowDepress:!0,checked:!0,toggleGroup:"valignGroup",value:"bottom"}]})}),n.btnAutofilter=new Common.UI.Button({id:"id-toolbar-btn-autofilter",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-autofilter",hint:n.tipAutofilter,lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.lostConnect,s.coAuth,s.ruleFilter],menu:new Common.UI.Menu({items:[n.mnuitemSortAZ=new Common.UI.MenuItem({caption:n.txtSortAZ,iconCls:"mnu-sort-asc",lock:[s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.coAuth,s.ruleFilter],value:"ascending"}),n.mnuitemSortZA=new Common.UI.MenuItem({caption:n.txtSortZA,iconCls:"mnu-sort-desc",lock:[s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.coAuth,s.ruleFilter],value:"descending"}),n.mnuitemAutoFilter=new Common.UI.MenuItem({caption:n.txtFilter,iconCls:"mnu-filter-add",checkable:!0,lock:[s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.coAuth,s.ruleFilter],value:"set-filter"}),n.mnuitemClearFilter=new Common.UI.MenuItem({caption:n.txtClearFilter,iconCls:"mnu-filter-clear",lock:[s.editCell,s.selChart,s.selChartText,s.selShape,s.selShapeText,s.selImage,s.coAuth,s.ruleDelFilter],value:"clear-filter"})]})}),n.mnuPrint=n.btnPrint.menu,n.lockControls=[n.cmbFontName,n.cmbFontSize,n.btnIncFontSize,n.btnDecFontSize,n.btnBold,n.btnItalic,n.btnUnderline,n.btnTextColor,n.btnHorizontalAlign,n.btnAlignLeft,n.btnAlignCenter,n.btnAlignRight,n.btnAlignJust,n.btnVerticalAlign,n.btnAlignTop,n.btnAlignMiddle,n.btnAlignBottom,n.btnWrap,n.btnTextOrient,n.btnBackColor,n.btnMerge,n.btnInsertFormula,n.btnIncDecimal,n.btnInsertShape,n.btnInsertText,n.btnSortUp,n.btnSortDown,n.btnSetAutofilter,n.btnClearAutofilter,n.btnTableTemplate,n.btnPercentStyle,n.btnCurrencyStyle,n.btnDecDecimal,n.btnAddCell,n.btnDeleteCell,n.btnNumberFormat,n.btnBorders,n.btnInsertImage,n.btnInsertHyperlink,n.btnInsertChart,n.btnColorSchemas,n.btnAutofilter,n.btnCopy,n.btnPaste,n.btnSettings,n.listStyles,n.btnPrint,n.btnShowMode,n.btnClearStyle,n.btnCopyStyle];var u=window.localStorage.getItem("sse-hide-synch");n.showSynchTip=!u||parseInt(u)!=1,n.needShowSynchTip=!1;var a=[n.cmbFontName,n.cmbFontSize,n.btnAlignLeft,n.btnAlignCenter,n.btnAlignRight,n.btnAlignJust,n.btnAlignTop,n.btnAlignMiddle,n.btnAlignBottom,n.btnHorizontalAlign,n.btnVerticalAlign,n.btnInsertImage,n.btnInsertText,n.btnInsertShape,n.btnIncFontSize,n.btnDecFontSize,n.btnBold,n.btnItalic,n.btnUnderline,n.btnTextColor,n.btnBackColor,n.btnInsertHyperlink,n.btnBorders,n.btnTextOrient,n.btnPercentStyle,n.btnCurrencyStyle,n.btnColorSchemas,n.btnSettings,n.btnInsertFormula,n.btnDecDecimal,n.btnIncDecimal,n.btnNumberFormat,n.btnWrap,n.btnInsertChart,n.btnMerge,n.btnAddCell,n.btnDeleteCell,n.btnShowMode,n.btnPrint,n.btnAutofilter,n.btnSortUp,n.btnSortDown,n.btnTableTemplate,n.btnSetAutofilter,n.btnClearAutofilter,n.btnSave,n.btnClearStyle,n.btnCopyStyle,n.btnCopy,n.btnPaste];return t.each(a,function(e){e&&t.isFunction(e.setDisabled)&&e.setDisabled(!0)}),this},lockToolbar:function(e,n,r){function s(e,r){if(t.contains(e.options.lock,r)){var i=e.keepState.indexOf(r);n?i<0&&e.keepState.push(r):i<0||e.keepState.splice(i,1)}}!r&&(r={});var i=r.array||this.lockControls;r.merge&&(i=t.union(this.lockControls,i)),t.each(i,function(n){t.isFunction(n.setDisabled)&&(!n.keepState&&(n.keepState=[]),r.clear&&r.clear.length>0&&n.keepState.length>0&&(n.keepState=t.difference(n.keepState,r.clear)),t.isArray(e)?t.each(e,function(e){s(n,e)}):s(n,e),n.keepState.length>0?!n.isDisabled()&&n.setDisabled(!0):n.isDisabled()&&n.setDisabled(!1))})},render:function(t){var n=this,r=e(this.el);return this.trigger("render:before",this),r.html(this.template({isEditDiagram:t,isCompactView:this.isCompactView})),n.rendererComponents(t?"diagram":this.isCompactView?"short":"full"),this.trigger("render:after",this),this},rendererComponents:function(t){var n=function(t,n){var r=e(t),i=r.get(0);i&&(n.rendered?(n.el=document.getElementById(n.id),i.appendChild(document.getElementById(n.id))):n.render(r))};n("#id-toolbar-"+t+"-placeholder-field-fontname",this.cmbFontName),n("#id-toolbar-"+t+"-placeholder-field-fontsize",this.cmbFontSize),n("#id-toolbar-"+t+"-placeholder-btn-newdocument",this.btnNewDocument),n("#id-toolbar-"+t+"-placeholder-btn-opendocument",this.btnOpenDocument),n("#id-toolbar-"+t+"-placeholder-btn-print",this.btnPrint),n("#id-toolbar-"+t+"-placeholder-btn-save",this.btnSave),n("#id-toolbar-"+t+"-placeholder-btn-undo",this.btnUndo),n("#id-toolbar-"+t+"-placeholder-btn-redo",this.btnRedo),n("#id-toolbar-"+t+"-placeholder-btn-copy",this.btnCopy),n("#id-toolbar-"+t+"-placeholder-btn-paste",this.btnPaste),n("#id-toolbar-"+t+"-placeholder-btn-incfont",this.btnIncFontSize),n("#id-toolbar-"+t+"-placeholder-btn-decfont",this.btnDecFontSize),n("#id-toolbar-"+t+"-placeholder-btn-bold",this.btnBold),n("#id-toolbar-"+t+"-placeholder-btn-italic",this.btnItalic),n("#id-toolbar-"+t+"-placeholder-btn-underline",this.btnUnderline),n("#id-toolbar-"+t+"-placeholder-btn-fontcolor",this.btnTextColor),n("#id-toolbar-"+t+"-placeholder-btn-fillparag",this.btnBackColor),n("#id-toolbar-"+t+"-placeholder-btn-borders",this.btnBorders),n("#id-toolbar-"+t+"-placeholder-btn-align-left",this.btnAlignLeft),n("#id-toolbar-"+t+"-placeholder-btn-align-center",this.btnAlignCenter),n("#id-toolbar-"+t+"-placeholder-btn-align-right",this.btnAlignRight),n("#id-toolbar-"+t+"-placeholder-btn-align-just",this.btnAlignJust),n("#id-toolbar-"+t+"-placeholder-btn-merge",this.btnMerge),n("#id-toolbar-"+t+"-placeholder-btn-top",this.btnAlignTop),n("#id-toolbar-"+t+"-placeholder-btn-middle",this.btnAlignMiddle),n("#id-toolbar-"+t+"-placeholder-btn-bottom",this.btnAlignBottom),n("#id-toolbar-"+t+"-placeholder-btn-wrap",this.btnWrap),n("#id-toolbar-"+t+"-placeholder-btn-text-orient",this.btnTextOrient),n("#id-toolbar-"+t+"-placeholder-btn-insertimage",this.btnInsertImage),n("#id-toolbar-"+t+"-placeholder-btn-inserthyperlink",this.btnInsertHyperlink),n("#id-toolbar-"+t+"-placeholder-btn-insertshape",this.btnInsertShape),n("#id-toolbar-"+t+"-placeholder-btn-text",this.btnInsertText),n("#id-toolbar-"+t+"-placeholder-btn-sortdesc",this.btnSortDown),n("#id-toolbar-"+t+"-placeholder-btn-sortasc",this.btnSortUp),n("#id-toolbar-"+t+"-placeholder-btn-setfilter",this.btnSetAutofilter),n("#id-toolbar-"+t+"-placeholder-btn-clear-filter",this.btnClearAutofilter),n("#id-toolbar-"+t+"-placeholder-btn-table-tpl",this.btnTableTemplate),n("#id-toolbar-"+t+"-placeholder-btn-format",this.btnNumberFormat),n("#id-toolbar-"+t+"-placeholder-btn-percents",this.btnPercentStyle),n("#id-toolbar-"+t+"-placeholder-btn-currency",this.btnCurrencyStyle),n("#id-toolbar-"+t+"-placeholder-btn-digit-dec",this.btnDecDecimal),n("#id-toolbar-"+t+"-placeholder-btn-digit-inc",this.btnIncDecimal),n("#id-toolbar-"+t+"-placeholder-btn-formula",this.btnInsertFormula),n("#id-toolbar-"+t+"-placeholder-btn-clear",this.btnClearStyle),n("#id-toolbar-"+t+"-placeholder-btn-copystyle",this.btnCopyStyle),n("#id-toolbar-"+t+"-placeholder-btn-cell-ins",this.btnAddCell),n("#id-toolbar-"+t+"-placeholder-btn-cell-del",this.btnDeleteCell),n("#id-toolbar-"+t+"-placeholder-btn-colorschemas",this.btnColorSchemas),n("#id-toolbar-"+t+"-placeholder-btn-hidebars",this.btnShowMode),n("#id-toolbar-"+t+"-placeholder-btn-settings",this.btnSettings),n("#id-toolbar-"+t+"-placeholder-btn-insertchart",this.btnInsertChart),n("#id-toolbar-diagram-placeholder-btn-chart",this.btnEditChart),n("#id-toolbar-short-placeholder-btn-halign",this.btnHorizontalAlign),n("#id-toolbar-short-placeholder-btn-valign",this.btnVerticalAlign),n("#id-toolbar-short-placeholder-btn-filter",this.btnAutofilter),n("#id-toolbar-full-placeholder-field-styles",this.listStyles)},setApi:function(e){return this.api=e,this.mode.isEditDiagram||(this.api.asc_registerCallback("asc_onCollaborativeChanges",t.bind(this.onApiCollaborativeChanges,this)),this.api.asc_registerCallback("asc_onSendThemeColorSchemes",t.bind(this.onApiSendThemeColorSchemes,this)),this.api.asc_registerCallback("asc_onAuthParticipantsChanged",t.bind(this.onApiUsersChanged,this)),this.api.asc_registerCallback("asc_onParticipantsChanged",t.bind(this.onApiUsersChanged,this))),this},setMode:function(t){if(t.isDisconnected)this.lockToolbar(SSE.enumLock.lostConnect,!0),this.lockToolbar(SSE.enumLock.lostConnect,!0,{array:[this.btnEditChart,this.btnUndo,this.btnRedo,this.btnOpenDocument,this.btnNewDocument,this.btnSave]});else{this.mode=t;if(!t.nativeApp){var n=e(".toolbar-group-native");n&&n.hide()}t.isDesktopApp&&(e(".toolbar-group-native").hide(),this.mnuitemHideTitleBar.hide())}},onApiSendThemeColorSchemes:function(n){var r=this;this.mnuColorSchema=this.btnColorSchemas.menu,this.mnuColorSchema&&this.mnuColorSchema.items.length>0&&t.each(this.mnuColorSchema.items,function(e){e.remove()}),this.mnuColorSchema==null&&(this.mnuColorSchema=(new Common.UI.Menu({maxHeight:600,restoreHeight:600})).on("render:after",function(t){this.scroller=new Common.UI.Scroller({el:e(this.el).find(".dropdown-menu "),useKeyboard:this.enableKeyEvents&&!this.handleSelect,minScrollbarLength:40})})),this.mnuColorSchema.items=[];var i=t.template([\'<a id="<%= id %>" class="<%= options.cls %>" tabindex="-1" type="menuitem">\',\'<span class="colors">\',"<% _.each(options.colors, function(color) { %>",\'<span class="color" style="background: <%= color %>;"></span>\',"<% }) %>","</span>",\'<span class="text"><%= caption %></span>\',"</a>"].join(""));t.each(n,function(e,t){var n=e.get_colors(),s=[];for(var o=2;o<7;o++){var u="#"+Common.Utils.ThemeColor.getHexColor(n[o].get_r(),n[o].get_g(),n[o].get_b());s.push(u)}t==21?this.mnuColorSchema.addItem({caption:"--"}):this.mnuColorSchema.addItem({template:i,cls:"color-schemas-menu",colors:s,caption:t<21?r.SchemeNames[t]||e.get_name():e.get_name(),value:t})},this)},onApiCollaborativeChanges:function(){if(this._state.hasCollaborativeChanges)return;if(!this.btnSave.rendered){this.needShowSynchTip=!0;return}this._state.hasCollaborativeChanges=!0;var t=e(".btn-icon",this.btnSave.cmpEl);t.removeClass(this.btnSaveCls),t.addClass("btn-synch"),this.showSynchTip?(this.btnSave.updateHint(""),this.synchTooltip===undefined&&this.createSynchTip(),this.synchTooltip.show()):this.btnSave.updateHint(this.tipSynchronize+Common.Utils.String.platformKey("Ctrl+S")),this.btnSave.setDisabled(!1)},createSynchTip:function(){this.synchTooltip=new Common.UI.SynchronizeTip({target:e("#id-toolbar-btn-save")}),this.synchTooltip.on("dontshowclick",function(){this.showSynchTip=!1,this.synchTooltip.hide(),this.btnSave.updateHint(this.tipSynchronize+Common.Utils.String.platformKey("Ctrl+S")),window.localStorage.setItem("sse-hide-synch",1)},this),this.synchTooltip.on("closeclick",function(){this.synchTooltip.hide(),this.btnSave.updateHint(this.tipSynchronize+Common.Utils.String.platformKey("Ctrl+S"))},this)},synchronizeChanges:function(){if(this.btnSave.rendered){var t=e(".btn-icon",this.btnSave.cmpEl);t.hasClass("btn-synch")&&(t.removeClass("btn-synch"),t.addClass(this.btnSaveCls),this.synchTooltip&&this.synchTooltip.hide(),this.btnSave.updateHint(this.btnSaveTip),this.btnSave.setDisabled(!0),this._state.hasCollaborativeChanges=!1)}},onApiUsersChanged:function(n){var r=t.size(n),i=r>1?"btn-save-coauth":"btn-save";if(i!==this.btnSaveCls&&this.btnSave.rendered){this.btnSaveTip=(r>1?this.tipSaveCoauth:this.tipSave)+Common.Utils.String.platformKey("Ctrl+S");var s=e(".btn-icon",this.btnSave.cmpEl);s.hasClass("btn-synch")||(s.removeClass(this.btnSaveCls),s.addClass(i),this.btnSave.updateHint(this.btnSaveTip)),this.btnSaveCls=i}},textBold:"Bold",textItalic:"Italic",textUnderline:"Underline",tipFontName:"Font Name",tipFontSize:"Font Size",tipCellStyle:"Cell Style",tipCopy:"Copy",tipPaste:"Paste",tipUndo:"Undo",tipRedo:"Redo",tipPrint:"Print",tipSave:"Save",tipFontColor:"Font color",tipPrColor:"Background color",tipClearStyle:"Clear",tipCopyStyle:"Copy Style",tipBack:"Back",tipHAligh:"Horizontal Align",tipVAligh:"Vertical Align",tipAlignLeft:"Align Left",tipAlignRight:"Align Right",tipAlignCenter:"Align Center",tipAlignJust:"Justified",textAlignTop:"Align text to the top",textAlignMiddle:"Align text to the middle",textAlignBottom:"Align text to the bottom",tipNumFormat:"Number Format",txtNumber:"Number",txtInteger:"Integer",txtGeneral:"General",txtCustom:"Custom",txtCurrency:"Currency",txtDollar:"$ Dollar",txtEuro:"€ Euro",txtRouble:"р. Rouble",txtPound:"£ Pound",txtYen:"¥ Yen",txtAccounting:"Accounting",txtDate:"Date",txtTime:"Time",txtDateTime:"Date & Time",txtPercentage:"Percentage",txtScientific:"Scientific",txtText:"Text",tipBorders:"Borders",textOutBorders:"Outside Borders",textAllBorders:"All Borders",textTopBorders:"Top Borders",textBottomBorders:"Bottom Borders",textLeftBorders:"Left Borders",textRightBorders:"Right Borders",textNoBorders:"No Borders",textInsideBorders:"Inside Borders",textMiddleBorders:"Inside Horizontal Borders",textCenterBorders:"Inside Vertical Borders",textDiagDownBorder:"Diagonal Down Border",textDiagUpBorder:"Diagonal Up Border",tipWrap:"Wrap Text",txtClearAll:"All",txtClearText:"Text",txtClearFormat:"Format",txtClearFormula:"Formula",txtClearHyper:"Hyperlink",txtClearComments:"Comments",tipMerge:"Merge",txtMergeCenter:"Merge Center",txtMergeAcross:"Merge Across",txtMergeCells:"Merge Cells",txtUnmerge:"Unmerge Cells",tipIncDecimal:"Increase Decimal",tipDecDecimal:"Decrease Decimal",tipAutofilter:"Set Autofilter",tipInsertImage:"Insert Picture",tipInsertHyperlink:"Add Hyperlink",tipSynchronize:"The document has been changed by another user. Please click to save your changes and reload the updates.",tipIncFont:"Increment font size",tipDecFont:"Decrement font size",tipInsertText:"Insert Text",tipInsertShape:"Insert Autoshape",tipDigStylePercent:"Percent Style",tipDigStyleAccounting:"Accounting Style",tipViewSettings:"View Settings",tipAdvSettings:"Advanced Settings",tipTextOrientation:"Orientation",tipInsertOpt:"Insert Cells",tipDeleteOpt:"Delete Cells",tipAlignTop:"Align Top",tipAlignMiddle:"Align Middle",tipAlignBottom:"Align Bottom",textBordersWidth:"Borders Width",textBordersColor:"Borders Color",textAlignLeft:"Left align text",textAlignRight:"Right align text",textAlignCenter:"Center text",textAlignJust:"Justify",txtSort:"Sort",txtFormula:"Insert Function",txtNoBorders:"No borders",txtAdditional:"Additional",mniImageFromFile:"Picture from file",mniImageFromUrl:"Picture from url",textNewColor:"Add New Custom Color",tipInsertChart:"Insert Chart",tipEditChart:"Edit Chart",textPrint:"Print",textPrintOptions:"Print Options",textThemeColors:"Theme Colors",textStandartColors:"Standart Colors",tipColorSchemas:"Change Color Scheme",tipNewDocument:"New Document",tipOpenDocument:"Open Document",txtSortAZ:"Sort A to Z",txtSortZA:"Sort Z to A",txtFilter:"Filter",txtTableTemplate:"Format As Table Template",textHorizontal:"Horizontal Text",textCounterCw:"Angle Counterclockwise",textClockwise:"Angle Clockwise",textRotateUp:"Rotate Text Up",textRotateDown:"Rotate Text Down",textInsRight:"Shift Cells Right",textInsDown:"Shift Cells Down",textEntireRow:"Entire Row",textEntireCol:"Entire Column",textDelLeft:"Shift Cells Left",textDelUp:"Shift Cells Up",textZoom:"Zoom",textCompactToolbar:"Compact Toolbar",textHideTBar:"Hide Title Bar",textHideFBar:"Hide Formula Bar",textHideHeadings:"Hide Headings",textHideGridlines:"Hide Gridlines",textFreezePanes:"Freeze Panes",txtScheme1:"Office",txtScheme2:"Grayscale",txtScheme3:"Apex",txtScheme4:"Aspect",txtScheme5:"Civic",txtScheme6:"Concourse",txtScheme7:"Equity",txtScheme8:"Flow",txtScheme9:"Foundry",txtScheme10:"Median",txtScheme11:"Metro",txtScheme12:"Module",txtScheme13:"Opulent",txtScheme14:"Oriel",txtScheme15:"Origin",txtScheme16:"Paper",txtScheme17:"Solstice",txtScheme18:"Technic",txtScheme19:"Trek",txtScheme20:"Urban",txtScheme21:"Verve",txtClearFilter:"Clear Filter",tipSaveCoauth:"Save your changes for the other users to see them."},SSE.Views.Toolbar||{}))}),define("spreadsheeteditor/main/app/model/TableTemplate",["backbone"],function(e){SSE.Models=SSE.Models||{},SSE.Models.TableTemplate=e.Model.extend({defaults:function(){return{id:Common.UI.getId(),name:null,caption:null,type:null,imageUrl:null}}})}),define("spreadsheeteditor/main/app/collection/TableTemplates",["backbone","spreadsheeteditor/main/app/model/TableTemplate"],function(e){if(t===undefined)var t={};t.Collections=t.Collections||{},SSE.Collections.TableTemplates=e.Collection.extend({model:SSE.Models.TableTemplate})});if(Common===undefined)var Common={};define("spreadsheeteditor/main/app/view/TableOptionsDialog",["common/main/lib/component/ComboBox","common/main/lib/component/CheckBox","common/main/lib/component/InputField","common/main/lib/component/Window"],function(){SSE.Views.TableOptionsDialog=Common.UI.Window.extend(_.extend({options:{width:350,cls:"modal-dlg",modal:!1},initialize:function(e){_.extend(this.options,{title:this.txtFormat},e),this.template=[\'<div class="box">\',\'<div id="id-dlg-tableoptions-range" class="input-row" style="margin-bottom: 10px;"></div>\',\'<div class="input-row" id="id-dlg-tableoptions-title"></div>\',"</div>",\'<div class="footer right">\',\'<button class="btn normal dlg-btn primary" result="ok" style="margin-right: 10px;">\'+this.okButtonText+"</button>",\'<button class="btn normal dlg-btn" result="cancel">\'+this.cancelButtonText+"</button>","</div>"].join(""),this.options.tpl=_.template(this.template,this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var e=this.getChild(),t=this;t.inputRange=new Common.UI.InputField({el:$("#id-dlg-tableoptions-range"),name:"range",style:"width: 100%;",allowBlank:!1,blankError:this.txtEmpty,validateOnChange:!0}),t.cbTitle=new Common.UI.CheckBox({el:$("#id-dlg-tableoptions-title"),labelText:this.txtTitle}),e.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),t.inputRange.cmpEl.find("input").on("keypress",_.bind(this.onKeyPress,this)),this.on("close",_.bind(this.onClose,this))},onPrimary:function(){return this._handleInput("ok"),!1},setSettings:function(e){var t=this;if(e.api){t.api=e.api;var n=t.api.asc_getAddFormatTableOptions();this.inputRange.setValue(n.asc_getRange()),this.cbTitle.setValue(n.asc_getIsTitle()),t.api.asc_setSelectionDialogMode(c_oAscSelectionDialogType.FormatTable,n.asc_getRange()),t.api.asc_registerCallback("asc_onSelectionRangeChanged",_.bind(t.onApiRangeChanged,t)),Common.NotificationCenter.trigger("cells:range",c_oAscSelectionDialogType.FormatTable)}t.inputRange.validation=function(e){var n=t.api.asc_checkDataRange(c_oAscSelectionDialogType.FormatTable,e,!1);return n==c_oAscError.ID.DataRangeError?t.txtInvalidRange:!0}},getSettings:function(){var e=this.api.asc_getAddFormatTableOptions();return e.asc_setRange(this.inputRange.getValue()),e.asc_setIsTitle(this.cbTitle.checked),e},onApiRangeChanged:function(e){this.inputRange.setValue(e),this.inputRange.cmpEl.hasClass("error")&&this.inputRange.cmpEl.removeClass("error")},isRangeValid:function(){var e=this.api.asc_checkDataRange(c_oAscSelectionDialogType.FormatTable,this.inputRange.getValue(),!0);return e==c_oAscError.ID.No?!0:(e==c_oAscError.ID.AutoFilterDataRangeError&&Common.UI.warning({msg:this.errorAutoFilterDataRange}),!1)},onBtnClick:function(e){this._handleInput(e.currentTarget.attributes.result.value)},onClose:function(e){this.api&&this.api.asc_setSelectionDialogMode(c_oAscSelectionDialogType.None),Common.NotificationCenter.trigger("cells:range",c_oAscSelectionDialogType.None),Common.NotificationCenter.trigger("edit:complete",this)},onKeyPress:function(e){e.keyCode==Common.UI.Keys.RETURN&&this._handleInput("ok")},_handleInput:function(e){if(this.options.handler){if(e=="ok"&&this.isRangeValid()!==!0)return;this.options.handler.call(this,this,e)}this.close()},txtTitle:"Title",txtFormat:"Format as table",textCancel:"Cancel",txtEmpty:"This field is required",txtInvalidRange:"ERROR! Invalid cells range",errorAutoFilterDataRange:"The operation could not be done for the selected range of cells.<br>Select a uniform data range inside or outside the table and try again."},SSE.Views.TableOptionsDialog||{}))}),define("spreadsheeteditor/main/app/controller/Toolbar",["core","common/main/lib/component/Window","common/main/lib/view/CopyWarningDialog","common/main/lib/view/ImageFromUrlDialog","spreadsheeteditor/main/app/view/Toolbar","spreadsheeteditor/main/app/collection/TableTemplates","spreadsheeteditor/main/app/view/HyperlinkSettingsDialog","spreadsheeteditor/main/app/view/TableOptionsDialog"],function(){SSE.Controllers.Toolbar=Backbone.Controller.extend({models:[],collections:[],views:["Toolbar"],initialize:function(){var e=this;this.addListeners({Statusbar:{"sheet:changed":_.bind(this.onApiSheetChanged,this)}}),this.editMode=!0,this._isAddingShape=!1,this._state={prstyle:undefined,clrtext:undefined,pralign:undefined,clrback:undefined,valign:undefined,can_undo:undefined,can_redo:undefined,bold:undefined,italic:undefined,underline:undefined,wrap:undefined,merge:undefined,filter:undefined,angle:undefined,controlsdisabled:{rows:undefined,cols:undefined,filters:undefined},show_copywarning:!0,selection_type:undefined};var t=function(t,n){var r=$(t.target),i=r.closest("#editor_sdk"),s=r.closest("button").attr("id");s===undefined&&(s=r.closest(".btn-group").attr("id")),e.api&&e.api.asc_isAddAutoshape()&&(i.length<=0||n=="cancel")&&(e.toolbar.btnInsertText.pressed&&s!=e.toolbar.btnInsertText.id||e.toolbar.btnInsertShape.pressed&&s!=e.toolbar.btnInsertShape.id?(e._isAddingShape=!1,e._addAutoshape(!1),e.toolbar.btnInsertShape.toggle(!1,!0),e.toolbar.btnInsertText.toggle(!1,!0),Common.NotificationCenter.trigger("edit:complete",e.toolbar)):e.toolbar.btnInsertShape.pressed&&s==e.toolbar.btnInsertShape.id&&_.defer(function(){e.api.asc_endAddShape(),Common.NotificationCenter.trigger("edit:complete",e.toolbar)},100))};this.checkInsertAutoshape=function(e){t({},e.action)},this._addAutoshape=function(e,n){this.api&&(e?(this.api.asc_startAddShape(n),$(document.body).on("mouseup",t)):(this.api.asc_endAddShape(),$(document.body).off("mouseup",t)))},this.onApiEndAddShape=function(){this.toolbar.btnInsertShape.pressed&&this.toolbar.btnInsertShape.toggle(!1,!0),this.toolbar.btnInsertText.pressed&&this.toolbar.btnInsertText.toggle(!1,!0),$(document.body).off("mouseup",t)}},onLaunch:function(){this.toolbar=this.createView("Toolbar"),this.toolbar.on("render:after",_.bind(this.onToolbarAfterRender,this))},onToolbarAfterRender:function(e){var t=this;e.btnNewDocument.on("click",_.bind(this.onNewDocument,this)),e.btnOpenDocument.on("click",_.bind(this.onOpenDocument,this)),e.btnPrint.on("click",_.bind(this.onPrint,this)),e.btnPrint.menu.on("item:click",_.bind(this.onPrintMenu,this)),e.btnSave.on("click",_.bind(this.onSave,this)),e.btnUndo.on("click",_.bind(this.onUndo,this)),e.btnRedo.on("click",_.bind(this.onRedo,this)),e.btnCopy.on("click",_.bind(this.onCopyPaste,this,!0)),e.btnPaste.on("click",_.bind(this.onCopyPaste,this,!1)),e.btnIncFontSize.on("click",_.bind(this.onIncreaseFontSize,this)),e.btnDecFontSize.on("click",_.bind(this.onDecreaseFontSize,this)),e.btnBold.on("click",_.bind(this.onBold,this)),e.btnItalic.on("click",_.bind(this.onItalic,this)),e.btnUnderline.on("click",_.bind(this.onUnderline,this)),e.btnTextColor.on("click",_.bind(this.onTextColor,this)),e.btnBackColor.on("click",_.bind(this.onBackColor,this)),e.mnuTextColorPicker.on("select",_.bind(this.onTextColorSelect,this)),e.mnuBackColorPicker.on("select",_.bind(this.onBackColorSelect,this)),e.btnBorders.on("click",_.bind(this.onBorders,this)),e.btnBorders.menu.on("item:click",_.bind(this.onBordersMenu,this)),e.mnuBorderWidth.on("item:toggle",_.bind(this.onBordersWidth,this)),e.mnuBorderColorPicker.on("select",_.bind(this.onBordersColor,this)),e.btnAlignLeft.on("click",_.bind(this.onHorizontalAlign,this,"left")),e.btnAlignCenter.on("click",_.bind(this.onHorizontalAlign,this,"center")),e.btnAlignRight.on("click",_.bind(this.onHorizontalAlign,this,"right")),e.btnAlignJust.on("click",_.bind(this.onHorizontalAlign,this,"justify")),e.btnHorizontalAlign.menu.on("item:click",_.bind(this.onHorizontalAlignMenu,this)),e.btnVerticalAlign.menu.on("item:click",_.bind(this.onVerticalAlignMenu,this)),e.btnMerge.on("click",_.bind(this.onMergeCellsMenu,this,e.btnMerge.menu,e.btnMerge.menu.items[0])),e.btnMerge.menu.on("item:click",_.bind(this.onMergeCellsMenu,this)),e.btnAlignTop.on("click",_.bind(this.onVerticalAlign,this,"top")),e.btnAlignMiddle.on("click",_.bind(this.onVerticalAlign,this,"center")),e.btnAlignBottom.on("click",_.bind(this.onVerticalAlign,this,"bottom")),e.btnWrap.on("click",_.bind(this.onWrap,this)),e.btnTextOrient.menu.on("item:click",_.bind(this.onTextOrientationMenu,this)),e.btnInsertImage.menu.on("item:click",_.bind(this.onInsertImageMenu,this)),e.btnInsertHyperlink.on("click",_.bind(this.onHyperlink,this)),e.btnInsertChart.on("click",_.bind(this.onInsertChart,this)),e.btnEditChart.on("click",_.bind(this.onInsertChart,this)),e.btnInsertText.on("click",_.bind(this.onInsertText,this)),e.btnInsertShape.menu.on("hide:after",_.bind(this.onInsertShapeHide,this)),e.btnSortDown.on("click",_.bind(this.onSortType,this,"ascending")),e.btnSortUp.on("click",_.bind(this.onSortType,this,"descending")),e.mnuitemSortAZ.on("click",_.bind(this.onSortType,this,"ascending")),e.mnuitemSortZA.on("click",_.bind(this.onSortType,this,"descending")),e.btnSetAutofilter.on("click",_.bind(this.onAutoFilter,this)),e.mnuitemAutoFilter.on("click",_.bind(this.onAutoFilter,this)),e.btnClearAutofilter.on("click",_.bind(this.onClearFilter,this)),e.mnuitemClearFilter.on("click",_.bind(this.onClearFilter,this)),e.btnTableTemplate.menu.on("show:after",_.bind(this.onTableTplMenuOpen,this)),e.btnPercentStyle.on("click",_.bind(this.onNumberFormat,this)),e.btnCurrencyStyle.on("click",_.bind(this.onNumberFormat,this)),e.btnDecDecimal.on("click",_.bind(this.onDecrement,this)),e.btnIncDecimal.on("click",_.bind(this.onIncrement,this)),e.btnInsertFormula.on("click",_.bind(this.onInsertFormulaMenu,this)),e.btnSettings.on("click",_.bind(this.onAdvSettingsClick,this)),e.btnInsertFormula.menu.on("item:click",_.bind(this.onInsertFormulaMenu,this)),e.btnClearStyle.menu.on("item:click",_.bind(this.onClearStyleMenu,this)),e.btnAddCell.menu.on("item:click",_.bind(this.onCellInsertMenu,this)),e.btnCopyStyle.on("toggle",_.bind(this.onCopyStyleToggle,this)),e.btnDeleteCell.menu.on("item:click",_.bind(this.onCellDeleteMenu,this)),e.btnColorSchemas.menu.on("item:click",_.bind(this.onColorSchemaClick,this)),e.cmbFontName.on("selected",_.bind(this.onFontNameSelect,this)),e.cmbFontName.on("show:after",_.bind(this.onFontNameOpen,this)),e.cmbFontName.on("hide:after",_.bind(this.onHideMenus,this)),e.cmbFontName.on("combo:blur",_.bind(this.onComboBlur,this)),e.cmbFontSize.on("selected",_.bind(this.onFontSizeSelect,this)),e.cmbFontSize.on("changed:before",_.bind(this.onFontSizeChanged,this,!0)),e.cmbFontSize.on("changed:after",_.bind(this.onFontSizeChanged,this,!1)),e.cmbFontSize.on("show:after",_.bind(this.onFontSizeOpen,this)),e.cmbFontSize.on("hide:after",_.bind(this.onHideMenus,this)),e.cmbFontSize.on("combo:blur",_.bind(this.onComboBlur,this)),e.mnuZoomIn&&e.mnuZoomIn.on("click",_.bind(this.onZoomInClick,this)),e.mnuZoomOut&&e.mnuZoomOut.on("click",_.bind(this.onZoomOutClick,this)),e.btnShowMode.menu.on("item:click",_.bind(this.onHideMenu,this)),e.listStyles.on("click",_.bind(this.onListStyleSelect,this)),e.btnNumberFormat.menu.on("item:click",_.bind(this.onNumberFormatMenu,this)),e.btnCurrencyStyle.menu.on("item:click",_.bind(this.onNumberFormatMenu,this)),e.mnuitemCompactToolbar.on("toggle",_.bind(this.onChangeViewMode,this)),$("#id-toolbar-menu-new-fontcolor").on("click",_.bind(this.onNewTextColor,this)),$("#id-toolbar-menu-new-paracolor").on("click",_.bind(this.onNewBackColor,this)),$("#id-toolbar-menu-new-bordercolor").on("click",_.bind(this.onNewBorderColor,this)),_.each(e.btnNumberFormat.menu.items,function(e){e.menu&&e.menu.on("item:click",_.bind(t.onNumberFormatMenu,t))}),this.onSetupCopyStyleButton()},setApi:function(e){this.api=e,this.api.asc_registerCallback("asc_onInitTablePictures",_.bind(this.onApiInitTableTemplates,this)),this.api.asc_registerCallback("asc_onInitEditorStyles",_.bind(this.onApiInitEditorStyles,this)),this.api.asc_registerCallback("asc_onСoAuthoringDisconnect",_.bind(this.onApiCoAuthoringDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onApiCoAuthoringDisconnect,this)),Common.NotificationCenter.on("copywarning:show",_.bind(function(){this._state.show_copywarning=!1},this))},onNewDocument:function(e,t){this.api&&this.api.asc_openNewDocument(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","New Document")},onOpenDocument:function(e,t){this.api&&this.api.asc_loadDocumentFromDisk(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Open Document")},onPrint:function(e){this.api&&(this.api.asc_Print(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("Print"),Common.component.Analytics.trackEvent("ToolBar","Print"))},onPrintMenu:function(e,t){t.value==="print"&&this.api&&(this.api.asc_Print(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("Print"),Common.component.Analytics.trackEvent("ToolBar","Print"))},onSave:function(e){if(this.api){var t=this.api.asc_isDocumentCanSave(),n=$(".btn-icon",this.toolbar.btnSave.cmpEl).hasClass("btn-synch");if(!t&&!n)return;this.api.asc_Save()}Common.component.Analytics.trackEvent("Save"),Common.component.Analytics.trackEvent("ToolBar","Save")},onUndo:function(e,t){this.api&&this.api.asc_Undo(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Undo")},onRedo:function(e,t){this.api&&this.api.asc_Redo(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Redo")},onCopyPaste:function(e,t){var n=this;if(n.api){if(typeof window["AscDesktopEditor"]=="object")e?n.api.asc_Copy():n.api.asc_Paste(),Common.NotificationCenter.trigger("edit:complete",n.toolbar);else{var r=window.localStorage.getItem("sse-hide-copywarning");(!r||parseInt(r)!=1)&&this._state.show_copywarning?(new Common.Views.CopyWarningDialog({handler:function(t){e?n.api.asc_Copy():n.api.asc_Paste(),t&&window.localStorage.setItem("sse-hide-copywarning",1),Common.NotificationCenter.trigger("edit:complete",n.toolbar)}})).show():(e?n.api.asc_Copy():n.api.asc_Paste(),Common.NotificationCenter.trigger("edit:complete",n.toolbar))}Common.component.Analytics.trackEvent("ToolBar","Copy Warning")}else Common.NotificationCenter.trigger("edit:complete",n.toolbar)},onIncreaseFontSize:function(e){this.api&&this.api.asc_increaseFontSize(),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Font Size")},onDecreaseFontSize:function(e){this.api&&this.api.asc_decreaseFontSize(),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Font Size")},onBold:function(e,t){this._state.bold=undefined,this.api&&this.api.asc_setCellBold(e.pressed),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Bold")},onItalic:function(e,t){this._state.italic=undefined,this.api&&this.api.asc_setCellItalic(e.pressed),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Italic")},onUnderline:function(e,t){this._state.underline=undefined,this.api&&this.api.asc_setCellUnderline(e.pressed),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Underline")},onTextColor:function(){this.toolbar.mnuTextColorPicker.trigger("select",this.toolbar.mnuTextColorPicker,this.toolbar.mnuTextColorPicker.currentColor,!0)},onBackColor:function(){this.toolbar.mnuBackColorPicker.trigger("select",this.toolbar.mnuBackColorPicker,this.toolbar.mnuBackColorPicker.currentColor,!0)},onTextColorSelect:function(e,t,n){this._state.clrtext_asccolor=this._state.clrtext=undefined;var r=typeof t=="object"?t.color:t;this.toolbar.btnTextColor.currentColor=t,$(".btn-color-value-line",this.toolbar.btnTextColor.cmpEl).css("background-color","#"+r),this.toolbar.mnuTextColorPicker.currentColor=t,this.api&&(this.toolbar.btnTextColor.ischanged=n!==!0,this.api.asc_setCellTextColor(Common.Utils.ThemeColor.getRgbColor(t)),this.toolbar.btnTextColor.ischanged=!1),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Text Color")},onBackColorSelect:function(e,t,n){this._state.clrshd_asccolor=this._state.clrback=undefined;var r=typeof t=="object"?t.color:t;this.toolbar.btnBackColor.currentColor=t,$(".btn-color-value-line",this.toolbar.btnBackColor.cmpEl).css("background-color",r=="transparent"?"transparent":"#"+r),this.toolbar.mnuBackColorPicker.currentColor=t,this.api&&(this.toolbar.btnBackColor.ischanged=n!==!0,this.api.asc_setCellBackgroundColor(t=="transparent"?null:Common.Utils.ThemeColor.getRgbColor(t)),this.toolbar.btnBackColor.ischanged=!1),Common.component.Analytics.trackEvent("ToolBar","Background Color")},onNewTextColor:function(e,t){this.toolbar.mnuTextColorPicker.addNewColor()},onNewBackColor:function(e,t){this.toolbar.mnuBackColorPicker.addNewColor()},onNewBorderColor:function(e,t){this.toolbar.btnBorders.menu.hide(),this.toolbar.btnBorders.toggle(!1,!0),this.toolbar.mnuBorderColorPicker.addNewColor()},onBorders:function(e){var t;_.each(e.menu.items,function(n){if(e.options.borderId==n.options.borderId)return t=n,!1}),t&&this.onBordersMenu(e.menu,t)},onBordersMenu:function(e,t){var n=this;if(n.api&&!_.isUndefined(t.options.borderId)){var r=n.toolbar.btnBorders,i=[],s=r.options.borderswidth,o=r.options.borderscolor;if(r.rendered){var u=$(".btn-icon",r.cmpEl);u&&(u.removeClass(r.options.icls),r.options.icls=t.options.icls,u.addClass(r.options.icls))}r.options.borderId=t.options.borderId,t.options.borderId=="inner"?(i[c_oAscBorderOptions.InnerV]=new Asc.asc_CBorder(s,o),i[c_oAscBorderOptions.InnerH]=new Asc.asc_CBorder(s,o)):t.options.borderId=="all"?(i[c_oAscBorderOptions.InnerV]=new Asc.asc_CBorder(s,o),i[c_oAscBorderOptions.InnerH]=new Asc.asc_CBorder(s,o),i[c_oAscBorderOptions.Left]=new Asc.asc_CBorder(s,o),i[c_oAscBorderOptions.Top]=new Asc.asc_CBorder(s,o),i[c_oAscBorderOptions.Right]=new Asc.asc_CBorder(s,o),i[c_oAscBorderOptions.Bottom]=new Asc.asc_CBorder(s,o)):t.options.borderId=="outer"?(i[c_oAscBorderOptions.Left]=new Asc.asc_CBorder(s,o),i[c_oAscBorderOptions.Top]=new Asc.asc_CBorder(s,o),i[c_oAscBorderOptions.Right]=new Asc.asc_CBorder(s,o),i[c_oAscBorderOptions.Bottom]=new Asc.asc_CBorder(s,o)):t.options.borderId!="none"&&(i[t.options.borderId]=new Asc.asc_CBorder(s,o)),n.api.asc_setCellBorders(i),Common.NotificationCenter.trigger("edit:complete",n.toolbar),Common.component.Analytics.trackEvent("ToolBar","Borders")}},onBordersWidth:function(e,t,n){n&&($("#id-toolbar-mnu-item-border-width .menu-item-icon").css("border-width",(t.value=="thin"?1:t.value=="medium"?2:3)+"px"),this.toolbar.btnBorders.options.borderswidth=t.value,Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Border Width"))},onBordersColor:function(e,t){$("#id-toolbar-mnu-item-border-color .menu-item-icon").css("border-color","#"+(typeof t=="object"?t.color:t)),this.toolbar.btnBorders.options.borderscolor=Common.Utils.ThemeColor.getRgbColor(t),this.toolbar.mnuBorderColorPicker.currentColor=t,Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Border Color")},onHorizontalAlign:function(e,t,n){this._state.pralign=undefined,this.api&&(this.api.asc_setCellAlign(t.pressed?e:"left"),this.toolbar.btnWrap.allowDepress=e!="justify"),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Horizontal align")},onHorizontalAlignMenu:function(e,t){var n=this.toolbar.btnHorizontalAlign,r=$(".btn-icon",n.cmpEl);r&&(r.removeClass(n.options.icls),n.options.icls=t.checked?t.options.icls:"btn-align-left",r.addClass(n.options.icls)),this._state.pralign=undefined,this.api&&this.api.asc_setCellAlign(t.checked?t.value:"left"),this.toolbar.btnWrap.allowDepress=t.value!="justify",Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Horizontal Align")},onVerticalAlignMenu:function(e,t){var n=this.toolbar.btnVerticalAlign,r=$(".btn-icon",n.cmpEl);r&&(r.removeClass(n.options.icls),n.options.icls=t.checked?t.options.icls:"btn-valign-bottom",r.addClass(n.options.icls)),this._state.valign=undefined,this.api&&this.api.asc_setCellVertAlign(t.checked?t.value:"bottom"),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Vertical Align")},onVerticalAlign:function(e,t,n){this._state.valign=undefined,this.api&&this.api.asc_setCellVertAlign(t.pressed?e:"bottom"),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Vertical align")},onMergeCellsMenu:function(e,t){function r(e){n._state.merge=undefined,n.api.asc_mergeCells(e),Common.NotificationCenter.trigger("edit:complete",n.toolbar),Common.component.Analytics.trackEvent("ToolBar","Merge")}var n=this;if(n.api){var i=n.api.asc_getCellInfo().asc_getFlags().asc_getMerge();!i&&n.api.asc_mergeCellsDataLost(t.value)?Common.UI.warning({msg:n.warnMergeLostData,buttons:["yes","no"],callback:function(e){e=="ok"?r(t.value):(n.toolbar.btnMerge.toggle(!1,!0),Common.NotificationCenter.trigger("edit:complete",n.toolbar),Common.component.Analytics.trackEvent("ToolBar","Merge"))}}):r(t.value)}Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Merge cells")},onWrap:function(e,t){this._state.wrap=undefined,this.api&&this.api.asc_setCellTextWrap(e.pressed),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Wrap")},onTextOrientationMenu:function(e,t){var n=0;switch(t.value){case"countcw":n=45;break;case"clockwise":n=-45;break;case"rotateup":n=90;break;case"rotatedown":n=-90}this._state.angle=undefined,this.api&&this.api.asc_setCellAngle(n),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Text orientation")},onInsertImageMenu:function(e,t,n){if(t.value==="file")this.toolbar.fireEvent("insertimage",this.toolbar),this.api&&this.api.asc_showImageFileDialog(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Image");else{var r=this;(new Common.Views.ImageFromUrlDialog({handler:function(e,t){if(e=="ok"){if(r.api){var n=t.replace(/\\s/g,"");_.isEmpty(n)?Common.UI.warning({msg:this.textEmptyImgUrl}):(r.toolbar.fireEvent("insertimage",r.toolbar),r.api.asc_addImageDrawingObject(n),Common.component.Analytics.trackEvent("ToolBar","Image"))}Common.NotificationCenter.trigger("edit:complete",r.toolbar)}}})).show()}},onHyperlink:function(e){var t=this,n,r;if(t.api){var i=t.api.asc_getWorksheetsCount(),s=-1,o=[];while(++s<i)this.api.asc_isWorksheetHidden(s)||o.push({displayValue:t.api.asc_getWorksheetName(s),value:t.api.asc_getWorksheetName(s)});var u=function(e,n){n=="ok"&&(r=e.getSettings(),t.api.asc_insertHyperlink(r)),Common.NotificationCenter.trigger("edit:complete",t.toolbar)},a=t.api.asc_getCellInfo(),f=a.asc_getFlags().asc_getSelectionType();r=a.asc_getHyperlink(),n=new SSE.Views.HyperlinkSettingsDialog({handler:u}),n.show(),n.setSettings({sheets:o,currentSheet:t.api.asc_getWorksheetName(t.api.asc_getActiveWorksheetIndex()),props:r,text:a.asc_getText(),isLock:a.asc_getFlags().asc_getLockText(),allowInternal:f!==c_oAscSelectionType.RangeImage&&f!==c_oAscSelectionType.RangeShape&&f!==c_oAscSelectionType.RangeShapeText&&f!==c_oAscSelectionType.RangeChart&&f!==c_oAscSelectionType.RangeChartText})}Common.component.Analytics.trackEvent("ToolBar","Add Hyperlink")},onInsertChart:function(e){if(!this.editMode)return;var t=this,n=t.api.asc_getCellInfo();if(n.asc_getFlags().asc_getSelectionType()!=c_oAscSelectionType.RangeImage){var r,i;if(t.api){i=t.api.asc_getChartObject();if(i){var s=t.toolbar.mode.isEditDiagram||n.asc_getFlags().asc_getSelectionType()==c_oAscSelectionType.RangeChart||n.asc_getFlags().asc_getSelectionType()==c_oAscSelectionType.RangeChartText;(new SSE.Views.ChartSettingsDlg({chartSettings:i,api:t.api,handler:function(e,n){e=="ok"&&t.api&&(s?t.api.asc_editChartDrawingObject(n.chartSettings):t.api.asc_addChartDrawingObject(n.chartSettings)),Common.NotificationCenter.trigger("edit:complete",t.toolbar)}})).show()}}}},onInsertText:function(e,t){this.api&&this._addAutoshape(e.pressed,"textRect"),this.toolbar.btnInsertShape.pressed&&this.toolbar.btnInsertShape.toggle(!1,!0),Common.NotificationCenter.trigger("edit:complete",this.toolbar,this.toolbar.btnInsertShape),Common.component.Analytics.trackEvent("ToolBar","Add Text")},onInsertShapeHide:function(e,t){this.toolbar.btnInsertShape.pressed&&!this._isAddingShape&&this.toolbar.btnInsertShape.toggle(!1,!0),this._isAddingShape=!1,Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onSortType:function(e,t){this.api&&this.api.asc_sortColFilter(e,"")},onAutoFilter:function(e){this._state.filter=undefined,this.api&&this.api.asc_addAutoFilter(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Auto filter")},onClearFilter:function(e){this.api&&this.api.asc_clearFilter(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Clear filter")},onNumberFormat:function(e){this.api&&this.api.asc_setCellFormat(e.options.formatId),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Number Format")},onNumberFormatMenu:function(e,t){this.api&&this.api.asc_setCellFormat(t.value),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Number Format")},onDecrement:function(e){this.api&&this.api.asc_decreaseCellDigitNumbers(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Decrement")},onIncrement:function(e){this.api&&this.api.asc_increaseCellDigitNumbers(),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Increment")},onInsertFormulaMenu:function(e,t,n){if(this.api)if(t.value==="more"){var r=this.getApplication().getController("FormulaDialog");r&&(this.api.asc_enableKeyEvents(!1),r.showDialog())}else t.value=t.value||"SUM",this.api.asc_insertFormula(t.value,!0),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Insert formula")},onClearStyleMenu:function(e,t,n){this.api&&this.api.asc_emptyCells(t.value),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Clear")},onCopyStyleToggle:function(e,t,n){this.api&&this.api.asc_formatPainter(t?1:0),Common.NotificationCenter.trigger("edit:complete",this.toolbar),this.modeAlwaysSetStyle=t},onCellInsertMenu:function(e,t,n){this.api&&this.api.asc_insertCells(t.value),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Cell insert")},onCellDeleteMenu:function(e,t,n){this.api&&this.api.asc_deleteCells(t.value),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Cell delete")},onColorSchemaClick:function(e,t){this.api&&(this.api.asc_ChangeColorScheme(t.value),Common.component.Analytics.trackEvent("ToolBar","Color Scheme")),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onComboBlur:function(){Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onFontNameSelect:function(e,t){this.api&&this.api.asc_setCellFontName(t.name),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Font Name")},onFontNameOpen:function(e){_.delay(function(){$("input",e.cmpEl).select().focus()},10)},onFontSizeSelect:function(e,t){this.api&&this.api.asc_setCellFontSize(t.value),Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0}),Common.component.Analytics.trackEvent("ToolBar","Font Size")},onFontSizeChanged:function(e,t,n,r){var i,s=this;if(e){var o=t.store.findWhere({displayValue:n.value});if(!o){i=/^\\+?(\\d*\\.?\\d+)$|^\\+?(\\d+\\.?\\d*)$/.exec(n.value);if(!i)return i=this._getApiTextSize(),Common.UI.error({msg:this.textFontSizeErr,callback:function(){_.defer(function(e){s.api.asc_enableKeyEvents(!1),$("input",t.cmpEl).focus()})}}),t.setRawValue(i),r.preventDefault(),!1}}else i=parseFloat(n.value),i=i>300?300:i<1?1:Math.floor((i+.4)*2)/2,t.setRawValue(i),this.api&&this.api.asc_setCellFontSize(i),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onFontSizeOpen:function(e){_.delay(function(){$("input",e.cmpEl).select().focus()},10)},onAdvSettingsClick:function(e,t){this.toolbar.fireEvent("file:settings",this),e.cmpEl.blur()},onZoomInClick:function(e){if(this.api){var t=this.api.asc_getZoom()+.1;t>0&&!(t>2)&&this.api.asc_setZoom(t)}Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onZoomOutClick:function(e){if(this.api){var t=this.api.asc_getZoom()-.1;t<.5||this.api.asc_setZoom(t)}Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onHideMenu:function(e,t){var n={},r;switch(t.value){case"title":n.title=t.checked,r="sse-hidden-title";break;case"formula":n.formula=t.checked,r="sse-hidden-formula";break;case"headings":n.headings=t.checked;break;case"gridlines":n.gridlines=t.checked;break;case"freezepanes":n.freezepanes=!0}this.hideElements(n),r&&localStorage.setItem(r,t.checked),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},onListStyleSelect:function(e,t){this._state.prstyle=undefined,this.api&&(this.api.asc_setCellStyle(t.get("name")),Common.NotificationCenter.trigger("edit:complete",this.toolbar),Common.component.Analytics.trackEvent("ToolBar","Style"))},createDelayedElements:function(){var e=this;this.api.asc_registerCallback("asc_onShowChartDialog",_.bind(this.onApiChartDblClick,this)),this.api.asc_registerCallback("asc_onCanUndoChanged",_.bind(this.onApiCanRevert,this,"undo")),this.api.asc_registerCallback("asc_onCanRedoChanged",_.bind(this.onApiCanRevert,this,"redo")),this.api.asc_registerCallback("asc_onEditCell",_.bind(this.onApiEditCell,this)),this.api.asc_registerCallback("asc_onEndAddShape",_.bind(this.onApiEndAddShape,this)),this.api.asc_registerCallback("asc_onZoomChanged",_.bind(this.onApiZoomChange,this)),this.api.asc_registerCallback("asc_onSheetsChanged",_.bind(this.onApiSheetChanged,this)),this.api.asc_registerCallback("asc_onStopFormatPainter",_.bind(this.onApiStyleChange,this)),this.api.asc_registerCallback("asc_onUpdateSheetViewSettings",_.bind(this.onApiSheetChanged,this)),Common.util.Shortcuts.delegateShortcuts({shortcuts:{"command+l,ctrl+l":function(t){return e.editMode&&e.api.asc_getCellInfo().asc_getIsFormatTable()!==!0&&e._setTableFormat(e.toolbar.mnuTableTemplatePicker.store.at(23).get("name")),!1},"command+shift+l,ctrl+shift+l":function(t){return e._state.filter=undefined,e.editMode&&e.api&&e.api.asc_addAutoFilter(),!1},"command+s,ctrl+s":function(t){e.onSave(),t.preventDefault(),t.stopPropagation()},"command+k,ctrl+k":function(t){e.editMode&&!e.toolbar.mode.isEditDiagram&&!e.api.isCellEdited&&e.onHyperlink(),t.preventDefault()}}}),this.wrapOnSelectionChanged=_.bind(this.onApiSelectionChanged,this),this.api.asc_registerCallback("asc_onSelectionChanged",this.wrapOnSelectionChanged),this.onApiSelectionChanged(this.api.asc_getCellInfo()),this.api.asc_registerCallback("asc_onEditorSelectionChanged",_.bind(this.onApiEditorSelectionChanged,this)),this.attachToControlEvents(),this.onApiSheetChanged(),Common.NotificationCenter.on("cells:range",_.bind(this.onCellsRange,this))},onChangeViewMode:function(e,t){var n=this,r=$("#id-toolbar-full"),i=$("#id-toolbar-short");n.toolbar.isCompactView=t,r&&i&&(n.api.asc_unregisterCallback("asc_onSelectionChanged",n.wrapOnSelectionChanged),t?(i.css({display:"table"}),r.css({display:"none"}),i.parent().css({height:"41px"}),n.toolbar.rendererComponents("short")):(i.css({display:"none"}),r.css({display:"table"}),i.parent().css({height:"67px"}),n.toolbar.rendererComponents("full"),_.defer(function(){var e=n.toolbar.listStyles.rendered;n.toolbar.listStyles.menuPicker.store.length>0&&e&&n.toolbar.listStyles.fillComboView(n.toolbar.listStyles.menuPicker.getSelectedRec(),!0)},100)),n._state.coauthdisable=undefined,n.api.asc_registerCallback("asc_onSelectionChanged",n.wrapOnSelectionChanged),n.onApiSelectionChanged(n.api.asc_getCellInfo()),window.localStorage.setItem("sse-toolbar-compact",t?1:0),Common.NotificationCenter.trigger("layout:changed","toolbar"))},fillTableTemplates:function(){function t(t){var n=new Common.UI.DataView({el:t,store:e.getCollection("TableTemplates"),itemTemplate:_.template(\'<div class="item-template"><img src="<%= imageUrl %>" id="<%= id %>"></div>\')});return n.on("item:click",function(t,n,r){e.api&&(e._setTableFormat(r.get("name")),Common.NotificationCenter.trigger("edit:complete",e.toolbar),Common.component.Analytics.trackEvent("ToolBar","Table Templates"))}),n.scroller&&n.scroller.update({}),n}var e=this;_.isUndefined(this.toolbar.mnuTableTemplatePicker)&&(this.toolbar.mnuTableTemplatePicker=t($("#id-toolbar-menu-table-templates"))),_.isUndefined(this.toolbar.mnuTableTemplatePickerShort)&&(this.toolbar.mnuTableTemplatePickerShort=t($("#id-toolbar-short-menu-table-templates")))},onTableTplMenuOpen:function(e){var t=this.toolbar.mnuTableTemplatePicker.scroller;t&&(t.update(),t.scrollTop(0))},onApiInitTableTemplates:function(e){var t=this.getCollection("TableTemplates");if(t){var n=[];_.each(e,function(e){n.push({name:e.asc_getName(),caption:e.asc_getDisplayName(),type:e.asc_getType(),imageUrl:e.asc_getImage(),allowSelected:!1,selected:!1})}),t.reset(),t.add(n)}this.fillTableTemplates()},onApiInitEditorStyles:function(e){window.styles_loaded=!1;var t=this,n=t.toolbar.listStyles;if(!n){t.styles=e;return}var r=document.createElement("canvas");r.id="bigimgdefaultstyles";var i=e.asc_getDocStylesImage().length>0,s=function(){n.menuPicker.store.reset([]);var t=e.asc_getStyleThumbnailWidth(),s=e.asc_getStyleThumbnailHeight(),o=e.asc_getDefaultStyles();i&&(o=o.concat(e.asc_getDocStyles()));var u=document.createElement("canvas"),f=u.getContext("2d");u.width=t,u.height=s,_.each(o,function(e){f.clearRect(0,0,t,s),f.save(),f.translate(0,-e.asc_getThumbnailOffset()*s),f.drawImage(e.asc_getType()==c_oAscStyleImage.Default?r:a,0,0),f.restore(),n.menuPicker.store.add({imageUrl:u.toDataURL(),name:e.asc_getName(),uid:Common.UI.getId()})}),n.menuPicker.store.length>0&&n.rendered&&(n.fillComboView(n.menuPicker.store.at(0),!0),n.selectByIndex(0)),window.styles_loaded=!0},o=new Image,u=1;if(i){u++;var a=document.createElement("canvas");a.id="bigimgdocstyles";var f=new Image;f.onload=function(){a.width=f.width,a.height=f.height,a.getContext("2d").drawImage(f,0,0),--u>0||s()}}o.onload=function(){r.width=o.width,r.height=o.height,r.getContext("2d").drawImage(o,0,0),--u>0||s()},o.src=e.asc_getDefaultStylesImage(),f&&(f.src=e.asc_getDocStylesImage())},onApiCoAuthoringDisconnect:function(){this.toolbar.setMode({isDisconnected:!0}),this.editMode=!1},onApiChartDblClick:function(){this.onInsertChart(this.btnInsertChart)},onApiCanRevert:function(e,t){e=="undo"?this._state.can_undo!==t&&(this.toolbar.btnUndo.setDisabled(!t),this._state.can_undo=t):this._state.can_redo!==t&&(this.toolbar.btnRedo.setDisabled(!t),this._state.can_redo=t)},setDisabledComponents:function(e,t){_.each([].concat(e),function(e){e.isDisabled()!==t&&e.setDisabled(t)})},onApiEditCell:function(e){var t=this.toolbar;if(t.mode.isEditDiagram)n=e==c_oAscCellEditorState.editStart,t.lockToolbar(SSE.enumLock.editCell,e==c_oAscCellEditorState.editStart,{array:[t.btnDecDecimal,t.btnIncDecimal,t.btnNumberFormat]});else if(e==c_oAscCellEditorState.editStart||e==c_oAscCellEditorState.editEnd){t.lockToolbar(SSE.enumLock.editCell,e==c_oAscCellEditorState.editStart,{array:[t.btnClearStyle.menu.items[1],t.btnClearStyle.menu.items[2],t.btnClearStyle.menu.items[3],t.btnClearStyle.menu.items[4],t.mnuitemClearFilter],merge:!0,clear:[SSE.enumLock.editFormula,SSE.enumLock.editText]});var n=e==c_oAscCellEditorState.editStart;n?Common.util.Shortcuts.suspendEvents("command+l, ctrl+l, command+shift+l, ctrl+shift+l, command+k, ctrl+k, command+alt+h, ctrl+alt+h"):Common.util.Shortcuts.resumeEvents("command+l, ctrl+l, command+shift+l, ctrl+shift+l, command+k, ctrl+k, command+alt+h, ctrl+alt+h"),n&&(t.listStyles.suspendEvents(),t.listStyles.menuPicker.selectRecord(null),t.listStyles.resumeEvents(),this._state.prstyle=undefined)}else{if(e==c_oAscCellEditorState.editText)var r=!0,i=!1;else e==c_oAscCellEditorState.editFormula?r=!(i=!0):e==c_oAscCellEditorState.editEmptyCell&&(r=i=!1);t.lockToolbar(SSE.enumLock.editFormula,i,{array:[t.cmbFontName,t.cmbFontSize,t.btnIncFontSize,t.btnDecFontSize,t.btnBold,t.btnItalic,t.btnUnderline,t.btnTextColor]}),t.lockToolbar(SSE.enumLock.editText,r,{array:[t.btnInsertFormula]})}this._state.coauthdisable=undefined,this._state.selection_type=undefined,this.checkInsertAutoshape({action:"cancel"})},onApiZoomChange:function(e,t){switch(t){case 1:case 2:case 0:default:$(".menu-zoom .zoom",this.toolbar.el).html(Math.floor((e+.005)*100)+"%")}},onApiSheetChanged:function(){if(this.api){var e=this.api.asc_getSheetViewSettings(),t=this.toolbar.btnShowMode.menu;t&&(t.items[3].setChecked(!e.asc_getShowRowColHeaders()),t.items[4].setChecked(!e.asc_getShowGridLines()),t.items[5].setChecked(e.asc_getIsFreezePane()))}},onApiEditorSelectionChanged:function(e){if(!this.editMode)return;var t=this.toolbar,n,r=e.asc_getName();r!=t.cmbFontName.getValue()&&Common.NotificationCenter.trigger("fonts:change",e),t.mode.isEditDiagram||(n=e.asc_getBold(),this._state.bold!==n&&(t.btnBold.toggle(n===!0,!0),this._state.bold=n),n=e.asc_getItalic(),this._state.italic!==n&&(t.btnItalic.toggle(n===!0,!0),this._state.italic=n),n=e.asc_getUnderline(),this._state.underline!==n&&(t.btnUnderline.toggle(n===!0,!0),this._state.underline=n));var i=e.asc_getSize();t.cmbFontSize.getValue()!=i&&t.cmbFontSize.setValue(i!==undefined?i:"");var s,o,u=this.toolbar.mnuTextColorPicker;if(!t.btnTextColor.ischanged&&!u.isDummy){o=e.asc_getColor(),o&&(o.get_type()==c_oAscColor.COLOR_TYPE_SCHEME?s={color:Common.Utils.ThemeColor.getHexColor(o.get_r(),o.get_g(),o.get_b()),effectValue:o.get_value()}:s=Common.Utils.ThemeColor.getHexColor(o.get_r(),o.get_g(),o.get_b()));var a=typeof s,f=typeof this._state.clrtext;if(a!==f||a=="object"&&(s.effectValue!==this._state.clrtext.effectValue||this._state.clrtext.color.indexOf(s.color)<0)||a!="object"&&this._state.clrtext!==undefined&&this._state.clrtext.indexOf(s)<0){if(_.isObject(s)){var l=!1;for(var c=0;c<10;c++)if(Common.Utils.ThemeColor.ThemeValues[c]==s.effectValue){u.select(s,!0),l=!0;break}l||u.clearSelection()}else u.select(s,!0);this._state.clrtext=s}this._state.clrtext_asccolor=o}},onApiSelectionChanged:function(e){if(!this.editMode)return;var t=e.asc_getFlags().asc_getSelectionType(),n=this.toolbar.mode.isEditDiagram?!1:e.asc_getLocked()===!0;if(this._disableEditOptions(t,n))return;var r=this,i=this.toolbar,s=e.asc_getFont(),o,u=s.asc_getName();u!=i.cmbFontName.getValue()&&Common.NotificationCenter.trigger("fonts:change",s),i.mode.isEditDiagram||(o=s.asc_getBold(),this._state.bold!==o&&(i.btnBold.toggle(o===!0,!0),this._state.bold=o),o=s.asc_getItalic(),this._state.italic!==o&&(i.btnItalic.toggle(o===!0,!0),this._state.italic=o),o=s.asc_getUnderline(),this._state.underline!==o&&(i.btnUnderline.toggle(o===!0,!0),this._state.underline=o));var a=s.asc_getSize();i.cmbFontSize.getValue()!=a&&i.cmbFontSize.setValue(a!==undefined?a:"");var f,l,c=this.toolbar.mnuTextColorPicker,h=this.toolbar.mnuBackColorPicker;if(!i.btnTextColor.ischanged&&!c.isDummy){l=s.asc_getColor(),l&&(l.get_type()==c_oAscColor.COLOR_TYPE_SCHEME?f={color:Common.Utils.ThemeColor.getHexColor(l.get_r(),l.get_g(),l.get_b()),effectValue:l.get_value()}:f=Common.Utils.ThemeColor.getHexColor(l.get_r(),l.get_g(),l.get_b()));var p=typeof f,d=typeof this._state.clrtext;if(p!==d||p=="object"&&(f.effectValue!==this._state.clrtext.effectValue||this._state.clrtext.color.indexOf(f.color)<0)||p!="object"&&this._state.clrtext!==undefined&&this._state.clrtext.indexOf(f)<0){if(_.isObject(f)){var v=!1;for(var m=0;m<10;m++)if(Common.Utils.ThemeColor.ThemeValues[m]==f.effectValue){c.select(f,!0),v=!0;break}v||c.clearSelection()}else c.select(f,!0);this._state.clrtext=f}this._state.clrtext_asccolor=l}if(!i.btnBackColor.ischanged&&!h.isDummy){l=e.asc_getFill().asc_getColor(),l?l.get_type()==c_oAscColor.COLOR_TYPE_SCHEME?f={color:Common.Utils.ThemeColor.getHexColor(l.get_r(),l.get_g(),l.get_b()),effectValue:l.get_value()}:f=Common.Utils.ThemeColor.getHexColor(l.get_r(),l.get_g(),l.get_b()):f="transparent",p=typeof f,d=typeof this._state.clrback;if(p!==d||p=="object"&&(f.effectValue!==this._state.clrback.effectValue||this._state.clrback.color.indexOf(f.color)<0)||p!="object"&&this._state.clrback!==undefined&&this._state.clrback.indexOf(f)<0){if(_.isObject(f)){var v=!1;for(m=0;m<10;m++)if(Common.Utils.ThemeColor.ThemeValues[m]==f.effectValue){h.select(f,!0),v=!0;break}v||h.clearSelection()}else h.select(f,!0);this._state.clrback=f}this._state.clrshd_asccolor=l}if(t==c_oAscSelectionType.RangeChart||t==c_oAscSelectionType.RangeChartText)return;if(!i.mode.isEditDiagram){u=e.asc_getHorAlign();if(this._state.pralign!==u){this._state.pralign=u;var g=-1,y;switch(u){case"left":g=0,y="btn-align-left";break;case"center":g=1,y="btn-align-center";break;case"right":g=2,y="btn-align-right";break;case"justify":g=3,y="btn-align-just";break;default:g=-255,y="btn-align-left"}g<0?g==-255&&(i.btnAlignRight.toggle(!1,!0),i.btnAlignLeft.toggle(!1,!0),i.btnAlignCenter.toggle(!1,!0),i.btnAlignJust.toggle(!1,!0),this._clearChecked(i.btnHorizontalAlign.menu)):(i.btnAlignRight.toggle(g===2,!0),i.btnAlignLeft.toggle(g===0,!0),i.btnAlignCenter.toggle(g===1,!0),i.btnAlignJust.toggle(g===3,!0),i.btnHorizontalAlign.menu.items[g].setChecked(!0,!1));var b=this.toolbar.btnHorizontalAlign;if(b.rendered){var w=$(".btn-icon",b.cmpEl);w&&(w.removeClass(b.options.icls),b.options.icls=y,w.addClass(b.options.icls))}i.btnTextOrient.menu.items[1].setDisabled(u=="justify"),i.btnTextOrient.menu.items[2].setDisabled(u=="justify")}u=e.asc_getVertAlign();if(this._state.valign!==u){this._state.valign=u,g=-1,y="";switch(u){case"top":g=0,y="btn-valign-top";break;case"center":g=1,y="btn-valign-middle";break;case"bottom":g=2,y="btn-valign-bottom"}if(g>-1){i.btnAlignTop.toggle(g===0,!0),i.btnAlignMiddle.toggle(g===1,!0),i.btnAlignBottom.toggle(g===2,!0),i.btnVerticalAlign.menu.items[g].setChecked(!0,!1);var E=this.toolbar.btnVerticalAlign;if(E.rendered){var S=$(".btn-icon",E.cmpEl);S&&(S.removeClass(E.options.icls),E.options.icls=y,S.addClass(E.options.icls))}}}var x=this._state.controlsdisabled.filters||e.asc_getIsFormatTable()===!0;i.lockToolbar(SSE.enumLock.ruleMerge,x,{array:[i.btnMerge]}),o=e.asc_getFlags().asc_getMerge(),this._state.merge!==o&&(i.btnMerge.toggle(o===!0,!0),this._state.merge=o),o=e.asc_getIsAutoFilter(),this._state.filter!==o&&(i.btnSetAutofilter.toggle(o===!0,!0),i.mnuitemAutoFilter.setChecked(o===!0,!0),this._state.filter=o),x=this._state.controlsdisabled.filters||o===null,i.lockToolbar(SSE.enumLock.ruleFilter,x,{array:[i.btnSortDown,i.btnSortUp,i.mnuitemSortAZ,i.mnuitemSortZA,i.btnTableTemplate,i.btnSetAutofilter,i.mnuitemAutoFilter,i.btnAutofilter]}),x=this._state.controlsdisabled.filters||e.asc_getClearFilter()!==!0,i.lockToolbar(SSE.enumLock.ruleDelFilter,x,{array:[i.btnClearAutofilter,i.mnuitemClearFilter]}),i.btnWrap.isDisabled()||(o=e.asc_getFlags().asc_getWrapText(),this._state.wrap!==o&&(i.btnWrap.toggle(o===!0,!0),this._state.wrap=o))}u=i.numFormatTypes[e.asc_getNumFormatType()],u||(u=i.numFormatTypes[1]),i.btnNumberFormat.setCaption(u),o=e.asc_getAngle();if(this._state.angle!==o){this._clearChecked(i.btnTextOrient.menu);switch(o){case 45:i.btnTextOrient.menu.items[1].setChecked(!0,!0);break;case-45:i.btnTextOrient.menu.items[2].setChecked(!0,!0);break;case 90:i.btnTextOrient.menu.items[3].setChecked(!0,!0);break;case-90:i.btnTextOrient.menu.items[4].setChecked(!0,!0);break;default:i.btnTextOrient.menu.items[0].setChecked(!0,!0)}this._state.angle=o}o=e.asc_getStyleName();if(this._state.prstyle!=o&&!this.toolbar.listStyles.isDisabled()){var T=this.toolbar.listStyles,N=T.rendered;if(N){T.suspendEvents();var C=T.menuPicker.store.findWhere({name:o});this._state.prstyle=T.menuPicker.store.length>0?o:undefined,T.menuPicker.selectRecord(C),T.resumeEvents()}}o=t==c_oAscSelectionType.RangeRow,this._state.controlsdisabled.rows!==o&&(this._state.controlsdisabled.rows=o,i.btnAddCell.menu.items[0].setDisabled(o),i.btnAddCell.menu.items[3].setDisabled(o),i.btnDeleteCell.menu.items[0].setDisabled(o),i.btnDeleteCell.menu.items[3].setDisabled(o)),o=t==c_oAscSelectionType.RangeCol,this._state.controlsdisabled.cols!==o&&(this._state.controlsdisabled.cols=o,i.btnAddCell.menu.items[1].setDisabled(o),i.btnAddCell.menu.items[2].setDisabled(o),i.btnDeleteCell.menu.items[1].setDisabled(o),i.btnDeleteCell.menu.items[2].setDisabled(o))},onApiStyleChange:function(){this.toolbar.btnCopyStyle.toggle(!1,!0),this.modeAlwaysSetStyle=!1},updateThemeColors:function(){var e=function(e,t){if(e){var n,r=Common.Utils.ThemeColor.getEffectColors();for(var i=0;i<r.length;i++)typeof e.currentColor=="object"&&n===undefined&&e.currentColor.effectId==r[i].effectId&&(n=r[i]);e.updateColors(r,Common.Utils.ThemeColor.getStandartColors()),e.currentColor===undefined?e.current

]]></string> </value>
        </item>
        <item>
            <key> <string>next</string> </key>
            <value>
              <persistent> <string encoding="base64">AAAAAAAAAAk=</string> </persistent>
            </value>
        </item>
      </dictionary>
    </pickle>
  </record>
  <record id="9" aka="AAAAAAAAAAk=">
    <pickle>
      <global name="Pdata" module="OFS.Image"/>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>data</string> </key>
            <value> <string encoding="cdata"><![CDATA[

Color=t:n!==undefined&&(e.currentColor=n)}};e(this.toolbar.mnuTextColorPicker,Common.Utils.ThemeColor.getStandartColors()[1]),this.toolbar.btnTextColor.currentColor===undefined?this.toolbar.btnTextColor.currentColor=Common.Utils.ThemeColor.getStandartColors()[1]:this.toolbar.btnTextColor.currentColor=this.toolbar.mnuTextColorPicker.currentColor.color||this.toolbar.mnuTextColorPicker.currentColor,$(".btn-color-value-line",this.toolbar.btnTextColor.cmpEl).css("background-color","#"+this.toolbar.btnTextColor.currentColor),e(this.toolbar.mnuBackColorPicker,Common.Utils.ThemeColor.getStandartColors()[3]),this.toolbar.btnBackColor.currentColor===undefined?this.toolbar.btnBackColor.currentColor=Common.Utils.ThemeColor.getStandartColors()[3]:this.toolbar.btnBackColor.currentColor=this.toolbar.mnuBackColorPicker.currentColor.color||this.toolbar.mnuBackColorPicker.currentColor,$(".btn-color-value-line",this.toolbar.btnBackColor.cmpEl).css("background-color",this.toolbar.btnBackColor.currentColor=="transparent"?"transparent":"#"+this.toolbar.btnBackColor.currentColor);if(this._state.clrtext_asccolor!==undefined||this._state.clrshd_asccolor!==undefined)this._state.clrtext=undefined,this._state.clrback=undefined,this.onApiSelectionChanged(this.api.asc_getCellInfo());this._state.clrtext_asccolor=undefined,this._state.clrshd_asccolor=undefined,e(this.toolbar.mnuBorderColorPicker,Common.Utils.ThemeColor.getEffectColors()[1]),this.toolbar.btnBorders.options.borderscolor=this.toolbar.mnuBorderColorPicker.currentColor.color||this.toolbar.mnuBorderColorPicker.currentColor,$("#id-toolbar-mnu-item-border-color .menu-item-icon").css("border-color","#"+this.toolbar.btnBorders.options.borderscolor)},hideElements:function(e){if(!_.isUndefined(e.title)){var t=this.getApplication().getController("Viewport").getView("Common.Views.Header");t&&t.setVisible(!e.title),Common.NotificationCenter.trigger("layout:changed","header")}_.isUndefined(e.compact)||this.onChangeViewMode(e.compact);if(!_.isUndefined(e.formula)){var n=this.getApplication().getController("CellEditor").getView("CellEditor");n&&n.setVisible(!e.formula),Common.NotificationCenter.trigger("layout:changed","celleditor",e.formula?"hidden":"showed")}if(!_.isUndefined(e.headings)&&this.api){var r=this.api.asc_getSheetViewSettings();r.asc_setShowRowColHeaders(!e.headings),this.api.asc_setSheetViewSettings(r)}_.isUndefined(e.gridlines)||this.api&&(r=this.api.asc_getSheetViewSettings(),r.asc_setShowGridLines(!e.gridlines),this.api.asc_setSheetViewSettings(r)),_.isUndefined(e.freezepanes)||this.api&&this.api.asc_freezePane(),Common.NotificationCenter.trigger("edit:complete",this.toolbar)},fillAutoShapes:function(){var e=this,t=this.getApplication().getCollection("ShapeGroups");for(var n=0;n<t.length-1;n++){var r=t.at(n),i=new Common.UI.MenuItem({caption:r.get("groupName"),menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{template:_.template(\'<div id="id-toolbar-menu-shapegroup\'+n+\'" class="menu-shape" style="width: \'+(r.get("groupWidth")-8)+\'px; margin-left: 5px;"></div>\')}]})});e.toolbar.btnInsertShape.menu.addItem(i);var s=new Common.UI.DataView({el:$("#id-toolbar-menu-shapegroup"+n),store:r.get("groupStore"),itemTemplate:_.template(\'<div class="item-shape"><img src="<%= imageUrl %>" id="<%= id %>"></div>\')});s.on("item:click",function(t,n,r){e.api&&(e._addAutoshape(!0,r.get("data").shapeType),e._isAddingShape=!0,e.toolbar.btnInsertText.pressed&&e.toolbar.btnInsertText.toggle(!1,!0),Common.NotificationCenter.trigger("edit:complete",e.toolbar,e.toolbar.btnInsertShape),Common.component.Analytics.trackEvent("ToolBar","Add Shape"))})}},attachToControlEvents:function(){},onSheetChanged:function(){if(this.api){var e=this.api.asc_getSheetViewSettings(),t=this.getMenuHideOptions();t&&(t.items.getAt(3).setChecked(!e.asc_getShowRowColHeaders()),t.items.getAt(4).setChecked(!e.asc_getShowGridLines()))}},_disableEditOptions:function(e,t){if(this.api.isCellEdited)return!0;if(this.api.isRangeSelection)return!0;if(this._state.selection_type===e&&this._state.coauthdisable===t)return e===c_oAscSelectionType.RangeImage;var n=this.toolbar,r=e==c_oAscSelectionType.RangeChartText,i=e==c_oAscSelectionType.RangeChart,s=e==c_oAscSelectionType.RangeShapeText,o=e==c_oAscSelectionType.RangeShape,u=e==c_oAscSelectionType.RangeImage,a=s||o||r||i;if(t)n.lockToolbar(SSE.enumLock.coAuth,t);else{var f=SSE.enumLock,l=e;switch(e){case c_oAscSelectionType.RangeImage:l=f.selImage;break;case c_oAscSelectionType.RangeShape:l=f.selShape;break;case c_oAscSelectionType.RangeShapeText:l=f.selShapeText;break;case c_oAscSelectionType.RangeChart:l=f.selChart;break;case c_oAscSelectionType.RangeChartText:l=f.selChartText}n.lockToolbar(l,l!=e,{array:[n.btnClearStyle.menu.items[1],n.btnClearStyle.menu.items[2],n.btnClearStyle.menu.items[3],n.btnClearStyle.menu.items[4],n.mnuitemSortAZ,n.mnuitemSortZA,n.mnuitemAutoFilter,n.mnuitemClearFilter],merge:!0,clear:[f.selImage,f.selChart,f.selChartText,f.selShape,f.selShapeText,f.coAuth]})}$("#ce-func-label").toggleClass("disabled",u||a||t),this._state.controlsdisabled.filters=u||a||t;if(u||a||t)n.listStyles.suspendEvents(),n.listStyles.menuPicker.selectRecord(null),n.listStyles.resumeEvents(),this._state.prstyle=undefined;return this._state.selection_type=e,this._state.coauthdisable=t,u},_getApiTextSize:function(){var e=this.api.asc_getCellInfo();return e?e.asc_getFont().asc_getSize():12},_clearChecked:function(e){_.each(e.items,function(e){e.setChecked&&e.setChecked(!1,!0)})},_setTableFormat:function(e){var t=this;if(t.api.isRangeSelection!==!0)if(t.api.asc_getAddFormatTableOptions()!=0){var n=function(n,r){r=="ok"&&(t._state.filter=undefined,t.api.asc_setSelectionDialogMode(c_oAscSelectionDialogType.None),t.api.asc_addAutoFilter(e,n.getSettings())),Common.NotificationCenter.trigger("edit:complete",t.toolbar)},r=new SSE.Views.TableOptionsDialog({handler:n});r.show(),r.setSettings({api:t.api})}else t._state.filter=undefined,t.api.asc_addAutoFilter(e)},onHideMenus:function(e){Common.NotificationCenter.trigger("edit:complete",this.toolbar,{restorefocus:!0})},onSetupCopyStyleButton:function(){this.modeAlwaysSetStyle=!1;var e={kOff:0,kOn:1,kMultiple:2},t=this;Common.NotificationCenter.on({"edit:complete":function(){t.api&&t.modeAlwaysSetStyle&&(t.api.asc_formatPainter(e.kOff),t.toolbar.btnCopyStyle.toggle(!1,!0),t.modeAlwaysSetStyle=!1)}}),$(t.toolbar.btnCopyStyle.cmpEl).dblclick(function(){t.api&&(t.modeAlwaysSetStyle=!0,t.toolbar.btnCopyStyle.toggle(!0,!0),t.api.asc_formatPainter(e.kMultiple))})},onCellsRange:function(e){this.api.isRangeSelection=e!=c_oAscSelectionDialogType.None,this.onApiEditCell(this.api.isRangeSelection?c_oAscCellEditorState.editStart:c_oAscCellEditorState.editEnd);var t=this.toolbar;t.lockToolbar(SSE.enumLock.selRange,this.api.isRangeSelection),this.setDisabledComponents([t.btnUndo],this.api.isRangeSelection||!this.api.asc_getCanUndo()),this.setDisabledComponents([t.btnRedo],this.api.isRangeSelection||!this.api.asc_getCanRedo()),this.onApiSelectionChanged(this.api.asc_getCellInfo())},DisableToolbar:function(e){var t=$(".toolbar-mask");if(e&&t.length>0||!e&&t.length==0)return;var n=this.toolbar;n.$el.find(".toolbar").toggleClass("masked",e),this.toolbar.lockToolbar(SSE.enumLock.menuFileOpen,e,{array:[n.btnShowMode]});if(e){t=$("<div class=\'toolbar-mask\'>").appendTo(n.$el);var r=n.isCompactView?75:n.mode.nativeApp?80:48;t.css("left",r+"px"),t.css("right",(n.isCompactView?0:45)+"px"),Common.util.Shortcuts.suspendEvents("command+l, ctrl+l, command+shift+l, ctrl+shift+l, command+k, ctrl+k, command+alt+h, ctrl+alt+h")}else t.remove(),Common.util.Shortcuts.resumeEvents("command+l, ctrl+l, command+shift+l, ctrl+shift+l, command+k, ctrl+k, command+alt+h, ctrl+alt+h")},textEmptyImgUrl:"You need to specify image URL.",warnMergeLostData:"Operation will can destroy data in the selected cells.<br>Continue?",textWarning:"Warning",textFontSizeErr:"The entered value must be more than 0",textCancel:"Cancel"})}),define("text!spreadsheeteditor/main/app/template/StatusBar.template",[],function(){return\'\\r\\n<div class="statusbar">\\r\\n    <div id="status-tabs-scroll" class="status-group">\\r\\n        <button id="status-btn-tabfirst" type="button" class="btn small btn-toolbar btn-toolbar-default"><span class="btn-icon btn-tab-first">&nbsp;</span></button>\\r\\n        <button id="status-btn-tabback" type="button" class="btn small btn-toolbar btn-toolbar-default"><span class="btn-icon btn-tab-back">&nbsp;</span></button>\\r\\n        <button id="status-btn-tabnext" type="button" class="btn small btn-toolbar btn-toolbar-default"><span class="btn-icon btn-tab-next">&nbsp;</span></button>\\r\\n        <button id="status-btn-tablast" type="button" class="btn small btn-toolbar btn-toolbar-default"><span class="btn-icon btn-tab-last">&nbsp;</span></button>\\r\\n    </div>\\r\\n    <div id="status-addtabs-box" class="status-group">\\r\\n        <button id="status-btn-addtab" type="button" class="btn small btn-toolbar btn-toolbar-default"><span class="btn-icon btn-zoom-up">&nbsp;</span></button>\\r\\n    </div>\\r\\n    <div id="status-zoom-box" class="status-group">\\r\\n        <div class="separator short" />\\r\\n        <button id="status-btn-zoomdown" type="button" class="btn small btn-toolbar btn-toolbar-default"><span class="btn-icon btn-zoom-down">&nbsp;</span></button>\\r\\n        <div class="cnt-zoom">\\r\\n            <div class="dropdown-toggle" data-toggle="dropdown">\\r\\n                <label id="status-label-zoom" class="status-label">Zoom 100%</label>\\r\\n            </div>\\r\\n        </div>\\r\\n        <button id="status-btn-zoomup" type="button" class="btn small btn-toolbar btn-toolbar-default" style="margin-right:40px;"><span class="btn-icon btn-zoom-up">&nbsp;</span></button>\\r\\n    </div>\\r\\n    <!-- /** coauthoring begin **/ -->\\r\\n    <div id="status-users-box" class="status-group" style="display:none;">\\r\\n        <div class="separator short" />\\r\\n        <div id="status-users-block" style="display:inline-block; cursor:pointer; margin-left: 12px;">\\r\\n            <span id="status-users-icon" />\\r\\n            <label id="status-users-count" class="status-label">3</label>\\r\\n        </div>\\r\\n    </div>\\r\\n    <!-- /** coauthoring end **/ -->\\r\\n    <div id="status-math-box" class="status-group">\\r\\n        <div class="separator short" style="margin-right: 12px;" />\\r\\n        <label id="status-math-average" class="status-label">AVERAGE: 10</label>\\r\\n        <label id="status-math-count" class="status-label">COUNT: 3</label>\\r\\n        <label id="status-math-sum" class="status-label">SUM: 5</label>\\r\\n    </div>\\r\\n    <div id="status-sheets-bar-box">\\r\\n        <div id="status-sheets-bar" class="status-group">\\r\\n        </div>\\r\\n    </div>\\r\\n</div>\\r\\n\'});if(Common===undefined)var Common={};define("common/main/lib/component/Tab",["common/main/lib/component/BaseView"],function(e){var t=function(e){return this.active=!1,this.label="Tab",this.cls="",this.template=_.template([\'<li class="<% if(active){ %>active<% } %> <% if(cls.length){%><%= cls %><%}%>" data-label="<%= label %>">\',"<a><%- label %></a>","</li>"].join("")),this.initialize.call(this,e),this};_.extend(t.prototype,{initialize:function(e){_.extend(this,e)},render:function(){var e=this.template(this);return this.$el=$(e),this.rendered=!0,this.disable(this.disabled),this},isActive:function(){return this.$el.hasClass("active")},activate:function(){this.$el.hasClass("active")||this.$el.addClass("active")},deactivate:function(){this.$el.removeClass("active")},on:function(){this.$el.on.apply(this,arguments)},disable:function(e){this.disabled=e,this.rendered&&(e&&!this.$el.hasClass("disabled")?this.$el.addClass("disabled"):this.$el.removeClass("disabled"))},addClass:function(e){e.length&&!this.$el.hasClass(e)&&this.$el.addClass(e)},removeClass:function(e){e.length&&this.$el.hasClass(e)&&this.$el.removeClass(e)},hasClass:function(e){return this.$el.hasClass(e)},setCaption:function(e){this.$el.find("> a").text(e)}}),Common.UI.Tab=t}),define("common/main/lib/component/TabBar",["common/main/lib/component/BaseView","common/main/lib/component/Tab"],function(){var e={bind:function(){this.o||(this.o=$({})),this.o.on.apply(this.o,arguments)},unbind:function(){this.o&&this.o.off.apply(this.o,arguments)},trigger:function(){this.o||(this.o=$({})),this.o.trigger.apply(this.o,arguments)}},t=function(e){this.initialize.call(this,e)};_.extend(t.prototype,e),t.prototype.initialize=function(e){this.bar=e.bar},t.prototype.attach=function(e){e.changeState=$.proxy(function(){this.trigger("tab:change",e),this.bar.$el.find("ul > li.active").removeClass("active"),e.activate(),this.bar.trigger("tab:changed",this.bar,this.bar.tabs.indexOf(e),e)},this);var t=new function(){return{bounds:[],drag:undefined,calculateBounds:function(){var e=this,t=e.bar.tabs.length,n=e.bar.$bar.get(0).getBoundingClientRect();if(n){e.bounds=[],e.scrollLeft=e.bar.$bar.scrollLeft(),e.bar.scrollX=this.scrollLeft;for(var r=0;r<t;++r)this.bounds.push(e.bar.tabs[r].$el.get(0).getBoundingClientRect());e.tabBarLeft=e.bounds[0].left,e.tabBarRight=e.bounds[t-1].right,e.tabBarRight=Math.min(e.tabBarRight,n.right-1)}},setAbsTabs:function(){var e=this,t=null,n=this.bounds.length;for(var r=0;r<n;++r)t=e.bar.tabs[r].$el,t.css("position","absolute"),t.css("left",e.bounds[r].left-e.tabBarLeft-this.scrollLeft+"px"),t.hasClass("active")?t.css("top","1px"):t.css("top","0px")},updatePositions:function(){this.drag.place=undefined;var e,t,n,r=-1,i=-this.scrollLeft,s=this.bounds.length,o=this.drag.tab.$el.get(0).getBoundingClientRect();if(this.drag.moveX-this.drag.mouseX>0){for(e=s-1;e>=0;--e){t=this.bounds[e],n=(t.right+t.left)*.5;if(o.left<n&&n<o.right){r=e;break}}if(-1===r)for(e=s-1;e>=0;--e){t=o,n=(t.right+t.left)*.5;if(this.bounds[e].left<n&&n<this.bounds[e].right){r=e;break}}}else{for(e=0;e<s;++e){t=this.bounds[e],n=(t.right+t.left)*.5;if(o.left<n&&n<o.right){r=e;break}}if(-1===r)for(e=0;e<s;++e){t=o,n=(t.right+t.left)*.5;if(this.bounds[e].left<n&&n<this.bounds[e].right){r=e;break}}}if(-1!==r){this.drag.place=r;for(e=0;e<s;++e){e===r&&r<this.drag.index&&(i+=this.drag.tabWidth),r>this.drag.index&&e===r+1&&(i+=this.drag.tabWidth);if(e===this.drag.index){this.drag.index===r&&(i+=this.drag.tabWidth);continue}this.bar.tabs[e].$el.css("left",i+"px"),i+=this.bounds[e].width}}},setHook:function(e,t,n){function i(){if(!_.isUndefined(r.drag)){r.drag.tab.$el.css("z-index","");var e=null;for(var t=r.bar.tabs.length-1;t>=0;--t)e=r.bar.tabs[t].$el,e&&(e.css("top",""),e.css("position",""),e.css("left",""));_.isUndefined(r.drag.place)?(r.bar.trigger("tab:move",r.drag.index),r.bar.$bar.scrollLeft(r.scrollLeft),r.bar.scrollX=undefined):(r.bar.trigger("tab:move",r.drag.index,r.drag.place),r.bar.$bar.scrollLeft(r.scrollLeft),r.bar.scrollX=undefined),r.drag=undefined}}function s(e){if(!_.isUndefined(r.drag)){r.drag.moveX=e.clientX;var t=Math.max(e.clientX-r.drag.anchorX-r.tabBarLeft-r.scrollLeft,0);t=Math.min(t,r.tabBarRight-r.tabBarLeft-r.drag.tabWidth-r.scrollLeft),r.drag.tab.$el.css("left",t+"px"),r.drag.tab.$el.css("z-index","100"),r.updatePositions()}}function o(e){e.preventDefault()}var r=this;if(!_.isUndefined(t)&&!_.isUndefined(n)&&t.tabs.length>1){var u=t.tabs.indexOf(n);r.bar=t,r.drag={tab:n,index:u},this.calculateBounds(),this.setAbsTabs(),r.drag.moveX=e.clientX,r.drag.mouseX=e.clientX,r.drag.anchorX=e.clientX-this.bounds[u].left,r.drag.tabWidth=this.bounds[u].width,document.addEventListener("dragstart",o),$(document).on("mousemove",s),$(document).on("mouseup",function(e){i(e),$(document).off("mouseup",i),$(document).off("mousemove",s),document.removeEventListener("dragstart",o)})}}}};e.$el.on({click:$.proxy(function(){!e.disabled&&!e.$el.hasClass("active")&&(e.control=="manual"?this.bar.trigger("tab:manual",this.bar,this.bar.tabs.indexOf(e),e):e.changeState())},this),dblclick:$.proxy(function(){this.trigger("tab:dblclick",this,this.tabs.indexOf(e),e)},this.bar),contextmenu:$.proxy(function(){this.trigger("tab:contextmenu",this,this.tabs.indexOf(e),e)},this.bar),mousedown:$.proxy(function(n){this.bar.options.draggable&&!_.isUndefined(t)&&3!==n.which&&(e.isLockTheDrag||t.setHook(n,this.bar,e))},this)})},t.prototype.detach=function(e){e.$el.off()},Common.UI.TabBar=Common.UI.BaseView.extend({config:{placement:"top",items:[],draggable:!1},tabs:[],template:_.template(\'<ul class="nav nav-tabs <%= placement %>" />\'),initialize:function(e){_.extend(this.config,e),Common.UI.BaseView.prototype.initialize.call(this,e),this.saved=[]},render:function(){this.$el.html(this.template(this.config)),this.$bar=this.$el.find("ul");var e=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},n=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";return e(this.$bar[0],n,_.bind(this._onMouseWheel,this)),this.manager=new t({bar:this}),this.insert(-1,this.config.items),this.insert(-1,this.saved),delete this.saved,this.rendered=!0,this},_onMouseWheel:function(e){var t=this.checkInvisible(!0),n=(e.detail&&-e.detail||e.wheelDelta)>0;n?t.last&&this.setTabVisible("forward"):t.first&&this.setTabVisible("backward")},add:function(e){return this.insert(-1,e)>0},insert:function(e,t){var n=0;if(t){t instanceof Array||(t=[t]);if(t.length){n=t.length;if(this.rendered){var r=this,i;if(e<0||e>r.tabs.length)for(var s=0;s<t.length;s++)i=new Common.UI.Tab(t[s]),r.$bar.append(i.render().$el),r.tabs.push(i),r.manager.attach(i);else for(s=t.length;s-->0;)i=new Common.UI.Tab(t[s]),e===0?(r.$bar.prepend(i.render().$el),r.tabs.unshift(i)):(r.$bar.find("li:nth-child("+e+")").before(i.render().$el),r.tabs.splice(e,0,i)),r.manager.attach(i)}else this.saved.push(t);this.checkInvisible()}}return n},remove:function(e){if(e>=0&&e<this.tabs.length){var t=this.tabs.splice(e,1)[0];this.manager.detach(t),t.$el.remove(),this.checkInvisible()}},empty:function(e){var t=this;this.tabs.forEach(function(e){t.manager.detach(e)}),this.$bar.empty(),t.tabs=[],this.checkInvisible(e)},setActive:function(e){if(e instanceof Common.UI.Tab)t=e;else if(typeof e=="number"&&e>=0&&e<this.tabs.length)var t=this.tabs[e];t&&t.control!="manual"&&!t.disabled&&!t.$el.hasClass("active")&&t.changeState(),this.checkInvisible()},getActive:function(e){return e?this.$bar.find("> li.active"):this.$bar.find("> li.active").index()},getAt:function(e){return e>=0&&e<this.tabs.length?this.tabs[e]:undefined},getCount:function(){return this.tabs.length},addClass:function(e){e.length&&!this.$bar.hasClass(e)&&this.$bar.addClass(e)},removeClass:function(e){e.length&&this.$bar.hasClass(e)&&this.$bar.removeClass(e)},hasClass:function(e){return this.$bar.hasClass(e)},setTabVisible:function(e,t){if(e<=0||e=="first")this.$bar.scrollLeft(0),this.checkInvisible(t);else if(e>=this.tabs.length-1||e=="last"){var n=this.tabs[this.tabs.length-1].$el.position().left;this.$bar.scrollLeft(n),this.checkInvisible(t)}else{var r=this.$bar.width();if(e=="forward"){var i,s;for(var o=0;o<this.tabs.length;o++){i=this.tabs[o].$el,s=i.position().left+parseInt(i.css("width"));if(s>r){this.$bar.scrollLeft(this.$bar.scrollLeft()+(s-r)+20),this.checkInvisible(t);break}}}else if(e=="backward")for(o=this.tabs.length;o-->0;){i=this.tabs[o].$el,n=i.position().left;if(n<0){this.$bar.scrollLeft(this.$bar.scrollLeft()+n-26),this.checkInvisible(t);break}}else typeof e=="number"&&(i=this.tabs[e].$el,n=i.position().left,s=n+parseInt(i.css("width")),n<0?(this.$bar.scrollLeft(this.$bar.scrollLeft()+n-26),this.checkInvisible(t)):s>r&&(this.$bar.scrollLeft(this.$bar.scrollLeft()+(s-r)+20),this.checkInvisible(t)))}},checkInvisible:function(e){var t={first:!this.isTabVisible(0),last:!this.isTabVisible(this.tabs.length-1)};return!e&&this.fireEvent("tab:invisible",this,t),t},hasInvisible:function(){var e=this.$bar.offset().left,t=e+this.$bar.width();for(var n=this.tabs.length;n-->0;)if(!this.isTabVisible(n,e,t))return!0;return!1},isTabVisible:function(e){var t=arguments[1]||this.$bar.offset().left,n=arguments[2]||t+this.$bar.width(),r,i,s,o;return e<this.tabs.length&&e>=0?(s=this.tabs[e].$el,o=s.get(0).getBoundingClientRect(),r=o.left,i=o.right,!(r<t)&&!(i>n)):!1}})}),define("spreadsheeteditor/main/app/view/Statusbar",["text!spreadsheeteditor/main/app/template/StatusBar.template","tip","common/main/lib/component/TabBar","common/main/lib/component/Menu","common/main/lib/component/Window","common/main/lib/component/ThemeColorPalette"],function(e){if(SSE.Views.Statusbar)var t=SSE.Views.Statusbar.RenameDialog,n=SSE.Views.Statusbar.CopyDialog;SSE.Views.Statusbar=Common.UI.BaseView.extend(_.extend({el:"#statusbar",template:_.template(e),events:function(){return{"click #status-btn-tabfirst":_.bind(this.onBtnTabScroll,this,"first"),"click #status-btn-tabback":_.bind(this.onBtnTabScroll,this,"backward"),"click #status-btn-tabnext":_.bind(this.onBtnTabScroll,this,"forward"),"click #status-btn-tablast":_.bind(this.onBtnTabScroll,this,"last")}},api:undefined,initialize:function(){},render:function(){function r(){return{isDummy:!0,on:function(){}}}$(this.el).html(this.template());var e=this;this.editMode=!1,this.btnZoomDown=new Common.UI.Button({el:$("#status-btn-zoomdown",this.el),hint:this.tipZoomOut+" (Ctrl+-)",hintAnchor:"top"}),this.btnZoomUp=new Common.UI.Button({el:$("#status-btn-zoomup",this.el),hint:this.tipZoomIn+" (Ctrl++)",hintAnchor:"top-right"}),this.btnScrollFirst=new Common.UI.Button({el:$("#status-btn-tabfirst",this.el),hint:this.tipFirst,disabled:!0,hintAnchor:"top"}),this.btnScrollBack=new Common.UI.Button({el:$("#status-btn-tabback",this.el),hint:this.tipPrev,disabled:!0,hintAnchor:"top"}),this.btnScrollNext=new Common.UI.Button({el:$("#status-btn-tabnext",this.el),hint:this.tipNext,disabled:!0,hintAnchor:"top"}),this.btnScrollLast=new Common.UI.Button({el:$("#status-btn-tablast",this.el),hint:this.tipLast,disabled:!0,hintAnchor:"top"}),this.btnAddWorksheet=new Common.UI.Button({el:$("#status-btn-addtab",this.el),hint:this.tipAddTab,disabled:!0,hintAnchor:"top"}),this.cntZoom=new Common.UI.Button({el:$(".cnt-zoom",this.el),hint:this.tipZoomFactor,hintAnchor:"top"}),this.cntZoom.cmpEl.on({"show.bs.dropdown":function(){_.defer(function(){e.api.asc_enableKeyEvents(!1),e.cntZoom.cmpEl.find("ul").focus()},100)},"hide.bs.dropdown":function(){_.defer(function(){e.api.asc_enableKeyEvents(!0)},100)}}),this.zoomMenu=new Common.UI.Menu({style:"margin-top:-5px;",menuAlign:"bl-tl",items:[{caption:"50%",value:50},{caption:"75%",value:75},{caption:"100%",value:100},{caption:"125%",value:125},{caption:"150%",value:150},{caption:"175%",value:175},{caption:"200%",value:200}]}),this.zoomMenu.render($(".cnt-zoom",this.el)),this.zoomMenu.cmpEl.attr({tabindex:-1}),this.labelZoom=$("#status-label-zoom",this.$el),this.panelUsers=$("#status-users-box",this.el),this.panelUsers.find("#status-users-block").on("click",_.bind(this.onUsersClick,this)),this.tabBarBox=$("#status-sheets-bar-box",this.el),this.tabbar=(new Common.UI.TabBar({el:"#status-sheets-bar",placement:"bottom",draggable:!1})).render(),this.tabbar.on({"tab:invisible":_.bind(this.onTabInvisible,this),"tab:changed":_.bind(this.onSheetChanged,this),"tab:contextmenu":_.bind(this.onTabMenu,this),"tab:dblclick":_.bind(function(){e.editMode&&e.rangeSelectionMode!==c_oAscSelectionDialogType.Chart&&e.rangeSelectionMode!==c_oAscSelectionDialogType.FormatTable&&e.fireEvent("sheet:changename")},this),"tab:move":_.bind(function(t,n){e.tabBarScroll={scrollLeft:e.tabbar.scrollX};if(_.isUndefined(n)||t===n)return;t<n&&++n,e.fireEvent("sheet:move",[!1,!0,t,n])},this)});var t=new Common.UI.Menu({menuAlign:"tl-tr"});t.on("item:click",function(t,n,r){e.fireEvent("show:hidden",[e,n.value])});var n=new Common.UI.Menu({menuAlign:"tl-tr",cls:"color-tab",items:[{template:_.template(\'<div id="id-tab-menu-color" style="width: 165px; height: 220px; margin: 10px;"></div>\')},{template:_.template(\'<a id="id-tab-menu-new-color" style="padding-left:12px;">\'+e.textNewColor+"</a>")}]});return e.mnuTabColor=r(),this.tabMenu=(new Common.UI.Menu({menuAlign:"bl-tl",items:[{caption:this.itemInsert,value:"ins"},{caption:this.itemDelete,value:"del"},{caption:this.itemRename,value:"ren"},{caption:this.itemCopy,value:"copy"},{caption:this.itemMove,value:"move"},{caption:this.itemHide,value:"hide"},{caption:this.itemHidden,menu:t},{caption:this.itemTabColor,menu:n}]})).on("render:after",function(t){var n=$(\'<div class="btn-color-value-line"></div>\');$("button:first-child",t.cmpEl).append(n),n.css("background-color",t.currentColor||"transparent"),e.mnuTabColor=new Common.UI.ThemeColorPalette({el:$("#id-tab-menu-color"),dynamiccolors:10,colors:[e.textThemeColors,"-",{color:"3366FF",effectId:1},{color:"0000FF",effectId:2},{color:"000090",effectId:3},{color:"660066",effectId:4},{color:"800000",effectId:5},{color:"FF0000",effectId:1},{color:"FF6600",effectId:1},{color:"FFFF00",effectId:2},{color:"CCFFCC",effectId:3},{color:"008000",effectId:4},"-",{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:3},{color:"FFFFFF",effectId:4},{color:"000000",effectId:5},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},"-","--","-",e.textStandartColors,"-","transparent","5301B3","980ABD","B2275F","F83D26","F86A1D","F7AC16","F7CA12","FAFF44","D6EF39","-","--"]}),e.mnuTabColor.on("select",function(t,n){e.fireEvent("sheet:setcolor",[n])})}),this.tabbar.$el.append(\'<div class="menu-backdrop" data-toggle="dropdown" style="width:0; height:0;"/>\'),this.tabMenu.render(this.tabbar.$el),this.tabMenu.on("show:after",_.bind(this.onTabMenuAfterShow,this)),this.tabMenu.on("hide:after",_.bind(this.onTabMenuAfterHide,this)),this.tabMenu.on("item:click",_.bind(this.onTabMenuClick,this)),this.boxMath=$("#status-math-box",this.el),this.labelSum=$("#status-math-sum",this.boxMath),this.labelCount=$("#status-math-count",this.boxMath),this.labelAverage=$("#status-math-average",this.boxMath),this.boxMath.hide(),this.boxZoom=$("#status-zoom-box",this.el),this.boxZoom.find(".separator").css("border-left-color","transparent"),this},setApi:function(e){return this.api=e,this.api.asc_registerCallback("asc_onSheetsChanged",_.bind(this.update,this)),this},setMode:function(e){this.mode=_.extend({},this.mode,e),this.btnAddWorksheet.setVisible(this.mode.isEdit),this.btnAddWorksheet.setDisabled(this.mode.isDisconnected)},setVisible:function(e){e?this.show():this.hide()},update:function(){var e=this;this.fireEvent("updatesheetsinfo",this),this.tabbar.empty(!0),this.tabMenu.items[6].menu.removeAll(),this.tabMenu.items[6].hide(),this.btnAddWorksheet.setDisabled(!0);if(this.api){var t=this.api.asc_getWorksheetsCount(),n=-1,r=[],i=[],s,o,u=this.api.asc_getActiveWorksheetIndex();while(++n<t)o=e.api.asc_isWorksheetLockedOrDeleted(n),s={sheetindex:n,active:u==n,label:e.api.asc_getWorksheetName(n),cls:o?"coauth-locked":"",isLockTheDrag:o},this.api.asc_isWorksheetHidden(n)?r.push(s):i.push(s);r.length&&(r.forEach(function(t){e.tabMenu.items[6].menu.addItem(new Common.UI.MenuItem({style:"white-space: pre-wrap",caption:Common.Utils.String.htmlEncode(t.label),value:t.sheetindex}))}),this.tabMenu.items[6].show()),this.tabbar.add(i),_.isUndefined(this.tabBarScroll)?this.tabbar.setTabVisible("last"):(this.tabbar.$bar.scrollLeft(this.tabBarScroll.scrollLeft),this.tabBarScroll=undefined),this.btnAddWorksheet.setDisabled(e.mode.isDisconnected||e.api.asc_isWorkbookLocked()),$("#status-label-zoom").text(Common.Utils.String.format(this.zoomText,Math.floor((this.api.asc_getZoom()+.005)*100))),e.fireEvent("sheet:updateColors",[!0])}},setMathInfo:function(e){e.count>1?(this.boxMath.is(":visible")||this.boxMath.show(),this.labelCount.text(this.textCount+": "+e.count),this.labelSum.text(e.sum&&e.sum.length?this.textSum+": "+e.sum:""),this.labelAverage.text(e.average&&e.average.length?this.textAverage+": "+e.average:"")):this.boxMath.is(":visible")&&this.boxMath.hide();var t=this;_.delay(function(){t.onTabInvisible(undefined,t.tabbar.checkInvisible(!0))},30)},onUsersClick:function(){this.fireEvent("click:users",this)},onSheetChanged:function(e,t,n){this.api.asc_showWorksheet(n.sheetindex),this.hasTabInvisible&&!this.tabbar.isTabVisible(t)&&this.tabbar.setTabVisible(t),this.fireEvent("sheet:changed",[this,n.sheetindex]),this.fireEvent("sheet:updateColors",[!0]),Common.NotificationCenter.trigger("comments:updatefilter",{property:"uid",value:new RegExp("^(doc_|sheet"+this.api.asc_getActiveWorksheetId()+"_)")},!1)},onTabMenu:function(e,t,n){if(this.mode.isEdit&&this.rangeSelectionMode!==c_oAscSelectionDialogType.Chart&&this.rangeSelectionMode!==c_oAscSelectionDialogType.FormatTable&&n&&n.sheetindex>=0){var r=n.$el.get(0).getBoundingClientRect(),i=n.$el.offset(),s=n.$el.parent().offset();n.isActive()||this.tabbar.setActive(n);var o=this.api.asc_isWorksheetLockedOrDeleted(n.sheetindex),u=this.api.asc_isWorkbookLocked();this.tabMenu.items[0].setDisabled(u),this.tabMenu.items[1].setDisabled(o),this.tabMenu.items[2].setDisabled(o),this.tabMenu.items[3].setDisabled(o),this.tabMenu.items[4].setDisabled(o),this.tabMenu.items[5].setDisabled(o),this.tabMenu.items[6].setDisabled(u),this.tabMenu.items[7].setDisabled(o),this.api.asc_closeCellEditor(),this.api.asc_enableKeyEvents(!1),this.tabMenu.atposition=function(){return{top:r.top,left:r.left-s.left-2}}(),this.tabMenu.hide(),this.tabMenu.show()}},onTabMenuAfterShow:function(e){e.atposition&&e.setOffset(e.atposition.left),this.enableKeyEvents=!0},onTabMenuAfterHide:function(){_.isUndefined(this.enableKeyEvents)||(this.api&&this.api.asc_enableKeyEvents(this.enableKeyEvents),this.enableKeyEvents=undefined)},onTabMenuClick:function(e,t){t&&this.api&&(this.enableKeyEvents=t.value==="ins"||t.value==="hide")},onTabInvisible:function(e,t){this.btnScrollFirst.isDisabled()!==!t.first&&(this.btnScrollFirst.setDisabled(!t.first),this.btnScrollBack.setDisabled(!t.first)),this.btnScrollNext.isDisabled()!==!t.last&&(this.btnScrollNext.setDisabled(!t.last),this.btnScrollLast.setDisabled(!t.last)),this.hasTabInvisible=t.first||t.last},onBtnTabScroll:function(e,t){this.tabbar.setTabVisible(e)},updateTabbarBorders:function(){var e=parseInt(this.boxZoom.css("width")),t=!1;this.boxMath.is(":visible")&&(e+=parseInt(this.boxMath.css("width")),t=!0),this.panelUsers.is(":visible")&&(e+=parseInt(this.panelUsers.css("width")),t=!0),this.boxZoom.find(".separator").css("border-left-color",t?"":"transparent"),this.tabBarBox.css("right",e+"px")},changeViewMode:function(e){e?this.tabBarBox.css("left","152px"):this.tabBarBox.css("left",""),this.tabbar.options.draggable=e,this.editMode=e},tipZoomIn:"Zoom In",tipZoomOut:"Zoom Out",tipZoomFactor:"Magnification",tipFirst:"First Sheet",tipLast:"Last Sheet",tipPrev:"Previous Sheet",tipNext:"Next Sheet",tipAddTab:"Add Worksheet",itemInsert:"Insert",itemDelete:"Delete",itemRename:"Rename",itemCopy:"Copy",itemMove:"Move",itemHide:"Hide",itemHidden:"Hidden",itemTabColor:"Tab Color",textThemeColors:"Theme Colors",textStandartColors:"Standart Colors",textNoColor:"No Color",textNewColor:"Add New Custom Color",zoomText:"Zoom {0}%",textSum:"SUM",textCount:"COUNT",textAverage:"AVERAGE"},SSE.Views.Statusbar||{})),SSE.Views.Statusbar.RenameDialog=Common.UI.Window.extend(_.extend({options:{header:!1,width:280,cls:"modal-dlg"},template:\'<div class="box"><div class="input-row"><label><%= label %></label></div><div class="input-row" id="txt-sheet-name" /></div><div class="footer right"><button class="btn normal dlg-btn primary" result="ok" style="margin-right: 10px;"><%= btns.ok %></button><button class="btn normal dlg-btn" result="cancel"><%= btns.cancel %></button></div>\',initialize:function(e){_.extend(this.options,e||{},{label:this.labelSheetName,btns:{ok:this.okButtonText,cancel:this.cancelButtonText}}),this.options.tpl=_.template(this.template,this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var e=this.getChild();e.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.txtName=new Common.UI.InputField({el:e.find("#txt-sheet-name"),style:"width:100%;",value:this.options.current,allowBlank:!1,validation:_.bind(this.nameValidator,this)}),this.txtName&&(this.txtName.$el.find("input").attr("maxlength",31),this.txtName.$el.on("keypress","input[type=text]",_.bind(this.onNameKeyPress,this)))},show:function(e,t){Common.UI.Window.prototype.show.apply(this,arguments);var n=this.txtName.$el.find("input");_.delay(function(e){n.focus(),n.select()},100,this)},onBtnClick:function(e){this.doClose(e.currentTarget.attributes.result.value)},doClose:function(e){if(e=="ok"&&this.txtName.checkValidate()!==!0){_.delay(function(e){e.txtName.focus()},100,this);return}this.options.handler&&this.options.handler.call(this,e,this.txtName.getValue()),this.close()},onNameKeyPress:function(e){e.keyCode==Common.UI.Keys.RETURN&&this.doClose("ok")},nameValidator:function(e){if(this.options.names){var t=e.toLowerCase();for(var n=this.options.names.length-1;n>=0;--n)if(this.options.names[n]===t)return this.errNameExists}return e.length>2&&e[0]==\'"\'&&e[e.length-1]==\'"\'?!0:/[:\\\\\\/\\*\\?\\[\\]\\\']/.test(e)?this.errNameWrongChar:!0},errNameExists:"Worksheet with such name already exist.",errNameWrongChar:"A sheet name cannot contains characters: \\\\, /, *, ?, [, ], :",labelSheetName:"Sheet Name"},t||{})),SSE.Views.Statusbar.CopyDialog=Common.UI.Window.extend(_.extend({options:{width:270,height:300,cls:"modal-dlg"},template:\'<div class="box"><div class="input-row"><label><%= label %></label></div><div id="status-list-names" style="height: 170px;"/></div><div class="footer center"><button class="btn normal dlg-btn primary" result="ok" style="margin-right: 10px;"><%= btns.ok %></button><button class="btn normal dlg-btn" result="cancel"><%= btns.cancel %></button></div>\',initialize:function(e){_.extend(this.options,e||{},{label:e.ismove?this.textMoveBefore:this.textCopyBefore,btns:{ok:this.okButtonText,cancel:this.cancelButtonText}}),this.options.tpl=_.template(this.template,this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var e=this.getChild();e.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this));var t=[];this.options.names.forEach(function(e){t.push(new Common.UI.DataViewModel(e))},this),t.length&&t.push(new Common.UI.DataViewModel({value:this.options.ismove?this.itemMoveToEnd:this.itemCopyToEnd,inindex:-255})),this.listNames=new Common.UI.ListView({el:$("#status-list-names",e),store:new Common.UI.DataViewStore(t),itemTemplate:_.template(\'<div id="<%= id %>" class="list-item" style="pointer-events:none;"><%= Common.Utils.String.htmlEncode(value) %></div>\')}),this.listNames.selectByIndex(0),this.listNames.on("entervalue",_.bind(this.onPrimary,this)),this.listNames.on("item:dblclick",_.bind(this.onPrimary,this)),this.mask=$(".modals-mask"),this.mask.on("mousedown",_.bind(this.onUpdateFocus,this))},show:function(e,t){Common.UI.Window.prototype.show.apply(this,arguments),_.delay(function(e){e.listNames.$el.find(".listview").focus()},100,this)},hide:function(){Common.UI.Window.prototype.hide.apply(this,arguments),this.mask.off("mousedown",_.bind(this.onUpdateFocus,this))},onBtnClick:function(e){var t=this.listNames.getSelectedRec();this.options.handler&&this.options.handler.call(this,e.currentTarget.attributes.result.value,t[0].get("inindex")),this.close()},onPrimary:function(){this.options.handler&&this.options.handler.call(this,"ok",this.listNames.getSelectedRec()[0].get("inindex")),this.close()},onUpdateFocus:function(){_.delay(function(e){e.listNames.$el.find(".listview").focus()},100,this)},itemCopyToEnd:"(Copy to end)",itemMoveToEnd:"(Move to end)",textCopyBefore:"Copy before sheet",textMoveBefore:"Move before sheet"},n||{}))}),define("spreadsheeteditor/main/app/controller/Statusbar",["core","spreadsheeteditor/main/app/view/Statusbar"],function(){SSE.Controllers.Statusbar=Backbone.Controller.extend(_.extend({models:[],collections:[],views:["Statusbar"],initialize:function(){this.addListeners({Statusbar:{"show:hidden":_.bind(function(e,t){this.hideWorksheet(!1,t)},this),"sheet:changename":_.bind(function(){this.api.asc_closeCellEditor(),this.renameWorksheet()},this),"sheet:setcolor":_.bind(this.setWorksheetColor,this),"sheet:updateColors":_.bind(this.updateTabsColors,this),"sheet:move":_.bind(this.moveWorksheet,this)}});var e=this;Common.util.Shortcuts.delegateShortcuts({shortcuts:{"alt+pageup":function(t){e.moveCurrentTab(-1),t.preventDefault(),t.stopPropagation()},"alt+pagedown":function(t){e.moveCurrentTab(1),t.preventDefault(),t.stopPropagation()}}})},events:function(){return{"click #status-btn-zoomdown":_.bind(this.zoomDocument,this,"down"),"click #status-btn-zoomup":_.bind(this.zoomDocument,this,"up"),"click .cnt-zoom":_.bind(this.onZoomShow,this)}},onLaunch:function(){this.statusbar=this.createView("Statusbar").render(),this.statusbar.$el.css("z-index",10),this.statusbar.labelZoom.css("min-width",70),this.statusbar.zoomMenu.on("item:click",_.bind(this.menuZoomClick,this)),this.bindViewEvents(this.statusbar,this.events),$("#id-tab-menu-new-color").on("click",_.bind(this.onNewBorderColor,this))},setApi:function(e){this.api=e,this.api.asc_registerCallback("asc_onZoomChanged",_.bind(this.onZoomChange,this)),this.api.asc_registerCallback("asc_onSelectionMathChanged",_.bind(this.onApiMathChanged,this)),this.api.asc_registerCallback("asc_onСoAuthoringDisconnect",_.bind(this.onApiDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onApiDisconnect,this)),this.api.asc_registerCallback("asc_onUpdateTabColor",_.bind(this.onApiUpdateTabColor,this)),this.api.asc_registerCallback("asc_onEditCell",_.bind(this.onApiEditCell,this)),this.api.asc_registerCallback("asc_onWorkbookLocked",_.bind(this.onWorkbookLocked,this)),this.api.asc_registerCallback("asc_onWorksheetLocked",_.bind(this.onWorksheetLocked,this)),this.api.asc_registerCallback("asc_onAuthParticipantsChanged",_.bind(this.onApiUsersChanged,this)),this.api.asc_registerCallback("asc_onParticipantsChanged",_.bind(this.onApiUsersChanged,this)),this.api.asc_coAuthoringGetUsers(),this.statusbar.setApi(e)},zoomDocument:function(e,t){switch(e){case"up":var n=this.api.asc_getZoom()+.1;!(n>2)&&this.api.asc_setZoom(n);break;case"down":n=this.api.asc_getZoom()-.1,!(n<.5)&&this.api.asc_setZoom(n)}},menuZoomClick:function(e,t){this.api.asc_setZoom(t.value/100)},onZoomChange:function(e,t){this.statusbar.labelZoom.text(Common.Utils.String.format(this.zoomText,Math.floor((e+.005)*100)))},onApiDisconnect:function(){this.statusbar.setMode({isDisconnected:!0}),this.statusbar.update()},onWorkbookLocked:function(e){this.statusbar.tabbar[e?"addClass":"removeClass"]("coauth-locked"),this.statusbar.btnAddWorksheet.setDisabled(e||this.statusbar.rangeSelectionMode==c_oAscSelectionDialogType.Chart||this.statusbar.rangeSelectionMode==c_oAscSelectionDialogType.FormatTable);var t,n=this.statusbar.tabbar.getCount();while(n-->0)t=this.statusbar.tabbar.getAt(n),t.sheetindex>=0||t.disable(e)},onWorksheetLocked:function(e,t){var n=this.statusbar.tabbar.getCount(),r;for(var i=n;i-->0;){r=this.statusbar.tabbar.getAt(i);if(e==r.sheetindex){r[t?"addClass":"removeClass"]("coauth-locked"),r.isLockTheDrag=t||this.statusbar.rangeSelectionMode==c_oAscSelectionDialogType.FormatTable;break}}},onApiUsersChanged:function(e){var t=[];_.each(e,function(e){e.asc_getView()||t.push(e)});var n=_.size(t),r=this.statusbar.panelUsers;r[n>1?"show":"hide"](),this.statusbar.updateTabbarBorders();var i=r.find("#status-users-block");i.data("bs.tooltip")&&i.removeData("bs.tooltip");if(n>1){r.find("#status-users-count").text(n);var s=this.tipUsers+"<br/><br/>",o=0;for(var u in t){s+="\\n"+Common.Utils.String.htmlEncode(t[u].asc_getUserName());if(++o>3)break}n>4&&(s+="<br/>"+this.tipMoreUsers.replace("%1",n-4),s+="<br/><br/>"+this.tipShowUsers),i.tooltip({title:s,html:!0,placement:"top"})}},onApiMathChanged:function(e){this.statusbar.setMathInfo({count:e.asc_getCount(),average:e.asc_getAverage(),sum:e.asc_getSum()}),this.statusbar.updateTabbarBorders()},onApiEditCell:function(e){var t=e!=c_oAscCellEditorState.editEnd;this.statusbar.btnZoomUp.setDisabled(t),this.statusbar.btnZoomDown.setDisabled(t),this.statusbar.labelZoom[t?"addClass":"removeClass"]("disabled")},createDelayedElements:function(){this.statusbar.$el.css("z-index",""),this.statusbar.tabMenu.on("item:click",_.bind(this.onTabMenu,this)),this.statusbar.btnAddWorksheet.on("click",_.bind(this.onAddWorksheetClick,this)),Common.NotificationCenter.on("window:resize",_.bind(this.onWindowResize,this)),Common.NotificationCenter.on("cells:range",_.bind(this.onRangeDialogMode,this))},onWindowResize:function(e){this.statusbar.onTabInvisible(undefined,this.statusbar.tabbar.checkInvisible(!0))},onRangeDialogMode:function(e){var t=this.statusbar.tabbar.hasClass("coauth-locked"),n=this.api.asc_getActiveWorksheetIndex();this.statusbar.btnAddWorksheet.setDisabled(t||e!=c_oAscSelectionDialogType.None);var r,i=this.statusbar.tabbar.getCount();while(i-->0)r=this.statusbar.tabbar.getAt(i),r.sheetindex!==n&&r.disable(e==c_oAscSelectionDialogType.FormatTable),r.isLockTheDrag=r.hasClass("coauth-locked")||e!=c_oAscSelectionDialogType.None;this.statusbar.rangeSelectionMode=e},onTabMenu:function(e,t,n){switch(t.value){case"ins":this.api.asc_insertWorksheet(this.createSheetName());break;case"del":this.deleteWorksheet();break;case"ren":this.renameWorksheet();break;case"copy":this.moveWorksheet(!1);break;case"move":this.moveWorksheet(!0);break;case"hide":this.hideWorksheet(!0)}},createSheetName:function(){var e=[],t=this.api.asc_getWorksheetsCount();while(t--)e.push(this.api.asc_getWorksheetName(t).toLowerCase());var n=0,r;while(++n<1e3){r=this.strSheet+n;if(e.indexOf(r.toLowerCase())<0)break}return r},createCopyName:function(e){var t=this.api.asc_getWorksheetsCount(),n=[];while(t--)n.push(this.api.asc_getWorksheetName(t).toLowerCase());var r=/^(.*)\\((\\d)\\)$/.exec(e),i=r?r[1]:e+" ",s=1,o;while(++s<1e3){o=i+"("+s+")";if(n.indexOf(o.toLowerCase())<0)break}return o},deleteWorksheet:function(){var e=this;this.statusbar.tabbar.tabs.length==1?Common.UI.warning({msg:this.errorLastSheet}):Common.UI.warning({msg:this.warnDeleteSheet,buttons:["ok","cancel"],callback:function(t){t=="ok"&&!e.api.asc_deleteWorksheet()&&_.delay(function(){Common.UI.error({msg:e.errorRemoveSheet})},10)}})},hideWorksheet:function(e,t){e?this.statusbar.tabbar.tabs.length==1?Common.UI.warning({msg:this.errorLastSheet}):this.api.asc_hideWorksheet(t):(this.api.asc_showWorksheet(t),this.loadTabColor(t))},renameWorksheet:function(){var e=this,t=e.api.asc_getWorksheetsCount(),n=[];if(t>0){var r=e.api.asc_getActiveWorksheetIndex();if(e.api.asc_isWorksheetLockedOrDeleted(r))return;while(t--)r!==t&&n.push(e.api.asc_getWorksheetName(t).toLowerCase());var i=e.statusbar.tabbar.tabs[this.statusbar.tabbar.getActive()],s=e.statusbar.$el.position().top-115,o=i.$el.offset().left,u=e.api.asc_getWorksheetName(e.api.asc_getActiveWorksheetIndex());(new SSE.Views.Statusbar.RenameDialog({current:u,names:n,handler:function(t,n){t=="ok"&&n!=u&&(e.api.asc_renameWorksheet(n),i.setCaption(n),e.statusbar.fireEvent("updatesheetsinfo",e.statusbar)),e.api.asc_enableKeyEvents(!0)}})).show(o,s)}},moveWorksheet:function(e,t,n,r){var i=this,s=i.api.asc_getWorksheetsCount(),o=[],u=-1;while(++u<s)this.api.asc_isWorksheetHidden(u)||o.push({value:i.api.asc_getWorksheetName(u),inindex:u});if(!_.isUndefined(t)){i.api.asc_showWorksheet(o[n].inindex),Common.NotificationCenter.trigger("comments:updatefilter",{property:"uid",value:new RegExp("^(doc_|sheet"+this.api.asc_getActiveWorksheetId()+"_)")}),_.isUndefined(r)||i.api.asc_moveWorksheet(o.length===r?s:o[r].inindex);return}(new SSE.Views.Statusbar.CopyDialog({title:e?i.statusbar.itemMove:i.statusbar.itemCopy,ismove:e,names:o,handler:function(t,n){if(t=="ok")if(e)i.api.asc_moveWorksheet(n==-255?s:n);else{var r=i.createCopyName(i.api.asc_getWorksheetName(i.api.asc_getActiveWorksheetIndex()));i.api.asc_copyWorksheet(n==-255?s:n,r)}i.api.asc_enableKeyEvents(!0)}})).show()},onAddWorksheetClick:function(e,t,n){this.api&&(this.api.asc_closeCellEditor(),this.api.asc_addWorksheet(this.createSheetName()),Common.NotificationCenter.trigger("comments:updatefilter",{property:"uid",value:new RegExp("^(doc_|sheet"+this.api.asc_getActiveWorksheetId()+"_)")},!1)),Common.NotificationCenter.trigger("edit:complete",this.statusbar)},selectTab:function(e){if(this.api){var t=this.api.asc_isWorksheetHidden(e);if(!t){var n=_.findWhere(this.statusbar.tabbar.tabs,{sheetindex:e});n&&this.statusbar.tabbar.setActive(n)}}},moveCurrentTab:function(e){if(this.api){var t=0,n=this.statusbar.tabbar,r=this.api.asc_getActiveWorksheetIndex(),i=n.tabs.length;this.statusbar.tabMenu.hide(),this.api.asc_closeCellEditor();for(var s=0;s<i;++s)if(n.tabs[s].sheetindex===r){t=s,e>0?(t++,t>=i&&(t=0)):(t--,t<0&&(t=i-1)),n.setActive(t),this.api.asc_showWorksheet(n.getAt(t).sheetindex);break}}},onApiUpdateTabColor:function(e){this.loadTabColor(e)},setWorksheetColor:function(e){if(this.api){var t=this.api.asc_getActiveWorksheetIndex(),n=_.findWhere(this.statusbar.tabbar.tabs,{sheetindex:t});if(n)if("transparent"===e)this.api.asc_setWorksheetTabColor(t,null),n.$el.find("a").css("box-shadow","");else{var r=Common.Utils.ThemeColor.getRgbColor(e);r&&(this.api.asc_setWorksheetTabColor(t,r),this.setTabLineColor(n,r))}}},updateThemeColors:function(){var e=function(e,t){if(e){var n,r=Common.Utils.ThemeColor.getEffectColors();for(var i=0;i<r.length;++i)typeof e.currentColor=="object"&&n===undefined&&e.currentColor.effectId==r[i].effectId&&(n=r[i]);e.updateColors(r,Common.Utils.ThemeColor.getStandartColors()),e.currentColor===undefined?e.currentColor=r[t]:n!==undefined&&(e.currentColor=n)}};this.statusbar&&e(this.statusbar.mnuTabColor,1)},onNewBorderColor:function(){this.statusbar&&this.statusbar.mnuTabColor&&this.statusbar.mnuTabColor.addNewColor()},updateTabsColors:function(e){var t=-1,n=-1,r=null,i=null,s=!1,o=this.api.asc_getWorksheetsCount(),u=this.api.asc_getActiveWorksheetIndex();if(!_.isUndefined(e)){var a=this.application.getController("Toolbar");if(a){this.statusbar.mnuTabColor.updateCustomColors(),r=this.api.asc_getWorksheetTabColor(u),r&&(r.get_type()==c_oAscColor.COLOR_TYPE_SCHEME?i={color:Common.Utils.ThemeColor.getHexColor(r.get_r(),r.get_g(),r.get_b()),effectValue:r.get_value()}:i=Common.Utils.ThemeColor.getHexColor(r.get_r(),r.get_g(),r.get_b()));if(_.isObject(i)){var f=!1;for(t=0;t<10;t++)if(Common.Utils.ThemeColor.ThemeValues[t]===i.effectValue){this.statusbar.mnuTabColor.select(i,!0),f=!0;break}f||this.statusbar.mnuTabColor.clearSelection()}else this.statusbar.mnuTabColor.select(i||"transparent",!0)}}t=-1;while(++t<o)++n,s=this.api.asc_isWorksheetHidden(t),s&&--n,s||this.setTabLineColor(this.statusbar.tabbar.getAt(n),this.api.asc_getWorksheetTabColor(t))},loadTabColor:function(e){if(this.api&&!this.api.asc_isWorksheetHidden(e)){var t=_.findWhere(this.statusbar.tabbar.tabs,{sheetindex:e});t&&this.setTabLineColor(t,this.api.asc_getWorksheetTabColor(e))}},setTabLineColor:function(e,t){e&&(null!==t?t="#"+Common.Utils.ThemeColor.getHexColor(t.get_r(),t.get_g(),t.get_b()):t="",t.length?(e.isActive()?t="0px 3px 0 "+t+" inset":t="0px 3px 0 "+Common.Utils.RGBColor(t).toRGBA(.7)+" inset",e.$el.find("a").css("box-shadow",t)):e.$el.find("a").css("box-shadow",""))},onZoomShow:function(e){if(e.target.classList.contains("disabled"))return!1},tipUsers:"Document is in the collaborative editing mode.",tipMoreUsers:"and %1 users.",tipShowUsers:"To see all users click the icon below.",zoomText:"Zoom {0}%",errorLastSheet:"Workbook must have at least one visible worksheet.",errorRemoveSheet:"Can\'t delete the worksheet.",warnDeleteSheet:"The worksheet maybe has data. Proceed operation?",strSheet:"Sheet"},SSE.Controllers.Statusbar||{}))}),define("text!spreadsheeteditor/main/app/template/RightMenu.template",[],function(){return\'<div id="view-right-menu" class="tool-menu right">\\n    <div class="right-panel">\\n        <div id="id-shape-settings" class="settings-panel">\\n        </div>\\n        <div id="id-image-settings" class="settings-panel">\\n        </div>\\n        <!-- /** proprietary begin **/ -->\\n        <div id="id-chart-settings" class="settings-panel">\\n        </div>\\n        <!-- /** proprietary end **/ -->\\n        <div id="id-paragraph-settings" class="settings-panel">\\n        </div>\\n    </div>\\n    <div class="tool-menu-btns">\\n        <div class="ct-btn-category arrow-left" />\\n        <button id="id-right-menu-shape" class="btn btn-category arrow-left" content-target="id-shape-settings"><span class="btn-icon btn-menu-shape">&nbsp;</span></button>\\n        <button id="id-right-menu-image" class="btn btn-category arrow-left" content-target="id-image-settings"><span class="btn-icon btn-menu-image">&nbsp;</span></button>\\n        <!-- /** proprietary begin **/ -->\\n        <button id="id-right-menu-chart" class="btn btn-category arrow-left" content-target="id-chart-settings"><span class="btn-icon btn-menu-chart">&nbsp;</span></button>\\n        <!-- /** proprietary end **/ -->\\n        <button id="id-right-menu-text" class="btn btn-category arrow-left" content-target="id-paragraph-settings"><span class="btn-icon btn-menu-text">&nbsp;</span></button>\\n    </div>\\n</div>\'}),define("text!spreadsheeteditor/main/app/template/ParagraphSettings.template",[],function(){return\'<table cols="2">\\r\\n    <tr>\\r\\n        <td colspan=2>\\r\\n            <label class="header"><%= scope.strParagraphSpacing %></label>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr>\\r\\n        <td class="padding-small" width="50%">\\r\\n            <label class="input-label"><%= scope.textAt %></label>\\r\\n            <div id="paragraph-combo-line-rule" style="width: 85px;"></div>\\r\\n        </td>\\r\\n        <td class="padding-small" width="50%">\\r\\n            <label class="input-label"><%= scope.textAt %></label>\\r\\n            <div id="paragraph-spin-line-height"></div>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr>\\r\\n        <td class="padding-small" width="50%">\\r\\n            <label class="input-label"><%= scope.strSpacingBefore %></label>\\r\\n            <div id="paragraph-spin-spacing-before"></div>\\r\\n        </td>\\r\\n        <td class="padding-small" width="50%">\\r\\n            <label class="input-label"><%= scope.strSpacingAfter %></label>\\r\\n            <div id="paragraph-spin-spacing-after"></div>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr>\\r\\n        <td class="padding-small" colspan=2>\\r\\n            <div class="separator horizontal"></div>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr>\\r\\n        <td align="center" colspan=2>\\r\\n            <label class="link" id="paragraph-advanced-link"><%= scope.textAdvanced %></label>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr class="finish-cell"></tr>\\r\\n</table>\'});var c_paragraphLinerule={LINERULE_LEAST:0,LINERULE_AUTO:1,LINERULE_EXACT:2};define("spreadsheeteditor/main/app/view/ParagraphSettings",["text!spreadsheeteditor/main/app/template/ParagraphSettings.template","jquery","underscore","backbone","common/main/lib/component/ComboBox","common/main/lib/component/MetricSpinner","spreadsheeteditor/main/app/view/ParagraphSettingsAdvanced"],function(e,t,n,r){SSE.Views.ParagraphSettings=r.View.extend(n.extend({el:"#id-paragraph-settings",template:n.template(e),events:{},options:{alias:"ParagraphSettings"},initialize:function(){var e=this;this._initSettings=!0,this._state={LineRuleIdx:1,LineHeight:1.5,LineSpacingBefore:0,LineSpacingAfter:.35,DisabledControls:!1},this.spinners=[],this.lockedControls=[],this._locked=!1,this.render(),this._arrLineRule=[{displayValue:this.textAtLeast,defaultValue:5,value:c_paragraphLinerule.LINERULE_LEAST,minValue:.03,step:.01,defaultUnit:"cm"},{displayValue:this.textAuto,defaultValue:1,value:c_paragraphLinerule.LINERULE_AUTO,minValue:.5,step:.01,defaultUnit:""},{displayValue:this.textExact,defaultValue:5,value:c_paragraphLinerule.LINERULE_EXACT,minValue:.03,step:.01,defaultUnit:"cm"}],this.cmbLineRule=new Common.UI.ComboBox({el:t("#paragraph-combo-line-rule"),cls:"input-group-nr",menuStyle:"min-width: 85px;",editable:!1,data:this._arrLineRule}),this.cmbLineRule.setValue(this._arrLineRule[this._state.LineRuleIdx].value),this.lockedControls.push(this.cmbLineRule),this.numLineHeight=new Common.UI.MetricSpinner({el:t("#paragraph-spin-line-height"),step:.01,width:85,value:"1.5",defaultUnit:"",maxValue:132,minValue:.5}),this.lockedControls.push(this.numLineHeight),this.numSpacingBefore=new Common.UI.MetricSpinner({el:t("#paragraph-spin-spacing-before"),step:.1,width:85,value:"0 cm",defaultUnit:"cm",maxValue:55.88,minValue:0,allowAuto:!0,autoText:this.txtAutoText}),this.spinners.push(this.numSpacingBefore),this.lockedControls.push(this.numSpacingBefore),this.numSpacingAfter=new Common.UI.MetricSpinner({el:t("#paragraph-spin-spacing-after"),step:.1,width:85,value:"0.35 cm",defaultUnit:"cm",maxValue:55.88,minValue:0,allowAuto:!0,autoText:this.txtAutoText}),this.spinners.push(this.numSpacingAfter),this.lockedControls.push(this.numSpacingAfter),this.numLineHeight.on("change",n.bind(this.onNumLineHeightChange,this)),this.numSpacingBefore.on("change",n.bind(this.onNumSpacingBeforeChange,this)),this.numSpacingAfter.on("change",n.bind(this.onNumSpacingAfterChange,this)),this.cmbLineRule.on("selected",n.bind(this.onLineRuleSelect,this)),this.cmbLineRule.on("hide:after",n.bind(this.onHideMenus,this)),t(this.el).on("click","#paragraph-advanced-link",n.bind(this.openAdvancedSettings,this))},render:function(){var e=t(this.el);e.html(this.template({scope:this})),this.linkAdvanced=t("#paragraph-advanced-link")},setApi:function(e){return this.api=e,this.api&&this.api.asc_registerCallback("asc_onParaSpacingLine",n.bind(this._onLineSpacing,this)),this},onNumLineHeightChange:function(e,t,n,r){if(this.cmbLineRule.getRawValue()==="")return;var i=c_paragraphLinerule.LINERULE_AUTO;this.api&&this.api.asc_putPrLineSpacing(this.cmbLineRule.getValue(),this.cmbLineRule.getValue()==c_paragraphLinerule.LINERULE_AUTO?e.getNumberValue():Common.Utils.Metric.fnRecalcToMM(e.getNumberValue())),Common.NotificationCenter.trigger("edit:complete",this)},onNumSpacingBeforeChange:function(e,t,n,r){if(this.api){var i=e.getNumberValue();i<0?this.api.asc_putLineSpacingBeforeAfter(0,-1):this.api.asc_putLineSpacingBeforeAfter(0,Common.Utils.Metric.fnRecalcToMM(e.getNumberValue()))}Common.NotificationCenter.trigger("edit:complete",this)},onNumSpacingAfterChange:function(e,t,n,r){if(this.api){var i=e.getNumberValue();i<0?this.api.asc_putLineSpacingBeforeAfter(1,-1):this.api.asc_putLineSpacingBeforeAfter(1,Common.Utils.Metric.fnRecalcToMM(e.getNumberValue()))}Common.NotificationCenter.trigger("edit:complete",this)},onLineRuleSelect:function(e,t){this.api&&this.api.asc_putPrLineSpacing(t.value,t.defaultValue),this.numLineHeight.setDefaultUnit(this._arrLineRule[t.value].defaultUnit),this.numLineHeight.setMinValue(this._arrLineRule[t.value].minValue),this.numLineHeight.setStep(this._arrLineRule[t.value].step),Common.NotificationCenter.trigger("edit:complete",this)},_onLineSpacing:function(e){var t=e.asc_getLineRule(),n=e.asc_getLine();this._state.LineRuleIdx!==t&&(this.cmbLineRule.setValue(t!==null?this._arrLineRule[t].value:""),this.numLineHeight.setMinValue(this._arrLineRule[t!==null?t:1].minValue),this.numLineHeight.setDefaultUnit(this._arrLineRule[t!==null?t:1].defaultUnit),this.numLineHeight.setStep(this._arrLineRule[t!==null?t:1].step),this._state.LineRuleIdx=t);if(Math.abs(this._state.LineHeight-n)>.001||(this._state.LineHeight===null||n===null)&&this._state.LineHeight!==n){var r="";t==c_paragraphLinerule.LINERULE_AUTO?r=n:t!==null&&n!==null&&(r=Common.Utils.Metric.fnRecalcFromMM(n)),this.numLineHeight.setValue(r!==null?r:"",!0),this._state.LineHeight=n}},ChangeSettings:function(e){this._initSettings&&(this.createDelayedElements(),this._initSettings=!1),this.disableControls(this._locked);if(e){var t={Line:e.asc_getSpacing().asc_getLine(),Before:e.asc_getSpacing().asc_getBefore(),After:e.asc_getSpacing().asc_getAfter(),LineRule:e.asc_getSpacing().asc_getLineRule()};this._state.LineRuleIdx!==t.LineRule&&(this.cmbLineRule.setValue(t.LineRule!==null?this._arrLineRule[t.LineRule].value:""),this.numLineHeight.setMinValue(this._arrLineRule[t.LineRule!==null?t.LineRule:1].minValue),this.numLineHeight.setDefaultUnit(this._arrLineRule[t.LineRule!==null?t.LineRule:1].defaultUnit),this.numLineHeight.setStep(this._arrLineRule[t.LineRule!==null?t.LineRule:1].step),this._state.LineRuleIdx=t.LineRule);if(Math.abs(this._state.LineHeight-t.Line)>.001||(this._state.LineHeight===null||t.Line===null)&&this._state.LineHeight!==t.Line){var n="";t.LineRule==c_paragraphLinerule.LINERULE_AUTO?n=t.Line:t.LineRule!==null&&t.Line!==null&&(n=Common.Utils.Metric.fnRecalcFromMM(t.Line)),this.numLineHeight.setValue(n!==null?n:"",!0),this._state.LineHeight=t.Line}if(Math.abs(this._state.LineSpacingBefore-t.Before)>.001||(this._state.LineSpacingBefore===null||t.Before===null)&&this._state.LineSpacingBefore!==t.Before)this.numSpacingBefore.setValue(t.Before!==null?t.Before<0?t.Before:Common.Utils.Metric.fnRecalcFromMM(t.Before):"",!0),this._state.LineSpacingBefore=t.Before;if(Math.abs(this._state.LineSpacingAfter-t.After)>.001||(this._state.LineSpacingAfter===null||t.After===null)&&this._state.LineSpacingAfter!==t.After)this.numSpacingAfter.setValue(t.After!==null?t.After<0?t.After:Common.Utils.Metric.fnRecalcFromMM(t.After):"",!0),this._state.LineSpacingAfter=t.After}},updateMetricUnit:function(){if(this.spinners)for(var e=0;e<this.spinners.length;e++){var t=this.spinners[e];t.setDefaultUnit(Common.Utils.Metric.metricName[Common.Utils.Metric.getCurrentMetric()]),t.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.cm?.01:1)}this._arrLineRule[2].defaultUnit=this._arrLineRule[0].defaultUnit=Common.Utils.Metric.metricName[Common.Utils.Metric.getCurrentMetric()],this._arrLineRule[2].minValue=this._arrLineRule[0].minValue=parseFloat(Common.Utils.Metric.fnRecalcFromMM(.3).toFixed(2)),this._arrLineRule[2].step=this._arrLineRule[0].step=Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.cm?.01:1,this._state.LineRuleIdx!==null&&(this.numLineHeight.setDefaultUnit(this._arrLineRule[this._state.LineRuleIdx].defaultUnit),this.numLineHeight.setStep(this._arrLineRule[this._state.LineRuleIdx].step))},createDelayedElements:function(){this.updateMetricUnit()},openAdvancedSettings:function(e){if(this.linkAdvanced.hasClass("disabled"))return;var t=this,n;if(t.api&&!this._locked){var r=t.api.asc_getGraphicObjectProps();if(r&&r.length>0){var i,s;for(var o=r.length-1;o>=0;o--){i=r[o].asc_getObjectType(),s=r[o].asc_getObjectValue();if(c_oAscTypeSelectElement.Paragraph==i){(new SSE.Views.ParagraphSettingsAdvanced({paragraphProps:s,api:t.api,handler:function(e,n){e=="ok"&&t.api&&(t.borderAdvancedProps=n.borderProps,t.api.asc_setGraphicObjectProps(n.paragraphProps)),Common.NotificationCenter.trigger("edit:complete",t)}})).show();break}}}}},onHideMenus:function(e){Common.NotificationCenter.trigger("edit:complete",this)},setLocked:function(e){this._locked=e},disableControls:function(e){this._state.DisabledControls!==e&&(this._state.DisabledControls=e,n.each(this.lockedControls,function(t){t.setDisabled(e)}),this.linkAdvanced.toggleClass("disabled",e))},strParagraphSpacing:"Spacing",strLineHeight:"Line Spacing",strSpacingBefore:"Before",strSpacingAfter:"After",textAuto:"Multiple",textAtLeast:"At least",textExact:"Exactly",textAdvanced:"Show advanced settings",textAt:"At",txtAutoText:"Auto"},SSE.Views.ParagraphSettings||{}))}),define("text!spreadsheeteditor/main/app/template/ImageSettings.template",[],function(){return\'<table cols="3">\\r\\n    <tr>\\r\\n        <td colspan=3>\\r\\n            <label class="header"><%= scope.textSize %></label>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr>\\r\\n        <td class="padding-small" width="88px">\\r\\n            <label class="input-label"><%= scope.textWidth %></label>\\r\\n            <div id="image-spin-width"></div>\\r\\n        </td>\\r\\n        <td class="padding-small" width="28px" style="vertical-align: bottom;">\\r\\n            <div id="image-button-ratio"></div>\\r\\n        </td>\\r\\n        <td class="padding-small" width="88px">\\r\\n            <label class="input-label"><%= scope.textHeight %></label>\\r\\n            <div id="image-spin-height"></div>\\r\\n        </td>\\r\\n    </tr>\\r\\n</table>\\r\\n<table cols="2">\\r\\n    <tr>\\r\\n        <td class="padding-small" colspan=2>\\r\\n            <button type="button" class="btn btn-text-default" id="image-button-original-size" style="width:100px;"><%= scope.textOriginalSize %></button>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr>\\r\\n        <td class="padding-small" colspan=2>\\r\\n            <div class="separator horizontal"></div>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr>\\r\\n        <td colspan=2>\\r\\n            <label class="header"><%= scope.textInsert %></label>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr>\\r\\n        <td width="50%">\\r\\n            <button type="button" class="btn btn-text-default" id="image-button-from-file" style="width:85px;"><%= scope.textFromFile %></button>\\r\\n        </td>\\r\\n        <td width="50%">\\r\\n            <button type="button" class="btn btn-text-default" id="image-button-from-url" style="width:85px;"><%= scope.textFromUrl %></button>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr class="finish-cell"></tr>\\r\\n</table>\'}),define("spreadsheeteditor/main/app/view/ImageSettings",["text!spreadsheeteditor/main/app/template/ImageSettings.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/MetricSpinner","common/main/lib/view/ImageFromUrlDialog"],function(e,t,n,r){SSE.Views.ImageSettings=r.View.extend(n.extend({el:"#id-image-settings",template:n.template(e),events:{},options:{alias:"ImageSettings"},initialize:function(){var e=this;this._initSettings=!0,this._nRatio=1,this._state={Width:0,Height:0,DisabledControls:!1},this.spinners=[],this.lockedControls=[],this._locked=!1,this._noApply=!1,this.render(),this.spnWidth=new Common.UI.MetricSpinner({el:t("#image-spin-width"),step:.1,width:78,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0}),this.spinners.push(this.spnWidth),this.lockedControls.push(this.spnWidth),this.spnHeight=new Common.UI.MetricSpinner({el:t("#image-spin-height"),step:.1,width:78,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0}),this.spinners.push(this.spnHeight),this.lockedControls.push(this.spnHeight),this.btnRatio=new Common.UI.Button({cls:"btn-toolbar btn-toolbar-default",iconCls:"advanced-btn-ratio",style:"margin-bottom: 1px;",enableToggle:!0,hint:this.textKeepRatio}),this.btnRatio.render(t("#image-button-ratio")),this.lockedControls.push(this.btnRatio);var r=window.localStorage.getItem("sse-settings-imageratio");(r===null||parseInt(r)==1)&&this.btnRatio.toggle(!0),this.btnRatio.on("click",n.bind(function(e,t){e.pressed&&this.spnHeight.getNumberValue()>0&&(this._nRatio=this.spnWidth.getNumberValue()/this.spnHeight.getNumberValue()),window.localStorage.setItem("sse-settings-imageratio",e.pressed?1:0)},this)),this.btnOriginalSize=new Common.UI.Button({el:t("#image-button-original-size")}),this.lockedControls.push(this.btnOriginalSize),this.btnInsertFromFile=new Common.UI.Button({el:t("#image-button-from-file")}),this.lockedControls.push(this.btnInsertFromFile),this.btnInsertFromUrl=new Common.UI.Button({el:t("#image-button-from-url")}),this.lockedControls.push(this.btnInsertFromUrl),this.spnWidth.on("change",n.bind(this.onWidthChange,this)),this.spnHeight.on("change",n.bind(this.onHeightChange,this)),this.btnOriginalSize.on("click",n.bind(this.setOriginalSize,this)),this.btnInsertFromFile.on("click",n.bind(function(e){this.api&&this.api.asc_changeImageFromFile(),Common.NotificationCenter.trigger("edit:complete",this)},this)),this.btnInsertFromUrl.on("click",n.bind(this.insertFromUrl,this))},render:function(){var e=t(this.el);e.html(this.template({scope:this}))},setApi:function(e){if(e==undefined)return;return this.api=e,this},updateMetricUnit:function(){if(this.spinners)for(var e=0;e<this.spinners.length;e++){var t=this.spinners[e];t.setDefaultUnit(Common.Utils.Metric.metricName[Common.Utils.Metric.getCurrentMetric()]),t.setStep(Common.Utils.Metric.getCurrentMetric()==C

]]></string> </value>
        </item>
        <item>
            <key> <string>next</string> </key>
            <value>
              <persistent> <string encoding="base64">AAAAAAAAAAo=</string> </persistent>
            </value>
        </item>
      </dictionary>
    </pickle>
  </record>
  <record id="10" aka="AAAAAAAAAAo=">
    <pickle>
      <global name="Pdata" module="OFS.Image"/>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>data</string> </key>
            <value> <string encoding="cdata"><![CDATA[

ommon.Utils.Metric.c_MetricUnits.cm?.1:1)}},createDelayedElements:function(){this.updateMetricUnit()},ChangeSettings:function(e){this._initSettings&&(this.createDelayedElements(),this._initSettings=!1),this.disableControls(this._locked);if(e){var t=e.asc_getWidth();if(Math.abs(this._state.Width-t)>.001||(this._state.Width===null||t===null)&&this._state.Width!==t)this.spnWidth.setValue(t!==null?Common.Utils.Metric.fnRecalcFromMM(t):"",!0),this._state.Width=t;t=e.asc_getHeight();if(Math.abs(this._state.Height-t)>.001||(this._state.Height===null||t===null)&&this._state.Height!==t)this.spnHeight.setValue(t!==null?Common.Utils.Metric.fnRecalcFromMM(t):"",!0),this._state.Height=t;e.asc_getHeight()>0&&(this._nRatio=e.asc_getWidth()/e.asc_getHeight()),this.btnOriginalSize.setDisabled(e.asc_getImageUrl()===null||e.asc_getImageUrl()===undefined||this._locked)}},onWidthChange:function(e,t,n,r){var i=e.getNumberValue(),s=this.spnHeight.getNumberValue();this.btnRatio.pressed&&(s=i/this._nRatio,s>this.spnHeight.options.maxValue&&(s=this.spnHeight.options.maxValue,i=s*this._nRatio,this.spnWidth.setValue(i,!0)),this.spnHeight.setValue(s,!0));if(this.api){var o=new Asc.asc_CImgProperty;o.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(i)),o.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(s)),this.api.asc_setGraphicObjectProps(o)}Common.NotificationCenter.trigger("edit:complete",this)},onHeightChange:function(e,t,n,r){var i=e.getNumberValue(),s=this.spnWidth.getNumberValue();this.btnRatio.pressed&&(s=i*this._nRatio,s>this.spnWidth.options.maxValue&&(s=this.spnWidth.options.maxValue,i=s/this._nRatio,this.spnHeight.setValue(i,!0)),this.spnWidth.setValue(s,!0));if(this.api){var o=new Asc.asc_CImgProperty;o.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(s)),o.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(i)),this.api.asc_setGraphicObjectProps(o)}Common.NotificationCenter.trigger("edit:complete",this)},setOriginalSize:function(){if(this.api){var e=this.api.asc_getOriginalImageSize(),t=e.asc_getImageWidth(),n=e.asc_getImageHeight(),r=new Asc.asc_CImgProperty;r.asc_putWidth(t),r.asc_putHeight(n),this.api.asc_setGraphicObjectProps(r),Common.NotificationCenter.trigger("edit:complete",this)}},insertFromUrl:function(){var e=this;(new Common.Views.ImageFromUrlDialog({handler:function(t,r){if(t=="ok"&&e.api){var i=r.replace(/ /g,"");if(!n.isEmpty(i)){var s=new Asc.asc_CImgProperty;s.asc_putImageUrl(i),e.api.asc_setGraphicObjectProps(s)}}Common.NotificationCenter.trigger("edit:complete",e)}})).show()},setLocked:function(e){this._locked=e},disableControls:function(e){this._state.DisabledControls!==e&&(this._state.DisabledControls=e,n.each(this.lockedControls,function(t){t.setDisabled(e)}))},textKeepRatio:"Constant Proportions",textSize:"Size",textWidth:"Width",textHeight:"Height",textOriginalSize:"Default Size",textInsert:"Insert Image",textFromUrl:"From URL",textFromFile:"From File"},SSE.Views.ImageSettings||{}))}),define("text!spreadsheeteditor/main/app/template/ChartSettings.template",[],function(){return\'<table cols="3">\\r\\n    <tr>\\r\\n        <td colspan=3>\\r\\n            <label class="header"><%= scope.textSize %></label>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr>\\r\\n        <td class="padding-small" width="88px">\\r\\n            <label class="input-label"><%= scope.textWidth %></label>\\r\\n            <div id="chart-spin-width"></div>\\r\\n        </td>\\r\\n        <td class="padding-small" width="28px" style="vertical-align: bottom;">\\r\\n            <div id="chart-button-ratio"></div>\\r\\n        </td>\\r\\n        <td class="padding-small" width="88px">\\r\\n            <label class="input-label"><%= scope.textHeight %></label>\\r\\n            <div id="chart-spin-height"></div>\\r\\n        </td>\\r\\n    </tr>\\r\\n</table>\\r\\n<table cols="2">\\r\\n    <tr>\\r\\n        <td class="padding-small" colspan=2>\\r\\n            <div class="separator horizontal"></div>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr>\\r\\n        <td colspan=2>\\r\\n            <label class="header"><%= scope.textChartType %></label>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr>\\r\\n        <td class="padding-small">\\r\\n            <div id="chart-button-type" style=""></div>\\r\\n        </td>\\r\\n        <td class="padding-small">\\r\\n            <div id="chart-button-style" style=""></div>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr>\\r\\n        <td class="padding-small" colspan=2>\\r\\n            <div class="separator horizontal"></div>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr>\\r\\n        <td align="center" colspan=2>\\r\\n            <label class="link" id="chart-advanced-link"><%= scope.textAdvanced %></label>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr class="finish-cell"></tr>\\r\\n</table>\'}),define("text!spreadsheeteditor/main/app/template/ChartSettingsDlg.template",[],function(){return\'<div id="id-chart-settings-dlg-style" class="settings-panel active">\\r\\n    <div class="inner-content">\\r\\n        <table cols="2" style="">\\r\\n            <tr>\\r\\n                <td class="padding-large">\\r\\n                    <label class="header"><%= scope.textType %></label>\\r\\n                    <div id="chart-dlg-button-type" style="margin-right: 15px;"></div>\\r\\n                </td>\\r\\n                <td class="padding-large">\\r\\n                    <label class="header"><%= scope.textStyle %></label>\\r\\n                    <div id="chart-dlg-button-style" style=""></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n        </table>\\r\\n    </div>\\r\\n    <div class="separator horizontal padding-large"></div>\\r\\n    <div class="inner-content">\\r\\n        <table cols="2" style="width: 100%;">\\r\\n            <tr>\\r\\n                <td colspan=2 >\\r\\n                    <label class="header"><%= scope.textDataRange %></label>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-small" width="200">\\r\\n                    <div id="chart-dlg-txt-range" class="input-row" style="margin-right: 10px;"></div>\\r\\n                </td>\\r\\n                <td class="padding-small" style="text-align: right;">\\r\\n                    <button type="button" class="btn btn-text-default" id="chart-dlg-btn-data" style="min-width: 100px;"><%= scope.textSelectData %></button>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td colspan=2 class="padding-small">\\r\\n                    <label class="input-label"><%= scope.textDataSeries %></label>\\r\\n                    <div id="chart-dlg-combo-range" class="input-group-nr" style="width:120px;"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n        </table>\\r\\n    </div>\\r\\n</div>\\r\\n<div id="id-chart-settings-dlg-layout" class="settings-panel">\\r\\n    <div class="inner-content">\\r\\n        <table cols="2" style="width: 100%;">\\r\\n            <tr>\\r\\n                <td class="padding-small">\\r\\n                    <label class="input-label"><%= scope.textChartTitle %></label>\\r\\n                    <div id="chart-dlg-combo-chart-title" class="input-group-nr"></div>\\r\\n                </td>\\r\\n                <td class="padding-small">\\r\\n                    <label class="input-label" style="margin-left: 15px;"><%= scope.textLegendPos %></label>\\r\\n                    <div id="chart-dlg-combo-legend-pos" class="input-group-nr" style="margin-left: 15px;" />\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-small">\\r\\n                    <label class="input-label"><%= scope.textHorTitle %></label>\\r\\n                    <div id="chart-dlg-combo-hor-title" class="input-group-nr"></div>\\r\\n                </td>\\r\\n                <td class="padding-small">\\r\\n                    <label class="input-label" style="margin-left: 15px;"><%= scope.textVertTitle %></label>\\r\\n                    <div id="chart-dlg-combo-vert-title" class="input-group-nr" style="margin-left: 15px;" />\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-small">\\r\\n                    <label class="input-label"><%= scope.textHorGrid %></label>\\r\\n                    <div id="chart-dlg-combo-hor-grid" class="input-group-nr"></div>\\r\\n                </td>\\r\\n                <td class="padding-small">\\r\\n                    <label class="input-label" style="margin-left: 15px;"><%= scope.textVertGrid %></label>\\r\\n                    <div id="chart-dlg-combo-vert-grid" class="input-group-nr" style="margin-left: 15px;" />\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-small">\\r\\n                    <label class="input-label"><%= scope.textDataLabels %></label>\\r\\n                    <div id="chart-dlg-combo-data-labels" class="input-group-nr"></div>\\r\\n                </td>\\r\\n                <td rowspan="2" class="padding-small">\\r\\n                    <div id="chart-dlg-check-series" style="margin: 20px 0 9px 15px;"></div>\\r\\n                    <div id="chart-dlg-check-category" style="margin: 0 0 9px 15px;"></div>\\r\\n                    <div id="chart-dlg-check-value" style="margin: 0 0 5px 15px;"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-small">\\r\\n                    <label class="input-label"><%= scope.textSeparator %></label>\\r\\n                    <div id="chart-dlg-txt-separator" class="input-row" />\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-small">\\r\\n                    <label id="chart-dlg-label-lines" class="input-label"><%= scope.textLines %></label>\\r\\n                    <div id="chart-dlg-combo-lines" class="input-group-nr"></div>\\r\\n                </td>\\r\\n                <td class="padding-small" style="vertical-align: bottom;">\\r\\n                    <div id="chart-dlg-check-markers" style="margin: 0 0 4px 15px;"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n        </table>\\r\\n    </div>\\r\\n</div>\\r\\n<div id="id-chart-settings-dlg-vert" class="settings-panel">\\r\\n    <div class="inner-content">\\r\\n        <table cols="3" style="width: 100%">\\r\\n            <tr>\\r\\n                <td colspan="3">\\r\\n                    <label class="header  padding-small"><%= scope.textAxisOptions %></label>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-small" width="100">\\r\\n                    <label class="input-label"><%= scope.textMinValue %></label>\\r\\n                </td>\\r\\n                <td class="padding-small" width="115" style="padding-right: 10px;">\\r\\n                    <div id="chart-dlg-combo-mintype"></div>\\r\\n                </td>\\r\\n                <td class="padding-small" width="90">\\r\\n                    <div id="chart-dlg-input-min-value"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-large" width="100">\\r\\n                    <label class="input-label"><%= scope.textMaxValue %></label>\\r\\n                </td>\\r\\n                <td class="padding-large" width="115" style="padding-right: 10px;">\\r\\n                    <div id="chart-dlg-combo-maxtype"></div>\\r\\n                </td>\\r\\n                <td class="padding-large" width="90">\\r\\n                    <div id="chart-dlg-input-max-value"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-large" width="100">\\r\\n                    <label class="input-label"><%= scope.textAxisCrosses %></label>\\r\\n                </td>\\r\\n                <td class="padding-large" width="115" style="padding-right: 10px;">\\r\\n                    <div id="chart-dlg-combo-v-crosstype"></div>\\r\\n                </td>\\r\\n                <td class="padding-large" width="90">\\r\\n                    <div id="chart-dlg-input-v-axis-crosses"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n        </table>\\r\\n    </div>\\r\\n    <div class="inner-content">\\r\\n        <table cols="1" style="width: 100%;">\\r\\n            <tr>\\r\\n                <td class="padding-large">\\r\\n                    <label class="input-label"><%= scope.textUnits %></label>\\r\\n                    <div id="chart-dlg-combo-units" class="input-group-nr" style="width:140px;"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-large">\\r\\n                    <div id="chart-dlg-check-v-reverse"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n        </table>\\r\\n    </div>\\r\\n    <div class="separator horizontal padding-large"></div>\\r\\n    <div class="inner-content">\\r\\n        <table cols="2" style="width: 100%;">\\r\\n            <tr>\\r\\n                <td colspan=2 class="padding-small">\\r\\n                    <label class="header"><%= scope.textTickOptions %></label>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-large">\\r\\n                    <label class="input-label"><%= scope.textMajorType %></label>\\r\\n                    <div id="chart-dlg-combo-v-major-type" class="input-group-nr"></div>\\r\\n                </td>\\r\\n                <td class="padding-large">\\r\\n                    <label class="input-label" style="margin-left: 15px;"><%= scope.textMinorType %></label>\\r\\n                    <div id="chart-dlg-combo-v-minor-type" class="input-group-nr" style="margin-left: 15px;" />\\r\\n                </td>\\r\\n            </tr>\\r\\n        </table>\\r\\n    </div>\\r\\n    <div class="separator horizontal padding-large"></div>\\r\\n    <div class="inner-content">\\r\\n        <table cols="1" style="width: 100%;">\\r\\n            <tr>\\r\\n                <td class="padding-small">\\r\\n                    <label class="header"><%= scope.textLabelOptions %></label>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td>\\r\\n                    <label class="input-label"><%= scope.textLabelPos %></label>\\r\\n                    <div id="chart-dlg-combo-v-label-pos" class="input-group-nr" style="width:140px;"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n        </table>\\r\\n    </div>\\r\\n</div>\\r\\n<div id="id-chart-settings-dlg-hor" class="settings-panel">\\r\\n    <div class="inner-content">\\r\\n        <table cols="3" style="width: 100%">\\r\\n            <tr>\\r\\n                <td colspan="3">\\r\\n                    <label class="header  padding-small"><%= scope.textAxisOptions %></label>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-small" width="100">\\r\\n                    <label class="input-label"><%= scope.textAxisCrosses %></label>\\r\\n                </td>\\r\\n                <td class="padding-small" width="115" style="padding-right: 10px;">\\r\\n                    <div id="chart-dlg-combo-h-crosstype"></div>\\r\\n                </td>\\r\\n                <td class="padding-small" width="90">\\r\\n                    <div id="chart-dlg-input-h-axis-crosses"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n        </table>\\r\\n    </div>\\r\\n    <div class="inner-content">\\r\\n        <table cols="1" style="width: 100%;">\\r\\n            <tr>\\r\\n                <td class="padding-large" width="140">\\r\\n                    <label class="input-label"><%= scope.textAxisPos %></label>\\r\\n                    <div id="chart-dlg-combo-axis-pos" class="input-group-nr" style="width:140px;"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-large">\\r\\n                    <div id="chart-dlg-check-h-reverse"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n        </table>\\r\\n    </div>\\r\\n    <div class="separator horizontal padding-large"></div>\\r\\n    <div class="inner-content">\\r\\n        <table cols="2" style="width: 100%;">\\r\\n            <tr>\\r\\n                <td colspan=2 class="padding-small">\\r\\n                    <label class="header"><%= scope.textTickOptions %></label>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-small" width="140">\\r\\n                    <label class="input-label"><%= scope.textMajorType %></label>\\r\\n                    <div id="chart-dlg-combo-h-major-type" class="input-group-nr"></div>\\r\\n                </td>\\r\\n                <td class="padding-small">\\r\\n                    <label class="input-label" style="margin-left: 15px;"><%= scope.textMinorType %></label>\\r\\n                    <div id="chart-dlg-combo-h-minor-type" class="input-group-nr" style="margin-left: 15px;"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td width="100%" colspan="2">\\r\\n                    <label class="input-label"><%= scope.textMarksInterval %></label>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-large" width="140">\\r\\n                    <div id="chart-dlg-input-marks-interval"></div>\\r\\n                </td>\\r\\n                <td class="padding-large">\\r\\n                </td>\\r\\n            </tr>\\r\\n        </table>\\r\\n    </div>\\r\\n    <div class="separator horizontal padding-large"></div>\\r\\n    <div class="inner-content">\\r\\n        <table cols="2" style="width: 100%;">\\r\\n            <tr>\\r\\n                <td colspan=2 class="padding-small">\\r\\n                    <label class="header"><%= scope.textLabelOptions %></label>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-small" width="140">\\r\\n                    <label class="input-label"><%= scope.textLabelPos %></label>\\r\\n                    <div id="chart-dlg-combo-h-label-pos" class="input-group-nr"></div>\\r\\n                </td>\\r\\n                <td class="padding-small">\\r\\n                    <label class="input-label" style="margin-left: 15px;"><%= scope.textLabelDist %></label>\\r\\n                    <div id="chart-dlg-input-label-dist" style="margin-left: 15px;"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td width="100%" colspan="2">\\r\\n                    <label class="input-label"><%= scope.textLabelInterval %></label>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td width="140">\\r\\n                    <div id="chart-dlg-combo-label-int" class="input-group-nr"></div>\\r\\n                </td>\\r\\n                <td style="vertical-align: bottom;">\\r\\n                    <div id="chart-dlg-input-label-int" style="margin-left: 15px;"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n        </table>\\r\\n    </div>\\r\\n</div>\'});if(Common===undefined)var Common={};define("spreadsheeteditor/main/app/view/CellRangeDialog",["common/main/lib/component/InputField","common/main/lib/component/Window"],function(){SSE.Views.CellRangeDialog=Common.UI.Window.extend(_.extend({options:{width:350,cls:"modal-dlg",modal:!1},initialize:function(e){_.extend(this.options,{title:this.txtTitle},e),this.template=[\'<div class="box">\',\'<div id="id-dlg-cell-range" class="input-row" style="margin-bottom: 5px;"></div>\',"</div>",\'<div class="footer right">\',\'<button class="btn normal dlg-btn primary" result="ok" style="margin-right: 10px;">\'+this.okButtonText+"</button>",\'<button class="btn normal dlg-btn" result="cancel">\'+this.cancelButtonText+"</button>","</div>"].join(""),this.options.tpl=_.template(this.template,this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){Common.UI.Window.prototype.render.call(this);var e=this.getChild(),t=this;t.inputRange=new Common.UI.InputField({el:$("#id-dlg-cell-range"),name:"range",style:"width: 100%;",allowBlank:!1,blankError:this.txtEmpty,validateOnChange:!0}),e.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),t.inputRange.cmpEl.find("input").on("keypress",_.bind(this.onKeyPress,this)),this.on("close",_.bind(this.onClose,this))},onPrimary:function(){return this._handleInput("ok"),!1},setSettings:function(e){var t=this;this.inputRange.setValue(e.range?e.range:""),e.api&&(t.api=e.api,t.api.asc_setSelectionDialogMode(c_oAscSelectionDialogType.Chart,e.range?e.range:""),t.api.asc_registerCallback("asc_onSelectionRangeChanged",_.bind(t.onApiRangeChanged,t)),Common.NotificationCenter.trigger("cells:range",c_oAscSelectionDialogType.Chart)),t.inputRange.validation=function(e){var n=t.api.asc_checkDataRange(c_oAscSelectionDialogType.Chart,e,!1);return n==c_oAscError.ID.DataRangeError?t.txtInvalidRange:!0}},getSettings:function(){return this.inputRange.getValue()},onApiRangeChanged:function(e){this.inputRange.setValue(e),this.inputRange.cmpEl.hasClass("error")&&this.inputRange.cmpEl.removeClass("error")},onBtnClick:function(e){this._handleInput(e.currentTarget.attributes.result.value)},onClose:function(e){this.api&&this.api.asc_setSelectionDialogMode(c_oAscSelectionDialogType.None),Common.NotificationCenter.trigger("cells:range",c_oAscSelectionDialogType.None)},onKeyPress:function(e){e.keyCode==Common.UI.Keys.RETURN&&this._handleInput("ok")},_handleInput:function(e){if(this.options.handler){if(e=="ok"&&this.inputRange.checkValidate()!==!0)return;this.options.handler.call(this,this,e)}this.close()},txtTitle:"Select Data Range",textCancel:"Cancel",txtEmpty:"This field is required",txtInvalidRange:"ERROR! Invalid cells range",errorMaxRows:"ERROR! The maximum number of data series per chart is 255."},SSE.Views.CellRangeDialog||{}))}),define("spreadsheeteditor/main/app/view/ChartSettingsDlg",["text!spreadsheeteditor/main/app/template/ChartSettingsDlg.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/CheckBox","common/main/lib/component/InputField","spreadsheeteditor/main/app/view/CellRangeDialog"],function(e){SSE.Views.ChartSettingsDlg=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:320,height:535,toggleGroup:"chart-settings-dlg-group"},initialize:function(t){_.extend(this.options,{title:this.textTitle,items:[{panelId:"id-chart-settings-dlg-style",panelCaption:this.textTypeData},{panelId:"id-chart-settings-dlg-layout",panelCaption:this.textLayout},{panelId:"id-chart-settings-dlg-vert",panelCaption:this.textVertAxis},{panelId:"id-chart-settings-dlg-hor",panelCaption:this.textHorAxis}],contentTemplate:_.template(e)({scope:this})},t),this.options.handler=function(e,n){if(e!="ok"||this.isRangeValid()){t.handler&&t.handler.call(this,e,n);return}return!0},Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options),this._state={ChartStyle:1,ChartType:c_oAscChartTypeSettings.barNormal},this._noApply=!0,this.api=this.options.api,this.chartSettings=this.options.chartSettings,this.vertAxisProps=null,this.horAxisProps=null,this.currentAxisProps=null,this.dataRangeValid=""},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var e=this,t=this.getChild();this.btnChartType=new Common.UI.Button({cls:"btn-large-dataview",iconCls:"item-chartlist bar-normal",menu:new Common.UI.Menu({style:"width: 330px;",items:[{template:_.template(\'<div id="id-chart-dlg-menu-type" class="menu-insertchart"  style="margin: 5px 5px 5px 10px;"></div>\')}]})}),this.btnChartType.on("render:after",function(t){e.mnuChartTypePicker=new Common.UI.DataView({el:$("#id-chart-dlg-menu-type"),parentMenu:t.menu,restoreHeight:411,groups:new Common.UI.DataViewGroupStore([{id:"menu-chart-group-bar",caption:e.textColumn},{id:"menu-chart-group-line",caption:e.textLine},{id:"menu-chart-group-pie",caption:e.textPie},{id:"menu-chart-group-hbar",caption:e.textBar},{id:"menu-chart-group-area",caption:e.textArea},{id:"menu-chart-group-scatter",caption:e.textPoint},{id:"menu-chart-group-stock",caption:e.textStock}]),store:new Common.UI.DataViewStore([{group:"menu-chart-group-bar",type:c_oAscChartTypeSettings.barNormal,iconCls:"column-normal",selected:!0},{group:"menu-chart-group-bar",type:c_oAscChartTypeSettings.barStacked,iconCls:"column-stack"},{group:"menu-chart-group-bar",type:c_oAscChartTypeSettings.barStackedPer,iconCls:"column-pstack"},{group:"menu-chart-group-line",type:c_oAscChartTypeSettings.lineNormal,iconCls:"line-normal"},{group:"menu-chart-group-line",type:c_oAscChartTypeSettings.lineStacked,iconCls:"line-stack"},{group:"menu-chart-group-line",type:c_oAscChartTypeSettings.lineStackedPer,iconCls:"line-pstack"},{group:"menu-chart-group-pie",type:c_oAscChartTypeSettings.pie,iconCls:"pie-normal"},{group:"menu-chart-group-pie",type:c_oAscChartTypeSettings.doughnut,iconCls:"pie-doughnut"},{group:"menu-chart-group-hbar",type:c_oAscChartTypeSettings.hBarNormal,iconCls:"bar-normal"},{group:"menu-chart-group-hbar",type:c_oAscChartTypeSettings.hBarStacked,iconCls:"bar-stack"},{group:"menu-chart-group-hbar",type:c_oAscChartTypeSettings.hBarStackedPer,iconCls:"bar-pstack"},{group:"menu-chart-group-area",type:c_oAscChartTypeSettings.areaNormal,iconCls:"area-normal"},{group:"menu-chart-group-area",type:c_oAscChartTypeSettings.areaStacked,iconCls:"area-stack"},{group:"menu-chart-group-area",type:c_oAscChartTypeSettings.areaStackedPer,iconCls:"area-pstack"},{group:"menu-chart-group-scatter",type:c_oAscChartTypeSettings.scatter,iconCls:"point-normal"},{group:"menu-chart-group-stock",type:c_oAscChartTypeSettings.stock,iconCls:"stock-normal"}]),itemTemplate:_.template(\'<div id="<%= id %>" class="item-chartlist <%= iconCls %>"></div>\')})}),this.btnChartType.render($("#chart-dlg-button-type")),this.mnuChartTypePicker.on("item:click",_.bind(this.onSelectType,this,this.btnChartType)),this.btnChartStyle=new Common.UI.Button({cls:"btn-large-dataview",iconCls:"item-wrap",menu:new Common.UI.Menu({items:[{template:_.template(\'<div id="id-chart-dlg-menu-style" style="width: 245px; margin: 0 5px;"></div>\')}]})}),this.btnChartStyle.on("render:after",function(t){e.mnuChartStylePicker=new Common.UI.DataView({el:$("#id-chart-dlg-menu-style"),parentMenu:t.menu,style:"max-height: 411px;",store:new Common.UI.DataViewStore,itemTemplate:_.template(\'<div id="<%= id %>" class="item-wrap" style="background-image: url(<%= imageUrl %>); background-position: 0 0;"></div>\')}),e.btnChartStyle.menu&&e.btnChartStyle.menu.on("show:after",function(){e.mnuChartStylePicker.scroller.update({alwaysVisibleY:!0})})}),this.btnChartStyle.render($("#chart-dlg-button-style")),this.mnuChartStylePicker.on("item:click",_.bind(this.onSelectStyle,this,this.btnChartStyle)),this.cmbDataDirect=new Common.UI.ComboBox({el:$("#chart-dlg-combo-range"),menuStyle:"min-width: 120px;",editable:!1,cls:"input-group-nr",data:[{value:0,displayValue:this.textDataRows},{value:1,displayValue:this.textDataColumns}]}),this.txtDataRange=new Common.UI.InputField({el:$("#chart-dlg-txt-range"),name:"range",style:"width: 100%;",allowBlank:!0,blankError:this.txtEmpty,validateOnChange:!0}),this.btnSelectData=new Common.UI.Button({el:$("#chart-dlg-btn-data")}),this.btnSelectData.on("click",_.bind(this.onSelectData,this)),this.cmbChartTitle=new Common.UI.ComboBox({el:$("#chart-dlg-combo-chart-title"),menuStyle:"min-width: 140px;",editable:!1,cls:"input-group-nr",data:[{value:c_oAscChartTitleShowSettings.none,displayValue:this.textNone},{value:c_oAscChartTitleShowSettings.overlay,displayValue:this.textOverlay},{value:c_oAscChartTitleShowSettings.noOverlay,displayValue:this.textNoOverlay}]}),this.cmbLegendPos=new Common.UI.ComboBox({el:$("#chart-dlg-combo-legend-pos"),menuStyle:"min-width: 140px;",editable:!1,cls:"input-group-nr",data:[{value:c_oAscChartLegendShowSettings.none,displayValue:this.textNone},{value:c_oAscChartLegendShowSettings.bottom,displayValue:this.textLegendBottom},{value:c_oAscChartLegendShowSettings.top,displayValue:this.textLegendTop},{value:c_oAscChartLegendShowSettings.right,displayValue:this.textLegendRight},{value:c_oAscChartLegendShowSettings.left,displayValue:this.textLegendLeft},{value:c_oAscChartLegendShowSettings.leftOverlay,displayValue:this.textLeftOverlay},{value:c_oAscChartLegendShowSettings.rightOverlay,displayValue:this.textRightOverlay}]}),this.cmbHorTitle=new Common.UI.ComboBox({el:$("#chart-dlg-combo-hor-title"),menuStyle:"min-width: 140px;",editable:!1,cls:"input-group-nr",data:[{value:c_oAscChartHorAxisLabelShowSettings.none,displayValue:this.textNone},{value:c_oAscChartHorAxisLabelShowSettings.noOverlay,displayValue:this.textNoOverlay}]}),this.cmbVertTitle=new Common.UI.ComboBox({el:$("#chart-dlg-combo-vert-title"),menuStyle:"min-width: 140px;",editable:!1,cls:"input-group-nr",data:[{value:c_oAscChartVertAxisLabelShowSettings.none,displayValue:this.textNone},{value:c_oAscChartVertAxisLabelShowSettings.rotated,displayValue:this.textRotated},{value:c_oAscChartVertAxisLabelShowSettings.horizontal,displayValue:this.textHorizontal}]}),this.cmbHorGrid=new Common.UI.ComboBox({el:$("#chart-dlg-combo-hor-grid"),menuStyle:"min-width: 140px;",editable:!1,cls:"input-group-nr",data:[{value:c_oAscGridLinesSettings.none,displayValue:this.textNone},{value:c_oAscGridLinesSettings.major,displayValue:this.textMajor},{value:c_oAscGridLinesSettings.minor,displayValue:this.textMinor},{value:c_oAscGridLinesSettings.majorMinor,displayValue:this.textMajorMinor}]}),this.cmbVertGrid=new Common.UI.ComboBox({el:$("#chart-dlg-combo-vert-grid"),menuStyle:"min-width: 140px;",editable:!1,cls:"input-group-nr",data:[{value:c_oAscGridLinesSettings.none,displayValue:this.textNone},{value:c_oAscGridLinesSettings.major,displayValue:this.textMajor},{value:c_oAscGridLinesSettings.minor,displayValue:this.textMinor},{value:c_oAscGridLinesSettings.majorMinor,displayValue:this.textMajorMinor}]}),this.cmbDataLabels=new Common.UI.ComboBox({el:$("#chart-dlg-combo-data-labels"),menuStyle:"min-width: 140px;",editable:!1,cls:"input-group-nr",data:[{value:c_oAscChartDataLabelsPos.none,displayValue:this.textNone},{value:c_oAscChartDataLabelsPos.ctr,displayValue:this.textCenter},{value:c_oAscChartDataLabelsPos.inBase,displayValue:this.textInnerBottom},{value:c_oAscChartDataLabelsPos.inEnd,displayValue:this.textInnerTop},{value:c_oAscChartDataLabelsPos.outEnd,displayValue:this.textOuterTop}]}),this.cmbDataLabels.on("selected",_.bind(e.onSelectDataLabels,this)),this.txtSeparator=new Common.UI.InputField({el:$("#chart-dlg-txt-separator"),name:"range",style:"width: 100%;",allowBlank:!0,blankError:this.txtEmpty}),this.chSeriesName=new Common.UI.CheckBox({el:$("#chart-dlg-check-series"),labelText:this.textSeriesName}),this.chCategoryName=new Common.UI.CheckBox({el:$("#chart-dlg-check-category"),labelText:this.textCategoryName}),this.chValue=new Common.UI.CheckBox({el:$("#chart-dlg-check-value"),labelText:this.textValue}),this.cmbLines=new Common.UI.ComboBox({el:$("#chart-dlg-combo-lines"),menuStyle:"min-width: 140px;",editable:!1,cls:"input-group-nr",data:[{value:0,displayValue:this.textNone},{value:1,displayValue:this.textStraight},{value:2,displayValue:this.textSmooth}]}),this.chMarkers=new Common.UI.CheckBox({el:$("#chart-dlg-check-markers"),labelText:this.textMarkers}),this.lblLines=$("#chart-dlg-label-lines"),this.cmbMinType=(new Common.UI.ComboBox({el:$("#chart-dlg-combo-mintype"),cls:"input-group-nr",menuStyle:"min-width: 100px;",editable:!1,data:[{displayValue:this.textAuto,value:c_oAscValAxisRule.auto},{displayValue:this.textFixed,value:c_oAscValAxisRule.fixed}]})).on("selected",_.bind(function(e,t){this.currentAxisProps&&this.currentAxisProps.putMinValRule(t.value)},this)),this.spnMinValue=(new Common.UI.MetricSpinner({el:$("#chart-dlg-input-min-value"),maxValue:1e6,minValue:-1e6,step:.1,defaultUnit:"",defaultValue:0,value:""})).on("change",_.bind(function(e,t,n){this.cmbMinType.suspendEvents(),this.cmbMinType.setValue(c_oAscValAxisRule.fixed),this.cmbMinType.resumeEvents(),this.currentAxisProps&&(this.currentAxisProps.putMinValRule(c_oAscValAxisRule.fixed),this.currentAxisProps.putMinVal(e.getNumberValue()))},this)),this.cmbMaxType=(new Common.UI.ComboBox({el:$("#chart-dlg-combo-maxtype"),cls:"input-group-nr",menuStyle:"min-width: 100px;",editable:!1,data:[{displayValue:this.textAuto,value:c_oAscValAxisRule.auto},{displayValue:this.textFixed,value:c_oAscValAxisRule.fixed}]})).on("selected",_.bind(function(e,t){this.currentAxisProps&&this.currentAxisProps.putMaxValRule(t.value)},this)),this.spnMaxValue=(new Common.UI.MetricSpinner({el:$("#chart-dlg-input-max-value"),maxValue:1e6,minValue:-1e6,step:.1,defaultUnit:"",defaultValue:0,value:""})).on("change",_.bind(function(e,t,n){this.cmbMaxType.suspendEvents(),this.cmbMaxType.setValue(c_oAscValAxisRule.fixed),this.cmbMaxType.resumeEvents(),this.currentAxisProps&&(this.currentAxisProps.putMaxValRule(c_oAscValAxisRule.fixed),this.currentAxisProps.putMaxVal(e.getNumberValue()))},this)),this.cmbVCrossType=(new Common.UI.ComboBox({el:$("#chart-dlg-combo-v-crosstype"),cls:"input-group-nr",menuStyle:"min-width: 100px;",editable:!1,data:[{displayValue:this.textAuto,value:c_oAscCrossesRule.auto},{displayValue:this.textValue,value:c_oAscCrossesRule.value},{displayValue:this.textMinValue,value:c_oAscCrossesRule.minValue},{displayValue:this.textMaxValue,value:c_oAscCrossesRule.maxValue}]})).on("selected",_.bind(function(e,t){this.currentAxisProps&&this.currentAxisProps.putCrossesRule(t.value)},this)),this.spnVAxisCrosses=(new Common.UI.MetricSpinner({el:$("#chart-dlg-input-v-axis-crosses"),maxValue:1e6,minValue:-1e6,step:.1,defaultUnit:"",defaultValue:0,value:""})).on("change",_.bind(function(e,t,n){this.cmbVCrossType.suspendEvents(),this.cmbVCrossType.setValue(c_oAscCrossesRule.value),this.cmbVCrossType.resumeEvents(),this.currentAxisProps&&(this.currentAxisProps.putCrossesRule(c_oAscCrossesRule.value),this.currentAxisProps.putCrosses(e.getNumberValue()))},this)),this.cmbUnits=(new Common.UI.ComboBox({el:$("#chart-dlg-combo-units"),cls:"input-group-nr",menuStyle:"min-width: 140px;",editable:!1,data:[{displayValue:this.textNone,value:c_oAscValAxUnits.none},{displayValue:this.textHundreds,value:c_oAscValAxUnits.HUNDREDS},{displayValue:this.textThousands,value:c_oAscValAxUnits.THOUSANDS},{displayValue:this.textTenThousands,value:c_oAscValAxUnits.TEN_THOUSANDS},{displayValue:this.textHundredThousands,value:c_oAscValAxUnits.HUNDRED_THOUSANDS},{displayValue:this.textMillions,value:c_oAscValAxUnits.MILLIONS},{displayValue:this.textTenMillions,value:c_oAscValAxUnits.TEN_MILLIONS},{displayValue:this.textHundredMil,value:c_oAscValAxUnits.HUNDRED_MILLIONS},{displayValue:this.textBillions,value:c_oAscValAxUnits.BILLIONS},{displayValue:this.textTrillions,value:c_oAscValAxUnits.TRILLIONS}]})).on("selected",_.bind(function(e,t){this.currentAxisProps&&this.currentAxisProps.putDispUnitsRule(t.value)},this)),this.chVReverse=(new Common.UI.CheckBox({el:$("#chart-dlg-check-v-reverse"),labelText:this.textReverse})).on("change",_.bind(function(e,t){this.currentAxisProps&&this.currentAxisProps.putInvertValOrder(t=="checked")},this)),this.cmbVMajorType=(new Common.UI.ComboBox({el:$("#chart-dlg-combo-v-major-type"),cls:"input-group-nr",menuStyle:"min-width: 140px;",editable:!1,data:[{displayValue:this.textNone,value:c_oAscTickMark.TICK_MARK_NONE},{displayValue:this.textCross,value:c_oAscTickMark.TICK_MARK_CROSS},{displayValue:this.textIn,value:c_oAscTickMark.TICK_MARK_IN},{displayValue:this.textOut,value:c_oAscTickMark.TICK_MARK_OUT}]})).on("selected",_.bind(function(e,t){this.currentAxisProps&&this.currentAxisProps.putMajorTickMark(t.value)},this)),this.cmbVMinorType=(new Common.UI.ComboBox({el:$("#chart-dlg-combo-v-minor-type"),cls:"input-group-nr",menuStyle:"min-width: 140px;",editable:!1,data:[{displayValue:this.textNone,value:c_oAscTickMark.TICK_MARK_NONE},{displayValue:this.textCross,value:c_oAscTickMark.TICK_MARK_CROSS},{displayValue:this.textIn,value:c_oAscTickMark.TICK_MARK_IN},{displayValue:this.textOut,value:c_oAscTickMark.TICK_MARK_OUT}]})).on("selected",_.bind(function(e,t){this.currentAxisProps&&this.currentAxisProps.putMinorTickMark(t.value)},this)),this.cmbVLabelPos=(new Common.UI.ComboBox({el:$("#chart-dlg-combo-v-label-pos"),cls:"input-group-nr",menuStyle:"min-width: 140px;",editable:!1,data:[{displayValue:this.textNone,value:c_oAscTickLabelsPos.TICK_LABEL_POSITION_NONE},{displayValue:this.textLow,value:c_oAscTickLabelsPos.TICK_LABEL_POSITION_LOW},{displayValue:this.textHigh,value:c_oAscTickLabelsPos.TICK_LABEL_POSITION_HIGH},{displayValue:this.textNextToAxis,value:c_oAscTickLabelsPos.TICK_LABEL_POSITION_NEXT_TO}]})).on("selected",_.bind(function(e,t){this.currentAxisProps&&this.currentAxisProps.putTickLabelsPos(t.value)},this)),this.cmbHCrossType=(new Common.UI.ComboBox({el:$("#chart-dlg-combo-h-crosstype"),cls:"input-group-nr",menuStyle:"min-width: 100px;",editable:!1,data:[{displayValue:this.textAuto,value:c_oAscCrossesRule.auto},{displayValue:this.textValue,value:c_oAscCrossesRule.value},{displayValue:this.textMinValue,value:c_oAscCrossesRule.minValue},{displayValue:this.textMaxValue,value:c_oAscCrossesRule.maxValue}]})).on("selected",_.bind(function(e,t){this.currentAxisProps&&this.currentAxisProps.putCrossesRule(t.value)},this)),this.spnHAxisCrosses=(new Common.UI.MetricSpinner({el:$("#chart-dlg-input-h-axis-crosses"),maxValue:1e6,minValue:-1e6,step:.1,defaultUnit:"",defaultValue:0,value:""})).on("change",_.bind(function(e,t,n){this.cmbHCrossType.suspendEvents(),this.cmbHCrossType.setValue(c_oAscCrossesRule.value),this.cmbHCrossType.resumeEvents(),this.currentAxisProps&&(this.currentAxisProps.putCrossesRule(c_oAscCrossesRule.value),this.currentAxisProps.putCrosses(e.getNumberValue()))},this)),this.cmbAxisPos=(new Common.UI.ComboBox({el:$("#chart-dlg-combo-axis-pos"),cls:"input-group-nr",menuStyle:"min-width: 140px;",editable:!1,data:[{displayValue:this.textOnTickMarks,value:c_oAscLabelsPosition.byDivisions},{displayValue:this.textBetweenTickMarks,value:c_oAscLabelsPosition.betweenDivisions}]})).on("selected",_.bind(function(e,t){this.currentAxisProps&&this.currentAxisProps.putLabelsPosition(t.value)},this)),this.chHReverse=(new Common.UI.CheckBox({el:$("#chart-dlg-check-h-reverse"),labelText:this.textReverse})).on("change",_.bind(function(e,t){this.currentAxisProps&&this.currentAxisProps.putInvertCatOrder(t=="checked")},this)),this.cmbHMajorType=(new Common.UI.ComboBox({el:$("#chart-dlg-combo-h-major-type"),cls:"input-group-nr",menuStyle:"min-width: 140px;",editable:!1,data:[{displayValue:this.textNone,value:c_oAscTickMark.TICK_MARK_NONE},{displayValue:this.textCross,value:c_oAscTickMark.TICK_MARK_CROSS},{displayValue:this.textIn,value:c_oAscTickMark.TICK_MARK_IN},{displayValue:this.textOut,value:c_oAscTickMark.TICK_MARK_OUT}]})).on("selected",_.bind(function(e,t){this.currentAxisProps&&this.currentAxisProps.putMajorTickMark(t.value)},this)),this.cmbHMinorType=(new Common.UI.ComboBox({el:$("#chart-dlg-combo-h-minor-type"),cls:"input-group-nr",menuStyle:"min-width: 140px;",editable:!1,data:[{displayValue:this.textNone,value:c_oAscTickMark.TICK_MARK_NONE},{displayValue:this.textCross,value:c_oAscTickMark.TICK_MARK_CROSS},{displayValue:this.textIn,value:c_oAscTickMark.TICK_MARK_IN},{displayValue:this.textOut,value:c_oAscTickMark.TICK_MARK_OUT}]})).on("selected",_.bind(function(e,t){this.currentAxisProps&&this.currentAxisProps.putMinorTickMark(t.value)},this)),this.spnMarksInterval=(new Common.UI.MetricSpinner({el:$("#chart-dlg-input-marks-interval"),width:140,maxValue:1e6,minValue:1,step:1,defaultUnit:"",value:""})).on("change",_.bind(function(e,t,n){this.currentAxisProps&&this.currentAxisProps.putIntervalBetweenTick(e.getNumberValue())},this)),this.cmbHLabelPos=(new Common.UI.ComboBox({el:$("#chart-dlg-combo-h-label-pos"),cls:"input-group-nr",menuStyle:"min-width: 140px;",editable:!1,data:[{displayValue:this.textNone,value:c_oAscTickLabelsPos.TICK_LABEL_POSITION_NONE},{displayValue:this.textLow,value:c_oAscTickLabelsPos.TICK_LABEL_POSITION_LOW},{displayValue:this.textHigh,value:c_oAscTickLabelsPos.TICK_LABEL_POSITION_HIGH},{displayValue:this.textNextToAxis,value:c_oAscTickLabelsPos.TICK_LABEL_POSITION_NEXT_TO}]})).on("selected",_.bind(function(e,t){this.currentAxisProps&&this.currentAxisProps.putTickLabelsPos(t.value)},this)),this.spnLabelDist=(new Common.UI.MetricSpinner({el:$("#chart-dlg-input-label-dist"),width:140,maxValue:1e3,minValue:0,step:1,defaultUnit:"",value:""})).on("change",_.bind(function(e,t,n){this.currentAxisProps&&this.currentAxisProps.putLabelsAxisDistance(e.getNumberValue())},this)),this.spnLabelInterval=(new Common.UI.MetricSpinner({el:$("#chart-dlg-input-label-int"),width:140,maxValue:1e6,minValue:1,step:1,defaultUnit:"",value:""})).on("change",_.bind(function(e,t,n){this.cmbLabelInterval.suspendEvents(),this.cmbLabelInterval.setValue(c_oAscBetweenLabelsRule.manual),this.cmbLabelInterval.resumeEvents(),this.currentAxisProps&&(this.currentAxisProps.putIntervalBetweenLabelsRule(c_oAscBetweenLabelsRule.manual),this.currentAxisProps.putIntervalBetweenLabels(e.getNumberValue()))},this)),this.cmbLabelInterval=(new Common.UI.ComboBox({el:$("#chart-dlg-combo-label-int"),cls:"input-group-nr",menuStyle:"min-width: 140px;",editable:!1,data:[{displayValue:this.textAuto,value:c_oAscBetweenLabelsRule.auto},{displayValue:this.textManual,value:c_oAscBetweenLabelsRule.manual}]})).on("selected",_.bind(function(e,t){this.currentAxisProps&&this.currentAxisProps.putIntervalBetweenLabelsRule(t.value)},this)),this.btnsCategory[2].on("click",_.bind(this.onVCategoryClick,this)),this.btnsCategory[3].on("click",_.bind(this.onHCategoryClick,this)),this.afterRender()},afterRender:function(){this.api&&this.updateChartStyles(this.api.asc_getChartPreviews(this._state.ChartType)),this._setDefaults(this.chartSettings)},onSelectType:function(e,t,n,r){if(this._noApply)return;var i={},s=_.isFunction(r.toJSON);if(s){if(!r.get("selected"))return;i=r.toJSON()}else i=r;this.btnChartType.setIconCls("item-chartlist "+i.iconCls),this.updateChartStyles(this.api.asc_getChartPreviews(i.type)),this.updateAxisProps(i.type,!0),this.chartSettings.changeType(i.type),this.vertAxisProps=this.chartSettings.getVertAxisProps(),this.horAxisProps=this.chartSettings.getHorAxisProps()},updateAxisProps:function(e,t){var n=e==c_oAscChartTypeSettings.lineNormal||e==c_oAscChartTypeSettings.lineStacked||e==c_oAscChartTypeSettings.lineStackedPer||e==c_oAscChartTypeSettings.scatter;this.chMarkers.setVisible(n),this.cmbLines.setVisible(n),this.lblLines.toggleClass("hidden",!n),n=e==c_oAscChartTypeSettings.pie||e==c_oAscChartTypeSettings.doughnut,this.btnsCategory[2].setDisabled(n),this.btnsCategory[3].setDisabled(n),this.cmbHorTitle.setDisabled(n),this.cmbVertTitle.setDisabled(n),this.cmbHorGrid.setDisabled(n),this.cmbVertGrid.setDisabled(n),n=e==c_oAscChartTypeSettings.hBarNormal||e==c_oAscChartTypeSettings.hBarStacked||e==c_oAscChartTypeSettings.hBarStackedPer,this.btnsCategory[2].options.contentTarget=n?"id-chart-settings-dlg-hor":"id-chart-settings-dlg-vert",this.btnsCategory[3].options.contentTarget=n||e==c_oAscChartTypeSettings.scatter?"id-chart-settings-dlg-vert":"id-chart-settings-dlg-hor";if(t)if(n)this.cmbHorGrid.setValue(c_oAscGridLinesSettings.none),this.cmbVertGrid.setValue(c_oAscGridLinesSettings.major);else if(e==c_oAscChartTypeSettings.scatter)this.cmbHorGrid.setValue(c_oAscGridLinesSettings.major),this.cmbVertGrid.setValue(c_oAscGridLinesSettings.major),this.chMarkers.setValue(!0,!0),this.cmbLines.setValue(0);else if(e==c_oAscChartTypeSettings.barNormal||e==c_oAscChartTypeSettings.barStacked||e==c_oAscChartTypeSettings.barStackedPer||e==c_oAscChartTypeSettings.lineNormal||e==c_oAscChartTypeSettings.lineStacked||e==c_oAscChartTypeSettings.lineStackedPer||e==c_oAscChartTypeSettings.areaNormal||e==c_oAscChartTypeSettings.areaStacked||e==c_oAscChartTypeSettings.areaStackedPer||e==c_oAscChartTypeSettings.stock){this.cmbHorGrid.setValue(c_oAscGridLinesSettings.major),this.cmbVertGrid.setValue(c_oAscGridLinesSettings.none);if(e==c_oAscChartTypeSettings.lineNormal||e==c_oAscChartTypeSettings.lineStacked||e==c_oAscChartTypeSettings.lineStackedPer)this.chMarkers.setValue(!1,!0),this.cmbLines.setValue(1)}},onVCategoryClick:function(){this.vertAxisProps.getAxisType()==c_oAscAxisType.val?this.fillVProps(this.vertAxisProps):this.fillHProps(this.vertAxisProps)},onHCategoryClick:function(){this.horAxisProps.getAxisType()==c_oAscAxisType.val?this.fillVProps(this.horAxisProps):this.fillHProps(this.horAxisProps)},fillVProps:function(e){if(e.getAxisType()!==c_oAscAxisType.val)return;var t=e.getMinValRule();this.cmbMinType.setValue(t),this.spnMinValue.setValue(t===c_oAscValAxisRule.fixed?e.getMinVal():"",!0),t=e.getMaxValRule(),this.cmbMaxType.setValue(t),this.spnMaxValue.setValue(t===c_oAscValAxisRule.fixed?e.getMaxVal():"",!0),t=e.getCrossesRule(),this.cmbVCrossType.setValue(t),this.spnVAxisCrosses.setValue(t===c_oAscCrossesRule.value?e.getCrosses():"",!0),this.cmbUnits.setValue(e.getDispUnitsRule()),this.chVReverse.setValue(e.getInvertValOrder(),!0),this.cmbVMajorType.setValue(e.getMajorTickMark()),this.cmbVMinorType.setValue(e.getMinorTickMark()),this.cmbVLabelPos.setValue(e.getTickLabelsPos()),this.currentAxisProps=e},fillHProps:function(e){if(e.getAxisType()!==c_oAscAxisType.cat)return;var t=e.getCrossesRule();this.cmbHCrossType.setValue(t),this.spnHAxisCrosses.setValue(t===c_oAscCrossesRule.value?e.getCrosses():"",!0),this.cmbAxisPos.setValue(e.getLabelsPosition()),this.chHReverse.setValue(e.getInvertCatOrder(),!0),this.cmbHMajorType.setValue(e.getMajorTickMark()),this.cmbHMinorType.setValue(e.getMinorTickMark()),this.spnMarksInterval.setValue(e.getIntervalBetweenTick(),!0),this.cmbHLabelPos.setValue(e.getTickLabelsPos()),this.spnLabelDist.setValue(e.getLabelsAxisDistance(),!0),t=e.getIntervalBetweenLabelsRule(),this.cmbLabelInterval.setValue(t),this.spnLabelInterval.setValue(t===c_oAscBetweenLabelsRule.manual?e.getIntervalBetweenLabels():"",!0),this.currentAxisProps=e},onSelectStyle:function(e,t,n,r){if(this._noApply)return;var i={},s=_.isFunction(r.toJSON);if(s){if(!r.get("selected"))return;i=r.toJSON()}else i=r;var o="url("+i.imageUrl+")",u=this.btnChartStyle.cmpEl.find("span.btn-icon");u.css("background-image",o),this._state.ChartStyle=i.data},updateChartStyles:function(e){var t=this;if(e&&e.length>0){var n=this.mnuChartStylePicker.store;if(n){var r=[],i=-1,s;_.each(e,function(e,n){r.push({imageUrl:e.asc_getImageUrl(),data:e.asc_getStyle(),tip:t.textStyle+" "+e.asc_getStyle()}),t._state.ChartStyle==e.asc_getStyle()&&(i=n,s=e.asc_getImageUrl())}),n.reset(r,{silent:!1})}}this.mnuChartStylePicker.selectByIndex(i,!0);if(i>=0&&this.btnChartStyle.cmpEl){var o="url("+s+")",u=this.btnChartStyle.cmpEl.find("span.btn-icon");u.css("background-image",o)}},_setDefaults:function(e){var t=this;if(e){this.chartSettings=e,this._state.ChartType=e.getType(),this._noApply=!0;var n=this.mnuChartTypePicker.store.findWhere({type:this._state.ChartType});this.mnuChartTypePicker.selectRecord(n,!0),n&&this.btnChartType.setIconCls("item-chartlist "+n.get("iconCls")),this.updateChartStyles(this.api.asc_getChartPreviews(this._state.ChartType)),this._noApply=!1,this._state.ChartStyle=e.getStyle(),n=this.mnuChartStylePicker.store.findWhere({data:this._state.ChartStyle}),this.mnuChartStylePicker.selectRecord(n,!0);if(n){var r=this.btnChartStyle.cmpEl.find("span.btn-icon");r.css("background-image","url("+n.get("imageUrl")+")")}var i=e.getRange();this.txtDataRange.setValue(i?i:""),this.dataRangeValid=i,this.txtDataRange.validation=function(e){if(_.isEmpty(e))return t.cmbDataDirect.isDisabled()||t.cmbDataDirect.setDisabled(!0),!0;t.cmbDataDirect.isDisabled()&&t.cmbDataDirect.setDisabled(!1);var n=t.api.asc_checkDataRange(c_oAscSelectionDialogType.Chart,e,!1);return n==c_oAscError.ID.DataRangeError?t.textInvalidRange:!0},this.cmbDataDirect.setDisabled(i===null),this.cmbDataDirect.setValue(e.getInColumns()?1:0),this.cmbChartTitle.setValue(e.getTitle()),this.cmbLegendPos.setValue(e.getLegendPos()),this.cmbHorTitle.setValue(e.getHorAxisLabel()),this.cmbVertTitle.setValue(e.getVertAxisLabel()),this.cmbHorGrid.setValue(e.getHorGridLines()),this.cmbVertGrid.setValue(e.getVertGridLines()),this.cmbDataLabels.setValue(e.getDataLabelsPos()),this.onSelectDataLabels(this.cmbDataLabels,{value:e.getDataLabelsPos()}),this.chSeriesName.setValue(this.chartSettings.getShowSerName(),!0),this.chCategoryName.setValue(this.chartSettings.getShowCatName(),!0),this.chValue.setValue(this.chartSettings.getShowVal(),!0),i=e.getSeparator(),this.txtSeparator.setValue(i?i:""),i=this._state.ChartType==c_oAscChartTypeSettings.lineNormal||this._state.ChartType==c_oAscChartTypeSettings.lineStacked||this._state.ChartType==c_oAscChartTypeSettings.lineStackedPer||this._state.ChartType==c_oAscChartTypeSettings.scatter,this.chMarkers.setVisible(i),this.cmbLines.setVisible(i),this.lblLines.toggleClass("hidden",!i),i&&(this.chMarkers.setValue(this.chartSettings.getShowMarker(),!0),this.cmbLines.setValue(e.getLine()?e.getSmooth()?2:1:0)),this.vertAxisProps=e.getVertAxisProps(),this.horAxisProps=e.getHorAxisProps(),this.updateAxisProps(this._state.ChartType)}},getSettings:function(){var e,t=this.mnuChartTypePicker.getSelectedRec()[0].get("type");return this.chartSettings.putType(t),this.chartSettings.putStyle(this._state.ChartStyle),this.chartSettings.putInColumns(this.cmbDataDirect.getValue()==1),this.chartSettings.putRange(this.txtDataRange.getValue()),this.chartSettings.putTitle(this.cmbChartTitle.getValue()),this.chartSettings.putLegendPos(this.cmbLegendPos.getValue()),this.chartSettings.putHorAxisLabel(this.cmbHorTitle.getValue()),this.chartSettings.putVertAxisLabel(this.cmbVertTitle.getValue()),this.chartSettings.putHorGridLines(this.cmbHorGrid.getValue()),this.chartSettings.putVertGridLines(this.cmbVertGrid.getValue()),this.chartSettings.putDataLabelsPos(this.cmbDataLabels.getValue()),this.chartSettings.putShowSerName(this.chSeriesName.getValue()=="checked"),this.chartSettings.putShowCatName(this.chCategoryName.getValue()=="checked"),this.chartSettings.putShowVal(this.chValue.getValue()=="checked"),this.chartSettings.putSeparator(_.isEmpty(this.txtSeparator.getValue())?" ":this.txtSeparator.getValue()),this.chartSettings.putShowMarker(this.chMarkers.getValue()=="checked"),e=t==c_oAscChartTypeSettings.lineNormal||t==c_oAscChartTypeSettings.lineStacked||t==c_oAscChartTypeSettings.lineStackedPer||t==c_oAscChartTypeSettings.scatter,e&&(e=this.cmbLines.getValue(),this.chartSettings.putLine(e!==0),e>0&&this.chartSettings.putSmooth(e==2)),this.chartSettings.putVertAxisProps(this.vertAxisProps),this.chartSettings.putHorAxisProps(this.horAxisProps),{chartSettings:this.chartSettings}},isRangeValid:function(){var e;if(!_.isEmpty(this.txtDataRange.getValue())){e=this.api.asc_checkDataRange(c_oAscSelectionDialogType.Chart,this.txtDataRange.getValue(),!0,this.cmbDataDirect.getValue()==0,this.mnuChartTypePicker.getSelectedRec()[0].get("type"));if(e==c_oAscError.ID.No)return!0}else this.txtDataRange.showError([this.txtEmpty]);return this.btnsCategory[0].toggle(!0),this.onCategoryClick(this.btnsCategory[0]),e==c_oAscError.ID.StockChartError?Common.UI.warning({msg:this.errorStockChart}):e==c_oAscError.ID.MaxDataSeriesError?Common.UI.warning({msg:this.errorMaxRows}):this.txtDataRange.cmpEl.find("input").focus(),!1},onSelectData:function(){var e=this;if(e.api){var t=function(t,n){n=="ok"&&(e.dataRangeValid=t.getSettings(),e.txtDataRange.setValue(e.dataRangeValid),e.txtDataRange.checkValidate())},n=(new SSE.Views.CellRangeDialog({handler:t})).on("close",function(){e.show()}),r=e.$window.offset();e.hide(),n.show(r.left+160,r.top+125),n.setSettings({api:e.api,isRows:e.cmbDataDirect.getValue()==0,range:!_.isEmpty(e.txtDataRange.getValue())&&e.txtDataRange.checkValidate()==1?e.txtDataRange.getValue():e.dataRangeValid})}},onSelectDataLabels:function(e,t,n){var r=t.value==c_oAscChartDataLabelsPos.none;this.chSeriesName.setDisabled(r),this.chCategoryName.setDisabled(r),this.chValue.setDisabled(r),this.txtSeparator.setDisabled(r)},show:function(){Common.Views.AdvancedSettingsWindow.prototype.show.apply(this,arguments);var e=this;_.delay(function(){e.txtDataRange.cmpEl.find("input").focus()},50)},textTitle:"Chart - Advanced Settings",textShowValues:"Display chart values",textShowBorders:"Display chart borders",textLine:"Line",textColumn:"Column",textBar:"Bar",textArea:"Area",textPie:"Pie",textPoint:"Point",textStock:"Stock",textDataRows:"in rows",textDataColumns:"in columns",textDisplayLegend:"Display Legend",textLegendBottom:"Bottom",textLegendTop:"Top",textLegendRight:"Right",textLegendLeft:"Left",textShowAxis:"Display Axis",textShowGrid:"Grid Lines",textDataRange:"Data Range",textChartTitle:"Chart Title",textXAxisTitle:"X Axis Title",textYAxisTitle:"Y Axis Title",txtEmpty:"This field is required",textInvalidRange:"ERROR! Invalid cells range",cancelButtonText:"Cancel",textTypeStyle:"Chart Type, Style &<br/>Data Range",textChartElementsLegend:"Chart Elements &<br/>Chart Legend",textLayout:"Layout",textLegendPos:"Legend",textHorTitle:"Horizontal Axis Title",textVertTitle:"Vertical Axis Title",textDataLabels:"Data Labels",textSeparator:"Data Labels Separator",textSeriesName:"Series Name",textCategoryName:"Category Name",textValue:"Value",textAxisOptions:"Axis Options",textMinValue:"Minimum Value",textMaxValue:"Maximum Value",textAxisCrosses:"Axis Crosses",textUnits:"Display Units",textTickOptions:"Tick Options",textMajorType:"Major Type",textMinorType:"Minor Type",textLabelOptions:"Label Options",textLabelPos:"Label Position",textReverse:"Values in reverse order",textVertAxis:"Vertical Axis",textHorAxis:"Horizontal Axis",textMarksInterval:"Interval between Marks",textLabelDist:"Axis Label Distance",textLabelInterval:"Interval between Labels",textAxisPos:"Axis Position",textLeftOverlay:"Left Overlay",textRightOverlay:"Right Overlay",textOverlay:"Overlay",textNoOverlay:"No Overlay",textRotated:"Rotated",textHorizontal:"Horizontal",textInnerBottom:"Inner Bottom",textInnerTop:"Inner Top",textOuterTop:"Outer Top",textNone:"None",textCenter:"Center",textFixed:"Fixed",textAuto:"Auto",textCross:"Cross",textIn:"In",textOut:"Out",textLow:"Low",textHigh:"High",textNextToAxis:"Next to axis",textHundreds:"Hundreds",textThousands:"Thousands",textTenThousands:"10 000",textHundredThousands:"100 000",textMillions:"Millions",textTenMillions:"10 000 000",textHundredMil:"100 000 000",textBillions:"Billions",textTrillions:"Trillions",textCustom:"Custom",textManual:"Manual",textBetweenTickMarks:"Between Tick Marks",textOnTickMarks:"On Tick Marks",textHorGrid:"Horizontal Gridlines",textVertGrid:"Vertical Gridlines",textLines:"Lines",textMarkers:"Markers",textMajor:"Major",textMinor:"Minor",textMajorMinor:"Major and Minor",textStraight:"Straight",textSmooth:"Smooth",textType:"Type",textTypeData:"Type & Data",textStyle:"Style",textSelectData:"Select Data",textDataSeries:"Data series",errorMaxRows:"ERROR! The maximum number of data series per chart is 255.",errorStockChart:"Incorrect row order. To build a stock chart place the data on the sheet in the following order:<br> opening price, max price, min price, closing price."},SSE.Views.ChartSettingsDlg||{}))}),define("spreadsheeteditor/main/app/view/ChartSettings",["text!spreadsheeteditor/main/app/template/ChartSettings.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/MetricSpinner","spreadsheeteditor/main/app/view/ChartSettingsDlg"],function(e,t,n,r){SSE.Views.ChartSettings=r.View.extend(n.extend({el:"#id-chart-settings",template:n.template(e),events:{},options:{alias:"ChartSettings"},initialize:function(){var e=this;this._initSettings=!0,this._state={Width:0,Height:0,ChartStyle:1,ChartType:-1,SeveralCharts:!1,DisabledControls:!1},this._nRatio=1,this.spinners=[],this.lockedControls=[],this._locked=!1,this._noApply=!1,this._originalProps=null,this.render(),this.btnChartType=new Common.UI.Button({cls:"btn-large-dataview",iconCls:"item-chartlist bar-normal",menu:new Common.UI.Menu({style:"width: 330px;",items:[{template:n.template(\'<div id="id-chart-menu-type" class="menu-insertchart"  style="margin: 5px 5px 5px 10px;"></div>\')}]})}),this.btnChartType.on("render:after",function(r){e.mnuChartTypePicker=new Common.UI.DataView({el:t("#id-chart-menu-type"),parentMenu:r.menu,restoreHeight:411,groups:new Common.UI.DataViewGroupStore([{id:"menu-chart-group-bar",caption:e.textColumn},{id:"menu-chart-group-line",caption:e.textLine},{id:"menu-chart-group-pie",caption:e.textPie},{id:"menu-chart-group-hbar",caption:e.textBar},{id:"menu-chart-group-area",caption:e.textArea},{id:"menu-chart-group-scatter",caption:e.textPoint},{id:"menu-chart-group-stock",caption:e.textStock}]),store:new Common.UI.DataViewStore([{group:"menu-chart-group-bar",type:c_oAscChartTypeSettings.barNormal,iconCls:"column-normal",selected:!0},{group:"menu-chart-group-bar",type:c_oAscChartTypeSettings.barStacked,iconCls:"column-stack"},{group:"menu-chart-group-bar",type:c_oAscChartTypeSettings.barStackedPer,iconCls:"column-pstack"},{group:"menu-chart-group-line",type:c_oAscChartTypeSettings.lineNormal,iconCls:"line-normal"},{group:"menu-chart-group-line",type:c_oAscChartTypeSettings.lineStacked,iconCls:"line-stack"},{group:"menu-chart-group-line",type:c_oAscChartTypeSettings.lineStackedPer,iconCls:"line-pstack"},{group:"menu-chart-group-pie",type:c_oAscChartTypeSettings.pie,iconCls:"pie-normal"},{group:"menu-chart-group-pie",type:c_oAscChartTypeSettings.doughnut,iconCls:"pie-doughnut"},{group:"menu-chart-group-hbar",type:c_oAscChartTypeSettings.hBarNormal,iconCls:"bar-normal"},{group:"menu-chart-group-hbar",type:c_oAscChartTypeSettings.hBarStacked,iconCls:"bar-stack"},{group:"menu-chart-group-hbar",type:c_oAscChartTypeSettings.hBarStackedPer,iconCls:"bar-pstack"},{group:"menu-chart-group-area",type:c_oAscChartTypeSettings.areaNormal,iconCls:"area-normal"},{group:"menu-chart-group-area",type:c_oAscChartTypeSettings.areaStacked,iconCls:"area-stack"},{group:"menu-chart-group-area",type:c_oAscChartTypeSettings.areaStackedPer,iconCls:"area-pstack"},{group:"menu-chart-group-scatter",type:c_oAscChartTypeSettings.scatter,iconCls:"point-normal"},{group:"menu-chart-group-stock",type:c_oAscChartTypeSettings.stock,iconCls:"stock-normal"}]),itemTemplate:n.template(\'<div id="<%= id %>" class="item-chartlist <%= iconCls %>"></div>\')})}),this.btnChartType.render(t("#chart-button-type")),this.mnuChartTypePicker.on("item:click",n.bind(this.onSelectType,this,this.btnChartType)),this.lockedControls.push(this.btnChartType),this.btnChartStyle=new Common.UI.Button({cls:"btn-large-dataview",iconCls:"item-wrap",menu:new Common.UI.Menu({menuAlign:"tr-br",items:[{template:n.template(\'<div id="id-chart-menu-style" style="width: 245px; margin: 0 5px;"></div>\')}]})}),this.btnChartStyle.on("render:after",function(r){e.mnuChartStylePicker=new Common.UI.DataView({el:t("#id-chart-menu-style"),style:"max-height: 411px;",parentMenu:r.menu,store:new Common.UI.DataViewStore,itemTemplate:n.template(\'<div id="<%= id %>" class="item-wrap" style="background-image: url(<%= imageUrl %>); background-position: 0 0;"></div>\')}),e.btnChartStyle.menu&&e.btnChartStyle.menu.on("show:after",function(){e.mnuChartStylePicker.scroller.update({alwaysVisibleY:!0})})}),this.btnChartStyle.render(t("#chart-button-style")),this.mnuChartStylePicker.on("item:click",n.bind(this.onSelectStyle,this,this.btnChartStyle)),this.lockedControls.push(this.btnChartStyle),this.spnWidth=new Common.UI.MetricSpinner({el:t("#chart-spin-width"),step:.1,width:78,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0}),this.spinners.push(this.spnWidth),this.lockedControls.push(this.spnWidth),this.spnHeight=new Common.UI.MetricSpinner({el:t("#chart-spin-height"),step:.1,width:78,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0}),this.spinners.push(this.spnHeight),this.lockedControls.push(this.spnHeight),this.spnWidth.on("change",n.bind(this.onWidthChange,this)),this.spnHeight.on("change",n.bind(this.onHeightChange,this)),this.btnRatio=new Common.UI.Button({cls:"btn-toolbar btn-toolbar-default",iconCls:"advanced-btn-ratio",style:"margin-bottom: 1px;",enableToggle:!0,hint:this.textKeepRatio}),this.btnRatio.render(t("#chart-button-ratio")),this.lockedControls.push(this.btnRatio);var r=window.localStorage.getItem("sse-settings-chartratio");r!==null&&parseInt(r)==1&&this.btnRatio.toggle(!0),this.btnRatio.on("click",n.bind(function(e,t){e.pressed&&this.spnHeight.getNumberValue()>0&&(this._nRatio=this.spnWidth.getNumberValue()/this.spnHeight.getNumberValue()),window.localStorage.setItem("sse-settings-chartratio",e.pressed?1:0)},this)),t(this.el).on("click","#chart-advanced-link",n.bind(this.openAdvancedSettings,this))},render:function(){var e=t(this.el);e.html(this.template({scope:this})),this.linkAdvanced=t("#chart-advanced-link")},setApi:function(e){return this.api=e,this.api&&this.api.asc_registerCallback("asc_onUpdateChartStyles",n.bind(this._onUpdateChartStyles,this)),this},ChangeSettings:function(e){this._initSettings&&(this.createDelayedElements(),this._initSettings=!1),this.disableControls(this._locked);if(this.api&&e&&e.asc_getChartProperties()){this._originalProps=new Asc.asc_CImgProperty(e),this._noApply=!0,this.chartProps=e.asc_getChartProperties();var t=e.asc_getSeveralCharts()||this._locked;this._state.SeveralCharts!==t&&(this.linkAdvanced.toggleClass("disabled",t),this._state.SeveralCharts=t),t=e.asc_getSeveralChartTypes();if(this._state.SeveralCharts&&t)this.btnChartType.setIconCls(""),this._state.ChartType=null;else{var n=this.chartProps.getType();if(this._state.ChartType!==n){var r=this.mnuChartTypePicker.store.findWhere({type:n});this.mnuChartTypePicker.selectRecord(r,!0),r&&this.btnChartType.setIconCls("item-chartlist "+r.get("iconCls")),this.updateChartStyles(this.api.asc_getChartPreviews(n)),this._state.ChartType=n}}t=e.asc_getSeveralChartStyles();if(this._state.SeveralCharts&&t){var i=this.btnChartStyle.cmpEl.find("span.btn-icon");i.css("background-image","none"),this.mnuChartStylePicker.selectRecord(null,!0),this._state.ChartStyle=null}else{t=this.chartProps.getStyle();if(this._state.ChartStyle!==t){var r=this.mnuChartStylePicker.store.findWhere({data:t});this.mnuChartStylePicker.selectRecord(r,!0);if(r){var i=this.btnChartStyle.cmpEl.find("span.btn-icon");i.css("background-image","url("+r.get("imageUrl")+")")}this._state.ChartStyle=t}}this._noApply=!1,t=e.asc_getWidth();if(Math.abs(this._state.Width-t)>.001||(this._state.Width===null||t===null)&&this._state.Width!==t)this.spnWidth.setValue(t!==null?Common.Utils.Metric.fnRecalcFromMM(t):"",!0),this._state.Width=t;t=e.asc_getHeight();if(Math.abs(this._state.Height-t)>.001||(this._state.Height===null||t===null)&&this._state.Height!==t)this.spnHeight.setValue(t!==null?Common.Utils.Metric.fnRecalcFromMM(t):"",!0),this._state.Height=t;e.asc_getHeight()>0&&(this._nRatio=e.asc_getWidth()/e.asc_getHeight())}},updateMetricUnit:function(){if(this.spinners)for(var e=0;e<this.spinners.length;e++){var t=this.spinners[e];t.setDefaultUnit(Common.Utils.Metric.metricName[Common.Utils.Metric.getCurrentMetric()]),t.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.cm?.1:1)}},createDelayedElements:function(){this.updateMetricUnit()},onWidthChange:function(e,t,n,r){var i=e.getNumberValue(),s=this.spnHeight.getNumberValue();this.btnRatio.pressed&&(s=i/this._nRatio,s>this.spnHeight.options.maxValue&&(s=this.spnHeight.options.maxValue,i=s*this._nRatio,this.spnWidth.setValue(i,!0)),this.spnHeight.setValue(s,!0));if(this.api){var o=new Asc.asc_CImgProperty;o.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(i)),o.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(s)),this.api.asc_setGraphicObjectProps(o)}Common.NotificationCenter.trigger("edit:complete",this)},onHeightChange:function(e,t,n,r){var i=e.getNumberValue(),s=this.spnWidth.getNumberValue();this.btnRatio.pressed&&(s=i*this._nRatio,s>this.spnWidth.options.maxValue&&(s=this.spnWidth.options.maxValue,i=s/this._nRatio,this.spnHeight.setValue(i,!0)),this.spnWidth.setValue(s,!0));if(this.api){var o=new Asc.asc_CImgProperty;o.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(s)),o.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(i)),this.api.asc_setGraphicObjectProps(o)}Common.NotificationCenter.trigger("edit:complete",this)},openAdvancedSettings:function(){if(this.linkAdvanced.hasClass("disabled"))return;var e=this,t,n;e.api&&(n=e.api.asc_getChartObject(),n&&(new SSE.Views.ChartSettingsDlg({chartSettings:n,api:e.api,handler:function(t,n){t=="ok"&&e.api&&e.api.asc_editChartDrawingObject(n.chartSettings),Common.NotificationCenter.trigger("edit:complete",e)}})).show())},onSelectType:function(e,t,r,i){if(this._noApply)return;var s={},o=n.isFunction(i.toJSON);if(o){if(!i.get("selected"))return;s=i.toJSON()}else s=i;this.btnChartType.setIconCls("item-chartlist "+s.iconCls),this._state.ChartType=-1;if(this.api&&!this._noApply&&this.chartProps){var u=new Asc.asc_CImgProperty;this.chartProps.changeType(s.type),u.asc_putChartProperties(this.chartProps),this.api.asc_setGraphicObjectProps(u)}Common.NotificationCenter.trigger("edit:complete",this)},onSelectStyle:function(e,t,r,i){if(this._noApply)return;var s={},o=n.isFunction(i.toJSON);if(o){if(!i.get("selected"))return;s=i.toJSON()}else s=i;var u="url("+s.imageUrl+")",a=this.btnChartStyle.cmpEl.find("span.btn-icon");a.css("background-image",u);if(this.api&&!this._noApply&&this.chartProps){var f=new Asc.asc_CImgProperty;this.chartProps.putStyle(s.data),f.asc_putChartProperties(this.chartProps),this.api.asc_setGraphicObjectProps(f)}Common.NotificationCenter.trigger("edit:complete",this)},_

]]></string> </value>
        </item>
        <item>
            <key> <string>next</string> </key>
            <value>
              <persistent> <string encoding="base64">AAAAAAAAAAs=</string> </persistent>
            </value>
        </item>
      </dictionary>
    </pickle>
  </record>
  <record id="11" aka="AAAAAAAAAAs=">
    <pickle>
      <global name="Pdata" module="OFS.Image"/>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>data</string> </key>
            <value> <string encoding="cdata"><![CDATA[

onUpdateChartStyles:function(){this.api&&this._state.ChartType!==null&&this._state.ChartType>-1&&this.updateChartStyles(this.api.asc_getChartPreviews(this._state.ChartType))},updateChartStyles:function(e){var t=this;if(e&&e.length>0){var r=this.mnuChartStylePicker.store;if(r){var i=[],s=-1,o;n.each(e,function(e,n){i.push({imageUrl:e.asc_getImageUrl(),data:e.asc_getStyle(),tip:t.textStyle+" "+e.asc_getStyle()}),t._state.ChartStyle==e.asc_getStyle()&&(s=n,o=e.asc_getImageUrl())}),r.reset(i,{silent:!1})}}this.mnuChartStylePicker.selectByIndex(s,!0);if(s>=0&&this.btnChartStyle.cmpEl){var u="url("+o+")",a=this.btnChartStyle.cmpEl.find("span.btn-icon");a.css("background-image",u)}},setLocked:function(e){this._locked=e},disableControls:function(e){this._state.DisabledControls!==e&&(this._state.DisabledControls=e,n.each(this.lockedControls,function(t){t.setDisabled(e)}),this.linkAdvanced.toggleClass("disabled",e))},textKeepRatio:"Constant Proportions",textSize:"Size",textWidth:"Width",textHeight:"Height",textEditData:"Edit Data",textChartType:"Change Chart Type",textLine:"Line Chart",textColumn:"Column Chart",textBar:"Bar Chart",textArea:"Area Chart",textPie:"Pie Chart",textPoint:"Point Chart",textStock:"Stock Chart",textStyle:"Style",textAdvanced:"Show advanced settings"},SSE.Views.ChartSettings||{}))}),define("text!spreadsheeteditor/main/app/template/ShapeSettings.template",[],function(){return\'<table cols="1">\\r\\n    <tr>\\r\\n        <td>\\r\\n            <label class="header"><%= scope.strFill %></label>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr>\\r\\n        <td class="padding-small">\\r\\n            <div id="shape-combo-fill-src" style="width: 100%;"></div>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr>\\r\\n        <td>\\r\\n            <div id="shape-panel-color-fill" class="padding-small" style="width: 100%;">\\r\\n                <div id="shape-back-color-btn" style=""></div>\\r\\n            </div>\\r\\n            <div id="shape-panel-image-fill" class="settings-hidden padding-small" style="width: 100%;">\\r\\n                <table cols="2" style="width: 100%;">\\r\\n                <tr>\\r\\n                    <td class="padding-small" width="50%">\\r\\n                        <button type="button" class="btn btn-text-default" id="shape-button-from-file" style="width:90px;"><%= scope.textFromFile %></button>\\r\\n                    </td>\\r\\n                    <td class="padding-small" width="50%">\\r\\n                        <button type="button" class="btn btn-text-default" id="shape-button-from-url" style="width:90px;"><%= scope.textFromUrl %></button>\\r\\n                    </td>\\r\\n                </tr>\\r\\n                <tr>\\r\\n                    <td style="vertical-align: top">\\r\\n                        <div id="shape-combo-fill-type" style="width: 90px;"></div>\\r\\n                    </td>\\r\\n                    <td rowspan="2">\\r\\n                        <div style="width: 90px; height: 80px; padding: 14px 20px; border: 1px solid #AFAFAF; border-radius: 2px; background: #ffffff;">\\r\\n                            <div id="shape-texture-img" style="width: 50px;height: 50px;"></div>\\r\\n                        </div>\\r\\n                    </td>\\r\\n                </tr>\\r\\n                <tr>\\r\\n                    <td style="vertical-align: bottom">\\r\\n                        <label class="input-label" style=""><%= scope.textTexture %></label>\\r\\n                        <div id="shape-combo-fill-texture" style="width: 90px;"></div>\\r\\n                    </td>\\r\\n                </tr>\\r\\n            </table>\\r\\n            </div>\\r\\n            <div id="shape-panel-pattern-fill" class="settings-hidden padding-small" style="width: 100%;">\\r\\n                <label class="input-label" style="margin-top: 3px;"><%= scope.strPattern %></label>\\r\\n                <div id="shape-combo-pattern" style="width: 100%; height: 42px; margin-bottom: 8px;"></div>\\r\\n                <div style="width: 100%; height: 25px; margin-bottom: 8px;">\\r\\n                    <label class="input-label" style="margin-top: 3px;"><%= scope.strForeground %></label>\\r\\n                    <div id="shape-foreground-color-btn" style="display: inline-block; float:right;"></div>\\r\\n                </div>\\r\\n                <div style="width: 100%; height: 25px;">\\r\\n                    <label class="input-label" style="margin-top: 3px;"><%= scope.strBackground %></label>\\r\\n                    <div id="shape-background-color-btn" style="display: inline-block; float:right;"></div>\\r\\n                </div>\\r\\n            </div>\\r\\n            <div id="shape-panel-gradient-fill" class="settings-hidden padding-small" style="width: 100%;">\\r\\n                <div style="height:80px;">\\r\\n                    <div style="display: inline-block;">\\r\\n                        <label class="input-label" style=""><%= scope.textStyle %></label>\\r\\n                        <div id="shape-combo-grad-type" style="width: 90px;"></div>\\r\\n                    </div>\\r\\n                    <div style="display: inline-block;float: right;">\\r\\n                        <label class="input-label" style=""><%= scope.textDirection %></label>\\r\\n                        <div id="shape-button-direction" style=""></div>\\r\\n                    </div>\\r\\n                </div>\\r\\n                <label class="header" style="display:block;margin-bottom: 5px;"><%= scope.textGradient %></label>\\r\\n                <div style="display: inline-block; margin-top: 3px;">\\r\\n                    <div id="shape-slider-gradient" style="display: inline-block; vertical-align: middle;"></div>\\r\\n                </div>\\r\\n                <div id="shape-gradient-color-btn" style="display: inline-block;float: right;"></div>\\r\\n            </div>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr>\\r\\n        <td>\\r\\n            <div class="padding-small" id="shape-panel-transparent-fill" style="width: 100%;">\\r\\n                <label class="header" style="display:block;"><%= scope.strTransparency %></label>\\r\\n                <div style="display: inline-block; margin-top: 3px;">\\r\\n                    <label id="shape-lbl-transparency-start">0</label>\\r\\n                    <div id="shape-slider-transparency" style="display: inline-block;margin: 0 4px; vertical-align: middle;"></div>\\r\\n                    <label id="shape-lbl-transparency-end">100</label>\\r\\n                </div>\\r\\n                <div id="shape-spin-transparency" style="display: inline-block;float: right;"></div>\\r\\n            </div>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr>\\r\\n        <td class="padding-small">\\r\\n            <div class="separator horizontal"></div>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr>\\r\\n        <td>\\r\\n            <label class="header"><%= scope.strStroke %></label>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr>\\r\\n        <td>\\r\\n        <div style="display:inline-block;width:100px;vertical-align: middle;">\\r\\n            <label class="input-label" style=""><%= scope.strSize %></label>\\r\\n            <div id="shape-combo-border-size" style="width: 93px;"></div>\\r\\n        </div>\\r\\n        <div style="display:inline-block;vertical-align: middle;">\\r\\n            <label class="input-label" style=""><%= scope.strColor %></label>\\r\\n            <div id="shape-border-color-btn" style=""></div>\\r\\n        </div>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr class="shape-only">\\r\\n        <td class="padding-small"></td>\\r\\n    </tr>\\r\\n    <tr class="shape-only">\\r\\n        <td class="padding-small">\\r\\n            <div class="separator horizontal"></div>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr class="shape-only">\\r\\n        <td class="padding-small">\\r\\n            <label class="header" style="margin-top: 3px;"><%= scope.strChange %></label>\\r\\n            <div id="shape-btn-change" style="display: inline-block; float:right;"></div>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr class="shape-only">\\r\\n        <td class="padding-small">\\r\\n            <div class="separator horizontal"></div>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr class="shape-only">\\r\\n        <td align="center">\\r\\n            <label class="link" id="shape-advanced-link"><%= scope.textAdvanced %></label>\\r\\n        </td>\\r\\n    </tr>\\r\\n    <tr class="finish-cell"></tr>\\r\\n</table>\'});if(Common===undefined)var Common={};define("common/main/lib/component/ComboBorderSize",["common/main/lib/component/ComboBox"],function(){Common.UI.BordersModel=Backbone.Model.extend({defaults:function(){return{value:null,displayValue:null,pxValue:null,id:Common.UI.getId(),offsety:undefined}}}),Common.UI.BordersStore=Backbone.Collection.extend({model:Common.UI.BordersModel}),Common.UI.ComboBorderSize=Common.UI.ComboBox.extend(_.extend({template:_.template([\'<div class="input-group combobox combo-border-size input-group-nr <%= cls %>" id="<%= id %>" style="<%= style %>">\',\'<div class="form-control" style="<%= style %>"></div>\',\'<div style="display: table-cell;"></div>\',\'<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>\',\'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">\',"<% _.each(items, function(item) { %>",\'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem">\',"<span><%= item.displayValue %></span>","<% if (item.offsety!==undefined) { %>",\'<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" align="right" style="background-position: 0 -<%= item.offsety %>px;">\',"<% } %>","</a></li>","<% }); %>","</ul>","</div>"].join("")),initialize:function(e){Common.UI.ComboBox.prototype.initialize.call(this,_.extend({editable:!1,store:new Common.UI.BordersStore,data:[{displayValue:this.txtNoBorders,value:0,pxValue:0},{displayValue:"0.5 pt",value:.5,pxValue:.5,offsety:0},{displayValue:"1 pt",value:1,pxValue:1,offsety:20},{displayValue:"1.5 pt",value:1.5,pxValue:2,offsety:40},{displayValue:"2.25 pt",value:2.25,pxValue:3,offsety:60},{displayValue:"3 pt",value:3,pxValue:4,offsety:80},{displayValue:"4.5 pt",value:4.5,pxValue:5,offsety:100},{displayValue:"6 pt",value:6,pxValue:6,offsety:120}],menuStyle:"min-width: 150px;"},e))},render:function(e){return Common.UI.ComboBox.prototype.render.call(this,e),this},itemClicked:function(e){var t=$(e.currentTarget).parent();this._selectedItem=this.store.findWhere({id:t.attr("id")}),this._selectedItem&&($(".selected",$(this.el)).removeClass("selected"),t.addClass("selected"),this.updateFormControl(this._selectedItem),this.trigger("selected",this,_.extend({},this._selectedItem.toJSON()),e),e.preventDefault())},updateFormControl:function(e){var t=$(this.el).find(".form-control");e.get("value")>0?(t[0].innerHTML="",t.removeClass("text").addClass("image"),t.css("background-position","0 -"+e.get("offsety")+"px")):(t[0].innerHTML=this.txtNoBorders,t.removeClass("image").addClass("text"))},setValue:function(e){this._selectedItem=e===null||e===undefined?undefined:_.find(this.store.models,function(t){if(e<t.attributes.value+.01&&e>t.attributes.value-.01)return!0}),$(".selected",$(this.el)).removeClass("selected");if(this._selectedItem)this.updateFormControl(this._selectedItem),$("#"+this._selectedItem.get("id"),$(this.el)).addClass("selected");else{var t=$(this.el).find(".form-control");t[0].innerHTML="",t.removeClass("image").addClass("text")}},txtNoBorders:"No Borders"},Common.UI.ComboBorderSize||{})),Common.UI.ComboBorderSizeEditable=Common.UI.ComboBox.extend(_.extend({template:_.template([\'<span class="input-group combobox combo-border-size-editable input-group-nr <%= cls %>" id="<%= id %>" style="<%= style %>">\',\'<input type="text" class="form-control">\',\'<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>\',\'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">\',"<% _.each(items, function(item) { %>",\'<li id="<%= item.id %>" data-value="<%= item.value %>"><a tabindex="-1" type="menuitem">\',"<span><%= item.displayValue %></span>","<% if (item.offsety!==undefined) { %>",\'<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" align="right" style="background-position: 0 -<%= item.offsety %>px;">\',"<% } %>","</a></li>","<% }); %>","</ul>","</span>"].join("")),initialize:function(e){this.txtNoBorders=e.txtNoBorders||this.txtNoBorders,Common.UI.ComboBox.prototype.initialize.call(this,_.extend({editable:!0,store:new Common.UI.BordersStore,data:[{displayValue:this.txtNoBorders,value:0,pxValue:0},{displayValue:"0.5 pt",value:.5,pxValue:.5,offsety:0},{displayValue:"1 pt",value:1,pxValue:1,offsety:20},{displayValue:"1.5 pt",value:1.5,pxValue:2,offsety:40},{displayValue:"2.25 pt",value:2.25,pxValue:3,offsety:60},{displayValue:"3 pt",value:3,pxValue:4,offsety:80},{displayValue:"4.5 pt",value:4.5,pxValue:5,offsety:100},{displayValue:"6 pt",value:6,pxValue:6,offsety:120}],menuStyle:"min-width: 150px;"},e))},render:function(e){return Common.UI.ComboBox.prototype.render.call(this,e),this},txtNoBorders:"No Borders"},Common.UI.ComboBorderSizeEditable||{}))});if(Common===undefined)var Common={};define("common/main/lib/component/ColorButton",["common/main/lib/component/Button"],function(){Common.UI.ColorButton=Common.UI.Button.extend({options:{hint:!1,enableToggle:!1},template:_.template([\'<div class="btn-group" id="<%= id %>">\',\'<button type="button" class="btn btn-color dropdown-toggle <%= cls %>" data-toggle="dropdown" style="<%= style %>">\',"<span>&nbsp;</span>","</button>","</div>"].join("")),setColor:function(e){var t,n,r=$(this.cmpEl).find("button span");this.color=e,e=="transparent"?(t="#BEBEBE",n=e,r.addClass("transparent")):(t="transparent",n=typeof e=="object"?"#"+e.color:"#"+e,r.removeClass("transparent")),r.css({"background-color":n,"border-color":t})}})});if(Common===undefined)var Common={};define("common/main/lib/component/Slider",["common/main/lib/component/BaseView","underscore"],function(e,t){Common.UI.SingleSlider=Common.UI.BaseView.extend({options:{width:100,minValue:0,maxValue:100,step:1,value:100,enableKeyEvents:!1},disabled:!1,template:t.template([\'<div class="slider single-slider" style="">\',\'<div class="track">\',\'<div class="track-left"></div>\',\'<div class="track-center""></div>\',\'<div class="track-right" style=""></div>\',"</div>",\'<div class="thumb" style=""></div>\',"<% if (this.options.enableKeyEvents) { %>",\'<input type="text" style="position: absolute; top:-10px; width: 1px; height: 1px;">\',"<% } %>","</div>"].join("")),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e);var t=this,n=$(this.el);t.width=t.options.width,t.minValue=t.options.minValue,t.maxValue=t.options.maxValue,t.delta=100/(t.maxValue-t.minValue),t.step=t.options.step,t.options.el&&t.render(),this.setValue(t.options.value)},render:function(e){var n=this;n.rendered?this.cmpEl=$(this.el):(this.cmpEl=$(this.template({})),e?(this.setElement(e,!1),e.html(this.cmpEl)):$(this.el).html(this.cmpEl)),this.cmpEl.find(".track-center").width(n.options.width-14),this.cmpEl.width(n.options.width),this.thumb=this.cmpEl.find(".thumb");var r=function(e){if(n.disabled)return;e.preventDefault(),e.stopPropagation();var t=Math.max(0,Math.min(100,Math.round((e.pageX-n.cmpEl.offset().left-n._dragstart)/n.width*100)));n.setThumbPosition(t),n.lastValue=n.value,n.value=t/n.delta+n.minValue,n.thumb.removeClass("active"),$(document).off("mouseup",r),$(document).off("mousemove",i),n._dragstart=undefined,n.trigger("changecomplete",n,n.value,n.lastValue)},i=function(e){if(n.disabled)return;if(n._dragstart===undefined)return;e.preventDefault(),e.stopPropagation();var t=Math.max(0,Math.min(100,Math.round((e.pageX-n.cmpEl.offset().left-n._dragstart)/n.width*100)));n.setThumbPosition(t),n.lastValue=n.value,n.value=t/n.delta+n.minValue,Math.abs(n.value-n.lastValue)>.001&&n.trigger("change",n,n.value,n.lastValue)},s=function(e){if(n.disabled)return;n._dragstart=e.pageX-n.thumb.offset().left-7,n.thumb.addClass("active"),$(document).on("mouseup",r),$(document).on("mousemove",i),n.options.enableKeyEvents&&setTimeout(function(){n.input.focus()},10)},o=function(e){if(n.disabled)return;var t=Math.max(0,Math.min(100,Math.round((e.pageX-n.cmpEl.offset().left)/n.width*100)));n.setThumbPosition(t),n.lastValue=n.value,n.value=t/n.delta+n.minValue,n.trigger("change",n,n.value,n.lastValue),n.trigger("changecomplete",n,n.value,n.lastValue)},u,a=function(e){n.lastValue=n.value,n.value=Math.max(n.minValue,Math.min(n.maxValue,n.value+(e?n.step:-n.step))),n.setThumbPosition(Math.round((n.value-n.minValue)*n.delta)),n.trigger("change",n,n.value,n.lastValue)},f=function(e){if(n.disabled)return;if(e.keyCode==Common.UI.Keys.UP||e.keyCode==Common.UI.Keys.DOWN||e.keyCode==Common.UI.Keys.LEFT||e.keyCode==Common.UI.Keys.RIGHT)e.preventDefault(),e.stopPropagation(),c.off("keydown","input",f),u=setInterval(t.bind(a,n,e.keyCode==Common.UI.Keys.UP||e.keyCode==Common.UI.Keys.RIGHT),100)},l=function(e){if(n.disabled)return;if(e.keyCode==Common.UI.Keys.UP||e.keyCode==Common.UI.Keys.DOWN||Common.UI.Keys.LEFT||Common.UI.Keys.RIGHT)e.stopPropagation(),e.preventDefault(),clearInterval(u),a(e.keyCode==Common.UI.Keys.UP||e.keyCode==Common.UI.Keys.RIGHT),c.on("keydown","input",f),n.trigger("changecomplete",n,n.value,n.lastValue)};if(!n.rendered){var c=n.cmpEl;c.on("mousedown",".thumb",s),c.on("mousedown",".track",o),this.options.enableKeyEvents&&(c.on("keydown","input",f),c.on("keyup","input",l))}return n.rendered=!0,this},setThumbPosition:function(e){this.thumb.css({left:e+"%"})},setValue:function(e){this.lastValue=this.value,this.value=Math.max(this.minValue,Math.min(this.maxValue,e)),this.setThumbPosition(Math.round((e-this.minValue)*this.delta))},getValue:function(){return this.value},setDisabled:function(e){e!==this.disabled&&this.cmpEl.toggleClass("disabled",e),this.disabled=e}}),Common.UI.MultiSlider=Common.UI.BaseView.extend({options:{width:100,minValue:0,maxValue:100,values:[0,100]},disabled:!1,template:t.template([\'<div class="slider multi-slider">\',\'<div class="track">\',\'<div class="track-left"></div>\',\'<div class="track-center""></div>\',\'<div class="track-right" style=""></div>\',"</div>","<% _.each(items, function(item) { %>",\'<div class="thumb" style=""></div>\',"<% }); %>","</div>"].join("")),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e);var t=this,n=$(this.el);t.width=t.options.width,t.minValue=t.options.minValue,t.maxValue=t.options.maxValue,t.delta=100/(t.maxValue-t.minValue),t.thumbs=[],t.options.el&&t.render()},render:function(e){var n=this;n.rendered?this.cmpEl=$(this.el):(this.cmpEl=$(this.template({items:this.options.values})),e?(this.setElement(e,!1),e.html(this.cmpEl)):$(this.el).html(this.cmpEl));var r=this.cmpEl;r.find(".track-center").width(n.options.width-14),r.width(n.options.width);var i=function(e){if(n.disabled)return;e.preventDefault(),e.stopPropagation();var t=e.data,r=n.thumbs[t].value,o=t-1<0?0:n.thumbs[t-1].position,u=t+1<n.thumbs.length?n.thumbs[t+1].position:100,a=Math.max(o,Math.min(u,Math.round((e.pageX-n.cmpEl.offset().left-n._dragstart)/n.width*100))),f=a/n.delta+n.minValue;n.setThumbPosition(t,a),n.thumbs[t].value=f,$(document).off("mouseup",i),$(document).off("mousemove",s),n._dragstart=undefined,n.trigger("changecomplete",n,f,r)},s=function(e){if(n.disabled)return;if(n._dragstart===undefined)return;e.preventDefault(),e.stopPropagation();var t=e.data,r=n.thumbs[t].value,i=t-1<0?0:n.thumbs[t-1].position,s=t+1<n.thumbs.length?n.thumbs[t+1].position:100,o=Math.max(i,Math.min(s,Math.round((e.pageX-n.cmpEl.offset().left-n._dragstart)/n.width*100))),u=o/n.delta+n.minValue;n.setThumbPosition(t,o),n.thumbs[t].value=u,Math.abs(u-r)>.001&&n.trigger("change",n,u,r)},o=function(e){if(n.disabled)return;var r=e.data,o=n.thumbs[r].thumb;n._dragstart=e.pageX-o.offset().left-o.width()/2,n.setActiveThumb(r),t.each(n.thumbs,function(e,t){r==t?e.thumb.css("z-index",500):e.thumb.css("z-index","")}),$(document).on("mouseup",null,r,i),$(document).on("mousemove",null,r,s)},u=function(e){if(n.disabled)return;var t=Math.max(0,Math.min(100,Math.round((e.pageX-n.cmpEl.offset().left)/n.width*100))),r=a(t),i=n.thumbs[r].value,s=t/n.delta+n.minValue;n.setThumbPosition(r,t),n.thumbs[r].value=s,n.trigger("change",n,s,i),n.trigger("changecomplete",n,s,i)},a=function(e){var t=100,r=0,i=n.thumbs.length,s;for(var o=0;o<i;o++){s=Math.abs(n.thumbs[o].position-e);if(Math.abs(s<=t)){var u=n.thumbs[o+1],a=n.thumbs[o-1];if(a!==undefined&&e<a.position)continue;if(u!==undefined&&e>u.position)continue;r=o,t=s}}return r};return this.$thumbs=r.find(".thumb"),t.each(this.$thumbs,function(e,t){var r=$(e);n.thumbs.push({thumb:r,index:t}),n.setValue(t,n.options.values[t]),r.on("mousedown",null,t,o)}),n.setActiveThumb(0,!0),n.rendered||r.on("mousedown",".track",u),n.rendered=!0,this},setActiveThumb:function(e,t){this.currentThumb=e,this.$thumbs.removeClass("active"),this.thumbs[e].thumb.addClass("active"),t!==!0&&this.trigger("thumbclick",this,e)},setThumbPosition:function(e,t){this.thumbs[e].position=t,this.thumbs[e].thumb.css({left:t+"%"})},setValue:function(e,t){this.thumbs[e].value=Math.max(this.minValue,Math.min(this.maxValue,t)),this.setThumbPosition(e,Math.round((t-this.minValue)*this.delta))},getValue:function(e){return this.thumbs[e].value},getValues:function(){var e=[];return t.each(this.thumbs,function(t){e.push(t.value)}),e},setDisabled:function(e){e!==this.disabled&&this.cmpEl.toggleClass("disabled",e),this.disabled=e}})});if(Common===undefined)var Common={};define("common/main/lib/component/MultiSliderGradient",["common/main/lib/component/Slider","underscore"],function(e,t){Common.UI.MultiSliderGradient=Common.UI.MultiSlider.extend({options:{width:100,minValue:0,maxValue:100,values:[0,100],colorValues:["#000000","#ffffff"],currentThumb:0},disabled:!1,template:t.template([\'<div class="slider multi-slider-gradient">\',\'<div class="track"></div>\',"<% _.each(items, function(item) { %>",\'<div class="thumb" style=""></div>\',"<% }); %>","</div>"].join("")),initialize:function(e){this.styleStr="",Common.Utils.isChrome&&Common.Utils.chromeVersion<10||Common.Utils.isSafari&&Common.Utils.safariVersion<5.1?this.styleStr="-webkit-gradient(linear, left top, right top, color-stop({1}%,{0}), color-stop({3}%,{2})); /* Chrome,Safari4+ */":Common.Utils.isChrome||Common.Utils.isSafari?this.styleStr="-webkit-linear-gradient(left, {0} {1}%, {2} {3}%)":Common.Utils.isGecko?this.styleStr="-moz-linear-gradient(left, {0} {1}%, {2} {3}%)":Common.Utils.isOpera&&Common.Utils.operaVersion>11?this.styleStr="-o-linear-gradient(left, {0} {1}%, {2} {3}%)":Common.Utils.isIE&&(this.styleStr="-ms-linear-gradient(left, {0} {1}%, {2} {3}%)"),this.colorValues=this.options.colorValues,Common.UI.MultiSlider.prototype.initialize.call(this,e)},render:function(e){Common.UI.MultiSlider.prototype.render.call(this,e);var n=this,r="";n.trackEl=n.cmpEl.find(".track");for(var i=0;i<n.thumbs.length;i++)n.thumbs[i].thumb.on("dblclick",null,function(){n.trigger("thumbdblclick",n)});n.styleStr!==""&&(r=Common.Utils.String.format(n.styleStr,n.colorValues[0],0,n.colorValues[1],100),n.trackEl.css("background",r)),Common.Utils.isIE&&(r=Common.Utils.String.format("progid:DXImageTransform.Microsoft.gradient( startColorstr={0}, endColorstr={1},GradientType=1 )",n.colorValues[0],n.colorValues[1]),n.trackEl.css("filter",r)),r=Common.Utils.String.format("linear-gradient(to right, {0} {1}%, {2} {3}%)",n.colorValues[0],0,n.colorValues[1],100),n.trackEl.css("background",r),n.on("change",t.bind(n.changeGradientStyle,n))},setColorValue:function(e,t){var n=t!==undefined?t:this.currentThumb;this.colorValues[n]=e,this.changeGradientStyle()},getColorValue:function(e){var t=e!==undefined?e:this.currentThumb;return this.colorValues[t]},setValue:function(e,t){Common.UI.MultiSlider.prototype.setValue.call(this,e,t),this.changeGradientStyle()},changeGradientStyle:function(){if(!this.rendered)return;var e;this.styleStr!==""&&(e=Common.Utils.String.format(this.styleStr,this.colorValues[0],this.getValue(0),this.colorValues[1],this.getValue(1)),this.trackEl.css("background",e)),Common.Utils.isIE&&(e=Common.Utils.String.format("progid:DXImageTransform.Microsoft.gradient( startColorstr={0}, endColorstr={1},GradientType=1 )",this.colorValues[0],this.colorValues[1]),this.trackEl.css("filter",e)),e=Common.Utils.String.format("linear-gradient(to right, {0} {1}%, {2} {3}%)",this.colorValues[0],this.getValue(0),this.colorValues[1],this.getValue(1)),this.trackEl.css("background",e)}})}),define("text!spreadsheeteditor/main/app/template/ShapeSettingsAdvanced.template",[],function(){return\'<div id="id-adv-shape-width" class="settings-panel active">\\r\\n    <div class="inner-content">\\r\\n    <table cols="3">\\r\\n        <tr>\\r\\n            <td width="108px">\\r\\n                <label class="input-label"><%= scope.textWidth %></label>\\r\\n                <div id="shape-advanced-spin-width"></div>\\r\\n            </td>\\r\\n            <td width="28px" style="vertical-align: bottom;">\\r\\n                <div id="shape-advanced-button-ratio"></div>\\r\\n            </td>\\r\\n            <td width="108px">\\r\\n                <label class="input-label"><%= scope.textHeight %></label>\\r\\n                <div id="shape-advanced-spin-height"></div>\\r\\n            </td>\\r\\n        </tr>\\r\\n    </table>\\r\\n    </div>\\r\\n</div>\\r\\n<div id="id-adv-shape-shape" class="settings-panel">\\r\\n    <div class="inner-content">\\r\\n        <table cols="2" style="width: 100%;">\\r\\n            <tr>\\r\\n                <td colspan=2 class="padding-small">\\r\\n                    <label class="header"><%= scope.textLineStyle %></label>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-large" width="125px">\\r\\n                    <label class="input-label"><%= scope.textCapType %></label>\\r\\n                    <div id="shape-advanced-cap-type" style="width: 100px;"></div>\\r\\n                </td>\\r\\n                <td class="padding-large">\\r\\n                    <label class="input-label"><%= scope.textJoinType %></label>\\r\\n                    <div id="shape-advanced-join-type" style="width: 100px;"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n        </table>\\r\\n    </div>\\r\\n    <div class="separator horizontal padding-large"></div>\\r\\n    <div class="inner-content">\\r\\n        <table cols="2" style="width: 100%;">\\r\\n            <tr>\\r\\n                <td colspan=2 class="padding-small">\\r\\n                    <label class="header"><%= scope.textArrows %></label>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-small" width="125px">\\r\\n                    <label class="input-label"><%= scope.textBeginStyle %></label>\\r\\n                    <div id="shape-advanced-begin-style" style="width: 100px;"></div>\\r\\n                </td>\\r\\n                <td class="padding-small">\\r\\n                    <label class="input-label"><%= scope.textEndStyle %></label>\\r\\n                    <div id="shape-advanced-end-style" style="width: 100px;"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-small">\\r\\n                    <label class="input-label"><%= scope.textBeginSize %></label>\\r\\n                    <div id="shape-advanced-begin-size" style="width: 100px;"></div>\\r\\n                </td>\\r\\n                <td class="padding-small">\\r\\n                    <label class="input-label"><%= scope.textEndSize %></label>\\r\\n                    <div id="shape-advanced-end-size" style="width: 100px;"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n        </table>\\r\\n    </div>\\r\\n</div>\\r\\n<div id="id-adv-shape-margins" class="settings-panel">\\r\\n    <div class="inner-content">\\r\\n        <table cols="2" style="width: 100%;">\\r\\n            <tr>\\r\\n                <td class="padding-small" width="125px">\\r\\n                    <label class="input-label"><%= scope.textTop %></label>\\r\\n                    <div id="shape-margin-top"></div>\\r\\n                </td>\\r\\n                <td class="padding-small">\\r\\n                    <label class="input-label"><%= scope.textLeft %></label>\\r\\n                    <div id="shape-margin-left"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td class="padding-small">\\r\\n                    <label class="input-label"><%= scope.textBottom %></label>\\r\\n                    <div id="shape-margin-bottom"></div>\\r\\n                </td>\\r\\n                <td class="padding-small">\\r\\n                    <label class="input-label"><%= scope.textRight %></label>\\r\\n                    <div id="shape-margin-right"></div>\\r\\n                </td>\\r\\n            </tr>\\r\\n        </table>\\r\\n    </div>\\r\\n</div>\'}),define("spreadsheeteditor/main/app/view/ShapeSettingsAdvanced",["text!spreadsheeteditor/main/app/template/ShapeSettingsAdvanced.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/ComboBox","common/main/lib/component/MetricSpinner"],function(e){SSE.Views.ShapeSettingsAdvanced=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{contentWidth:300,height:332,toggleGroup:"shape-adv-settings-group",sizeOriginal:{width:0,height:0},sizeMax:{width:55.88,height:55.88},properties:null},initialize:function(t){_.extend(this.options,{title:this.textTitle,items:[{panelId:"id-adv-shape-width",panelCaption:this.textSize},{panelId:"id-adv-shape-shape",panelCaption:this.textWeightArrows},{panelId:"id-adv-shape-margins",panelCaption:this.strMargins}],contentTemplate:_.template(e)({scope:this})},t),Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options),this.spinners=[],this.Margins=undefined,this._nRatio=1,this._originalProps=this.options.shapeProps,this._changedProps=null},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this);var e=this;this.spnWidth=new Common.UI.MetricSpinner({el:$("#shape-advanced-spin-width"),step:.1,width:100,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0}),this.spnWidth.on("change",_.bind(function(e,t,n,r){if(this.btnRatio.pressed){var i=e.getNumberValue(),s=i/this._nRatio;s>this.spnHeight.options.maxValue&&(s=this.spnHeight.options.maxValue,i=s*this._nRatio,this.spnWidth.setValue(i,!0)),this.spnHeight.setValue(s,!0)}this._changedProps&&(this._changedProps.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(e.getNumberValue())),this._changedProps.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(this.spnHeight.getNumberValue())))},this)),this.spinners.push(this.spnWidth),this.spnHeight=new Common.UI.MetricSpinner({el:$("#shape-advanced-spin-height"),step:.1,width:100,defaultUnit:"cm",value:"3 cm",maxValue:55.88,minValue:0}),this.spnHeight.on("change",_.bind(function(e,t,n,r){var i=e.getNumberValue(),s=null;this.btnRatio.pressed&&(s=i*this._nRatio,s>this.spnWidth.options.maxValue&&(s=this.spnWidth.options.maxValue,i=s/this._nRatio,this.spnHeight.setValue(i,!0)),this.spnWidth.setValue(s,!0)),this._changedProps&&(this._changedProps.asc_putHeight(Common.Utils.Metric.fnRecalcToMM(e.getNumberValue())),this._changedProps.asc_putWidth(Common.Utils.Metric.fnRecalcToMM(this.spnWidth.getNumberValue())))},this)),this.spinners.push(this.spnHeight),this.btnRatio=new Common.UI.Button({cls:"btn-toolbar btn-toolbar-default",iconCls:"advanced-btn-ratio",style:"margin-bottom: 1px;",enableToggle:!0,hint:this.textKeepRatio}),this.btnRatio.render($("#shape-advanced-button-ratio")),this.btnRatio.on("click",_.bind(function(e,t){e.pressed&&this.spnHeight.getNumberValue()>0&&(this._nRatio=this.spnWidth.getNumberValue()/this.spnHeight.getNumberValue())},this)),this.spnMarginTop=new Common.UI.MetricSpinner({el:$("#shape-margin-top"),step:.1,width:100,defaultUnit:"cm",value:"0 cm",maxValue:55.87,minValue:0}),this.spnMarginTop.on("change",_.bind(function(e,t,n,r){this._changedProps&&((this._changedProps.asc_getShapeProperties()===null||this._changedProps.asc_getShapeProperties()===undefined)&&this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),this._changedProps.asc_getShapeProperties().asc_getPaddings()===null&&this._changedProps.asc_getShapeProperties().asc_putPaddings(new Asc.asc_CPaddings),this._changedProps.asc_getShapeProperties().asc_getPaddings().asc_putTop(Common.Utils.Metric.fnRecalcToMM(e.getNumberValue())))},this)),this.spinners.push(this.spnMarginTop),this.spnMarginBottom=new Common.UI.MetricSpinner({el:$("#shape-margin-bottom"),step:.1,width:100,defaultUnit:"cm",value:"0 cm",maxValue:55.87,minValue:0}),this.spnMarginBottom.on("change",_.bind(function(e,t,n,r){this._changedProps&&((this._changedProps.asc_getShapeProperties()===null||this._changedProps.asc_getShapeProperties()===undefined)&&this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),this._changedProps.asc_getShapeProperties().asc_getPaddings()===null&&this._changedProps.asc_getShapeProperties().asc_putPaddings(new Asc.asc_CPaddings),this._changedProps.asc_getShapeProperties().asc_getPaddings().asc_putBottom(Common.Utils.Metric.fnRecalcToMM(e.getNumberValue())))},this)),this.spinners.push(this.spnMarginBottom),this.spnMarginLeft=new Common.UI.MetricSpinner({el:$("#shape-margin-left"),step:.1,width:100,defaultUnit:"cm",value:"0.19 cm",maxValue:9.34,minValue:0}),this.spnMarginLeft.on("change",_.bind(function(e,t,n,r){this._changedProps&&((this._changedProps.asc_getShapeProperties()===null||this._changedProps.asc_getShapeProperties()===undefined)&&this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),this._changedProps.asc_getShapeProperties().asc_getPaddings()===null&&this._changedProps.asc_getShapeProperties().asc_putPaddings(new Asc.asc_CPaddings),this._changedProps.asc_getShapeProperties().asc_getPaddings().asc_putLeft(Common.Utils.Metric.fnRecalcToMM(e.getNumberValue())))},this)),this.spinners.push(this.spnMarginLeft),this.spnMarginRight=new Common.UI.MetricSpinner({el:$("#shape-margin-right"),step:.1,width:100,defaultUnit:"cm",value:"0.19 cm",maxValue:9.34,minValue:0}),this.spnMarginRight.on("change",_.bind(function(e,t,n,r){this._changedProps&&((this._changedProps.asc_getShapeProperties()===null||this._changedProps.asc_getShapeProperties()===undefined)&&this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),this._changedProps.asc_getShapeProperties().asc_getPaddings()===null&&this._changedProps.asc_getShapeProperties().asc_putPaddings(new Asc.asc_CPaddings),this._changedProps.asc_getShapeProperties().asc_getPaddings().asc_putRight(Common.Utils.Metric.fnRecalcToMM(e.getNumberValue())))},this)),this.spinners.push(this.spnMarginRight),this._arrCapType=[{displayValue:this.textFlat,value:c_oAscLineCapType.Flat},{displayValue:this.textRound,value:c_oAscLineCapType.Round},{displayValue:this.textSquare,value:c_oAscLineCapType.Square}],this.cmbCapType=new Common.UI.ComboBox({el:$("#shape-advanced-cap-type"),cls:"input-group-nr",menuStyle:"min-width: 100px;",editable:!1,data:this._arrCapType}),this.cmbCapType.setValue(c_oAscLineCapType.Flat),this.cmbCapType.on("selected",_.bind(function(e,t){this._changedProps&&((this._changedProps.asc_getShapeProperties()===null||this._changedProps.asc_getShapeProperties()===undefined)&&this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),this._changedProps.asc_getShapeProperties().asc_getStroke()===null&&this._changedProps.asc_getShapeProperties().asc_putStroke(new Asc.asc_CStroke),this._changedProps.asc_getShapeProperties().asc_getStroke().asc_putLinecap(t.value))},this)),this._arrJoinType=[{displayValue:this.textRound,value:c_oAscLineJoinType.Round},{displayValue:this.textBevel,value:c_oAscLineJoinType.Bevel},{displayValue:this.textMiter,value:c_oAscLineJoinType.Miter}],this.cmbJoinType=new Common.UI.ComboBox({el:$("#shape-advanced-join-type"),cls:"input-group-nr",menuStyle:"min-width: 100px;",editable:!1,data:this._arrJoinType}),this.cmbJoinType.setValue(c_oAscLineJoinType.Round),this.cmbJoinType.on("selected",_.bind(function(e,t){this._changedProps&&((this._changedProps.asc_getShapeProperties()===null||this._changedProps.asc_getShapeProperties()===undefined)&&this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),this._changedProps.asc_getShapeProperties().asc_getStroke()===null&&this._changedProps.asc_getShapeProperties().asc_putStroke(new Asc.asc_CStroke),this._changedProps.asc_getShapeProperties().asc_getStroke().asc_putLinejoin(t.value))},this));var t=[],n=[];for(var r=0;r<6;r++)t.push({value:r,offsetx:80*r+10,offsety:0});t[0].type=c_oAscLineBeginType.None,t[1].type=c_oAscLineBeginType.Triangle,t[2].type=c_oAscLineBeginType.Arrow,t[3].type=c_oAscLineBeginType.Stealth,t[4].type=c_oAscLineBeginType.Diamond,t[5].type=c_oAscLineBeginType.Oval;for(r=0;r<9;r++)n.push({value:r,offsetx:90,offsety:20*(r+1)});n[0].type=c_oAscLineBeginSize.small_small,n[1].type=c_oAscLineBeginSize.small_mid,n[2].type=c_oAscLineBeginSize.small_large,n[3].type=c_oAscLineBeginSize.mid_small,n[4].type=c_oAscLineBeginSize.mid_mid,n[5].type=c_oAscLineBeginSize.mid_large,n[6].type=c_oAscLineBeginSize.large_small,n[7].type=c_oAscLineBeginSize.large_mid,n[8].type=c_oAscLineBeginSize.large_large,this.btnBeginStyle=new Common.UI.ComboBox({el:$("#shape-advanced-begin-style"),template:_.template([\'<div class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle combo-arrow-style"  data-toggle="dropdown">\',\'<div class="form-control image" style="width: 100px;"></div>\',\'<div style="display: table-cell;"></div>\',\'<button type="button" class="btn btn-default"><span class="caret"></span></button>\',"</div>"].join(""))}),(new Common.UI.Menu({style:"min-width: 105px;",items:[{template:_.template(\'<div id="shape-advanced-menu-begin-style" style="width: 105px; margin: 0 5px;"></div>\')}]})).render($("#shape-advanced-begin-style")),this.mnuBeginStylePicker=new Common.UI.DataView({el:$("#shape-advanced-menu-begin-style"),parentMenu:e.btnBeginStyle.menu,store:new Common.UI.DataViewStore(t),itemTemplate:_.template(\'<div id="<%= id %>" class="item-arrow" style="background-position: -<%= offsetx %>px -<%= offsety %>px;"></div>\')}),this.mnuBeginStylePicker.on("item:click",_.bind(this.onSelectBeginStyle,this)),this._selectStyleItem(this.btnBeginStyle,null),this.btnBeginSize=new Common.UI.ComboBox({el:$("#shape-advanced-begin-size"),template:_.template([\'<div class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle combo-arrow-style"  data-toggle="dropdown">\',\'<div class="form-control image" style="width: 100px;"></div>\',\'<div style="display: table-cell;"></div>\',\'<button type="button" class="btn btn-default"><span class="caret"></span></button>\',"</div>"].join(""))}),(new Common.UI.Menu({style:"min-width: 160px;",items:[{template:_.template(\'<div id="shape-advanced-menu-begin-size" style="width: 160px; margin: 0 5px;"></div>\')}]})).render($("#shape-advanced-begin-size")),this.mnuBeginSizePicker=new Common.UI.DataView({el:$("#shape-advanced-menu-begin-size"),parentMenu:e.btnBeginSize.menu,store:new Common.UI.DataViewStore(n),itemTemplate:_.template(\'<div id="<%= id %>" class="item-arrow" style="background-position: -<%= offsetx %>px -<%= offsety %>px;"></div>\')}),this.mnuBeginSizePicker.on("item:click",_.bind(this.onSelectBeginSize,this)),this._selectStyleItem(this.btnBeginSize,null);for(r=0;r<t.length;r++)t[r].offsety+=200;for(r=0;r<n.length;r++)n[r].offsety+=200;this.btnEndStyle=new Common.UI.ComboBox({el:$("#shape-advanced-end-style"),template:_.template([\'<div class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle combo-arrow-style"  data-toggle="dropdown">\',\'<div class="form-control image" style="width: 100px;"></div>\',\'<div style="display: table-cell;"></div>\',\'<button type="button" class="btn btn-default"><span class="caret"></span></button>\',"</div>"].join(""))}),(new Common.UI.Menu({style:"min-width: 105px;",items:[{template:_.template(\'<div id="shape-advanced-menu-end-style" style="width: 105px; margin: 0 5px;"></div>\')}]})).render($("#shape-advanced-end-style")),this.mnuEndStylePicker=new Common.UI.DataView({el:$("#shape-advanced-menu-end-style"),parentMenu:e.btnEndStyle.menu,store:new Common.UI.DataViewStore(t),itemTemplate:_.template(\'<div id="<%= id %>" class="item-arrow" style="background-position: -<%= offsetx %>px -<%= offsety %>px;"></div>\')}),this.mnuEndStylePicker.on("item:click",_.bind(this.onSelectEndStyle,this)),this._selectStyleItem(this.btnEndStyle,null),this.btnEndSize=new Common.UI.ComboBox({el:$("#shape-advanced-end-size"),template:_.template([\'<div class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle combo-arrow-style"  data-toggle="dropdown">\',\'<div class="form-control image" style="width: 100px;"></div>\',\'<div style="display: table-cell;"></div>\',\'<button type="button" class="btn btn-default"><span class="caret"></span></button>\',"</div>"].join(""))}),(new Common.UI.Menu({style:"min-width: 160px;",items:[{template:_.template(\'<div id="shape-advanced-menu-end-size" style="width: 160px; margin: 0 5px;"></div>\')}]})).render($("#shape-advanced-end-size")),this.mnuEndSizePicker=new Common.UI.DataView({el:$("#shape-advanced-menu-end-size"),parentMenu:e.btnEndSize.menu,store:new Common.UI.DataViewStore(n),itemTemplate:_.template(\'<div id="<%= id %>" class="item-arrow" style="background-position: -<%= offsetx %>px -<%= offsety %>px;"></div>\')}),this.mnuEndSizePicker.on("item:click",_.bind(this.onSelectEndSize,this)),this._selectStyleItem(this.btnEndSize,null),this.afterRender()},afterRender:function(){this.updateMetricUnit(),this._setDefaults(this._originalProps)},_setDefaults:function(e){if(e&&e.asc_getShapeProperties()){var t=e.asc_getShapeProperties();this.spnWidth.setValue(Common.Utils.Metric.fnRecalcFromMM(e.asc_getWidth()).toFixed(2),!0),this.spnHeight.setValue(Common.Utils.Metric.fnRecalcFromMM(e.asc_getHeight()).toFixed(2),!0),e.asc_getHeight()>0&&(this._nRatio=e.asc_getWidth()/e.asc_getHeight());var n=window.localStorage.getItem("sse-settings-shaperatio");n!==null&&parseInt(n)==1&&this.btnRatio.toggle(!0),this._setShapeDefaults(t);var r=t.asc_getPaddings();if(r){var i=r.asc_getLeft();this.spnMarginLeft.setValue(null!==i&&undefined!==i?Common.Utils.Metric.fnRecalcFromMM(i):"",!0),i=r.asc_getTop(),this.spnMarginTop.setValue(null!==i&&undefined!==i?Common.Utils.Metric.fnRecalcFromMM(i):"",!0),i=r.asc_getRight(),this.spnMarginRight.setValue(null!==i&&undefined!==i?Common.Utils.Metric.fnRecalcFromMM(i):"",!0),i=r.asc_getBottom(),this.spnMarginBottom.setValue(null!==i&&undefined!==i?Common.Utils.Metric.fnRecalcFromMM(i):"",!0)}this.btnsCategory[2].setDisabled(null===r),this._changedProps=new Asc.asc_CImgProperty}},getSettings:function(){return window.localStorage.setItem("sse-settings-shaperatio",this.btnRatio.pressed?1:0),{shapeProps:this._changedProps}},_setShapeDefaults:function(e){if(e){var t=e.asc_getStroke();if(t){var n=t.asc_getLinejoin();for(var r=0;r<this._arrJoinType.length;r++)if(n==this._arrJoinType[r].value){this.cmbJoinType.setValue(n);break}n=t.asc_getLinecap();for(r=0;r<this._arrCapType.length;r++)if(n==this._arrCapType[r].value){this.cmbCapType.setValue(n);break}var i=t.asc_getCanChangeArrows();this.btnBeginStyle.setDisabled(!i),this.btnEndStyle.setDisabled(!i),this.btnBeginSize.setDisabled(!i),this.btnEndSize.setDisabled(!i);if(i){n=t.asc_getLinebeginsize();var s=this.mnuBeginSizePicker.store.findWhere({type:n});s?this._beginSizeIdx=s.get("value"):(this._beginSizeIdx=null,this._selectStyleItem(this.btnBeginSize,null)),n=t.asc_getLinebeginstyle(),s=this.mnuBeginStylePicker.store.findWhere({type:n}),s?(this.mnuBeginStylePicker.selectRecord(s,!0),this._updateSizeArr(this.btnBeginSize,this.mnuBeginSizePicker,s,this._beginSizeIdx),this._selectStyleItem(this.btnBeginStyle,s)):this._selectStyleItem(this.btnBeginStyle,null),n=t.asc_getLineendsize(),s=this.mnuEndSizePicker.store.findWhere({type:n}),s?this._endSizeIdx=s.get("value"):(this._endSizeIdx=null,this._selectStyleItem(this.btnEndSize,null)),n=t.asc_getLineendstyle(),s=this.mnuEndStylePicker.store.findWhere({type:n}),s?(this.mnuEndStylePicker.selectRecord(s,!0),this._updateSizeArr(this.btnEndSize,this.mnuEndSizePicker,s,this._endSizeIdx),this._selectStyleItem(this.btnEndStyle,s)):this._selectStyleItem(this.btnEndStyle,null)}else this._selectStyleItem(this.btnBeginStyle),this._selectStyleItem(this.btnEndStyle),this._selectStyleItem(this.btnBeginSize),this._selectStyleItem(this.btnEndSize)}}},updateMetricUnit:function(){if(this.spinners)for(var e=0;e<this.spinners.length;e++){var t=this.spinners[e];t.setDefaultUnit(Common.Utils.Metric.metricName[Common.Utils.Metric.getCurrentMetric()]),t.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.cm?.01:1)}this.sizeMax={width:Common.Utils.Metric.fnRecalcFromMM(this.options.sizeMax.width*10),height:Common.Utils.Metric.fnRecalcFromMM(this.options.sizeMax.height*10)},this.options.sizeOriginal&&(this.sizeOriginal={width:Common.Utils.Metric.fnRecalcFromMM(this.options.sizeOriginal.width),height:Common.Utils.Metric.fnRecalcFromMM(this.options.sizeOriginal.height)})},_updateSizeArr:function(e,t,n,r){n.get("value")>0?(t.store.each(function(e){e.set({offsetx:n.get("value")*80+10})},this),e.setDisabled(!1),r!==null?(t.selectByIndex(r,!0),this._selectStyleItem(e,t.store.at(r))):this._selectStyleItem(e,null)):(this._selectStyleItem(e,null),e.setDisabled(!0))},_selectStyleItem:function(e,t){var n=$(e.el).find(".form-control");n.css("background-position",(t?-t.get("offsetx")+20+"px":"0")+" "+(t?"-"+t.get("offsety")+"px":"-30px"))},onSelectBeginStyle:function(e,t,n){this._changedProps&&((this._changedProps.asc_getShapeProperties()===null||this._changedProps.asc_getShapeProperties()===undefined)&&this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),this._changedProps.asc_getShapeProperties().asc_getStroke()===null&&this._changedProps.asc_getShapeProperties().asc_putStroke(new Asc.asc_CStroke),this._changedProps.asc_getShapeProperties().asc_getStroke().asc_putLinebeginstyle(n.get("type")));if(this._beginSizeIdx===null||this._beginSizeIdx===undefined)this._beginSizeIdx=4;this._updateSizeArr(this.btnBeginSize,this.mnuBeginSizePicker,n,this._beginSizeIdx),this._selectStyleItem(this.btnBeginStyle,n)},onSelectBeginSize:function(e,t,n){this._changedProps&&((this._changedProps.asc_getShapeProperties()===null||this._changedProps.asc_getShapeProperties()===undefined)&&this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),this._changedProps.asc_getShapeProperties().asc_getStroke()===null&&this._changedProps.asc_getShapeProperties().asc_putStroke(new Asc.asc_CStroke),this._changedProps.asc_getShapeProperties().asc_getStroke().asc_putLinebeginsize(n.get("type"))),this._beginSizeIdx=n.get("value"),this._selectStyleItem(this.btnBeginSize,n)},onSelectEndStyle:function(e,t,n){this._changedProps&&((this._changedProps.asc_getShapeProperties()===null||this._changedProps.asc_getShapeProperties()===undefined)&&this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),this._changedProps.asc_getShapeProperties().asc_getStroke()===null&&this._changedProps.asc_getShapeProperties().asc_putStroke(new Asc.asc_CStroke),this._changedProps.asc_getShapeProperties().asc_getStroke().asc_putLineendstyle(n.get("type")));if(this._endSizeIdx===null||this._endSizeIdx===undefined)this._endSizeIdx=4;this._updateSizeArr(this.btnEndSize,this.mnuEndSizePicker,n,this._endSizeIdx),this._selectStyleItem(this.btnEndStyle,n)},onSelectEndSize:function(e,t,n){this._changedProps&&((this._changedProps.asc_getShapeProperties()===null||this._changedProps.asc_getShapeProperties()===undefined)&&this._changedProps.asc_putShapeProperties(new Asc.asc_CShapeProperty),this._changedProps.asc_getShapeProperties().asc_getStroke()===null&&this._changedProps.asc_getShapeProperties().asc_putStroke(new Asc.asc_CStroke),this._changedProps.asc_getShapeProperties().asc_getStroke().asc_putLineendsize(n.get("type"))),this._endSizeIdx=n.get("value"),this._selectStyleItem(this.btnEndSize,n)},textTop:"Top",textLeft:"Left",textBottom:"Bottom",textRight:"Right",textSize:"Size",textWidth:"Width",textHeight:"Height",textKeepRatio:"Constant Proportions",cancelButtonText:"Cancel",okButtonText:"Ok",textTitle:"Shape - Advanced Settings",strMargins:"Text Padding",textRound:"Round",textMiter:"Miter",textSquare:"Square",textFlat:"Flat",textBevel:"Bevel",textArrows:"Arrows",textLineStyle:"Line Style",textCapType:"Cap Type",textJoinType:"Join Type",textBeginStyle:"Begin Style",textBeginSize:"Begin Size",textEndStyle:"End Style",textEndSize:"End Size",textWeightArrows:"Weights & Arrows"},SSE.Views.ShapeSettingsAdvanced||{}))}),define("spreadsheeteditor/main/app/view/ShapeSettings",["text!spreadsheeteditor/main/app/template/ShapeSettings.template","jquery","underscore","backbone","common/main/lib/component/ComboBox","common/main/lib/component/ComboBorderSize","common/main/lib/component/MetricSpinner","common/main/lib/component/ThemeColorPalette","common/main/lib/component/ColorButton","common/main/lib/component/ComboDataView","common/main/lib/component/Slider","common/main/lib/component/MultiSliderGradient","common/main/lib/view/ImageFromUrlDialog","spreadsheeteditor/main/app/view/ShapeSettingsAdvanced"],function(e,t,n,r){SSE.Views.ShapeSettings=r.View.extend(n.extend({el:"#id-shape-settings",template:n.template(e),events:{},options:{alias:"ShapeSettings"},initialize:function(){var e=this;this._initSettings=!0,this._originalProps=null,this._noApply=!0,this.imgprops=null,this._sendUndoPoint=!0,this._sliderChanged=!1,this._state={Transparency:null,FillType:c_oAscFill.FILL_TYPE_SOLID,ShapeColor:"transparent",BlipFillType:c_oAscFillBlipType.STRETCH,StrokeType:c_oAscStrokeType.STROKE_COLOR,StrokeWidth:this._pt2mm(1),StrokeColor:"000000",FGColor:"000000",BGColor:"ffffff",GradColor:"000000",GradFillType:c_oAscFillGradType.GRAD_LINEAR,DisabledFillPanels:!1,DisabledControls:!1,HideShapeOnlySettings:!1},this.lockedControls=[],this._locked=!1,this.OriginalFillType=c_oAscFill.FILL_TYPE_SOLID,this.ShapeColor={Value:1,Color:"transparent"},this.BlipFillType=c_oAscFillBlipType.STRETCH,this.GradFillType=c_oAscFillGradType.GRAD_LINEAR,this.GradColor={values:[0,100],colors:["000000","ffffff"],currentIdx:0},this.GradRadialDirectionIdx=0,this.GradLinearDirectionType=0,this.PatternFillType=0,this.FGColor={Value:1,Color:"000000"},this.BGColor={Value:1,Color:"ffffff"},this.BorderColor={Value:1,Color:"transparent"},this.BorderSize=0,this.textureNames=[this.txtCanvas,this.txtCarton,this.txtDarkFabric,this.txtGrain,this.txtGranite,this.txtGreyPaper,this.txtKnit,this.txtLeather,this.txtBrownPaper,this.txtPapyrus,this.txtWood],this.fillControls=[],this.render(),this._arrFillSrc=[{displayValue:this.textColor,value:c_oAscFill.FILL_TYPE_SOLID},{displayValue:this.textGradientFill,value:c_oAscFill.FILL_TYPE_GRAD},{displayValue:this.textImageTexture,value:c_oAscFill.FILL_TYPE_BLIP},{displayValue:this.textPatternFill,value:c_oAscFill.FILL_TYPE_PATT},{displayValue:this.textNoFill,value:c_oAscFill.FILL_TYPE_NOFILL}],this.cmbFillSrc=new Common.UI.ComboBox({el:t("#shape-combo-fill-src"),cls:"input-group-nr",style:"width: 100%;",menuStyle:"min-width: 180px;",editable:!1,data:this._arrFillSrc}),this.cmbFillSrc.setValue(this._arrFillSrc[0].value),this.cmbFillSrc.on("selected",n.bind(this.onFillSrcSelect,this)),this.fillControls.push(this.cmbFillSrc),this.btnBackColor=new Common.UI.ColorButton({style:"width:45px;",menu:new Common.UI.Menu({items:[{template:n.template(\'<div id="shape-back-color-menu" style="width: 165px; height: 220px; margin: 10px;"></div>\')},{template:n.template(\'<a id="shape-back-color-new" style="padding-left:12px;">\'+e.textNewColor+"</a>")}]})}),this.btnBackColor.on("render:after",function(r){e.colorsBack=new Common.UI.ThemeColorPalette({el:t("#shape-back-color-menu"),dynamiccolors:10,value:"transparent",colors:[e.textThemeColors,"-",{color:"3366FF",effectId:1},{color:"0000FF",effectId:2},{color:"000090",effectId:3},{color:"660066",effectId:4},{color:"800000",effectId:5},{color:"FF0000",effectId:1},{color:"FF6600",effectId:1},{color:"FFFF00",effectId:2},{color:"CCFFCC",effectId:3},{color:"008000",effectId:4},"-",{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:3},{color:"FFFFFF",effectId:4},{color:"000000",effectId:5},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},"-","--","-",e.textStandartColors,"-","transparent","5301B3","980ABD","B2275F","F83D26","F86A1D","F7AC16","F7CA12","FAFF44","D6EF39","-","--"]}),e.colorsBack.on("select",n.bind(e.onColorsBackSelect,e))}),this.btnBackColor.render(t("#shape-back-color-btn")),this.btnBackColor.setColor("transparent"),t(this.el).on("click","#shape-back-color-new",n.bind(this.addNewColor,this,this.colorsBack,this.btnBackColor)),this.fillControls.push(this.btnBackColor),this.cmbPattern=new Common.UI.ComboDataView({itemWidth:28,itemHeight:28,menuMaxHeight:300,enableKeyEvents:!0,cls:"combo-pattern"}),this.cmbPattern.menuPicker.itemTemplate=this.cmbPattern.fieldPicker.itemTemplate=n.template([\'<div class="style" id="<%= id %>">\',\'<img src="data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==" class="combo-pattern-item" \',\'width="\'+this.cmbPattern.itemWidth+\'" height="\'+this.cmbPattern.itemHeight+\'" \',\'style="background-position: -<%= offsetx %>px -<%= offsety %>px;"/>\',"</div>"].join("")),this.cmbPattern.render(t("#shape-combo-pattern")),this.cmbPattern.openButton.menu.cmpEl.css({"min-width":178,"max-width":178}),this.cmbPattern.on("click",n.bind(this.onPatternSelect,this)),this.cmbPattern.openButton.menu.on("show:after",function(){e.cmbPattern.menuPicker.scroller.update({alwaysVisibleY:!0})}),this.fillControls.push(this.cmbPattern),this.btnFGColor=new Common.UI.ColorButton({style:"width:45px;",menu:new Common.UI.Menu({items:[{template:n.template(\'<div id="shape-foreground-color-menu" style="width: 165px; height: 220px; margin: 10px;"></div>\')},{template:n.template(\'<a id="shape-foreground-color-new" style="padding-left:12px;">\'+e.textNewColor+"</a>")}]})}),this.btnFGColor.on("render:after",function(r){e.colorsFG=new Common.UI.ThemeColorPalette({el:t("#shape-foreground-color-menu"),dynamiccolors:10,value:"000000",colors:[e.textThemeColors,"-",{color:"3366FF",effectId:1},{color:"0000FF",effectId:2},{color:"000090",effectId:3},{color:"660066",effectId:4},{color:"800000",effectId:5},{color:"FF0000",effectId:1},{color:"FF6600",effectId:1},{color:"FFFF00",effectId:2},{color:"CCFFCC",effectId:3},{color:"008000",effectId:4},"-",{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:3},{color:"FFFFFF",effectId:4},{color:"000000",effectId:5},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},"-","--","-",e.textStandartColors,"-","3D55FE","5301B3","980ABD","B2275F","F83D26","F86A1D","F7AC16","F7CA12","FAFF44","D6EF39","-","--"]}),e.colorsFG.on("select",n.bind(e.onColorsFGSelect,e))}),this.btnFGColor.render(t("#shape-foreground-color-btn")),this.btnFGColor.setColor("000000"),t(this.el).on("click","#shape-foreground-color-new",n.bind(this.addNewColor,this,this.colorsFG,this.btnFGColor)),this.fillControls.push(this.btnFGColor),this.btnBGColor=new Common.UI.ColorButton({style:"width:45px;",menu:new Common.UI.Menu({items:[{template:n.template(\'<div id="shape-background-color-menu" style="width: 165px; height: 220px; margin: 10px;"></div>\')},{template:n.template(\'<a id="shape-background-color-new" style="padding-left:12px;">\'+e.textNewColor+"</a>")}]})}),this.btnBGColor.on("render:after",function(r){e.colorsBG=new Common.UI.ThemeColorPalette({el:t("#shape-background-color-menu"),dynamiccolors:10,value:"ffffff",colors:[e.textThemeColors,"-",{color:"3366FF",effectId:1},{color:"0000FF",effectId:2},{color:"000090",effectId:3},{color:"660066",effectId:4},{color:"800000",effectId:5},{color:"FF0000",effectId:1},{color:"FF6600",effectId:1},{color:"FFFF00",effectId:2},{color:"CCFFCC",effectId:3},{color:"008000",effectId:4},"-",{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:3},{color:"FFFFFF",effectId:4},{color:"000000",effectId:5},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},"-","--","-",e.textStandartColors,"-","3D55FE","5301B3","980ABD","B2275F","F83D26","F86A1D","F7AC16","F7CA12","FAFF44","D6EF39","-","--"]}),e.colorsBG.on("select",n.bind(e.onColorsBGSelect,e))}),this.btnBGColor.render(t("#shape-background-color-btn")),this.btnBGColor.setColor("ffffff"),t(this.el).on("click","#shape-background-color-new",n.bind(this.addNewColor,this,this.colorsBG,this.btnBGColor)),this.fillControls.push(this.btnBGColor),this.btnInsertFromFile=new Common.UI.Button({el:t("#shape-button-from-file")}),this.fillControls.push(this.btnInsertFromFile),this.btnInsertFromUrl=new Common.UI.Button({el:t("#shape-button-from-url")}),this.fillControls.push(this.btnInsertFromUrl),this.btnInsertFromFile.on("click",n.bind(function(e){this.api&&this.api.asc_changeShapeImageFromFile(),Common.NotificationCenter.trigger("edit:complete",this)},this)),this.btnInsertFromUrl.on("click",n.bind(this.insertFromUrl,this)),this._arrFillType=[{displayValue:this.textStretch,value:c_oAscFillBlipType.STRETCH},{displayValue:this.textTile,value:c_oAscFillBlipType.TILE}],this.cmbFillType=new Common.UI.ComboBox({el:t("#shape-combo-fill-type"),cls:"input-group-nr",menuStyle:"min-width: 90px;",editable:!1,data:this._arrFillType}),this.cmbFillType.setValue(this._arrFillType[0].value),this.cmbFillType.on("selected",n.bind(this.onFillTypeSelect,this)),this.fillControls.push(this.cmbFillType),this.btnTexture=new Common.UI.ComboBox({el:t("#shape-combo-fill-texture"),template:n.template([\'<div class="input-group combobox combo-dataview-menu input-group-nr dropdown-toggle" tabindex="0" data-toggle="dropdown">\',\'<div class="form-control text" style="width: 90px;">\'+this.textSelectTexture+"</div>",\'<div style="display: table-cell;"></div>\',\'<button type="button" class="btn btn-default"><span class="caret"></span></button>\',"</div>"].join(""))}),this.textureMenu=new Common.UI.Menu({items:[{template:n.template(\'<div id="id-shape-menu-texture" style="width: 233px; margin: 0 5px;"></div>\')}]}),this.textureMenu.render(t("#shape-combo-fill-texture")),this.fillControls.push(this.btnTexture),this.numTransparency=new Common.UI.MetricSpinner({el:t("#shape-spin-transparency"),step:1,width:60,value:"100 %",defaultUnit:"%",maxValue:100,minValue:0}),this.numTransparency.on("change",n.bind(this.onNumTransparencyChange,this)),this.fillControls.push(this.numTransparency),this.sldrTransparency=new Common.UI.SingleSlider({el:t("#shape-slider-transparency"),width:75,minValue:0,maxValue:100,value:100}),this.sldrTransparency.on("change",n.bind(this.onTransparencyChange,this)),this.sldrTransparency.on("changecomplete",n.bind(this.onTransparencyChangeComplete,this)),this.fillControls.push(this.sldrTransparency),this.lblTransparencyStart=t(this.el).find("#shape-lbl-transparency-start"),this.lblTransparencyEnd=t(this.el).find("#shape-lbl-transparency-end"),this._arrGradType=[{displayValue:this.textLinear,value:c_oAscFillGradType.GRAD_LINEAR},{displayValue:this.textRadial,value:c_oAscFillGradType.GRAD_PATH}],this.cmbGradType=new Common.UI.ComboBox({el:t("#shape-combo-grad-type"),cls:"input-group-nr",menuStyle:"min-width: 90px;",editable:!1,data:this._arrGradType}),this.cmbGradType.setValue(this._arrGradType[0].value),this.cmbGradType.on("selected",n.bind(this.onGradTypeSelect,this)),this.fillControls.push(this.cmbGradType),this._viewDataLinear=[{offsetx:0,offsety:0,type:45,subtype:-1,iconcls:"gradient-left-top"},{offsetx:50,offsety:0,type:90,subtype:4,iconcls:"gradient-top"},{offsetx:100,offsety:0,type:135,subtype:5,iconcls:"gradient-right-top"},{offsetx:0,offsety:50,type:0,subtype:6,iconcls:"gradient-left",cls:"item-gradient-separator",selected:!0},{offsetx:100,offsety:50,type:180,subtype:1,iconcls:"gradient-right"},{offsetx:0,offsety:100,type:315,subtype:2,iconcls:"gradient-left-bottom"},{offsetx:50,offsety:100,type:270,subtype:3,iconcls:"gradient-bottom"},{offsetx:100,offsety:100,type:225,subtype:7,iconcls:"gradient-right-bottom"}],this._viewDataRadial=[{offsetx:100,offsety:150,type:2,subtype:5,iconcls:"gradient-radial-center"}],this.btnDirection=new Common.UI.Button({cls:"btn-large-dataview",iconCls:"item-gradient gradient-left",menu:new Common.UI.Menu({style:"min-width: 60px;",menuAlign:"tr-br",items:[{template:n.template(\'<div id="id-shape-menu-direction" style="width: 175px; margin: 0 5px;"></div>\')}]})}),this.btnDirection.on("render:after",function(r){e.mnuDirectionPicker=new Common.UI.DataView({el:t("#id-shape-menu-direction"),parentMenu:r.menu,restoreHeight:174,store:new Common.UI.DataViewStore(e._viewDataLinear),itemTemplate:n.template(\'<div id="<%= id %>" class="item-gradient" style="background-position: -<%= offsetx %>px -<%= offsety %>px;"></div>\')})}),this.btnDirection.render(t("#shape-button-direction")),this.mnuDirectionPicker.on("item:click",n.bind(this.onSelectGradient,this,this.btnDirection)),this.fillControls.push(this.btnDirection),this.btnGradColor=new Common.UI.ColorButton({style:"width:45px;",menu:new Common.UI.Menu({items:[{template:n.template(\'<div id="shape-gradient-color-menu" style="width: 165px; height: 220px; margin: 10px;"></div>\')},{template:n.template(\'<a id="shape-gradient-color-new" style="padding-left:12px;">\'+e.textNewColor+"</a>")}]})}),this.btnGradColor.on("render:after",function(r){e.colorsGrad=new Common.UI.ThemeColorPalette({el:t("#shape-gradient-color-menu"),dynamiccolors:10,value:"000000",colors:[e.textThemeColors,"-",{color:"3366FF",effectId:1},{color:"0000FF",effectId:2},{color:"000090",effectId:3},{color:"660066",effectId:4},{color:"800000",effectId:5},{color:"FF0000",effectId:1},{color:"FF6600",effect

]]></string> </value>
        </item>
        <item>
            <key> <string>next</string> </key>
            <value>
              <persistent> <string encoding="base64">AAAAAAAAAAw=</string> </persistent>
            </value>
        </item>
      </dictionary>
    </pickle>
  </record>
  <record id="12" aka="AAAAAAAAAAw=">
    <pickle>
      <global name="Pdata" module="OFS.Image"/>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>data</string> </key>
            <value> <string encoding="cdata"><![CDATA[

Id:1},{color:"FFFF00",effectId:2},{color:"CCFFCC",effectId:3},{color:"008000",effectId:4},"-",{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:3},{color:"FFFFFF",effectId:4},{color:"000000",effectId:5},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},"-","--","-",e.textStandartColors,"-","3D55FE","5301B3","980ABD","B2275F","F83D26","F86A1D","F7AC16","F7CA12","FAFF44","D6EF39","-","--"]}),e.colorsGrad.on("select",n.bind(e.onColorsGradientSelect,e))}),this.btnGradColor.render(t("#shape-gradient-color-btn")),this.btnGradColor.setColor("000000"),t(this.el).on("click","#shape-gradient-color-new",n.bind(this.addNewColor,this,this.colorsGrad,this.btnGradColor)),this.fillControls.push(this.btnGradColor),this.sldrGradient=new Common.UI.MultiSliderGradient({el:t("#shape-slider-gradient"),width:125,minValue:0,maxValue:100,values:[0,100]}),this.sldrGradient.on("change",n.bind(this.onGradientChange,this)),this.sldrGradient.on("changecomplete",n.bind(this.onGradientChangeComplete,this)),this.sldrGradient.on("thumbclick",function(t,n){e.GradColor.currentIdx=n;var r=e.GradColor.colors[e.GradColor.currentIdx];e.btnGradColor.setColor(r),e.colorsGrad.select(r,!1)}),this.sldrGradient.on("thumbdblclick",function(t){e.btnGradColor.cmpEl.find("button").dropdown("toggle")}),this.fillControls.push(this.sldrGradient),this.cmbBorderSize=(new Common.UI.ComboBorderSizeEditable({el:t("#shape-combo-border-size"),style:"width: 93px;",txtNoBorders:this.txtNoBorders})).on("selected",n.bind(this.onBorderSizeSelect,this)).on("changed:before",n.bind(this.onBorderSizeChanged,this,!0)).on("changed:after",n.bind(this.onBorderSizeChanged,this,!1)).on("combo:blur",n.bind(this.onComboBlur,this,!1)),this.BorderSize=this.cmbBorderSize.store.at(2).get("value"),this.cmbBorderSize.setValue(this.BorderSize),this.lockedControls.push(this.cmbBorderSize),this.btnBorderColor=new Common.UI.ColorButton({style:"width:45px;",menu:new Common.UI.Menu({items:[{template:n.template(\'<div id="shape-border-color-menu" style="width: 165px; height: 220px; margin: 10px;"></div>\')},{template:n.template(\'<a id="shape-border-color-new" style="padding-left:12px;">\'+e.textNewColor+"</a>")}]})}),this.btnBorderColor.on("render:after",function(r){e.colorsBorder=new Common.UI.ThemeColorPalette({el:t("#shape-border-color-menu"),dynamiccolors:10,value:"000000",colors:[e.textThemeColors,"-",{color:"3366FF",effectId:1},{color:"0000FF",effectId:2},{color:"000090",effectId:3},{color:"660066",effectId:4},{color:"800000",effectId:5},{color:"FF0000",effectId:1},{color:"FF6600",effectId:1},{color:"FFFF00",effectId:2},{color:"CCFFCC",effectId:3},{color:"008000",effectId:4},"-",{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:3},{color:"FFFFFF",effectId:4},{color:"000000",effectId:5},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},{color:"FFFFFF",effectId:2},{color:"000000",effectId:1},"-","--","-",e.textStandartColors,"-","3D55FE","5301B3","980ABD","B2275F","F83D26","F86A1D","F7AC16","F7CA12","FAFF44","D6EF39","-","--"]}),e.colorsBorder.on("select",n.bind(e.onColorsBorderSelect,e))}),this.btnBorderColor.render(t("#shape-border-color-btn")),this.btnBorderColor.setColor("000000"),t(this.el).on("click","#shape-border-color-new",n.bind(this.addNewColor,this,this.colorsBorder,this.btnBorderColor)),this.lockedControls.push(this.btnBorderColor),this.btnChangeShape=new Common.UI.Button({cls:"btn-icon-default",iconCls:"btn-change-shape",menu:new Common.UI.Menu({menuAlign:"tr-br",cls:"menu-shapes",items:[]})}),this.btnChangeShape.render(t("#shape-btn-change")),this.lockedControls.push(this.btnChangeShape),t(this.el).on("click","#shape-advanced-link",n.bind(this.openAdvancedSettings,this)),this.FillColorContainer=t("#shape-panel-color-fill"),this.FillImageContainer=t("#shape-panel-image-fill"),this.FillPatternContainer=t("#shape-panel-pattern-fill"),this.FillGradientContainer=t("#shape-panel-gradient-fill"),this.TransparencyContainer=t("#shape-panel-transparent-fill"),this.ShapeOnlySettings=t(".shape-only")},render:function(){var e=t(this.el);e.html(this.template({scope:this})),this.linkAdvanced=t("#shape-advanced-link")},setApi:function(e){return this.api=e,this.api&&(this.api.asc_setInterfaceDrawImagePlaceShape("shape-texture-img"),this.api.asc_registerCallback("asc_onInitStandartTextures",n.bind(this.onInitStandartTextures,this))),this},onFillSrcSelect:function(e,t){this.ShowHideElem(t.value);switch(t.value){case c_oAscFill.FILL_TYPE_SOLID:this._state.FillType=c_oAscFill.FILL_TYPE_SOLID;if(!this._noApply){var n=new Asc.asc_CShapeProperty,r=new Asc.asc_CShapeFill;r.asc_putType(c_oAscFill.FILL_TYPE_SOLID),r.asc_putFill(new Asc.asc_CFillSolid),r.asc_getFill().asc_putColor(Common.Utils.ThemeColor.getRgbColor(this.ShapeColor.Color=="transparent"?{color:"4f81bd",effectId:24}:this.ShapeColor.Color)),n.asc_putFill(r),this.imgprops.asc_putShapeProperties(n),this.api.asc_setGraphicObjectProps(this.imgprops)}break;case c_oAscFill.FILL_TYPE_GRAD:this._state.FillType=c_oAscFill.FILL_TYPE_GRAD;if(!this._noApply){var n=new Asc.asc_CShapeProperty,r=new Asc.asc_CShapeFill;r.asc_putType(c_oAscFill.FILL_TYPE_GRAD),r.asc_putFill(new Asc.asc_CFillGrad),r.asc_getFill().asc_putGradType(this.GradFillType),this.GradFillType==c_oAscFillGradType.GRAD_LINEAR&&(r.asc_getFill().asc_putLinearAngle(this.GradLinearDirectionType*6e4),r.asc_getFill().asc_putLinearScale(!0)),this.OriginalFillType!==c_oAscFill.FILL_TYPE_GRAD&&(r.asc_getFill().asc_putPositions([this.GradColor.values[0]*1e3,this.GradColor.values[1]*1e3]),r.asc_getFill().asc_putColors([Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[0]),Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[1])])),n.asc_putFill(r),this.imgprops.asc_putShapeProperties(n),this.api.asc_setGraphicObjectProps(this.imgprops)}break;case c_oAscFill.FILL_TYPE_BLIP:this._state.FillType=c_oAscFill.FILL_TYPE_BLIP;break;case c_oAscFill.FILL_TYPE_PATT:this._state.FillType=c_oAscFill.FILL_TYPE_PATT;if(!this._noApply){var n=new Asc.asc_CShapeProperty,r=new Asc.asc_CShapeFill;r.asc_putType(c_oAscFill.FILL_TYPE_PATT),r.asc_putFill(new Asc.asc_CFillHatch),r.asc_getFill().asc_putPatternType(this.PatternFillType);var i=Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color).get_color().get_hex(),s=Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color).get_color().get_hex();s==="ffffff"&&i==="ffffff"?i={color:"4f81bd",effectId:24}:i=this.FGColor.Color,r.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(i)),r.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color)),n.asc_putFill(r),this.imgprops.asc_putShapeProperties(n),this.api.asc_setGraphicObjectProps(this.imgprops)}break;case c_oAscFill.FILL_TYPE_NOFILL:this._state.FillType=c_oAscFill.FILL_TYPE_NOFILL;if(!this._noApply){var n=new Asc.asc_CShapeProperty,r=new Asc.asc_CShapeFill;r.asc_putType(c_oAscFill.FILL_TYPE_NOFILL),r.asc_putFill(null),n.asc_putFill(r),this.imgprops.asc_putShapeProperties(n),this.api.asc_setGraphicObjectProps(this.imgprops)}}Common.NotificationCenter.trigger("edit:complete",this)},onColorsBackSelect:function(e,t){this.btnBackColor.setColor(t),this.ShapeColor={Value:1,Color:t};if(this.api&&!this._noApply){var n=new Asc.asc_CShapeProperty,r=new Asc.asc_CShapeFill;this.ShapeColor.Color=="transparent"?(r.asc_putType(c_oAscFill.FILL_TYPE_NOFILL),r.asc_putFill(null)):(r.asc_putType(c_oAscFill.FILL_TYPE_SOLID),r.asc_putFill(new Asc.asc_CFillSolid),r.asc_getFill().asc_putColor(Common.Utils.ThemeColor.getRgbColor(this.ShapeColor.Color))),n.asc_putFill(r),this.imgprops.asc_putShapeProperties(n),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},addNewColor:function(e,t){e.addNewColor(typeof t.color=="object"?t.color.color:t.color)},onPatternSelect:function(e,t){if(this.api&&!this._noApply){this.PatternFillType=t.get("type");var n=new Asc.asc_CShapeProperty,r=new Asc.asc_CShapeFill;r.asc_putType(c_oAscFill.FILL_TYPE_PATT),r.asc_putFill(new Asc.asc_CFillHatch),r.asc_getFill().asc_putPatternType(this.PatternFillType),this.OriginalFillType!==c_oAscFill.FILL_TYPE_PATT&&(r.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color)),r.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color))),n.asc_putFill(r),this.imgprops.asc_putShapeProperties(n),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onColorsFGSelect:function(e,t){this.btnFGColor.setColor(t),this.FGColor={Value:1,Color:t};if(this.api&&!this._noApply){var n=new Asc.asc_CShapeProperty,r=new Asc.asc_CShapeFill;r.asc_putType(c_oAscFill.FILL_TYPE_PATT),r.asc_putFill(new Asc.asc_CFillHatch),r.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color)),this.OriginalFillType!==c_oAscFill.FILL_TYPE_PATT&&(r.asc_getFill().asc_putPatternType(this.PatternFillType),r.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color))),n.asc_putFill(r),this.imgprops.asc_putShapeProperties(n),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onColorsBGSelect:function(e,t){this.btnBGColor.setColor(t),this.BGColor={Value:1,Color:t};if(this.api&&!this._noApply){var n=new Asc.asc_CShapeProperty,r=new Asc.asc_CShapeFill;r.asc_putType(c_oAscFill.FILL_TYPE_PATT),r.asc_putFill(new Asc.asc_CFillHatch),this.OriginalFillType!==c_oAscFill.FILL_TYPE_PATT&&(r.asc_getFill().asc_putPatternType(this.PatternFillType),r.asc_getFill().asc_putColorFg(Common.Utils.ThemeColor.getRgbColor(this.FGColor.Color))),r.asc_getFill().asc_putColorBg(Common.Utils.ThemeColor.getRgbColor(this.BGColor.Color)),n.asc_putFill(r),this.imgprops.asc_putShapeProperties(n),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onFillTypeSelect:function(e,t){this.BlipFillType=t.value;if(this.api&&this._fromTextureCmb!==!0&&this.OriginalFillType==c_oAscFill.FILL_TYPE_BLIP){var n=new Asc.asc_CShapeProperty,r=new Asc.asc_CShapeFill;r.asc_putType(c_oAscFill.FILL_TYPE_BLIP),r.asc_putFill(new Asc.asc_CFillBlip),r.asc_getFill().asc_putType(this.BlipFillType),n.asc_putFill(r),this.imgprops.asc_putShapeProperties(n),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onNumTransparencyChange:function(e,t,n,r){this.sldrTransparency.setValue(e.getNumberValue(),!0);if(this.api){var i=e.getNumberValue(),s=new Asc.asc_CShapeProperty,o=new Asc.asc_CShapeFill;o.asc_putTransparent(i*2.55),s.asc_putFill(o),this.imgprops.asc_putShapeProperties(s),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onTransparencyChange:function(e,t,r){this._sliderChanged=t,this.numTransparency.setValue(t,!0),this._sendUndoPoint&&(this.api.setStartPointHistory(),this._sendUndoPoint=!1,this.updateslider=setInterval(n.bind(this._transparencyApplyFunc,this),100))},onTransparencyChangeComplete:function(e,t,n){clearInterval(this.updateslider),this._sliderChanged=t,this.api.setEndPointHistory(),this._transparencyApplyFunc(),this._sendUndoPoint=!0},_transparencyApplyFunc:function(){if(this._sliderChanged!==undefined){var e=new Asc.asc_CShapeProperty,t=new Asc.asc_CShapeFill;t.asc_putTransparent(this._sliderChanged*2.55),e.asc_putFill(t),this.imgprops.asc_putShapeProperties(e),this.api.asc_setGraphicObjectProps(this.imgprops),this._sliderChanged=undefined}},onGradTypeSelect:function(e,t){this.GradFillType=t.value;if(this.GradFillType==c_oAscFillGradType.GRAD_LINEAR){this.mnuDirectionPicker.store.reset(this._viewDataLinear),this.mnuDirectionPicker.cmpEl.width(175),this.mnuDirectionPicker.restoreHeight=174;var t=this.mnuDirectionPicker.store.findWhere({type:this.GradLinearDirectionType});this.mnuDirectionPicker.selectRecord(t,!0),t?this.btnDirection.setIconCls("item-gradient "+t.get("iconcls")):this.btnDirection.setIconCls("")}else this.GradFillType==c_oAscFillGradType.GRAD_PATH&&(this.mnuDirectionPicker.store.reset(this._viewDataRadial),this.mnuDirectionPicker.cmpEl.width(60),this.mnuDirectionPicker.restoreHeight=58,this.mnuDirectionPicker.selectByIndex(this.GradRadialDirectionIdx,!0),this.GradRadialDirectionIdx>=0?this.btnDirection.setIconCls("item-gradient "+this._viewDataRadial[this.GradRadialDirectionIdx].iconcls):this.btnDirection.setIconCls(""));if(this.api&&!this._noApply){var n=new Asc.asc_CShapeProperty,r=new Asc.asc_CShapeFill;r.asc_putType(c_oAscFill.FILL_TYPE_GRAD),r.asc_putFill(new Asc.asc_CFillGrad),r.asc_getFill().asc_putGradType(this.GradFillType),this.GradFillType==c_oAscFillGradType.GRAD_LINEAR&&(r.asc_getFill().asc_putLinearAngle(this.GradLinearDirectionType*6e4),r.asc_getFill().asc_putLinearScale(!0)),r.asc_getFill().asc_putPositions([this.GradColor.values[0]*1e3,this.GradColor.values[1]*1e3]),r.asc_getFill().asc_putColors([Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[0]),Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[1])]),n.asc_putFill(r),this.imgprops.asc_putShapeProperties(n),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onSelectGradient:function(e,t,r,i){if(this._noApply)return;var s={},o=n.isFunction(i.toJSON);if(o){if(!i.get("selected"))return;s=i.toJSON()}else s=i;this.btnDirection.setIconCls("item-gradient "+s.iconcls),this.GradFillType==c_oAscFillGradType.GRAD_LINEAR?this.GradLinearDirectionType=s.type:this.GradRadialDirectionIdx=0;if(this.api&&this.GradFillType==c_oAscFillGradType.GRAD_LINEAR){var u=new Asc.asc_CShapeProperty,a=new Asc.asc_CShapeFill;a.asc_putType(c_oAscFill.FILL_TYPE_GRAD),a.asc_putFill(new Asc.asc_CFillGrad),a.asc_getFill().asc_putGradType(this.GradFillType),a.asc_getFill().asc_putLinearAngle(s.type*6e4),a.asc_getFill().asc_putLinearScale(!0),this.OriginalFillType!==c_oAscFill.FILL_TYPE_GRAD&&(a.asc_getFill().asc_putPositions([this.GradColor.values[0]*1e3,this.GradColor.values[1]*1e3]),a.asc_getFill().asc_putColors([Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[0]),Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[1])])),u.asc_putFill(a),this.imgprops.asc_putShapeProperties(u),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onColorsGradientSelect:function(e,t){this.btnGradColor.setColor(t),this.GradColor.colors[this.GradColor.currentIdx]=t,this.sldrGradient.setColorValue(Common.Utils.String.format("#{0}",typeof t=="object"?t.color:t));if(this.api&&!this._noApply){var n=new Asc.asc_CShapeProperty,r=new Asc.asc_CShapeFill;r.asc_putType(c_oAscFill.FILL_TYPE_GRAD),r.asc_putFill(new Asc.asc_CFillGrad),r.asc_getFill().asc_putGradType(this.GradFillType),r.asc_getFill().asc_putColors([Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[0]),Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[1])]),this.OriginalFillType!==c_oAscFill.FILL_TYPE_GRAD&&(this.GradFillType==c_oAscFillGradType.GRAD_LINEAR&&(r.asc_getFill().asc_putLinearAngle(this.GradLinearDirectionType*6e4),r.asc_getFill().asc_putLinearScale(!0)),r.asc_getFill().asc_putPositions([this.GradColor.values[0]*1e3,this.GradColor.values[1]*1e3])),n.asc_putFill(r),this.imgprops.asc_putShapeProperties(n),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},onGradientChange:function(e,t,r){this.GradColor.values=e.getValues(),this._sliderChanged=!0,this.api&&!this._noApply&&this._sendUndoPoint&&(this.api.setStartPointHistory(),this._sendUndoPoint=!1,this.updateslider=setInterval(n.bind(this._gradientApplyFunc,this),100))},onGradientChangeComplete:function(e,t,n){clearInterval(this.updateslider),this._sliderChanged=!0,this.api.setEndPointHistory(),this._gradientApplyFunc(),this._sendUndoPoint=!0},_gradientApplyFunc:function(){if(this._sliderChanged){var e=new Asc.asc_CShapeProperty,t=new Asc.asc_CShapeFill;t.asc_putType(c_oAscFill.FILL_TYPE_GRAD),t.asc_putFill(new Asc.asc_CFillGrad),t.asc_getFill().asc_putGradType(this.GradFillType),t.asc_getFill().asc_putPositions([this.GradColor.values[0]*1e3,this.GradColor.values[1]*1e3]),this.OriginalFillType!==c_oAscFill.FILL_TYPE_GRAD&&(this.GradFillType==c_oAscFillGradType.GRAD_LINEAR&&(t.asc_getFill().asc_putLinearAngle(this.GradLinearDirectionType*6e4),t.asc_getFill().asc_putLinearScale(!0)),t.asc_getFill().asc_putColors([Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[0]),Common.Utils.ThemeColor.getRgbColor(this.GradColor.colors[1])])),e.asc_putFill(t),this.imgprops.asc_putShapeProperties(e),this.api.asc_setGraphicObjectProps(this.imgprops),this._sliderChanged=!1}},applyBorderSize:function(e){e=parseFloat(e),e=isNaN(e)?0:Math.max(0,Math.min(1584,e)),this.BorderSize=e;if(this.api&&!this._noApply){var t=new Asc.asc_CShapeProperty,n=new Asc.asc_CStroke;this.BorderSize<.01?(n.asc_putType(c_oAscStrokeType.STROKE_NONE),this._state.StrokeType=this._state.StrokeWidth=-1):(n.asc_putType(c_oAscStrokeType.STROKE_COLOR),this.BorderColor.Color=="transparent"||this.BorderColor.Color.color=="transparent"?n.asc_putColor(Common.Utils.ThemeColor.getRgbColor({color:"000000",effectId:29})):(this._state.StrokeType==c_oAscStrokeType.STROKE_NONE||this._state.StrokeType===null)&&n.asc_putColor(Common.Utils.ThemeColor.getRgbColor(Common.Utils.ThemeColor.colorValue2EffectId(this.BorderColor.Color))),n.asc_putWidth(this._pt2mm(this.BorderSize))),t.asc_putStroke(n),this.imgprops.asc_putShapeProperties(t),this.api.asc_setGraphicObjectProps(this.imgprops),Common.NotificationCenter.trigger("edit:complete",this)}},onComboBlur:function(){Common.NotificationCenter.trigger("edit:complete",this)},onBorderSizeChanged:function(e,t,r,i){var s=this;if(e){var o=parseFloat(r.value);if(!/^\\s*(\\d*(\\.|,)?\\d+)\\s*(pt)?\\s*$/.exec(r.value)||o<0||o>1584)this._state.StrokeType=this._state.StrokeWidth=-1,Common.UI.error({msg:this.textBorderSizeErr,callback:function(){n.defer(function(e){Common.NotificationCenter.trigger("edit:complete",s)})}})}else this.applyBorderSize(r.value)},onBorderSizeSelect:function(e,t){this.applyBorderSize(t.value)},onColorsBorderSelect:function(e,t){this.btnBorderColor.setColor(t),this.BorderColor={Value:1,Color:t};if(this.api&&this.BorderSize>0&&!this._noApply){var n=new Asc.asc_CShapeProperty,r=new Asc.asc_CStroke;this.BorderSize<.01?r.asc_putType(c_oAscStrokeType.STROKE_NONE):(r.asc_putType(c_oAscStrokeType.STROKE_COLOR),r.asc_putColor(Common.Utils.ThemeColor.getRgbColor(this.BorderColor.Color)),r.asc_putWidth(this._pt2mm(this.BorderSize))),n.asc_putStroke(r),this.imgprops.asc_putShapeProperties(n),this.api.asc_setGraphicObjectProps(this.imgprops)}Common.NotificationCenter.trigger("edit:complete",this)},insertFromUrl:function(){var e=this;(new Common.Views.ImageFromUrlDialog({handler:function(t,r){if(t=="ok"&&e.api){var i=r.replace(/ /g,"");if(!n.isEmpty(i)&&e.BlipFillType!==null){var s=new Asc.asc_CShapeProperty,o=new Asc.asc_CShapeFill;o.asc_putType(c_oAscFill.FILL_TYPE_BLIP),o.asc_putFill(new Asc.asc_CFillBlip),o.asc_getFill().asc_putType(e.BlipFillType),o.asc_getFill().asc_putUrl(i),s.asc_putFill(o),e.imgprops.asc_putShapeProperties(s),e.api.asc_setGraphicObjectProps(e.imgprops)}}Common.NotificationCenter.trigger("edit:complete",e)}})).show()},openAdvancedSettings:function(e){if(this.linkAdvanced.hasClass("disabled"))return;var t=this,n;if(t.api&&!this._locked){var r=t.api.asc_getGraphicObjectProps();if(r&&r.length>0){var i,s;for(var o=r.length-1;o>=0;o--){i=r[o].asc_getObjectType();if(c_oAscTypeSelectElement.Image==i){s=r[o].asc_getObjectValue(),(new SSE.Views.ShapeSettingsAdvanced({shapeProps:s,handler:function(e,n){e=="ok"&&t.api&&t.api.asc_setGraphicObjectProps(n.shapeProps),Common.NotificationCenter.trigger("edit:complete",t)}})).show();break}}}}},ChangeSettings:function(e){this._initSettings&&this.createDelayedElements(),this._initSettings=!1,this.imgprops==null&&(this.imgprops=new Asc.asc_CImgProperty);if(e&&e.asc_getShapeProperties()){var r=e.asc_getShapeProperties();this._originalProps=r,this._noApply=!0,this.disableControls(this._locked,!r.asc_getCanFill()),this.hideShapeOnlySettings(r.asc_getFromChart());var i=null,s=r.asc_getFill(),o=s.asc_getType(),u=null,a=s.asc_getTransparent();if(Math.abs(this._state.Transparency-a)>.001||Math.abs(this.numTransparency.getNumberValue()-a)>.001||(this._state.Transparency===null||a===null)&&(this._state.Transparency!==a||this.numTransparency.getNumberValue()!==a))a!==undefined&&(this.sldrTransparency.setValue(a===null?100:a/255*100,!0),this.numTransparency.setValue(this.sldrTransparency.getValue(),!0)),this._state.Transparency=a;if(s===null||o===null)this.OriginalFillType=null;else if(o==c_oAscFill.FILL_TYPE_NOFILL)this.OriginalFillType=c_oAscFill.FILL_TYPE_NOFILL;else if(o==c_oAscFill.FILL_TYPE_SOLID)s=s.asc_getFill(),u=s.asc_getColor(),u?u.asc_getType()==c_oAscColor.COLOR_TYPE_SCHEME?this.ShapeColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),effectValue:u.asc_getValue()}}:this.ShapeColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB())}:this.ShapeColor={Value:0,Color:"transparent"},this.OriginalFillType=c_oAscFill.FILL_TYPE_SOLID,this.FGColor=this.ShapeColor.Color!=="transparent"?{Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.ShapeColor.Color)}:{Value:1,Color:"000000"},this.BGColor={Value:1,Color:"ffffff"};else if(o==c_oAscFill.FILL_TYPE_BLIP)s=s.asc_getFill(),this.BlipFillType=s.asc_getType(),this._state.BlipFillType!==this.BlipFillType&&(this.BlipFillType==c_oAscFillBlipType.STRETCH||this.BlipFillType==c_oAscFillBlipType.TILE?this.cmbFillType.setValue(this.BlipFillType):this.cmbFillType.setValue(""),this._state.BlipFillType=this.BlipFillType),this.OriginalFillType=c_oAscFill.FILL_TYPE_BLIP;else if(o==c_oAscFill.FILL_TYPE_PATT){s=s.asc_getFill(),this.PatternFillType=s.asc_getPatternType();if(this._state.PatternFillType!==this.PatternFillType){this.cmbPattern.suspendEvents();var i=this.cmbPattern.menuPicker.store.findWhere({type:this.PatternFillType});this.cmbPattern.menuPicker.selectRecord(i),this.cmbPattern.resumeEvents(),this._state.PatternFillType=this.PatternFillType}u=s.asc_getColorFg(),u?u.asc_getType()==c_oAscColor.COLOR_TYPE_SCHEME?this.FGColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),effectValue:u.asc_getValue()}}:this.FGColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB())}:this.FGColor={Value:1,Color:"000000"},u=s.asc_getColorBg(),u?u.asc_getType()==c_oAscColor.COLOR_TYPE_SCHEME?this.BGColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),effectValue:u.asc_getValue()}}:this.BGColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB())}:this.BGColor={Value:1,Color:"ffffff"},this.OriginalFillType=c_oAscFill.FILL_TYPE_PATT,this.ShapeColor=this.FGColor.Color!=="transparent"?{Value:1,Color:Common.Utils.ThemeColor.colorValue2EffectId(this.FGColor.Color)}:{Value:1,Color:"ffffff"}}else if(o==c_oAscFill.FILL_TYPE_GRAD){s=s.asc_getFill();var f=s.asc_getGradType();if(this._state.GradFillType!==f||this.GradFillType!==f)this.GradFillType=f,i=undefined,this.GradFillType==c_oAscFillGradType.GRAD_LINEAR||this.GradFillType==c_oAscFillGradType.GRAD_PATH?(this.cmbGradType.setValue(this.GradFillType),i=this.cmbGradType.store.findWhere({value:this.GradFillType}),this.onGradTypeSelect(this.cmbGradType,i.attributes)):(this.cmbGradType.setValue(""),this.btnDirection.setIconCls("")),this._state.GradFillType=this.GradFillType;if(this.GradFillType==c_oAscFillGradType.GRAD_LINEAR){var l=Math.floor(s.asc_getLinearAngle()/6e4);if(Math.abs(this.GradLinearDirectionType-l)>.001){this.GradLinearDirectionType=l;var c=this.mnuDirectionPicker.store.findWhere({type:l});this.mnuDirectionPicker.selectRecord(c,!0),c?this.btnDirection.setIconCls("item-gradient "+c.get("iconcls")):this.btnDirection.setIconCls("")}}var h=s.asc_getColors();h&&h.length>0&&(u=h[0],u?u.asc_getType()==c_oAscColor.COLOR_TYPE_SCHEME?(this.GradColor.colors[0]={color:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),effectValue:u.asc_getValue()},Common.Utils.ThemeColor.colorValue2EffectId(this.GradColor.colors[0])):this.GradColor.colors[0]=Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()):this.GradColor.colors[0]="000000",u=h[1],u?u.asc_getType()==c_oAscColor.COLOR_TYPE_SCHEME?(this.GradColor.colors[1]={color:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),effectValue:u.asc_getValue()},Common.Utils.ThemeColor.colorValue2EffectId(this.GradColor.colors[1])):this.GradColor.colors[1]=Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()):this.GradColor.colors[1]="ffffff");var p=s.asc_getPositions();if(p&&p.length>0){var d=p[0];d!==null&&(d/=1e3,this.GradColor.values[0]=d),d=p[1],d!==null&&(d/=1e3,this.GradColor.values[1]=d)}this.sldrGradient.setColorValue(Common.Utils.String.format("#{0}",typeof this.GradColor.colors[0]=="object"?this.GradColor.colors[0].color:this.GradColor.colors[0]),0),this.sldrGradient.setColorValue(Common.Utils.String.format("#{0}",typeof this.GradColor.colors[1]=="object"?this.GradColor.colors[1].color:this.GradColor.colors[1]),1),this.sldrGradient.setValue(0,this.GradColor.values[0]),this.sldrGradient.setValue(1,this.GradColor.values[1]),this.OriginalFillType=c_oAscFill.FILL_TYPE_GRAD}this._state.FillType!==this.OriginalFillType&&(this.cmbFillSrc.setValue(this.OriginalFillType===null?"":this.OriginalFillType),this._state.FillType=this.OriginalFillType,this.ShowHideElem(this.OriginalFillType)),t(this.btnTexture.el).find(".form-control").prop("innerHTML",this.textSelectTexture);var v=typeof this.ShapeColor.Color,m=typeof this._state.ShapeColor;if(v!==m||v=="object"&&(this.ShapeColor.Color.effectValue!==this._state.ShapeColor.effectValue||this._state.ShapeColor.color.indexOf(this.ShapeColor.Color.color)<0)||v!="object"&&this._state.ShapeColor.indexOf(this.ShapeColor.Color)<0){this.btnBackColor.setColor(this.ShapeColor.Color);if(typeof this.ShapeColor.Color=="object"){var g=!1;for(var y=0;y<10;y++)if(Common.Utils.ThemeColor.ThemeValues[y]==this.ShapeColor.Color.effectValue){this.colorsBack.select(this.ShapeColor.Color,!0),g=!0;break}g||this.colorsBack.clearSelection()}else this.colorsBack.select(this.ShapeColor.Color,!0);this._state.ShapeColor=this.ShapeColor.Color}var b=r.asc_getStroke(),w=b.asc_getType();b?w==c_oAscStrokeType.STROKE_COLOR?(u=b.asc_getColor(),u?u.asc_getType()==c_oAscColor.COLOR_TYPE_SCHEME?this.BorderColor={Value:1,Color:{color:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB()),effectValue:u.asc_getValue()}}:this.BorderColor={Value:1,Color:Common.Utils.ThemeColor.getHexColor(u.asc_getR(),u.asc_getG(),u.asc_getB())}:this.BorderColor={Value:1,Color:"transparent"}):this.BorderColor={Value:1,Color:"transparent"}:(w=null,this.BorderColor={Value:0,Color:"transparent"}),v=typeof this.BorderColor.Color,m=typeof this._state.StrokeColor;if(v!==m||v=="object"&&(this.BorderColor.Color.effectValue!==this._state.StrokeColor.effectValue||this._state.StrokeColor.color.indexOf(this.BorderColor.Color.color)<0)||v!="object"&&(this._state.StrokeColor.indexOf(this.BorderColor.Color)<0||typeof this.btnBorderColor.color=="object")){this.btnBorderColor.setColor(this.BorderColor.Color);if(typeof this.BorderColor.Color=="object"){var g=!1;for(var y=0;y<10;y++)if(Common.Utils.ThemeColor.ThemeValues[y]==this.BorderColor.Color.effectValue){this.colorsBorder.select(this.BorderColor.Color,!0),g=!0;break}g||this.colorsBorder.clearSelection()}else this.colorsBorder.select(this.BorderColor.Color,!0);this._state.StrokeColor=this.BorderColor.Color}if(this._state.StrokeType!==w||w==c_oAscStrokeType.STROKE_COLOR){if(w==c_oAscStrokeType.STROKE_COLOR){var E=b.asc_getWidth(),S=Math.abs(this._state.StrokeWidth-E)<.001&&!/pt\\s*$/.test(this.cmbBorderSize.getRawValue());if(Math.abs(this._state.StrokeWidth-E)>.001||S||(this._state.StrokeWidth===null||E===null)&&this._state.StrokeWidth!==E){this._state.StrokeWidth=E,E!==null&&(E=this._mm2pt(E));var x=E===null?E:n.find(this.cmbBorderSize.store.models,function(e){if(E<e.attributes.value+.01&&E>e.attributes.value-.01)return!0});x?this.cmbBorderSize.selectRecord(x):this.cmbBorderSize.setValue(E!==null?parseFloat(E.toFixed(2))+" pt":""),this.BorderSize=E}}else w==c_oAscStrokeType.STROKE_NONE?(this._state.StrokeWidth=0,this.BorderSize=this.cmbBorderSize.store.at(0).get("value"),this.cmbBorderSize.setValue(this.BorderSize)):(this._state.StrokeWidth=null,this.BorderSize=-1,this.cmbBorderSize.setValue(null));this._state.StrokeType=w}v=typeof this.FGColor.Color,m=typeof this._state.FGColor;if(v!==m||v=="object"&&(this.FGColor.Color.effectValue!==this._state.FGColor.effectValue||this._state.FGColor.color.indexOf(this.FGColor.Color.color)<0)||v!="object"&&this._state.FGColor.indexOf(this.FGColor.Color)<0){this.btnFGColor.setColor(this.FGColor.Color);if(typeof this.FGColor.Color=="object"){var g=!1;for(var y=0;y<10;y++)if(Common.Utils.ThemeColor.ThemeValues[y]==this.FGColor.Color.effectValue){this.colorsFG.select(this.FGColor.Color,!0),g=!0;break}g||this.colorsFG.clearSelection()}else this.colorsFG.select(this.FGColor.Color,!0);this._state.FGColor=this.FGColor.Color}v=typeof this.BGColor.Color,m=typeof this._state.BGColor;if(v!==m||v=="object"&&(this.BGColor.Color.effectValue!==this._state.BGColor.effectValue||this._state.BGColor.color.indexOf(this.BGColor.Color.color)<0)||v!="object"&&this._state.BGColor.indexOf(this.BGColor.Color)<0){this.btnBGColor.setColor(this.BGColor.Color);if(typeof this.BGColor.Color=="object"){var g=!1;for(var y=0;y<10;y++)if(Common.Utils.ThemeColor.ThemeValues[y]==this.BGColor.Color.effectValue){this.colorsBG.select(this.BGColor.Color,!0),g=!0;break}g||this.colorsBG.clearSelection()}else this.colorsBG.select(this.BGColor.Color,!0);this._state.BGColor=this.BGColor.Color}u=this.GradColor.colors[this.GradColor.currentIdx],v=typeof u,m=typeof this._state.GradColor;if(v!==m||v=="object"&&(u.effectValue!==this._state.GradColor.effectValue||this._state.GradColor.color.indexOf(u.color)<0)||v!="object"&&this._state.GradColor.indexOf(u)<0){this.btnGradColor.setColor(u);if(typeof u=="object"){var g=!1;for(var y=0;y<10;y++)if(Common.Utils.ThemeColor.ThemeValues[y]==u.effectValue){this.colorsGrad.select(u,!0),g=!0;break}g||this.colorsGrad.clearSelection()}else this.colorsGrad.select(u,!0);this._state.GradColor=u}this._noApply=!1}},createDelayedElements:function(){var e=[0,1,3,2,4,53,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,22,23,24,25,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,49,50,51,52];this.patternViewData=[];for(var t=0;t<13;t++)for(var n=0;n<4;n++){var r=t*4+n;this.patternViewData[r]={offsetx:n*28,offsety:t*28,type:e[r]}}this.patternViewData.splice(this.patternViewData.length-2,2);for(var t=0;t<this.patternViewData.length;t++)this.patternViewData[t].id=Common.UI.getId();this.cmbPattern.menuPicker.store.add(this.patternViewData),this.cmbPattern.menuPicker.store.length>0&&(this.cmbPattern.fillComboView(this.cmbPattern.menuPicker.store.at(0),!0),this.PatternFillType=this.patternViewData[0].type),this.fillAutoShapes(),this.UpdateThemeColors()},onInitStandartTextures:function(e){var r=this;if(e&&e.length>0){var i=[];n.each(e,function(e){i.push({imageUrl:e.asc_getImage(),name:r.textureNames[e.asc_getId()],type:e.asc_getId(),selected:!1})});var s=new Common.UI.DataView({el:t("#id-shape-menu-texture"),parentMenu:r.textureMenu,restoreHeight:174,store:new Common.UI.DataViewStore(i),itemTemplate:n.template(\'<div class="item-shape"><img src="<%= imageUrl %>" id="<%= id %>"></div>\')});s.on("item:click",n.bind(this.onSelectTexture,this)),r.textureMenu.on("show:after",function(e){s.deselectAll()})}},onSelectTexture:function(e,n,r){this._fromTextureCmb=!0,this.cmbFillType.setValue(this._arrFillType[1].value),this._fromTextureCmb=!1;if(this.api){var i=new Asc.asc_CShapeProperty,s=new Asc.asc_CShapeFill;s.asc_putType(c_oAscFill.FILL_TYPE_BLIP),s.asc_putFill(new Asc.asc_CFillBlip),s.asc_getFill().asc_putType(c_oAscFillBlipType.TILE),s.asc_getFill().asc_putTextureId(r.get("type")),i.asc_putFill(s),this.imgprops.asc_putShapeProperties(i),this.api.asc_setGraphicObjectProps(this.imgprops)}t(this.btnTexture.el).find(".form-control").prop("innerHTML",r.get("name")),Common.NotificationCenter.trigger("edit:complete",this)},fillAutoShapes:function(){var e=this,r=this.application.getCollection("ShapeGroups"),i=r.length;for(var s=0;s<i;s++){if(s==i-2)continue;var o=r.at(s),u=new Common.UI.MenuItem({caption:o.get("groupName"),menu:new Common.UI.Menu({menuAlign:"tr-tl",items:[{template:n.template(\'<div id="id-shape-menu-shapegroup\'+s+\'" class="menu-shape" style="width: \'+(o.get("groupWidth")-8)+\'px; margin-left: 5px;"></div>\')}]})});e.btnChangeShape.menu.addItem(u);var a=new Common.UI.DataView({el:t("#id-shape-menu-shapegroup"+s),store:o.get("groupStore"),itemTemplate:n.template(\'<div class="item-shape"><img src="<%= imageUrl %>" id="<%= id %>"></div>\')});a.on("item:click",function(t,n,r){e.api&&(e.api.asc_changeShapeType(r.get("data").shapeType),Common.NotificationCenter.trigger("edit:complete",e))})}},UpdateThemeColors:function(){this.colorsBorder.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsBack.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsFG.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsBG.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors()),this.colorsGrad.updateColors(Common.Utils.ThemeColor.getEffectColors(),Common.Utils.ThemeColor.getStandartColors())},_pt2mm:function(e){return e*25.4/72},_mm2pt:function(e){return e*72/25.4},disableFillPanels:function(e){this._state.DisabledFillPanels!==e&&(this._state.DisabledFillPanels=e,n.each(this.fillControls,function(t){t.setDisabled(e)}),this.lblTransparencyStart.toggleClass("disabled",e),this.lblTransparencyEnd.toggleClass("disabled",e))},ShowHideElem:function(e){this.FillColorContainer.toggleClass("settings-hidden",e!==c_oAscFill.FILL_TYPE_SOLID),this.FillImageContainer.toggleClass("settings-hidden",e!==c_oAscFill.FILL_TYPE_BLIP),this.FillPatternContainer.toggleClass("settings-hidden",e!==c_oAscFill.FILL_TYPE_PATT),this.FillGradientContainer.toggleClass("settings-hidden",e!==c_oAscFill.FILL_TYPE_GRAD),this.TransparencyContainer.toggleClass("settings-hidden",e===c_oAscFill.FILL_TYPE_NOFILL||e===null)},setLocked:function(e){this._locked=e},disableControls:function(e,t){this.disableFillPanels(e||t),this._state.DisabledControls!==e&&(this._state.DisabledControls=e,n.each(this.lockedControls,function(t){t.setDisabled(e)}),this.linkAdvanced.toggleClass("disabled",e))},hideShapeOnlySettings:function(e){this._state.HideShapeOnlySettings!==e&&(this._state.HideShapeOnlySettings=e,this.ShapeOnlySettings.toggleClass("hidden",e==1))},txtNoBorders:"No Line",strStroke:"Stroke",strColor:"Color",strSize:"Size",strChange:"Change Autoshape",strFill:"Fill",textColor:"Color Fill",textImageTexture:"Picture or Texture",textTexture:"From Texture",textFromUrl:"From URL",textFromFile:"From File",textStretch:"Stretch",textTile:"Tile",txtCanvas:"Canvas",txtCarton:"Carton",txtDarkFabric:"Dark Fabric",txtGrain:"Grain",txtGranite:"Granite",txtGreyPaper:"Grey Paper",txtKnit:"Knit",txtLeather:"Leather",txtBrownPaper:"Brown Paper",txtPapyrus:"Papyrus",txtWood:"Wood",textNewColor:"Add New Custom Color",textThemeColors:"Theme Colors",textStandartColors:"Standart Colors",textAdvanced:"Show advanced settings",strTransparency:"Opacity",textNoFill:"No Fill",textSelectTexture:"Select",textGradientFill:"Gradient Fill",textPatternFill:"Pattern",strBackground:"Background color",strForeground:"Foreground color",strPattern:"Pattern",textEmptyPattern:"No Pattern",textLinear:"Linear",textRadial:"Radial",textDirection:"Direction",textStyle:"Style",textGradient:"Gradient",textBorderSizeErr:"The entered value is incorrect.<br>Please enter a value between 0 pt and 1584 pt."},SSE.Views.ShapeSettings||{}))});var SCALE_MIN=40,MENU_SCALE_PART=260;define("spreadsheeteditor/main/app/view/RightMenu",["text!spreadsheeteditor/main/app/template/RightMenu.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/component/MetricSpinner","common/main/lib/component/CheckBox","spreadsheeteditor/main/app/view/ParagraphSettings","spreadsheeteditor/main/app/view/ImageSettings","spreadsheeteditor/main/app/view/ChartSettings","spreadsheeteditor/main/app/view/ShapeSettings","common/main/lib/component/Scroller"],function(e,t,n,r){SSE.Views.RightMenu=r.View.extend(n.extend({el:"#right-menu",template:n.template(e),events:{},initialize:function(){return this.minimizedMode=!0,this.btnText=new Common.UI.Button({hint:this.txtParagraphSettings,asctype:c_oAscTypeSelectElement.Paragraph,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup"}),this.btnImage=new Common.UI.Button({hint:this.txtImageSettings,asctype:c_oAscTypeSelectElement.Image,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup"}),this.btnChart=new Common.UI.Button({hint:this.txtChartSettings,asctype:c_oAscTypeSelectElement.Chart,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup"}),this.btnShape=new Common.UI.Button({hint:this.txtShapeSettings,asctype:c_oAscTypeSelectElement.Shape,enableToggle:!0,disabled:!0,toggleGroup:"tabpanelbtnsGroup"}),this._settings=[],this._settings[c_oAscTypeSelectElement.Paragraph]={panel:"id-paragraph-settings",btn:this.btnText},this._settings[c_oAscTypeSelectElement.Image]={panel:"id-image-settings",btn:this.btnImage},this._settings[c_oAscTypeSelectElement.Shape]={panel:"id-shape-settings",btn:this.btnShape},this._settings[c_oAscTypeSelectElement.Chart]={panel:"id-chart-settings",btn:this.btnChart},this},render:function(){var e=t(this.el);return this.trigger("render:before",this),e.css("width","40px"),e.css("z-index",101),e.show(),e.html(this.template({})),this.btnText.el=t("#id-right-menu-text"),this.btnText.render(),this.btnImage.el=t("#id-right-menu-image"),this.btnImage.render(),this.btnChart.el=t("#id-right-menu-chart"),this.btnChart.render(),this.btnShape.el=t("#id-right-menu-shape"),this.btnShape.render(),this.btnText.on("click",n.bind(this.onBtnMenuClick,this)),this.btnImage.on("click",n.bind(this.onBtnMenuClick,this)),this.btnChart.on("click",n.bind(this.onBtnMenuClick,this)),this.btnShape.on("click",n.bind(this.onBtnMenuClick,this)),this.paragraphSettings=new SSE.Views.ParagraphSettings,this.imageSettings=new SSE.Views.ImageSettings,this.chartSettings=new SSE.Views.ChartSettings,this.shapeSettings=new SSE.Views.ShapeSettings,n.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:t(this.el).find(".right-panel"),suppressScrollX:!0,useKeyboard:!1})),this.trigger("render:after",this),this},setApi:function(e){this.api=e,this.paragraphSettings.setApi(e),this.imageSettings.setApi(e),this.chartSettings.setApi(e),this.shapeSettings.setApi(e)},setMode:function(e){},onBtnMenuClick:function(e,n){var r=t("#"+this._settings[e.options.asctype].panel),i=r.parent();e.pressed?(this.minimizedMode&&(t(this.el).width(MENU_SCALE_PART),i.css("display","inline-block"),this.minimizedMode=!1,window.localStorage.setItem("sse-hidden-right-settings",0)),i.find("> .active").removeClass("active"),r.addClass("active"),this.scroller&&this.scroller.scrollTop(0)):(i.css("display","none"),t(this.el).width(SCALE_MIN),this.minimizedMode=!0,window.localStorage.setItem("sse-hidden-right-settings",1)),this.fireEvent("rightmenuclick",[this,e.options.asctype,this.minimizedMode])},SetActivePane:function(e,n){if(this.minimizedMode&&n!==!0||this._settings[e]===undefined)return;if(this.minimizedMode)this._settings[e].btn.toggle(!0,!1),this._settings[e].btn.trigger("click",this._settings[e].btn);else{var r=t("#"+this._settings[e].panel);r.hasClass("active")||(r.parent().find("> .active").removeClass("active"),r.addClass("active"),this.scroller&&this.scroller.update()),this._settings[e].btn.isActive()||this._settings[e].btn.toggle(!0,!1)}},GetActivePane:function(){return this.minimizedMode?null:t(".settings-panel.active")[0].id},SetDisabled:function(e,n,r){if(r)this.paragraphSettings.disableControls(n),this.shapeSettings.disableControls(n),this.imageSettings.disableControls(n),this.chartSettings.disableControls(n);else{var i=t("#"+e);n!==i.hasClass("disabled")&&(i.toggleClass("disabled",n),n?i.attr({disabled:n}):i.removeAttr("disabled"))}},clearSelection:function(){var e=t(".right-panel");e.find("> .active").removeClass("active"),n.each(this._settings,function(e){e.btn.isActive()&&e.btn.toggle(!1,!0)}),e.css("display","none"),t(this.el).width(SCALE_MIN),this.minimizedMode=!0,window.localStorage.setItem("sse-hidden-right-settings",1),Common.NotificationCenter.trigger("layout:changed","rightmenu")},txtParagraphSettings:"Paragraph Settings",txtImageSettings:"Image Settings",txtShapeSettings:"Shape Settings",txtChartSettings:"Chart Settings"},SSE.Views.RightMenu||{}))}),define("spreadsheeteditor/main/app/controller/RightMenu",["core","spreadsheeteditor/main/app/view/RightMenu"],function(){SSE.Controllers.RightMenu=Backbone.Controller.extend({models:[],collections:[],views:["RightMenu"],initialize:function(){this.editMode=!0,this._state={},this.addListeners({RightMenu:{rightmenuclick:this.onRightMenuClick}})},onLaunch:function(){this.rightmenu=this.createView("RightMenu"),this.rightmenu.on("render:after",_.bind(this.onRightMenuAfterRender,this))},onRightMenuAfterRender:function(e){e.shapeSettings.application=this.getApplication(),this._settings=[],this._settings[c_oAscTypeSelectElement.Paragraph]={panelId:"id-paragraph-settings",panel:e.paragraphSettings,btn:e.btnText,hidden:1,locked:!1},this._settings[c_oAscTypeSelectElement.Image]={panelId:"id-image-settings",panel:e.imageSettings,btn:e.btnImage,hidden:1,locked:!1},this._settings[c_oAscTypeSelectElement.Shape]={panelId:"id-shape-settings",panel:e.shapeSettings,btn:e.btnShape,hidden:1,locked:!1},this._settings[c_oAscTypeSelectElement.Chart]={panelId:"id-chart-settings",panel:e.chartSettings,btn:e.btnChart,hidden:1,locked:!1}},setApi:function(e){this.api=e,this.api.asc_registerCallback("asc_onСoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this))},setMode:function(e){this.editMode=e.isEdit},onRightMenuClick:function(e,t,n){if(!n&&this.editMode){var r=this._settings[t].panel,i=this._settings[t].props;i&&r&&r.ChangeSettings.call(r,i)}Common.NotificationCenter.trigger("layout:changed","rightmenu"),Common.NotificationCenter.trigger("edit:complete",this.rightmenu)},onSelectionChanged:function(e){var t=[],n=e.asc_getFlags().asc_getSelectionType();if(n==c_oAscSelectionType.RangeImage||n==c_oAscSelectionType.RangeShape||n==c_oAscSelectionType.RangeChart||n==c_oAscSelectionType.RangeChartText||n==c_oAscSelectionType.RangeShapeText)t=this.api.asc_getGraphicObjectProps();t.length<=0&&!this.rightmenu.minimizedMode&&this.rightmenu.clearSelection(),this.onFocusObject(t);var r=e.asc_getLocked(),i=this;this._state.prevDisabled!=r&&(this._state.prevDisabled=r,_.each(this._settings,function(e){e.panel.setLocked(r)}))},onFocusObject:function(e){if(!this.editMode)return;for(var t=0;t<this._settings.length;++t)this._settings[t]&&(this._settings[t].hidden=1,this._settings[t].locked=!1);for(t=0;t<e.length;++t){var n=e[t].asc_getObjectType();if(n>=this._settings.length||this._settings[n]===undefined)continue;var r=e[t].asc_getObjectValue();n==c_oAscTypeSelectElement.Image&&(r.asc_getChartProperties()!==null?n=c_oAscTypeSelectElement.Chart:r.asc_getShapeProperties()!==null&&(n=c_oAscTypeSelectElement.Shape)),this._settings[n].props=r,this._settings[n].hidden=0,this._settings[n].locked=r.asc_getLocked()}var i=-1,s,o=-1;for(t=0;t<this._settings.length;++t){var u=this._settings[t];if(u===undefined)continue;u.hidden?(u.btn.isDisabled()||u.btn.setDisabled(!0),this.rightmenu.GetActivePane()==u.panelId&&(s=-1)):(u.btn.isDisabled()&&u.btn.setDisabled(!1),i=t,u.needShow?(u.needShow=!1,o=t):this.rightmenu.GetActivePane()==u.panelId&&(s=t),u.panel.setLocked(u.locked))}if(!this.rightmenu.minimizedMode){var a;o>-1?a=o:i>=0&&s<0?a=i:s>=0&&(a=s),a!==undefined&&(this.rightmenu.SetActivePane(a),this._settings[a].panel.ChangeSettings.call(this._settings[a].panel,this._settings[a].props))}this._settings[c_oAscTypeSelectElement.Image].needShow=!1,this._settings[c_oAscTypeSelectElement.Chart].needShow=!1},onCoAuthoringDisconnect:function(){this.rightmenu&&this.rightmenu.SetDisabled("",!0,!0),this.setMode({isEdit:!1})},onInsertImage:function(){this._settings[c_oAscTypeSelectElement.Image].needShow=!0},onInsertChart:function(){this._settings[c_oAscTypeSelectElement.Chart].needShow=!0},onInsertShape:function(){this._settings[c_oAscTypeSelectElement.Shape].needShow=!0},UpdateThemeColors:function(){this.rightmenu.shapeSettings.UpdateThemeColors()},updateMetricUnit:function(){this.rightmenu.paragraphSettings.updateMetricUnit(),this.rightmenu.chartSettings.updateMetricUnit(),this.rightmenu.imageSettings.updateMetricUnit()},createDelayedElements:function(){var e=this;this.api&&(this.api.asc_registerCallback("asc_onFocusObject",_.bind(this.onFocusObject,this)),this.api.asc_registerCallback("asc_onSelectionChanged",_.bind(this.onSelectionChanged,this)),this.api.asc_registerCallback("asc_doubleClickOnObject",_.bind(this.onDoubleClickOnObject,this)))},onDoubleClickOnObject:function(e){if(!this.editMode)return;var t=e.asc_getObjectType();if(t>=this._settings.length||this._settings[t]===undefined)return;var n=e.asc_getObjectValue();t==c_oAscTypeSelectElement.Image&&(n.asc_getChartProperties()!==null?t=c_oAscTypeSelectElement.Chart:n.asc_getShapeProperties()!==null&&(t=c_oAscTypeSelectElement.Shape)),t!==c_oAscTypeSelectElement.Paragraph&&(this.rightmenu.SetActivePane(t,!0),this._settings[t].panel.ChangeSettings.call(this._settings[t].panel,this._settings[t].props))}})}),function(e){function l(e,t){var n=e.length;while(n--)if(e[n]===t)return n;return-1}function c(e,t){if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function p(e){for(t in r)r[t]=e[h[t]]}function d(e){var t,i,o,u,c,h;t=e.keyCode,l(a,t)==-1&&a.push(t);if(t==93||t==224)t=91;if(t in r){r[t]=!0;for(o in s)s[o]==t&&(g[o]=!0);return}p(e);if(!g.filter.call(this,e))return;if(!(t in n))return;h=x();for(u=0;u<n[t].length;u++){i=n[t][u];if(i.scope==h||i.scope=="all"){c=i.mods.length>0;for(o in r)if(!r[o]&&l(i.mods,+o)>-1||r[o]&&l(i.mods,+o)==-1)c=!1;if(i.mods.length==0&&!r[16]&&!r[18]&&!r[17]&&!r[91]||c)if(f===!0||i.locked||i.method(e,i)===!1)e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)}}}function v(e){var t=e.keyCode,n,i=l(a,t);i>=0&&a.splice(i,1);if(t==93||t==224)t=91;if(t in r){r[t]=!1;for(n in s)s[n]==t&&(g[n]=!1)}}function m(){for(t in r)r[t]=!1;for(t in s)g[t]=!1}function g(e,t,r){var i,s;i=N(e),r===undefined&&(r=t,t="all");for(var o=0;o<i.length;o++)s=[],e=i[o].split("+"),e.length>1&&(s=C(e),e=[e[e.length-1]]),e=e[0],e=u(e),e in n||(n[e]=[]),n[e].push({shortcut:i[o],scope:t,method:r,key:i[o],mods:s})}function y(e,t){var r,i,s=[],o,a,f;r=N(e);for(a=0;a<r.length;a++){i=r[a].split("+"),i.length>1&&(s=C(i),e=i[i.length-1]),e=u(e),t===undefined&&(t=x());if(!n[e])return;for(o in n[e])f=n[e][o],f.scope===t&&c(f.mods,s)&&(n[e][o]={})}}function b(e){return typeof e=="string"&&(e=u(e)),l(a,e)!=-1}function w(){return a.slice(0)}function E(e){var t=(e.target||e.srcElement).tagName;return t!="INPUT"&&t!="SELECT"&&t!="TEXTAREA"}function S(e){i=e||"all"}function x(){return i||"all"}function T(e){var t,r,i;for(t in n){r=n[t];for(i=0;i<r.length;)r[i].scope===e?r.splice(i,1):i++}}function N(e){var t;return e=e.replace(/\\s/g,""),t=e.split(","),t[t.length-1]==""&&(t[t.length-2]+=","),t}function C(e){var t=e.slice(0,e.length-1);for(var n=0;n<t.length;n++)t[n]=s[t[n]];return t}function k(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,function(){n(window.event)})}function A(){var t=e.key;return e.key=L,t}function O(e,t,r,i){var s,o=[],a,f,l=N(e);for(var h=l.length;h--;){s=l[h].split("+"),s.length>1&&(o=C(s),e=s[s.length-1]),e=u(e),t===undefined&&(t=x());if(n[e])for(a in n[e])f=n[e][a],f.scope===t&&c(f.mods,o)&&(n[e][a][r]=i)}}function M(e,t){e?O(e,t,"locked",!0):f=!0}function _(e,t){e?O(e,t,"locked",!1):f=!1}var t,n={},r={16:!1,18:!1,17:!1,91:!1},i="all",s={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},o={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"\'":222,"[":219,"]":221,"\\\\":220},u=function(e){return o[e]||e.toUpperCase().charCodeAt(0)},a=[],f;for(t=1;t<20;t++)o["f"+t]=111+t;var h={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(t in s)g[t]=!1;k(document,"keydown",function(e){d(e)}),k(document,"keyup",v),k(window,"focus",m);var L=e.key;e.key=g,e.key.setScope=S,e.key.getScope=x,e.key.deleteScope=T,e.key.filter=E,e.key.isPressed=b,e.key.getPressedKeyCodes=w,e.key.noConflict=A,e.key.unbind=y,e.key.suspend=M,e.key.resume=_,typeof module!="undefined"&&(module.exports=key)}(this),define("keymaster",function(){});if(Common===undefined)var Common={};Common.util=Common.util||{},define("common/main/lib/util/Shortcuts",["backbone","keymaster"],function(e){var t=function(e){return this.cid=_.uniqueId("shortcuts"),this.initialize.apply(this,arguments),this};_.extend(t.prototype,e.Events,{initialize:function(){window.key.filter=function(e){return!0},Common.NotificationCenter.on({"modal:show":function(e){window.key.suspend()},"modal:close":function(e){window.key.resume()},"modal:hide":function(e){window.key.resume()}})},delegateShortcuts:function(e){if(!e||!e.shortcuts)return;this.removeShortcuts(e);var t,n,r,i,s,o,u=[];for(s in e.shortcuts){t=e.shortcuts[s];if(!_.isFunction(t)){r=e[t];if(!r)throw new Error("Method "+t+" does not exist")}else r=t;n=s.match(/^(\\S+)\\s*(.*)$/),o=n[1],i=n[2].length?n[2]:"all",r=_.bind(r,this),u.push(window.key(o,i,r))}},removeShortcuts:function(e){if(!e||!e.shortcuts)return;var t,n,r,i,s=[];for(r in e.shortcuts)t=r.match(/^(\\S+)\\s*(.*)$/),i=t[1],n=t[2].length?t[2]:"all",window.key.unbind(i,n)},suspendEvents:function(e,t){window.key.suspend(e,t)},resumeEvents:function(e,t){window.key.resume(e,t)}}),t.extend=e.View.extend,Common.util.Shortcuts=new t}),define("text!spreadsheeteditor/main/app/template/LeftMenu.template",[],function(){return\'<div id="view-left-menu" class="tool-menu left">\\r\\n    <div class="tool-menu-btns">\\r\\n        <button id="left-btn-file" class="btn btn-category" content-target="left-panel-file"><span class="btn-icon btn-menu-file">&nbsp;</span></button>\\r\\n        <button id="left-btn-search" class="btn btn-category" content-target=""><span class="btn-icon btn-menu-search">&nbsp;</span></button>\\r\\n        <!-- /** coauthoring begin **/ -->\\r\\n        <button id="left-btn-comments" class="btn btn-category" content-target="left-panel-comments"><span class="btn-icon btn-menu-comments">&nbsp;</span></button>\\r\\n        <button id="left-btn-chat" class="btn btn-category" content-target="left-panel-chat"><span class="btn-icon btn-menu-chat">&nbsp;</span></button>\\r\\n        <!-- /** coauthoring end **/ -->\\r\\n        <button id="left-btn-support" class="btn btn-category" content-target=""><span class="btn-icon btn-menu-support">&nbsp;</span></button>\\r\\n        <button id="left-btn-about" class="btn btn-category" content-target=""><span class="btn-icon btn-menu-about">&nbsp;</span></button>\\r\\n    </div>\\r\\n    <div class="left-panel" style="">\\r\\n        <!-- /** coauthoring begin **/ -->\\r\\n        <div id="left-panel-comments" class="" style="display: none;" />\\r\\n        <div id="left-panel-chat" class="" style="display: none;" />\\r\\n        <!-- /** coauthoring end **/ -->\\r\\n    </div>\\r\\n</div>\'}),define("common/main/lib/view/About",["common/main/lib/component/BaseView","common/main/lib/component/Scroller"],function(){Common.Views.About=Common.UI.BaseView.extend(_.extend({menu:undefined,options:{alias:"Common.Views.About"},initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.txtVersionNum="3.0",this.txtAscMail="support@onlyoffice.com",this.txtAscTelNum="+371 660-16425",this.txtAscUrl="www.onlyoffice.com",this.txtAscName="Ascensio System SIA",this.template=_.template([\'<table id="id-about-licensor-logo" cols="1" style="width: 100%; margin-top: 20px;">\',"<tr>",\'<td align="center"><div class="asc-about-office"/></td>\',"</tr>","<tr>",\'<td align="center"><label class="asc-about-version">\'+e.appName.toUpperCase()+"</label></td>","</tr>","<tr>",\'<td align="center"><label class="asc-about-version">\'+this.txtVersion+this.txtVersionNum+"</label></td>","</tr>","</table>",\'<table id="id-about-licensor-info" cols="3" style="width: 100%;" class="margin-bottom">\',"<tr>",\'<td colspan="3" align="center" style="padding: 20px 0 10px 0;"><label class="asc-about-companyname">\'+this.txtAscName+"</label></td>","</tr>","<tr>",\'<td colspan="3" align="center" class="padding-small">\',\'<label class="asc-about-desc-name">\'+this.txtAddress+"</label>",\'<label class="asc-about-desc">\'+this.txtAscAddress+"</label>","</td>","</tr>","<tr>",\'<td colspan="3" align="center" class="padding-small">\',\'<label class="asc-about-desc-name">\'+this.txtMail+"</label>",\'<a href="mailto:\'+this.txtAscMail+\'">\'+this.txtAscMail+"</a>","</td>","</tr>","<tr>",\'<td colspan="3" align="center" class="padding-small">\',\'<label class="asc-about-desc-name">\'+this.txtTel+"</label>",\'<label class="asc-about-desc">\'+this.txtAscTelNum+"</label>","</td>","</tr>","<tr>",\'<td colspan="3" align="center">\',\'<a href="http://\'+this.txtAscUrl+\'" target="_blank">\'+this.txtAscUrl+"</a>","</td>","</tr>","</table>",\'<table id="id-about-licensee-info" cols="1" style="width: 100%; margin-top: 20px;" class="hidden margin-bottom"><tbody>\',"<tr>",\'<td align="center" class="padding-small"><div id="id-about-company-logo"/></td>\',"</tr>","<tr>",\'<td align="center"><label class="asc-about-version">\'+e.appName.toUpperCase()+"</label></td>","</tr>","<tr>",\'<td align="center"><label style="padding-bottom: 29px;" class="asc-about-version">\'+this.txtVersion+this.txtVersionNum+"</label></td>","</tr>","<tr>",\'<td align="center" class="padding-small">\',\'<label class="asc-about-companyname" id="id-about-company-name"></label>\',"</td>","</tr>","<tr>",\'<td align="center" class="padding-small">\',\'<label class="asc-about-desc-name">\'+this.txtAddress+"</label>",\'<label class="asc-about-desc" id="id-about-company-address"></label>\',"</td>","</tr>","<tr>",\'<td align="center" class="padding-small">\',\'<label class="asc-about-desc-name">\'+this.txtMail+"</label>",\'<a href="mailto:" id="id-about-company-mail"></a>\',"</td>","</tr>","<tr>",\'<td align="center" class="padding-small">\',\'<a href="" target="_blank" id="id-about-company-url"></a>\',"</td>","</tr>","<tr>",\'<td align="center">\',\'<label class="asc-about-lic" id="id-about-company-lic"></label>\',"</td>","</tr>","</table>",\'<table id="id-about-licensor-short" cols="1" style="width: 100%; margin-top: 31px;" class="hidden"><tbody>\',"<tr>",\'<td style="width:50%;"><div class="separator horizontal short left"/></td>\',\'<td align="center"><label class="asc-about-header">\'+this.txtPoweredBy+"</label></td>",\'<td style="width:50%;"><div class="separator horizontal short"/></td>\',"</tr>","<tr>",\'<td colspan="3" align="center" style="padding: 9px 0 10px;"><label class="asc-about-companyname">\'+this.txtAscName+"</label></td>","</tr>","<tr>",\'<td colspan="3" align="center">\',\'<a href="http://\'+this.txtAscUrl+\'" target="_blank">\'+this.txtAscUrl+"</a>","</td>","</tr>","</table>"].join("")),this.menu=e.menu},render:function(){var e=$(this.el);return e.html(this.template({scope:this})),e.addClass("about-dlg"),this.cntLicenseeInfo=$("#id-about-licensee-info"),this.cntLicensorInfo=$("#id-about-licensor-info"),this.divCompanyLogo=$("#id-about-company-logo"),this.lblCompanyName=$("#id-about-company-name"),this.lblCompanyAddress=$("#id-about-company-address"),this.lblCompanyMail=$("#id-about-company-mail"),this.lblCompanyUrl=$("#id-about-company-url"),this.lblCompanyLic=$("#id-about-company-lic"),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:$(this.el),suppressScrollX:!0})),this},setLicInfo:function(e){if(e&&typeof e=="object"&&typeof e.customer=="object"){var t=e.customer;$("#id-about-licensor-logo").addClass("hidden"),$("#id-about-licensor-short").removeClass("hidden"),this.cntLicensorInfo.addClass("hidden"),this.cntLicenseeInfo.removeClass("hidden"),this.cntLicensorInfo.removeClass("margin-bottom");var n=t.name;n&&n.length?this.lblCompanyName.text(n):this.lblCompanyName.parents("tr").addClass("hidden"),n=t.address,n&&n.length?this.lblCompanyAddress.text(n):this.lblCompanyAddress.parents("tr").addClass("hidden"),(n=t.mail)&&n.length?this.lblCompanyMail.attr("href","mailto:"+n).text(n):this.lblCompanyMail.parents("tr").addClass("hidden");if((n=t.www)&&n.length){var r=/^https?:\\/{2}/i.test(n)?"":"http://";this.lblCompanyUrl.attr("href",r+n).text(n)}else this.lblCompanyUrl.parents("tr").addClass("hidden");(n=t.info)&&n.length?this.lblCompanyLic.text(n):this.lblCompanyLic.parents("tr").addClass("hidden"),(n=t.logo)&&n.length?this.divCompanyLogo.html(\'<img src="\'+n+\'" />\'):this.divCompanyLogo.parents("tr").addClass("hidden")}else this.cntLicenseeInfo.addClass("hidden"),this.cntLicensorInfo.addClass("margin-bottom")},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.fireEvent("show",this)},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments),this.fireEvent("hide",this)},txtPoweredBy:"Powered by",txtVersion:"Version ",txtLicensor:"LICENSOR",txtLicensee:"LICENSEE",txtAddress:"address: ",txtAscAddress:"Lubanas st. 125a-25, Riga, Latvia, EU, LV-1021",txtMail:"email: ",txtTel:"tel.: "},Common.Views.About||{}))}),define("text!common/main/lib/template/Comments.template",[],function(){return\'<% if (!hide) { %>\\r\\n    <div id="<%= id %>" class="user-comment-item">\\r\\n\\r\\n        <!-- comment block -->\\r\\n\\r\\n        <div class="user-name"><%=scope.getUserName(username)%></div>\\r\\n        <div class="user-date"><%=date%></div>\\r\\n        <div class="user-quote"><%=scope.getFixedQuote(quote)%></div>\\r\\n        <% if (!editText) { %>\\r\\n            <div class="user-message text-select" data-can-copy="true"><%=scope.pickLink(comment)%></div>\\r\\n        <% } else { %>\\r\\n            <div class="inner-edit-ct">\\r\\n                <textarea class="msg-reply"><%=comment%></textarea>\\r\\n                <button class="btn normal dlg-btn primary btn-inner-edit" id="id-comments-change">textEdit</button>\\r\\n                <button class="btn normal dlg-btn btn-inner-close">textCancel</button>\\r\\n            </div>\\r\\n        <% } %>\\r\\n\\r\\n        <!-- replys elements -->\\r\\n\\r\\n        <% if (replys.length) { %>\\r\\n            <div class="reply-arrow "></div>\\r\\n            <% _.each(replys, function (item) { %>\\r\\n                <div class="reply-item-ct">\\r\\n                    <div class="user-name"><%=scope.getFixedQuote(item.get("username"))%></div>\\r\\n                    <div class="user-date"><%=item.get("date")%></div>\\r\\n                    <% if (!item.get("editText")) { %>\\r\\n                        <div class="user-message text-select" data-can-copy="true"><%=scope.pickLink(item.get("reply"))%></div>\\r\\n                            <div class="btns-reply-ct">\\r\\n                            <div class="btn-edit" data-value="<%=item.get("id")%>"></div>\\r\\n                            <div class="btn-delete" data-value="<%=item.get("id")%>"></div>\\r\\n                        </div>\\r\\n                    <% } else { %>\\r\\n                        <div class="inner-edit-ct">\\r\\n                            <textarea class="msg-reply textarea-fix"><%=item.get("reply")%></textarea>\\r\\n                            <button class="btn normal dlg-btn primary btn-inner-edit btn-fix" id="id-comments-change">textEdit</button>\\r\\n                            <button class="btn normal dlg-btn btn-inner-close">textClose</button>\\r\\n                        </div>\\r\\n                    <% } %>\\r\\n                </div>\\r\\n            <% }); %>\\r\\n        <% } %>\\r\\n\\r\\n        <!-- add reply button -->\\r\\n\\r\\n        <% if (!showReply) { %>\\r\\n            <% if (replys.length) { %>\\r\\n                <label class="user-reply" style="margin-left: 20px; margin-top: 5px;" role="presentation" tabindex="-1">textAddReply</label>\\r\\n            <% } else { %>\\r\\n                <label class="user-reply" role="presentation" tabindex="-1">textAddReply</label>\\r\\n            <% } %>\\r\\n        <% } %>\\r\\n\\r\\n        <!-- edit buttons -->\\r\\n\\r\\n        <% if (!editText && !lock) { %>\\r\\n            <div class="edit-ct">\\r\\n                <div class="btn-edit"></div>\\r\\n                <div class="btn-delete"></div>\\r\\n                <% if (resolved) { %>\\r\\n                <div class="resolve-ct-check" style="float:left;">\\r\\n                    <div class="resolved"></div>\\r\\n                    <div class="btn-resolve-check">textResolved</div>\\r\\n                <% } else { %>\\r\\n                <div class="resolve-ct" style="float:left;">\\r\\n                    <div class="btn-resolve">textResolve</div>\\r\\n                <% } %>\\r\\n                </div>\\r\\n            </div>\\r\\n        <% } %>\\r\\n\\r\\n        <!-- reply -->\\r\\n\\r\\n        <% if (showReply) { %>\\r\\n            <div class="reply-ct">\\r\\n                <textarea class="msg-reply" placeholder="textAddReply"></textarea>\\r\\n                <button class="btn normal dlg-btn primary btn-reply" id="id-comments-change">textReply</button>\\r\\n                <button class="btn normal dlg-btn btn-close">textClose</button>\\r\\n            </div>\\r\\n        <% } %>\\r\\n        <% if (lock) { %>\\r\\n            <div class="lock-area"></div>\\r\\n            <div class="lock-author"><%=lockuserid%></div>\\r\\n        <% } %>\\r\\n        <% if (!last) { %>\\r\\n            <div class="separator-cmt"></div>\\r\\n        <% } %>\\r\\n    </div>\\r\\n<% } %>\\r\\n\'}),define("text!common/main/lib/template/CommentsPanel.template",[],function(){return\'<div id="comments-box">\\r\\n    <div id="comments-messages"/>\\r\\n    <div id="comments-add-link-ct">\\r\\n        <label id="comment-btn-new" class="btn"><%=textAddCommentToDoc%></label>\\r\\n    </div>\\r\\n    <div id="comments-new-comment-ct" style="display: none;">\\r\\n        <div id="comments-inner-ct">\\r\\n            <textarea id="comment-msg-ne

]]></string> </value>
        </item>
        <item>
            <key> <string>next</string> </key>
            <value>
              <persistent> <string encoding="base64">AAAAAAAAAA0=</string> </persistent>
            </value>
        </item>
      </dictionary>
    </pickle>
  </record>
  <record id="13" aka="AAAAAAAAAA0=">
    <pickle>
      <global name="Pdata" module="OFS.Image"/>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>data</string> </key>
            <value> <string encoding="cdata"><![CDATA[

w" placeholder="<%=textEnterCommentHint%>"/>\\r\\n            <button id="comment-btn-add" class="btn normal dlg-btn primary"><%=textAddComment%></button>\\r\\n            <button id="comment-btn-cancel" class="btn normal dlg-btn"><%=textCancel%></button>\\r\\n        </div>\\r\\n    </div>\\r\\n</div>\\r\\n\'}),define("text!common/main/lib/template/CommentsPopover.template",[],function(){return\'<div id="<%=id%>" class="user-comment-item">\\r\\n\\r\\n    <!-- comment block -->\\r\\n\\r\\n    <div class="user-name"><%=scope.getUserName(username)%></div>\\r\\n    <div class="user-date"><%=date%></div>\\r\\n    <% if (!editTextInPopover || hint) { %>\\r\\n        <div class="user-message"><%=scope.pickLink(comment)%></div>\\r\\n    <% } else { %>\\r\\n        <div class="inner-edit-ct">\\r\\n            <textarea class="msg-reply"><%=comment%></textarea>\\r\\n            <% if (hideAddReply) { %>\\r\\n                <button class="btn normal dlg-btn primary btn-inner-edit" id="id-comments-change-popover">textAdd</button>\\r\\n            <% } else { %>\\r\\n                <button class="btn normal dlg-btn primary btn-inner-edit" id="id-comments-change-popover">textEdit</button>\\r\\n            <% } %>\\r\\n            <button class="btn normal dlg-btn btn-inner-close">textCancel</button>\\r\\n        </div>\\r\\n    <% } %>\\r\\n\\r\\n    <!-- replys elements -->\\r\\n\\r\\n    <% if (replys.length) { %>\\r\\n        <div class="reply-arrow "></div>\\r\\n        <% _.each(replys, function (item) { %>\\r\\n            <div class="reply-item-ct">\\r\\n                <div class="user-name"><%=scope.getFixedQuote(item.get("username"))%></div>\\r\\n                <div class="user-date"><%=item.get("date")%></div>\\r\\n                <% if (!item.get("editTextInPopover")) { %>\\r\\n                    <div class="user-message"><%=scope.pickLink(item.get("reply"))%></div>\\r\\n                    <% if (!hint) { %>\\r\\n                        <div class="btns-reply-ct">\\r\\n                            <div class="btn-edit" data-value="<%=item.get("id")%>"></div>\\r\\n                            <div class="btn-delete" data-value="<%=item.get("id")%>"></div>\\r\\n                        </div>\\r\\n                    <%}%>\\r\\n                <% } else { %>\\r\\n                    <div class="inner-edit-ct">\\r\\n                        <textarea class="msg-reply textarea-fix"><%=item.get("reply")%></textarea>\\r\\n                        <button class="btn normal dlg-btn primary btn-inner-edit btn-fix" id="id-comments-change-popover">textEdit</button>\\r\\n                        <button class="btn normal dlg-btn btn-inner-close">textClose</button>\\r\\n                    </div>\\r\\n                <% } %>\\r\\n                </div>\\r\\n        <% }); %>\\r\\n\\r\\n    <% } %>\\r\\n\\r\\n    <!-- add reply button -->\\r\\n\\r\\n    <% if (!showReplyInPopover && !hideAddReply && !hint) { %>\\r\\n        <% if (replys.length) { %>\\r\\n            <label class="user-reply" style="margin-left: 20px; margin-top: 5px;" role="presentation" tabindex="-1">textAddReply</label>\\r\\n        <% } else { %>\\r\\n            <label class="user-reply" role="presentation" tabindex="-1">textAddReply</label>\\r\\n        <% } %>\\r\\n    <% } %>\\r\\n\\r\\n    <!-- edit buttons -->\\r\\n\\r\\n    <% if (!editTextInPopover && !lock && !hint) { %>\\r\\n        <div class="edit-ct">\\r\\n            <div class="btn-edit"></div>\\r\\n            <div class="btn-delete"></div>\\r\\n            <% if (resolved) { %>\\r\\n                <div class="resolve-ct-check" style="float:left;">\\r\\n                <div class="resolved"></div>\\r\\n                <div class="btn-resolve-check">textResolved</div>\\r\\n            <% } else { %>\\r\\n                <div class="resolve-ct" style="float:left;">\\r\\n                <div class="btn-resolve">textResolve</div>\\r\\n            <% } %>\\r\\n            </div>\\r\\n        </div>\\r\\n    <% } %>\\r\\n\\r\\n    <!-- reply -->\\r\\n\\r\\n    <% if (showReplyInPopover) { %>\\r\\n        <div class="reply-ct">\\r\\n            <textarea class="msg-reply" placeholder="textAddReply"></textarea>\\r\\n            <button class="btn normal dlg-btn primary btn-reply" id="id-comments-change-popover">textReply</button>\\r\\n            <button class="btn normal dlg-btn btn-close">textClose</button>\\r\\n        </div>\\r\\n    <% } %>\\r\\n\\r\\n    <!-- locked user -->\\r\\n\\r\\n    <% if (lock) { %>\\r\\n        <div class="lock-area" style="cursor: default;"></div>\\r\\n        <div class="lock-author" style="cursor: default;"><%=lockuserid%></div>\\r\\n    <% } %>\\r\\n\\r\\n</div>\'});if(Common===undefined)var Common={};Common.Views=Common.Views||{},define("common/main/lib/view/Comments",["text!common/main/lib/template/Comments.template","text!common/main/lib/template/CommentsPanel.template","text!common/main/lib/template/CommentsPopover.template","common/main/lib/util/utils","common/main/lib/component/Button","common/main/lib/component/ComboBox","common/main/lib/component/DataView","common/main/lib/component/Window"],function(e,t,n){function r(e,t){var n,r,i=e;for(n in t)undefined!==n&&(r=t[n],i=i.replace(new RegExp(n,"g"),r));return i}Common.Views.CommentsPopover=Common.UI.Window.extend({initialize:function(e){var t={};_.extend(t,{closable:!1,width:265,height:120,header:!1,modal:!1},e),this.template=e.template||[\'<div class="box">\',\'<div id="id-comments-popover" class="comments-popover"></div>\',\'<div id="id-comments-arrow" class="comments-arrow-left"></div>\',"</div>"].join(""),this.store=e.store,this.delegate=e.delegate,t.tpl=_.template(this.template,t),this.arrow={margin:20,width:12,height:34},this.sdkBounds={width:0,height:0,padding:5,paddingTop:20},Common.UI.Window.prototype.initialize.call(this,t)},render:function(){Common.UI.Window.prototype.render.call(this);var e=this,t=this.delegate,i=this.$window;i.css({height:"",minHeight:"",overflow:"hidden",position:"absolute",zIndex:"990"});var s=i.find(".body");s&&s.css("position","relative");var o=Common.UI.DataView.extend(function(){var t=e;return{options:{handleSelect:!1,scrollable:!0,template:_.template(\'<div class="dataview-ct inner" style="overflow-y: hidden;"></div>\')},getTextBox:function(){var e=$(this.el).find("textarea");return e&&e.length?e:undefined},setFocusToTextBox:function(e){var t=$(this.el).find("textarea");if(e)t.blur();else if(t&&t.length){var n=t.val();t.focus(),t.val(""),t.val(n)}},getActiveTextBoxVal:function(){var e=$(this.el).find("textarea");return e&&e.length?e.val().trim():""},autoHeightTextBox:function(){function l(){u=$(n.scroller.el).scrollTop(),i.scrollHeight>i.clientHeight?(r.css({height:i.scrollHeight+o+"px"}),t.calculateSizeOfContent()):(a=i.clientHeight,a>=s&&(r.css({height:s+"px"}),i.scrollHeight>i.clientHeight&&(f=Math.max(i.scrollHeight+o,s),r.css({height:f+"px"})),t.calculateSizeOfContent(),t.setLeftTop(e.arrowPosX,e.arrowPosY,e.leftX),t.calculateSizeOfContent())),n.scroller.scrollTop(u),n.autoScrollToEditButtons()}var n=this,r=this.$el.find("textarea"),i=null,s=50,o=0,u=0,a=0,f=0;r&&r.length&&(i=r.get(0),i&&(o=parseInt(r.css("lineHeight"),10)*.25,l(),r.bind("input propertychange",l))),this.textBox=r},clearTextBoxBind:function(){this.textBox&&(this.textBox.unbind("input propertychange"),this.textBox=undefined)},autoScrollToEditButtons:function(){var e=$("#id-comments-change-popover"),t=null,n=this.el.getBoundingClientRect(),r=0,i=7;e.length&&(t=e.get(0).getBoundingClientRect(),t&&n&&(r=n.bottom-(t.bottom+i),r<0&&this.scroller.scrollTop(this.scroller.getScrollTop()-r)))}}}());o&&(this.commentsView?(this.commentsView.render($("#id-comments-popover")),this.commentsView.onResetItems()):(this.commentsView=new o({el:$("#id-comments-popover"),store:e.store,itemTemplate:_.template(r(n,{textAddReply:t.textAddReply,textAdd:t.textAdd,textCancel:t.textCancel,textEdit:t.textEdit,textReply:t.textReply,textClose:t.textClose,textResolved:t.textResolved,textResolve:t.textResolve}))}),this.commentsView.on("item:click",function(n,r,i,s){function h(){e.renderResolvedComboButtons(),t.renderResolvedComboButtons(),e.update()}var o,u,a,f,l,c;o=$(s.target);if(o){u=i.get("editTextInPopover"),a=i.get("showReplyInPopover"),c=i.get("hideAddReply"),f=i.get("uid"),l=o.attr("data-value");if(i.get("hint")){t.fireEvent("comment:disableHint",[i]);return}if(o.hasClass("btn-edit"))_.isUndefined(l)?u||(t.fireEvent("comment:closeEditing"),i.set("editTextInPopover",!0),t.fireEvent("comment:show",[f]),this.autoHeightTextBox(),e.calculateSizeOfContent(),e.setLeftTop(e.arrowPosX,e.arrowPosY,e.leftX),e.calculateSizeOfContent(),h(),e.hookTextBox(),this.autoScrollToEditButtons(),this.setFocusToTextBox()):(t.fireEvent("comment:closeEditing",[f]),t.fireEvent("comment:editReply",[f,l,!0]),this.replyId=l,this.autoHeightTextBox(),e.calculateSizeOfContent(),e.setLeftTop(e.arrowPosX,e.arrowPosY,e.leftX),e.calculateSizeOfContent(),h(),e.hookTextBox(),this.autoScrollToEditButtons(),this.setFocusToTextBox());else if(o.hasClass("btn-delete"))_.isUndefined(l)?t.fireEvent("comment:remove",[f]):(t.fireEvent("comment:removeReply",[f,l]),e.calculateSizeOfContent(),e.setLeftTop(e.arrowPosX,e.arrowPosY,e.leftX),e.calculateSizeOfContent()),t.fireEvent("comment:closeEditing"),h();else if(o.hasClass("user-reply"))t.fireEvent("comment:closeEditing"),i.set("showReplyInPopover",!0),e.calculateSizeOfContent(),e.setLeftTop(e.arrowPosX,e.arrowPosY,e.leftX),e.calculateSizeOfContent(),h(),this.autoHeightTextBox(),e.hookTextBox(),this.autoScrollToEditButtons(),this.setFocusToTextBox();else if(o.hasClass("btn-reply",!1))a&&(this.clearTextBoxBind(),t.fireEvent("comment:addReply",[f,this.getActiveTextBoxVal()]),t.fireEvent("comment:closeEditing"),h());else if(o.hasClass("btn-close",!1))t.fireEvent("comment:closeEditing",[f]),e.calculateSizeOfContent(),t.fireEvent("comment:show",[f]),h();else if(o.hasClass("btn-inner-edit",!1)){if(i.get("dummy")){t.fireEvent("comment:addDummyComment",[this.getActiveTextBoxVal()]);return}this.clearTextBoxBind(),_.isUndefined(this.replyId)?u&&(t.fireEvent("comment:change",[f,this.getActiveTextBoxVal()]),t.fireEvent("comment:closeEditing"),e.calculateSizeOfContent()):(t.fireEvent("comment:changeReply",[f,this.replyId,this.getActiveTextBoxVal()]),this.replyId=undefined,t.fireEvent("comment:closeEditing")),h()}else if(o.hasClass("btn-inner-close",!1)){if(i.get("dummy")){e.hide();return}c&&this.getActiveTextBoxVal().length>0?(e.saveText(),i.set("hideAddReply",!1),this.getTextBox().val(e.textVal),this.autoHeightTextBox()):(this.clearTextBoxBind(),t.fireEvent("comment:closeEditing",[f])),this.replyId=undefined,e.calculateSizeOfContent(),e.setLeftTop(e.arrowPosX,e.arrowPosY,e.leftX),e.calculateSizeOfContent(),h()}else o.hasClass("btn-resolve",!1)&&(t.fireEvent("comment:resolve",[f]),h())}}),e.on({show:function(){e.commentsView.autoHeightTextBox();var t=e.$window.find("textarea");t&&t.length&&t.focus(),t.keydown(function(t){t.keyCode==Common.UI.Keys.ESC&&e.hide()})}})))},show:function(e,t,n,r){this.options.animate=e;var i=this,s=this.commentsView.getTextBox();t&&this.textVal&&s&&s.val(this.textVal),r&&r.length&&s&&s.val(r),Common.UI.Window.prototype.show.call(this),this.renderResolvedComboButtons(),this.commentsView.scroller&&this.commentsView.scroller.update({minScrollbarLength:40}),this.hookTextBox()},hide:function(){this.handlerHide&&this.handlerHide(),Common.UI.Window.prototype.hide.call(this),!_.isUndefined(this.e)&&this.e.keyCode==Common.UI.Keys.ESC&&(this.e.preventDefault(),this.e.stopImmediatePropagation(),this.e=undefined)},update:function(){this.commentsView&&this.commentsView.scroller&&this.commentsView.scroller.update({minScrollbarLength:40})},isVisible:function(){return this.$window&&this.$window.is(":visible")},setLeftTop:function(e,t,n,r){this.$window||this.render(),r&&(e=this.arrowPosX,t=this.arrowPosY,n=this.leftX);if(_.isUndefined(e)&&_.isUndefined(t))return;this.arrowPosX=e,this.arrowPosY=t,this.leftX=n;var i=$("#id-comments-popover"),s=$("#id-comments-arrow"),o=$("#editor_sdk"),u=null,a=0,f=0,l=0,c="",h=0,p="",d=0,v="",m=0,g="",y=0,b=0,w=0,E=0,S=0,x=0;i&&s&&o&&o.get(0)&&(u=o.get(0).getBoundingClientRect(),u&&(a=u.height-this.sdkBounds.padding*2,this.$window.css({maxHeight:a+"px"}),this.sdkBounds.width=u.width,this.sdkBounds.height=u.height,_.isUndefined(e)||(c=$("#id_vertical_scroll"),c.length?h=c.css("display")!=="none"?c.width():0:(c=$("#ws-v-scrollbar"),c.length&&(h=c.css("display")!=="none"?c.width():0)),this.sdkBounds.width-=h,p=$("#id_panel_left"),p.length&&(d=p.css("display")!=="none"?p.width():0),v=$("#id_panel_thumbnails"),v.length&&(m=v.css("display")!=="none"?v.width():0,this.sdkBounds.width-=m),b=Math.min(l+e+this.arrow.width,l+this.sdkBounds.width-this.$window.outerWidth()),b=Math.max(l+d+this.arrow.width,b),s.attr("class","comments-arrow-left"),_.isUndefined(n)||(w=this.$window.outerWidth(),w&&(e+w>this.sdkBounds.width-this.arrow.width+5&&this.leftX>w?(b=this.leftX-w+l-this.arrow.width,s.attr("class","comments-arrow-right")):(s.attr("class","comments-arrow-left"),b=l+e+this.arrow.width))),this.$window.css("left",b+"px")),_.isUndefined(t)||(g=$("#id_panel_top"),x=f,g.length?(y=g.css("display")!=="none"?g.height():0,x+=this.sdkBounds.paddingTop):(g=$("#ws-h-scrollbar"),g.length&&(y=g.css("display")!=="none"?g.height():0,x-=this.sdkBounds.paddingTop)),this.sdkBounds.height-=y,E=this.$window.outerHeight(),S=Math.min(f+a-E,this.arrowPosY+f-this.arrow.height),S=Math.max(S,x),this.$window.css("top",S+"px")))),this.calculateSizeOfContent()},calculateSizeOfContent:function(e){if(e&&!this.$window.is(":visible"))return;this.$window.css({overflow:"hidden"});var t=$("#id-comments-arrow"),n=$("#id-comments-popover"),r=null,i=null,s=null,o=0,u=0,a=0,f="",l=0,c=0,h=0,p=0,d=0,v=0;n&&t&&n.get(0)&&(n.css({height:"100%"}),r=n.get(0).getBoundingClientRect(),r&&(i=$("#editor_sdk"),i&&i.get(0)&&(s=i.get(0).getBoundingClientRect(),s&&(o=s.height-this.sdkBounds.padding*2,v=u,h=this.$window.outerHeight(),f=$("#id_panel_top"),f.length?(l=f.css("display")!=="none"?f.height():0,v+=this.sdkBounds.paddingTop):(f=$("#ws-h-scrollbar"),f.length&&(l=f.css("display")!=="none"?f.height():0,v-=this.sdkBounds.paddingTop)),p=Math.max(n.outerHeight(),this.$window.outerHeight()),o<p?(this.$window.css({maxHeight:o-l+"px",top:u+l+"px"}),n.css({height:o-l+"px"}),c=Math.min(c,o-(l+this.arrow.margin+this.arrow.width)),t.css({top:c+"px"})):(p=h,p>0&&(r.top+p>o+u||r.height===0)&&(d=Math.min(u+o-p,this.arrowPosY+u-this.arrow.height),d=Math.max(d,v),this.$window.css({top:d+"px"})),c=Math.max(this.arrow.margin,this.arrowPosY-(o-p)-this.arrow.width),c=Math.min(c,p-this.arrow.margin-this.arrow.width),t.css({top:c+"px"})))))),this.$window.css({overflow:""})},saveText:function(e){this.textVal=undefined,this.commentsView&&(e?this.commentsView.clearTextBoxBind():this.textVal=this.commentsView.getActiveTextBoxVal())},getEditText:function(){return this.commentsView?this.commentsView.getActiveTextBoxVal():undefined},renderResolvedComboButtons:function(){function s(t){if($(t.el).parent()&&$(t.el).parent().parent()){var n=$(t.el).parent().parent().attr("id");n&&(e.delegate.fireEvent("comment:resolve",[undefined,n]),e.delegate.renderResolvedComboButtons(),e.renderResolvedComboButtons())}}_.isUndefined(this.openComboBoxes)&&(this.openComboBoxes=[]);var e=this,t=0,n,r,i=this.openComboBoxes.length-1;for(;i>=0;--i)this.openComboBoxes[i].off(),this.openComboBoxes[i].stopListening();this.openComboBoxes=[];if(this.commentsView){r=$(this.commentsView.el).find(".resolve-ct-check");for(t=r.length-1;t>=0;--t)n=new Common.UI.ComboBox({template:_.template(["<div>",\'<div class="resolved"></div>\',\'<div class="btn-resolve-check dropdown-toggle" data-toggle="dropdown">\',this.delegate.textResolved,"</div>",\'<span class="comments-caret"></span>\',\'<ul class="dropdown-menu <%= menuCls %>" style="<%= menuStyle %>" role="menu">\',"<% _.each(items, function (item) { %>",\'<li id="<%= item.id %>" data-value="<%= item.value %>"><a href="#"><%= scope.getDisplayValue(item) %></a></li>\',"<% }); %>","</ul>","</div>"].join("")),menuStyle:"min-width: 55px; margin-top: -7px; margin-left: -2px; padding: 0 0; right: 6px; left: auto;",data:[{value:1,displayValue:this.delegate.textOpenAgain}]}),n.render($(r[t])),n.on("selected",s),this.openComboBoxes.push(n)}},hookTextBox:function(){var e=this,t=this.commentsView.getTextBox();t&&t.keydown(function(t){if((t.ctrlKey||t.metaKey)&&t.keyCode===Common.UI.Keys.RETURN){var n=$("#id-comments-change-popover");n&&n.length&&n.click(),t.stopImmediatePropagation()}else if(t.keyCode===Common.UI.Keys.TAB){var r,i,s;s=this.selectionStart,i=this.selectionEnd,r=$(this),r.val(r.val().substring(0,s)+"\t"+r.val().substring(i)),this.selectionStart=this.selectionEnd=s+1,t.stopImmediatePropagation(),t.preventDefault()}e.e=t})}}),Common.Views.Comments=Common.UI.BaseView.extend(_.extend({el:"#left-panel-comments",template:_.template(t),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e),this.store=this.options.store,this.popoverComments=this.options.popoverComments},render:function(){var t=this;$(this.el).html(this.template({textAddCommentToDoc:t.textAddCommentToDoc,textAddComment:t.textAddComment,textCancel:t.textCancel,textEnterCommentHint:t.textEnterCommentHint})),this.buttonAddCommentToDoc=new Common.UI.Button({el:$("#comment-btn-new"),enableToggle:!1}),this.buttonAdd=new Common.UI.Button({action:"add",el:$("#comment-btn-add"),enableToggle:!1}),this.buttonCancel=new Common.UI.Button({el:$("#comment-btn-cancel"),enableToggle:!1}),this.buttonAddCommentToDoc.on("click",_.bind(this.onClickShowBoxDocumentComment,this)),this.buttonAdd.on("click",_.bind(this.onClickAddDocumentComment,this)),this.buttonCancel.on("click",_.bind(this.onClickCancelDocumentComment,this)),this.txtComment=$("#comment-msg-new",this.el),this.txtComment.keydown(function(e){if((e.ctrlKey||e.metaKey)&&e.keyCode==Common.UI.Keys.RETURN)t.onClickAddDocumentComment(),e.stopImmediatePropagation();else if(e.keyCode===Common.UI.Keys.TAB){var n,r,i;i=this.selectionStart,r=this.selectionEnd,n=$(this),n.val(n.val().substring(0,i)+"\t"+n.val().substring(r)),this.selectionStart=this.selectionEnd=i+1,e.stopImmediatePropagation(),e.preventDefault()}});var n=Common.UI.DataView.extend(function(){var e=t;return{options:{handleSelect:!1,scrollable:!0,listenStoreEvents:!1,template:_.template(\'<div class="dataview-ct inner"></div>\')},getTextBox:function(){var e=$(this.el).find("textarea");return e&&e.length?e:undefined},setFocusToTextBox:function(){var e=$(this.el).find("textarea");if(e&&e.length){var t=e.val();e.focus(),e.val(""),e.val(t)}},getActiveTextBoxVal:function(){var e=$(this.el).find("textarea");return e&&e.length?e.val().trim():""},autoHeightTextBox:function(){function a(){n.scrollHeight>n.clientHeight?t.css({height:n.scrollHeight+i+"px"}):(o=n.clientHeight,o>=r&&(t.css({height:r+"px"}),n.scrollHeight>n.clientHeight&&(u=Math.max(n.scrollHeight+i,r),t.css({height:u+"px"})))),e.autoScrollToEditButtons()}var e=this,t=$(this.el).find("textarea"),n=null,r=50,i=0,s=0,o=0,u=0;t&&t.length&&(n=t.get(0),n&&(i=parseInt(t.css("lineHeight"),10)*.25,a(),t.bind("input propertychange",a))),this.textBox=t},clearTextBoxBind:function(){this.textBox&&(this.textBox.unbind("input propertychange"),this.textBox=undefined)},autoScrollToEditButtons:function(){var e=$("#id-comments-change"),t=null,n=this.el.getBoundingClientRect(),r=0,i=7;e.length&&(t=e.get(0).getBoundingClientRect(),t&&n&&(r=n.bottom-(t.bottom+i),r<0&&this.scroller.scrollTop(this.scroller.getScrollTop()-r)))}}}());return n&&(this.commentsView?(this.commentsView.render($("#comments-messages")),this.commentsView.onResetItems()):(this.commentsView=new n({el:$("#comments-messages"),store:t.store,itemTemplate:_.template(r(e,{textAddReply:t.textAddReply,textAdd:t.textAdd,textCancel:t.textCancel,textEdit:t.textEdit,textReply:t.textReply,textClose:t.textClose,textResolved:t.textResolved,textResolve:t.textResolve}))}),this.commentsView.on("item:click",function(e,n,r,i){function c(){t.popover&&t.popover.renderResolvedComboButtons(),t.renderResolvedComboButtons(),t.update()}var s,o,u,a,f,l;s=$(i.target),s&&(o=r.get("editText"),u=r.get("showReply"),a=r.get("uid"),f=s.attr("data-value"),s.hasClass("btn-edit")?_.isUndefined(f)?o||(t.fireEvent("comment:closeEditing"),r.set("editText",!0),this.autoHeightTextBox(),c(),this.setFocusToTextBox(),t.hookTextBox()):(t.fireEvent("comment:closeEditing",[a]),t.fireEvent("comment:editReply",[a,f]),t.commentsView.reply=f,this.autoHeightTextBox(),c(),t.hookTextBox(),this.autoScrollToEditButtons(),this.setFocusToTextBox()):s.hasClass("btn-delete")?(_.isUndefined(f)?t.fireEvent("comment:remove",[a]):t.fireEvent("comment:removeReply",[a,f]),t.fireEvent("comment:closeEditing"),c()):s.hasClass("user-reply")?(t.fireEvent("comment:closeEditing"),r.set("showReply",!0),c(),this.autoHeightTextBox(),t.hookTextBox(),this.autoScrollToEditButtons(),this.setFocusToTextBox()):s.hasClass("btn-reply",!1)?u&&(t.fireEvent("comment:addReply",[a,this.getActiveTextBoxVal()]),t.fireEvent("comment:closeEditing"),c()):s.hasClass("btn-close",!1)?(t.fireEvent("comment:closeEditing",[a]),t.renderResolvedComboButtons()):s.hasClass("btn-inner-edit",!1)?(_.isUndefined(t.commentsView.reply)?o&&t.fireEvent("comment:change",[a,this.getActiveTextBoxVal()]):(t.fireEvent("comment:changeReply",[a,t.commentsView.reply,this.getActiveTextBoxVal()]),t.commentsView.reply=undefined),t.fireEvent("comment:closeEditing"),c()):s.hasClass("btn-inner-close",!1)?(t.fireEvent("comment:closeEditing"),t.commentsView.reply=undefined,c()):s.hasClass("btn-resolve",!1)?(t.fireEvent("comment:resolve",[a]),c()):!s.hasClass("msg-reply")&&!s.hasClass("btn-resolve-check")&&!s.hasClass("btn-resolve")&&t.fireEvent("comment:show",[a,!1]))}))),this.update(),this},update:function(){this.commentsView&&this.commentsView.scroller&&this.commentsView.scroller.update({minScrollbarLength:40})},getPopover:function(e){return _.isUndefined(this.popover)&&(this.popover=new Common.Views.CommentsPopover({store:this.popoverComments,delegate:this,renderTo:e})),this.popover},showEditContainer:function(e){var t=$("#comments-add-link-ct",this.el),n=$("#comments-new-comment-ct",this.el),r=$("#comments-messages",this.el);e?(r.css("bottom",110),t.css({display:"none"}),n.css({display:"table-row"}),this.txtComment.val(""),this.txtComment.focus()):(r.css("bottom",45),t.css({display:"table-row"}),n.css({display:"none"}))},onClickShowBoxDocumentComment:function(){this.fireEvent("comment:closeEditing"),this.showEditContainer(!0)},onClickAddDocumentComment:function(){this.fireEvent("comment:add",[this,this.txtComment.val().trim(),undefined,!1,!0]),this.txtComment.val("")},onClickCancelDocumentComment:function(){this.showEditContainer(!1)},renderResolvedComboButtons:function(){function s(t){if($(t.el).parent()&&$(t.el).parent().parent()){var n=$(t.el).parent().parent().attr("id");n&&(arguments[2]&&arguments[2].stopImmediatePropagation(),e.fireEvent("comment:resolve",[undefined,n]),e.renderResolvedComboButtons(),e.popover&&e.popover.renderResolvedComboButtons())}}_.isUndefined(this.openComboBoxes)&&(this.openComboBoxes=[]);var e=this,t,n,r=this.openComboBoxes.length-1,i=$(this.commentsView.el).find(".resolve-ct-check");for(r=this.openComboBoxes.length-1;r>=0;--r)this.openComboBoxes[r].off(),this.openComboBoxes[r].stopListening();this.openComboBoxes=[];for(t=i.length-1;t>=0;--t)n=new Common.UI.ComboBox({template:_.template(["<div>",\'<div class="resolved"></div>\',\'<div class="btn-resolve-check dropdown-toggle" data-toggle="dropdown">\',this.textResolved,"</div>",\'<span class="comments-caret"></span>\',\'<ul class="dropdown-menu <%= menuCls %>" style="\',"<%= menuStyle %>",\' role="menu">\',"<% _.each(items, function (item) { %>",\'<li id="<%= item.id %>" data-value="<%= item.value %>"><a href="#"><%= scope.getDisplayValue(item) %></a></li>\',"<% }); %>","</ul>","</div>"].join("")),menuStyle:"min-width: 55px; margin-top: -7px; margin-left: -2px; padding: 0 0; right: 6px; left: auto;",data:[{value:1,displayValue:this.textOpenAgain}]}),n.render($(i[t])),n.on("selected",s),this.openComboBoxes.push(n)},hookTextBox:function(){var e=this,t=this.commentsView.getTextBox();t&&t.keydown(function(e){if((e.ctrlKey||e.metaKey)&&e.keyCode==Common.UI.Keys.RETURN){var t=$("#id-comments-change");t&&t.length&&t.click(),e.stopImmediatePropagation()}else if(e.keyCode===Common.UI.Keys.TAB){var n,r,i;i=this.selectionStart,r=this.selectionEnd,n=$(this),n.val(n.val().substring(0,i)+"\t"+n.val().substring(r)),this.selectionStart=this.selectionEnd=i+1,e.stopImmediatePropagation(),e.preventDefault()}})},getFixedQuote:function(e){return Common.Utils.String.ellipsis(Common.Utils.String.htmlEncode(e),120,!0)},getUserName:function(e){return Common.Utils.String.ellipsis(Common.Utils.String.htmlEncode(e),15,!0)},pickLink:function(e){var t=[],n,r;e=Common.Utils.String.htmlEncode(e),e.replace(Common.Utils.emailStrongRe,function(e){return n=arguments[arguments.length-2],t.push({start:n,end:e.length+n,str:\'<a href="\'+e+\'">\'+e+"</a>"}),""}),e.replace(Common.Utils.ipStrongRe,function(e){n=arguments[arguments.length-2],r=e.length;var i=_.find(t,function(e){return n>=e.start&&n<e.end||n<=e.start&&n+r>e.start});return i||t.push({start:n,end:r+n,str:\'<a href="\'+e+\'" target="_blank" data-can-copy="true">\'+e+"</a>"}),""}),e.replace(Common.Utils.hostnameStrongRe,function(e){var i=/(((^https?)|(^ftp)):\\/\\/)/i.test(e)?e:"http://"+e;n=arguments[arguments.length-2],r=e.length;var s=_.find(t,function(e){return n>=e.start&&n<e.end||n<=e.start&&n+r>e.start});return s||t.push({start:n,end:r+n,str:\'<a href="\'+i+\'" target="_blank" data-can-copy="true">\'+e+"</a>"}),""}),t=_.sortBy(t,function(e){return e.start});var i=t.length>0?e.substring(0,t[0].start)+t[0].str:e;for(var s=1;s<t.length;s++)i+=e.substring(t[s-1].end,t[s].start)+t[s].str;return t.length>0&&(i+=e.substring(t[s-1].end,e.length)),i},textComments:"Comments",textAnonym:"Guest",textAddCommentToDoc:"Add Comment to Document",textAddComment:"Add Comment",textCancel:"Cancel",textAddReply:"Add Reply",textReply:"Reply",textClose:"Close",textResolved:"Resolved",textResolve:"Resolve",textEnterCommentHint:"Enter your comment here",textEdit:"Edit",textAdd:"Add",textOpenAgain:"Open Again"},Common.Views.Comments||{}))}),define("text!common/main/lib/template/Chat.template",[],function(){return\'<div id="chat-box">\\r\\n    <div id="chat-users">\\r\\n        <div id="chat-user-ct"></div>\\r\\n    </div>\\r\\n    <div id="chat-messages">\\r\\n        <div id="chat-message-ct"></div>\\r\\n    </div>\\r\\n    <div id="chat-options">\\r\\n        <div id="chat-options-ct">\\r\\n            <textarea id="chat-msg-text"></textarea>\\r\\n            <button id="chat-msg-btn-add" class="btn normal dlg-btn primary"><%=scope.textSend%></button>\\r\\n        </div>\\r\\n    </div>\\r\\n</div>\'});if(Common===undefined)var Common={};Common.Views=Common.Views||{},define("common/main/lib/view/Chat",["text!common/main/lib/template/Chat.template","common/main/lib/util/utils","common/main/lib/component/BaseView"],function(e){Common.Views.Chat=Common.UI.BaseView.extend(_.extend({el:"#left-panel-chat",template:_.template(e),storeUsers:undefined,storeMessages:undefined,tplUser:[\'<li id="chat-user-<%= user.get("id") %>"<% if (!user.get("online")) { %> class="offline"<% } %>>\',\'<div class="color" style="background-color: <%= user.get("color") %>;" >\',\'<label class="name"><%= scope.getUserName(user.get("username")) %></label>\',"</div>","</li>"].join(""),templateUserList:_.template("<ul><% _.each(users, function(item) { %><%= _.template(usertpl, {user: item, scope: scope}) %><% }); %></ul>"),tplMsg:["<li>",\'<% if (msg.get("type")==1) { %>\',\'<div class="message service" data-can-copy="true"><%= msg.get("message") %></div>\',"<% } else { %>",\'<div class="user" data-can-copy="true" style="color: <%= msg.get("usercolor") %>;"><%= scope.getUserName(msg.get("username")) %></div>\',\'<label class="message" data-can-copy="true"><%= msg.get("message") %></label>\',"<% } %>","</li>"].join(""),templateMsgList:_.template("<ul><% _.each(messages, function(item) { %><%= _.template(msgtpl, {msg: item, scope: scope}) %><% }); %></ul>"),events:{},initialize:function(e){_.extend(this,e),Common.UI.BaseView.prototype.initialize.call(this,arguments),this.storeUsers.bind({add:_.bind(this._onAddUser,this),change:_.bind(this._onUsersChanged,this),reset:_.bind(this._onResetUsers,this)}),this.storeMessages.bind({add:_.bind(this._onAddMessage,this),reset:_.bind(this._onResetMessages,this)})},render:function(e){return e=e||this.el,$(e).html(this.template({scope:this})),this.panelUsers=$("#chat-users",this.el),this.panelMessages=$("#chat-messages",this.el),this.txtMessage=$("#chat-msg-text",this.el),this.panelUsers.scroller=new Common.UI.Scroller({el:$("#chat-users"),useKeyboard:!0,minScrollbarLength:25}),this.panelMessages.scroller=new Common.UI.Scroller({el:$("#chat-messages"),includePadding:!0,useKeyboard:!0,minScrollbarLength:40}),$("#chat-msg-btn-add",this.el).on("click",_.bind(this._onBtnAddMessage,this)),this.txtMessage.on("keydown",_.bind(this._onKeyDown,this)),this},focus:function(){var e=this;_.defer(function(){e.txtMessage.focus()},100)},_onKeyDown:function(e){e.keyCode==Common.UI.Keys.RETURN?(e.ctrlKey||e.metaKey)&&this._onBtnAddMessage(e):e.keyCode==Common.UI.Keys.ESC&&this.hide()},_onAddUser:function(e,t,n){this.panelUsers&&(this.panelUsers.find("ul").append(_.template(this.tplUser,{user:e,scope:this})),this.panelUsers.scroller.update({minScrollbarLength:25}))},_onUsersChanged:function(e){e.changed.online!=undefined&&this.panelUsers&&(this.panelUsers.find("#chat-user-"+e.get("id"))[e.changed.online?"removeClass":"addClass"]("offline"),this.panelUsers.scroller.update({minScrollbarLength:25}))},_onResetUsers:function(e,t){this.panelUsers&&(this.panelUsers.html(this.templateUserList({users:e.models,usertpl:this.tplUser,scope:this})),this.panelUsers.scroller.update({minScrollbarLength:25}))},_onAddMessage:function(e,t,n){if(this.panelMessages){var r=this.panelMessages.find("ul");r&&r.length&&(this._prepareMessage(e),r.append(_.template(this.tplMsg,{msg:e,scope:this})),this.panelMessages.scroller.update({minScrollbarLength:40}),this.panelMessages.scroller.scrollTop(r.get(0).getBoundingClientRect().height))}},_onResetMessages:function(e,t){if(this.panelMessages){var n,r;e.each(function(e){this._prepareMessage(e)},this),this.panelMessages.html(this.templateMsgList({messages:e.models,msgtpl:this.tplMsg,scope:this})),this.panelMessages.scroller.update({minScrollbarLength:40})}},_onBtnAddMessage:function(e){this.txtMessage&&(this.fireEvent("message:add",[this,this.txtMessage.val().trim()]),this.txtMessage.val(""),this.focus())},_prepareMessage:function(e){var t=this.storeUsers.findUser(e.get("userid"));e.set({usercolor:t?t.get("color"):"#000",message:this._pickLink(Common.Utils.String.htmlEncode(e.get("message")))},{silent:!0})},_pickLink:function(e){var t=[],n,r;e.replace(Common.Utils.emailStrongRe,function(e){return n=arguments[arguments.length-2],t.push({start:n,end:e.length+n,str:\'<a href="\'+e+\'">\'+e+"</a>"}),""}),e.replace(Common.Utils.ipStrongRe,function(e){n=arguments[arguments.length-2],r=e.length;var i=_.find(t,function(e){return n>=e.start&&n<e.end||n<=e.start&&n+r>e.start});return i||t.push({start:n,end:r+n,str:\'<a href="\'+e+\'" target="_blank" data-can-copy="true">\'+e+"</a>"}),""}),e.replace(Common.Utils.hostnameStrongRe,function(e){var i=/(((^https?)|(^ftp)):\\/\\/)/i.test(e)?e:"http://"+e;n=arguments[arguments.length-2],r=e.length;var s=_.find(t,function(e){return n>=e.start&&n<e.end||n<=e.start&&n+r>e.start});return s||t.push({start:n,end:r+n,str:\'<a href="\'+i+\'" target="_blank" data-can-copy="true">\'+e+"</a>"}),""}),t=_.sortBy(t,function(e){return e.start});var i=t.length>0?e.substring(0,t[0].start)+t[0].str:e;for(var s=1;s<t.length;s++)i+=e.substring(t[s-1].end,t[s].start)+t[s].str;return t.length>0&&(i+=e.substring(t[s-1].end,e.length)),i},getUserName:function(e){return Common.Utils.String.htmlEncode(e)},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments),this.fireEvent("hide",this)},textSend:"Send"},Common.Views.Chat||{}))}),define("common/main/lib/view/SearchDialog",["common/main/lib/component/Window"],function(){Common.UI.SearchDialog=Common.UI.Window.extend(_.extend({options:{width:550,title:"Search & Replace",modal:!1,cls:"search",toolclose:"hide",alias:"SearchDialog"},initialize:function(e){_.extend(this.options,e||{}),this.template=[\'<div class="box">\',\'<div class="input-row">\',\'<span class="btn-placeholder" id="search-placeholder-btn-options"></span>\',\'<input type="text" id="sd-text-search" class="form-control" maxlength="100" placeholder="\'+this.textSearchStart+\'">\',"</div>",\'<div class="input-row">\',\'<input type="text" id="sd-text-replace" class="form-control" maxlength="100" placeholder="\'+this.textReplaceDef+\'">\',"</div>",\'<div class="input-row">\',\'<label class="link" id="search-label-replace" result="replaceshow">\'+this.txtBtnReplace+"</label>","</div>","</div>",\'<div class="separator horizontal"/>\',\'<div class="footer right">\',\'<button class="btn normal dlg-btn" result="replace" style="margin-right: 6px;">\'+this.txtBtnReplace+"</button>",\'<button class="btn normal dlg-btn" result="replaceall" style="margin-right: 10px;">\'+this.txtBtnReplaceAll+"</button>",\'<button class="btn normal dlg-btn iconic" result="back" style="margin-right: 6px;"><span class="icon back" /></button>\',\'<button class="btn normal dlg-btn iconic" result="next"><span class="icon next" /></button>\',"</div>"].join(""),this.options.tpl=_.template(this.template,this.options),Common.UI.Window.prototype.initialize.call(this,this.options)},render:function(){return Common.UI.Window.prototype.render.call(this),this.miMatchCase=new Common.UI.MenuItem({caption:this.textMatchCase,checkable:!0}),this.miMatchWord=new Common.UI.MenuItem({caption:this.options.matchwordstr||this.textWholeWords,checkable:!0}),this.miHighlight=new Common.UI.MenuItem({caption:this.textHighlight,checkable:!0}),this.btnOptions=new Common.UI.Button({id:"search-btn-options",cls:"btn-toolbar btn-toolbar-default",iconCls:"btn-settings",menu:new Common.UI.Menu({items:[this.miMatchCase,this.miMatchWord,this.miHighlight]})}),this.options.extraoptions&&(this.btnOptions.menu.addItem({caption:"--"}),this.options.extraoptions.forEach(function(e){this.btnOptions.menu.addItem(e)},this)),this.btnOptions.render(this.$window.find("#search-placeholder-btn-options")),this.options.matchcase||this.miMatchCase.hide(),this.options.matchword||this.miMatchWord.hide(),this.options.markresult?this.options.markresult.applied&&this.miHighlight.setChecked(!0,!0):this.miHighlight.hide(),this.options.mode==="search"&&$(this.$window.find(".input-row").get(2)).hide(),this.txtSearch=this.$window.find("#sd-text-search"),this.txtReplace=this.$window.find("#sd-text-replace"),this.miHighlight.on("toggle",_.bind(this.onHighlight,this)),this.$window.find(".btn[result=back]").on("click",_.bind(this.onBtnClick,this,"back")),this.$window.find(".btn[result=next]").on("click",_.bind(this.onBtnClick,this,"next")),this.$window.find(".btn[result=replace]").on("click",_.bind(this.onBtnClick,this,"replace")),this.$window.find(".btn[result=replaceall]").on("click",_.bind(this.onBtnClick,this,"replaceall")),this.$window.find("label[result=replaceshow]").on("click",_.bind(this.onShowReplace,this)),this.txtSearch.on("keydown",null,"search",_.bind(this.onKeyPress,this)),this.txtReplace.on("keydown",null,"replace",_.bind(this.onKeyPress,this)),this},show:function(e){Common.UI.Window.prototype.show.call(this),!this.mode&&!e&&(e="search"),e&&this.mode!=e&&this.setMode(e),this.options.markresult&&this.miHighlight.checked&&this.fireEvent("search:highlight",[this,!0]),this.focus()},focus:function(){var e=this;_.delay(function(){e.txtSearch.focus(),e.txtSearch.select()},300)},onKeyPress:function(e){this.isLocked()||(e.keyCode==Common.UI.Keys.RETURN?(e.data=="search"?this.onBtnClick("next",e):e.data=="replace"&&this.mode=="replace"&&this.onBtnClick("replace",e),e.preventDefault(),e.stopPropagation()):e.keyCode==Common.UI.Keys.ESC&&(this.hide(),e.preventDefault(),e.stopPropagation()))},onBtnClick:function(e,t){var n={textsearch:this.txtSearch.val(),textreplace:this.txtReplace.val(),matchcase:this.miMatchCase.checked,matchword:this.miMatchWord.checked,highlight:this.miHighlight.checked};this.fireEvent("search:"+e,[this,n])},setMode:function(e){this.mode=e;var t=this.$window.find(".input-row");e==="no-replace"?(this.setTitle(this.textTitle2),t.eq(1).hide(),t.eq(2).hide(),this.$window.find(".btn[result=replace]").hide(),this.$window.find(".btn[result=replaceall]").hide(),this.options.matchcase||this.options.matchword||this.options.markresult||(this.txtSearch.addClass("clear"),this.btnOptions.hide()),this.setHeight(170)):(this.txtSearch.removeClass("clear"),this.setTitle(this.textTitle),e==="search"?(t.eq(2).show(),t.eq(1).hide(),this.$window.find(".btn[result=replace]").hide(),this.$window.find(".btn[result=replaceall]").hide()):(t.eq(2).hide(),t.eq(1).show(),this.$window.find(".btn[result=replace]").show(),this.$window.find(".btn[result=replaceall]").show()),this.setHeight(200))},onShowReplace:function(e){this.setMode("replace");var t=this;_.defer(function(){t.txtReplace.focus()},300)},onHighlight:function(e,t){this.fireEvent("search:highlight",[this,t])},getSettings:function(){return{textsearch:this.txtSearch.val(),casesensitive:this.miMatchCase.checked,wholewords:this.miMatchWord.checked}},textTitle:"Search & Replace",textTitle2:"Search",txtBtnReplace:"Replace",txtBtnReplaceAll:"Replace All",textMatchCase:"Case sensitive",textWholeWords:"Whole words only",textHighlight:"Highlight results",textReplaceDef:"Enter the replacement text",textSearchStart:"Enter text for search"},Common.UI.SearchDialog||{}))}),define("text!spreadsheeteditor/main/app/template/FileMenu.template",[],function(){return\'<div class="panel-menu">\\r\\n    <li class="fm-first-item"/>\\r\\n    <li id="fm-btn-return" class="fm-btn" />\\r\\n    <li class="devider" />\\r\\n    <li id="fm-btn-save" class="fm-btn" />\\r\\n    <li id="fm-btn-edit" class="fm-btn" />\\r\\n    <li id="fm-btn-download" class="fm-btn" />\\r\\n    <li id="fm-btn-print" class="fm-btn" />\\r\\n    <li class="devider" />\\r\\n    <li id="fm-btn-recent" class="fm-btn" />\\r\\n    <li id="fm-btn-create" class="fm-btn" />\\r\\n    <li class="devider" />\\r\\n    <li id="fm-btn-info" class="fm-btn" />\\r\\n    <li id="fm-btn-rights" class="fm-btn" />\\r\\n    <li class="devider" class="fm-btn" />\\r\\n    <li id="fm-btn-settings" class="fm-btn" />\\r\\n    <li class="devider" />\\r\\n    <li id="fm-btn-help" class="fm-btn" />\\r\\n    <li class="devider" />\\r\\n    <li id="fm-btn-back" class="fm-btn" />\\r\\n</div>\\r\\n<div class="panel-context">\\r\\n    <div id="panel-saveas" class="content-box" />\\r\\n    <div id="panel-recentfiles" class="content-box" />\\r\\n    <div id="panel-createnew" class="content-box" />\\r\\n    <div id="panel-info" class="content-box" />\\r\\n    <div id="panel-rights" class="content-box" />\\r\\n    <div id="panel-settings" class="content-box" />\\r\\n    <div id="panel-help" class="content-box" />\\r\\n</div>\'});if(Common===undefined)var Common={};define("common/main/lib/component/LoadMask",["common/main/lib/component/BaseView"],function(){Common.UI.LoadMask=Common.UI.BaseView.extend(function(){var e,t,n;return{options:{cls:"",style:"",title:"Loading...",owner:document.body},template:_.template([\'<div id="<%= id %>" class="asc-loadmask-body <%= cls %>" role="presentation" tabindex="-1">\',\'<div class="asc-loadmask-image"></div>\',\'<div class="asc-loadmask-title"><%= title %></div>\',"</div>"].join("")),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,e),this.template=this.options.template||this.template,this.cls=this.options.cls,this.style=this.options.style,this.title=this.options.title,this.owner=this.options.owner},render:function(){return this},show:function(){if(t||n)return;e=this.owner instanceof Common.UI.BaseView?$(this.owner.el):$(this.owner);if(e.hasClass("masked"))return this;var r=this;return t=$(\'<div class="asc-loadmask"></div>\'),n=$(this.template({id:r.id,cls:r.cls,style:r.style,title:r.title})),e.addClass("masked"),e.append(t),e.append(n),n.css({top:Math.round(e.height()/2-(n.height()+parseInt(n.css("padding-top"))+parseInt(n.css("padding-bottom")))/2)+"px",left:Math.round(e.width()/2-(n.width()+parseInt(n.css("padding-left"))+parseInt(n.css("padding-right")))/2)+"px"}),Common.util.Shortcuts.suspendEvents(),this},hide:function(){e&&e.removeClass("masked"),t&&t.remove(),n&&n.remove(),t=null,n=null,Common.util.Shortcuts.resumeEvents()},setTitle:function(t){this.title=t,e&&e.hasClass("masked")&&n&&$(".asc-loadmask-title",n).html(t)}}}())}),define("common/main/lib/view/DocumentAccessDialog",["common/main/lib/component/Window","common/main/lib/component/LoadMask"],function(){Common.Views.DocumentAccessDialog=Common.UI.Window.extend(_.extend({initialize:function(e){var t={};_.extend(t,{title:this.textTitle,width:850,height:534,header:!0},e),this.template=[\'<div id="id-sharing-placeholder"></div>\'].join(""),t.tpl=_.template(this.template,t),this.settingsurl=e.settingsurl||"",Common.UI.Window.prototype.initialize.call(this,t)},render:function(){Common.UI.Window.prototype.render.call(this),this.$window.find("> .body").css({height:"auto",overflow:"hidden"});var e=document.createElement("iframe");e.width="100%",e.height=500,e.align="top",e.frameBorder=0,e.scrolling="no",e.onload=_.bind(this._onLoad,this),$("#id-sharing-placeholder").append(e),this.loadMask=new Common.UI.LoadMask({owner:$("#id-sharing-placeholder")}),this.loadMask.setTitle(this.textLoading),this.loadMask.show(),e.src=this.settingsurl,this._bindWindowEvents.call(this)},_bindWindowEvents:function(){var e=this;window.addEventListener?window.addEventListener("message",function(t){e._onWindowMessage(t)},!1):window.attachEvent&&window.attachEvent("onmessage",function(t){e._onWindowMessage(t)})},_onWindowMessage:function(e){if(e&&window.JSON)try{this._onMessage.call(this,window.JSON.parse(e.data))}catch(t){}},_onMessage:function(e){e&&e.needUpdate&&this.trigger("accessrights",this,e.sharingSettings),this.close()},_onLoad:function(){this.loadMask&&this.loadMask.hide()},textTitle:"Sharing Settings",textLoading:"Loading"},Common.Views.DocumentAccessDialog||{}))}),define("spreadsheeteditor/main/app/view/FileMenuPanels",["common/main/lib/view/DocumentAccessDialog"],function(){!SSE.Views.FileMenuPanels&&(SSE.Views.FileMenuPanels={}),SSE.Views.FileMenuPanels.ViewSaveAs=Common.UI.BaseView.extend({el:"#panel-saveas",menu:undefined,formats:[[{name:"XLSX",imgCls:"xlsx",type:c_oAscFileType.XLSX},{name:"ODS",imgCls:"ods",type:c_oAscFileType.ODS}],[{name:"CSV",imgCls:"csv",type:c_oAscFileType.CSV},{name:"HTML",imgCls:"html",type:c_oAscFileType.HTML}]],template:_.template(["<table><tbody>","<% _.each(rows, function(row) { %>","<tr>","<% _.each(row, function(item) { %>",\'<td><span class="btn-doc-format <%= item.imgCls %>" /></td>\',"<% }) %>","</tr>","<% }) %>","</tbody></table>"].join("")),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=e.menu},render:function(){return $(this.el).html(this.template({rows:this.formats})),$(".btn-doc-format",this.el).on("click",_.bind(this.onFormatClick,this)),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:$(this.el),suppressScrollX:!0})),this.flatFormats=_.flatten(this.formats),this},onFormatClick:function(e){var t=/\\s(\\w+)/.exec(e.currentTarget.className);if(t){t=t[1];var n=_.findWhere(this.flatFormats,{imgCls:t});n&&this.menu&&this.menu.fireEvent("saveas:format",[this.menu,n.type])}}}),SSE.Views.FileMenuPanels.Settings=Common.UI.BaseView.extend(_.extend({el:"#panel-settings",menu:undefined,template:_.template([\'<div style="width:100%; height:100%; position: relative;">\',\'<div id="id-settings-menu" style="position: absolute; width:200px; top: 0; bottom: 0;" class="no-padding"></div>\',\'<div id="id-settings-content" style="position: absolute; left: 200px; top: 0; right: 0; bottom: 0;" class="no-padding">\',\'<div id="panel-settings-general" style="width:100%; height:100%;" class="no-padding main-settings-panel active"></div>\',\'<div id="panel-settings-print" style="width:100%; height:100%;" class="no-padding main-settings-panel"></div>\',"</div>","</div>"].join("")),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=e.menu},render:function(){return $(this.el).html(this.template()),this.generalSettings=new SSE.Views.FileMenuPanels.MainSettingsGeneral({menu:this.menu}),this.generalSettings.options={alias:"MainSettingsGeneral"},this.generalSettings.render(),this.printSettings=SSE.getController("Print").getView("MainSettingsPrint"),this.printSettings.menu=this.menu,this.printSettings.render($("#panel-settings-print")),this.viewSettingsPicker=new Common.UI.DataView({el:$("#id-settings-menu"),store:new Common.UI.DataViewStore([{name:this.txtGeneral,panel:this.generalSettings,iconCls:"mnu-settings-general",selected:!0},{name:this.txtPrint,panel:this.printSettings,iconCls:"mnu-print"}]),itemTemplate:_.template([\'<div id="<%= id %>" class="settings-item-wrap">\',\'<div class="settings-icon <%= iconCls %>" style="display: inline-block;" >\',"</div><%= name %>","</div>"].join(""))}),this.viewSettingsPicker.on("item:select",_.bind(function(e,t,n){var r=n.get("panel");$("#id-settings-content > div").removeClass("active"),r.$el.addClass("active"),r.show()},this)),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments);var e=this.viewSettingsPicker.getSelectedRec();e[0]&&e[0].get("panel").show()},setMode:function(e){this.mode=e,this.generalSettings&&this.generalSettings.setMode(this.mode)},txtGeneral:"General",txtPrint:"Print"},SSE.Views.FileMenuPanels.Settings||{})),SSE.Views.MainSettingsPrint=Common.UI.BaseView.extend(_.extend({menu:undefined,template:_.template([\'<table class="main"><tbody>\',"<tr>",\'<td class="left"><label><%= scope.textSettings %></label></td>\',\'<td class="right"><div id="advsettings-print-combo-sheets" class="input-group-nr" /></td>\',"</tr>",\'<tr class="divider"></tr>\',\'<tr class="divider"></tr>\',"<tr>",\'<td class="left"><label><%= scope.textPageSize %></label></td>\',\'<td class="right"><div id="advsettings-print-combo-pages" class="input-group-nr" /></td>\',"</tr>",\'<tr class="divider"></tr>\',"<tr>",\'<td class="left"><label><%= scope.textPageOrientation %></label></td>\',\'<td class="right"><span id="advsettings-print-combo-orient" /></td>\',"</tr>",\'<tr class="divider"></tr>\',"<tr>",\'<td class="left" style="vertical-align: top;"><label><%= scope.strMargins %></label></td>\',\'<td class="right" style="vertical-align: top;"><div id="advsettings-margins">\',\'<table cols="2" class="no-padding">\',"<tr>","<td><label><%= scope.strTop %></label></td>","<td><label><%= scope.strBottom %></label></td>","</tr>","<tr>",\'<td><div id="advsettings-spin-margin-top"></div></td>\',\'<td><div id="advsettings-spin-margin-bottom"></div></td>\',"</tr>","<tr>","<td><label><%= scope.strLeft %></label></td>","<td><label><%= scope.strRight %></label></td>","</tr>","<tr>",\'<td><div id="advsettings-spin-margin-left"></div></td>\',\'<td><div id="advsettings-spin-margin-right"></div></td>\',"</tr>","</table>","</div></td>","</tr>",\'<tr class="divider"></tr>\',"<tr>",\'<td class="left" style="vertical-align: top;"><label><%= scope.strPrint %></label></td>\',\'<td class="right" style="vertical-align: top;"><div id="advsettings-print">\',\'<div id="advsettings-print-chb-grid" style="margin-bottom: 10px;"/>\',\'<div id="advsettings-print-chb-rows"/>\',"</div></td>","</tr>",\'<tr class="divider"></tr>\',\'<tr class="divider"></tr>\',"<tr>",\'<td class="left"></td>\',\'<td class="right"><button id="advsettings-print-button-save" class="btn normal dlg-btn primary"><%= scope.okButtonText %></button></td>\',"</tr>","</tbody></table>"].join("")),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=e.menu,this.spinners=[],this._initSettings=!0},render:function(e){return e&&this.setElement(e,!1),$(this.el).html(this.template({scope:this})),this.cmbSheet=new Common.UI.ComboBox({el:$("#advsettings-print-combo-sheets"),style:"width: 260px;",menuStyle:"min-width: 260px;max-height: 280px;",editable:!1,cls:"input-group-nr",data:[{value:-255,displayValue:this.strAllSheets}]}),this.cmbPaperSize=new Common.UI.ComboBox({el:$("#advsettings-print-combo-pages"),style:"width: 260px;",menuStyle:"max-height: 280px; min-width: 260px;",editable:!1,cls:"input-group-nr",data:[{value:"215.9|279.4",displayValue:"US Letter (21,59cm x 27,94cm)"},{value:"215.9|355.6",displayValue:"US Legal (21,59cm x 35,56cm)"},{value:"210|297",displayValue:"A4 (21cm x 29,7cm)"},{value:"148.1|209.9",displayValue:"A5 (14,81cm x 20,99cm)"},{value:"176|250.1",displayValue:"B5 (17,6cm x 25,01cm)"},{value:"104.8|241.3",displayValue:"Envelope #10 (10,48cm x 24,13cm)"},{value:"110.1|220.1",displayValue:"Envelope DL (11,01cm x 22,01cm)"},{value:"279.4|431.7",displayValue:"Tabloid (27,94cm x 43,17cm)"},{value:"297|420.1",displayValue:"A3 (29,7cm x 42,01cm)"},{value:"304.8|457.1",displayValue:"Tabloid Oversize (30,48cm x 45,71cm)"},{value:"196.8|273",displayValue:"ROC 16K (19,68cm x 27,3cm)"},{value:"119.9|234.9",displayValue:"Envelope Choukei 3 (11,99cm x 23,49cm)"},{value:"330.2|482.5",displayValue:"Super B/A3 (33,02cm x 48,25cm)"}]}),this.cmbPaperOrientation=new Common.UI.ComboBox({el:$("#advsettings-print-combo-orient"),style:"width: 200px;",menuStyle:"min-width: 200px;",editable:!1,cls:"input-group-nr",data:[{value:c_oAscPageOrientation.PagePortrait,displayValue:this.strPortrait},{value:c_oAscPageOrientation.PageLandscape,displayValue:this.strLandscape}]}),this.chPrintGrid=new Common.UI.CheckBox({el:$("#advsettings-print-chb-grid"),labelText:this.textPrintGrid}),this.chPrintRows=new Common.UI.CheckBox({el:$("#advsettings-print-chb-rows"),labelText:this.textPrintHeadings}),this.spnMarginTop=new Common.UI.MetricSpinner({el:$("#advsettings-spin-margin-top"),step:.1,width:90,defaultUnit:"cm",value:"0 cm",maxValue:48.25,minValue:0}),this.spinners.push(this.spnMarginTop),this.spnMarginBottom=new Common.UI.MetricSpinner({el:$("#advsettings-spin-margin-bottom"),step:.1,width:90,defaultUnit:"cm",value:"0 cm",maxValue:48.25,minValue:0}),this.spinners.push(this.spnMarginBottom),this.spnMarginLeft=new Common.UI.MetricSpinner({el:$("#advsettings-spin-margin-left"),step:.1,width:90,defaultUnit:"cm",value:"0.19 cm",maxValue:48.25,minValue:0}),this.spinners.push(this.spnMarginLeft),this.spnMarginRight=new Common.UI.MetricSpinner({el:$("#advsettings-spin-margin-right"),step:.1,width:90,defaultUnit:"cm",value:"0.19 cm",maxValue:48.25,minValue:0}),this.spinners.push(this.spnMarginRight),this.btnOk=new Common.UI.Button({el:"#advsettings-print-button-save"}),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:$(this.el),suppressScrollX:!0})),this.fireEvent("render:after",this),this},updateMetricUnit:function(){if(this.spinners)for(var e=0;e<this.spinners.length;e++){var t=this.spinners[e];t.setDefaultUnit(Common.Utils.Metric.metricName[Common.Utils.Metric.getCurrentMetric()]),t.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.cm?.1:1)}},applySettings:function(){this.menu&&this.menu.fireEvent("settings:apply",[this.menu])},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this._initSettings&&(this.updateMetricUnit(),this._initSettings=!1),this.fireEvent("show",this)},okButtonText:"Save",strPortrait:"Portrait",strLandscape:"Landscape",textPrintGrid:"Print Gridlines",textPrintHeadings:"Print Rows and Columns Headings",strLeft:"Left",strRight:"Right",strTop:"Top",strBottom:"Bottom",strMargins:"Margins",textPageSize:"Page Size",textPageOrientation:"Page Orientation",strPrint:"Print",textSettings:"Settings for"},SSE.Views.MainSettingsPrint||{})),SSE.Views.FileMenuPanels.MainSettingsGeneral=Common.UI.BaseView.extend(_.extend({el:"#panel-settings-general",menu:undefined,template:_.template([\'<table class="main"><tbody>\',\'<tr class="coauth">\',\'<td class="left"><label><%= scope.txtLiveComment %></label></td>\',\'<td class="right"><div id="fms-chb-live-comment"/></td>\',"</tr>",\'<tr class="divider coauth"></tr>\',\'<tr class="autosave">\',\'<td class="left"><label><%= scope.textAutoSave %></label></td>\',\'<td class="right"><span id="fms-chb-autosave" /></td>\',"</tr>",\'<tr class="divider autosave"></tr>\',"<tr>",\'<td class="left"><label><%= scope.strZoom %></label></td>\',\'<td class="right"><div id="fms-cmb-zoom" class="input-group-nr" /></td>\',"</tr>",\'<tr class="divider"></tr>\',"<tr>",\'<td class="left"><label><%= scope.strFontRender %></label></td>\',\'<td class="right"><span id="fms-cmb-font-render" /></td>\',"</tr>",\'<tr class="divider"></tr>\',\'<tr class="edit">\',\'<td class="left"><label><%= scope.strUnit %></label></td>\',\'<td class="right"><span id="fms-cmb-unit" /></td>\',"</tr>",\'<tr class="divider edit"></tr>\',"<tr>",\'<td class="left"></td>\',\'<td class="right"><button id="fms-btn-apply" class="btn normal dlg-btn primary"><%= scope.okButtonText %></button></td>\',"</tr>","</tbody></table>"].join("")),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=e.menu},render:function(){return $(this.el).html(this.template({scope:this})),this.chLiveComment=new Common.UI.CheckBox({el:$("#fms-chb-live-comment"),labelText:this.strLiveComment}),this.cmbZoom=new Common.UI.ComboBox({el:$("#fms-cmb-zoom"),style:"width: 160px;",editable:!1,cls:"input-group-nr",data:[{value:50,displayValue:"50%"},{value:60,displayValue:"60%"},{value:70,displayValue:"70%"},{value:80,displayValue:"80%"},{value:90,displayValue:"90%"},{value:100,displayValue:"100%"},{value:110,displayValue:"110%"},{value:120,displayValue:"120%"},{value:150,displayValue:"150%"},{value:175,displayValue:"175%"},{value:200,displayValue:"200%"}]}),this.cmbFontRender=new Common.UI.ComboBox({el:$("#fms-cmb-font-render"),style:"width: 160px;",editable:!1,cls:"input-group-nr",data:[{value:c_oAscFontRenderingModeType.hintingAndSubpixeling,displayValue:this.txtWin},{value:c_oAscFontRenderingModeType.noHinting,displayValue:this.txtMac},{value:c_oAscFontRenderingModeType.hinting,displayValue:this.txtNative}]}),this.chAutosave=new Common.UI.CheckBox({el:$("#fms-chb-autosave"),labelText:this.strAutosave}),this.cmbUnit=new Common.UI.ComboBox({el:$("#fms-cmb-unit"),style:"width: 160px;",editable:!1,cls:"input-group-nr",data:[{value:Common.Utils.Metric.c_MetricUnits.cm,displayValue:this.txtCm},{value:Common.Utils.Metric.c_MetricUnits.pt,displayValue:this.txtPt}]}),this.btnApply=new Common.UI.Button({el:"#fms-btn-apply"}),this.btnApply.on("click",_.bind(this.applySettings,this)),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:$(this.el),suppressScrollX:!0})),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments),this.updateSettings()},setMode:function(e){$("tr.autosave",this.el)[e.isEdit&&e.canAutosave?"show":"hide"](),$("tr.coauth",this.el)[e.canCoAuthoring&&e.isEdit?"show":"hide"]()},updateSettings:function(){var e=window.localStorage.getItem("sse-settings-zoom"),t=this.cmbZoom.store.findWhere({value:parseInt(e)});this.cmbZoom.setValue(t?parseInt(t.get("value")):100),e=window.localStorage.getItem("sse-settings-livecomment"),this.chLiveComment.setValue(e===null||parseInt(e)!=0),e=window.localStorage.getItem("sse-settings-fontrender"),t=this.cmbFontRender.store.findWhere({value:parseInt(e)}),this.cmbFontRender.setValue(t?t.get("value"):window.devicePixelRatio>1?c_oAscFontRenderingModeType.noHinting:c_oAscFontRenderingModeType.hintingAndSubpixeling),e=window.localStorage.getItem("sse-settings-unit"),t=this.cmbUnit.store.findWhere({value:parseInt(e)}),this.cmbUnit.setValue(t?parseInt(t.get("value")):0),this._oldUnits=this.cmbUnit.getValue(),e=window.localStorage.getItem("sse-settings-autosave"),this.chAutosave.setValue(e===null||parseInt(e)==1)},applySettings:function(){window.localStorage.setItem("sse-settings-zoom",this.cmbZoom.getValue()),window.localStorage.setItem("sse-settings-livecomment",this.chLiveComment.isChecked()?1:0),window.localStorage.setItem("sse-settings-fontrender",this.cmbFontRender.getValue()),window.localStorage.setItem("sse-settings-unit",this.cmbUnit.getValue()),window.localStorage.setItem("sse-settings-autosave",this.chAutosave.isChecked()?1:0),this.menu&&(this.menu.fireEvent("settings:apply",[this.menu]),this._oldUnits!==this.cmbUnit.getValue()&&Common.NotificationCenter.trigger("settings:unitschanged",this))},strLiveComment:"Turn on option",strZoom:"Default Zoom Value",okButtonText:"Apply",txtLiveComment:"Live Commenting",txtWin:"as Windows",txtMac:"as OS X",txtNative:"Native",strFontRender:"Font Hinting",strUnit:"Unit of Measurement",txtCm:"Centimeter",txtPt:"Point",strAutosave:"Turn on autosave",textAutoSave:"Autosave"},SSE.Views.FileMenuPanels.MainSettingsGeneral||{})),SSE.Views.FileMenuPanels.RecentFiles=Common.UI.BaseView.extend({el:"#panel-recentfiles",menu:undefined,template:_.template([\'<div id="id-recent-view" style="margin: 20px 0;"></div>\'].join("")),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=e.menu,this.recent=e.recent},render:function(){return $(this.el).html(this.template()),this.viewRecentPicker=new Common.UI.DataView({el:$("#id-recent-view"),store:new Common.UI.DataViewStore(this.recent),itemTemplate:_.template([\'<div class="recent-wrap">\',\'<div class="recent-icon"></div>\',\'<div class="file-name"><%= Common.Utils.String.htmlEncode(title) %></div>\',\'<div class="file-info"><%= Common.Utils.String.htmlEncode(folder) %></div>\',"</div>"].join(""))}),this.viewRecentPicker.on("item:click",_.bind(this.onRecentFileClick,this)),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:$(this.el),suppressScrollX:!0})),this},onRecentFileClick:function(e,t,n){this.menu&&this.menu.fireEvent("recent:open",[this.menu,n.get("url")])}}),SSE.Views.FileMenuPanels.CreateNew=Common.UI.BaseView.extend(_.extend({el:"#panel-createnew",menu:undefined,events:function(){return{"click .blank-document-btn":_.bind(this._onBlankDocument,this),"click .thumb-list .thumb-wrap":_.bind(this._onDocumentTemplate,this)}},template:_.template([\'<h3 style="margin-top: 20px;"><%= scope.fromBlankText %></h3><hr noshade />\',\'<div class="blank-document">\',\'<div class="blank-document-btn"></div>\',\'<div class="blank-document-info">\',"<h3><%= scope.newDocumentText %></h3>","<%= scope.newDescriptionText %>","</div>","</div>","<h3><%= scope.fromTemplateText %></h3><hr noshade />",\'<div class="thumb-list">\',"<% _.each(docs, function(item) { %>",\'<div class="thumb-wrap" template="<%= item.name %>">\',\'<div class="thumb"<% if (!_.isEmpty(item.icon)) { %> style="background-image: url(<%= item.icon %>);" <% } %> />\',\'<div class="title"><%= item.name %></div>\',"</div>","<% }) %>","</div>"].join("")),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=e.menu},render:function(){return $(this.el).html(this.template({scope:this,docs:this.options[0].docs})),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:$(this.el),suppressScrollX:!0})),this},_onBlankDocument:function(){this.menu&&this.menu.fireEvent("create:new",[this.menu,"blank"])},_onDocumentTemplate:function(e){this.menu&&this.menu.fireEvent("create:new",[this.menu,e.currentTarget.attributes.template.value])},fromBlankText:"From Blank",newDocumentText:"New Spreadsheet",newDescriptionText:"Create a new blank text document which you will be able to style and format after it is created during the editing. Or choose one of the templates to start a document of a certain type or purpose where some styles have already been pre-applied.",fromTemplateText:"From Template"},SSE.Views.FileMenuPanels.CreateNew||{})),SSE.Views.FileMenuPanels.DocumentInfo=Common.UI.BaseView.extend(_.extend({el:"#panel-info",menu:undefined,initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.rendered=!1,this.template=_.template([\'<table class="main">\',"<tr>",\'<td class="left"><label>\'+this.txtTitle+"</label></td>",\'<td class="right"><label id="id-info-title">-</label></td>\',"</tr>",\'<tr class="author">\',\'<td class="left"><label>\'+this.txtAuthor+"</label></td>",\'<td class="right"><span class="userLink" id="id-info-author">-</span></td>\',"</tr>",\'<tr class="placement">\',\'<td class="left"><label>\'+this.txtPlacement+"</label></td>",\'<td class="right"><label id="id-info-placement">-</label></td>\',"</tr>",\'<tr class="date">\',\'<td class="left"><label>\'+this.txtDate+"</label></td>",\'<td class="right"><label id="id-info-date">-</label></td>\',"</tr>",\'<tr class="divider date"></tr>\',"</table>"].join("")),this.menu=e.menu},render:function(){return $(this.el).html(this.template()),this.lblTitle=$("#id-info-title"),this.lblPlacement=$("#id-info-placement"),this.lblDate=$("#id-info-date"),this.lblAuthor=$("#id-info-author"),this.rendered=!0,this.updateInfo(this.doc),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:$(this.el),suppressScrollX:!0})),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments)},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments)},updateInfo:function(e){this.doc=e;if(!this.rendered)return;e=e||{},this.lblTitle.text(e.title?e.title:"-"),e.info?(e.info.author&&this.lblAuthor.text(e.info.author),this._ShowHideInfoItem("author",e.info.author!==undefined&&e.info.author!==null),e.info.created&&this.lblDate.text(e.info.created),this._ShowHideInfoItem("date",e.info.created!==undefined&&e.info.created!==null),e.info.folder&&this.lblPlacement.text(e.info.folder),this._ShowHideInfoItem("placement",e.info.folder!==undefined&&e.info.folder!==null)):this._ShowHideDocInfo(!1)},_ShowHideInfoItem:function(e,t){$("tr."+e,this.el)[t?"show":"hide"]()},_ShowHideDocInfo:function(e){this._ShowHideInfoItem("date",e),this._ShowHideInfoItem("placement",e),this._ShowHideInfoItem("author",e)},setMode:function(e){return this},txtTitle:"Document Title",txtAuthor:"Author",txtPlacement:"Placement",txtDate:"Creation Date"},SSE.Views.FileMenuPanels.DocumentInfo||{})),SSE.Views.FileMenuPanels.DocumentRights=Common.UI.BaseView.extend(_.extend({el:"#panel-rights",menu:undefined,initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.rendered=!1,this.template=_.template([\'<table class="main">\',\'<tr class="rights">\',\'<td class="left" style="vertical-align: top;"><label>\'+this.txtRights+"</label></td>",\'<td class="right"><div id="id-info-rights"></div></td>\',"</tr>",\'<tr class="edit-rights">\',\'<td class="left"></td><td class="right"><button id="id-info-btn-edit" class="btn normal dlg-btn primary" style="margin-right: 10px;width: auto;">\'+this.txtBtnAccessRights+"</button></td>","</tr>","</table>"].join("")),this.templateRights=_.template(["<table>","<% _.each(users, function(item) { %>","<tr>",\'<td><span class="userLink"><%= Common.Utils.String.htmlEncode(item.user) %></span></td>\',"<td><%= Common.Utils.String.htmlEncode(item.permissions) %></td>","</tr>","<% }); %>","</table>"].join("")),this.menu=e.menu},render:function(){return $(this.el).html(this.template()),this.cntRights=$("#id-info-rights"),this.btnEditRights=new Common.UI.Button({el:"#id-info-btn-edit"}),this.btnEditRights.on("click",_.bind(this.changeAccessRights,this)),this.rendered=!0,this.updateInfo(this.doc),_.isUndefined(this.scroller)&&(this.scroller=new Common.UI.Scroller({el:$(this.el),suppressScrollX:!0})),this},show:function(){Common.UI.BaseView.prototype.show.call(this,arguments)},hide:function(){Common.UI.BaseView.prototype.hide.call(this,arguments)},updateInfo:function(e){this.doc=e;if(!this.rendered)return;e=e||{},e.info?(e.info.sharingSettings&&this.cntRights.html(this.templateRights({users:e.info.sharingSettings})),this._ShowHideInfoItem("rights",e.info.sharingSettings!==undefined&&e.info.sharingSettings!==null&&e.info.sharingSettings.length>0),this._ShowHideInfoItem("edit-rights",!!this.sharingSettingsUrl&&this.sharingSettingsUrl.length&&this._readonlyRights!==!0)):this._ShowHideDocInfo(!1)},_ShowHideInfoItem:function(e,t){$("tr."+e,this.el)[t?"show":"hide"]()},_ShowHideDocInfo:function(e){this._ShowHideInfoItem("rights",e),this._ShowHideInfoItem("edit-rights",e)},setMode:function(e){return this.sharingSettingsUrl=e.sharingSettingsUrl,this},changeAccessRights:function(e,t,n){if(this._docAccessDlg)return;var r=this;r._docAccessDlg=new Common.Views.DocumentAccessDialog({settingsurl:this.sharingSettingsUrl}),r._docAccessDlg.on("accessrights",function(e,t){r.doc.info.sharingSettings=t,r._ShowHideInfoItem("rights",r.doc.info.sharingSettings!==undefined&&r.doc.info.sharingSettings!==null&&r.doc.info.sharingSettings.length>0),r.cntRights.html(r.templateRights({users:r.doc.info.sharingSettings}))}).on("close",function(e){r._docAccessDlg=undefined}),r._docAccessDlg.show()},onLostEditRights:function(){this._readonlyRights=!0;if(!this.rendered)return;this._ShowHideInfoItem("edit-rights",!1)},txtRights:"Persons who have rights",txtBtnAccessRights:"Change access rights"},SSE.Views.FileMenuPanels.DocumentRights||{})),SSE.Views.FileMenuPanels.Help=Common.UI.BaseView.extend({el:"#panel-help",menu:undefined,template:_.template([\'<div style="width:100%; height:100%; position: relative;">\',\'<div id="id-help-contents" style="position: absolute; width:200px; top: 0; bottom: 0;" class="no-padding"></div>\',\'<div id="id-help-frame" style="position: absolute; left: 200px; top: 0; righ

]]></string> </value>
        </item>
        <item>
            <key> <string>next</string> </key>
            <value>
              <persistent> <string encoding="base64">AAAAAAAAAA4=</string> </persistent>
            </value>
        </item>
      </dictionary>
    </pickle>
  </record>
  <record id="14" aka="AAAAAAAAAA4=">
    <pickle>
      <global name="Pdata" module="OFS.Image"/>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>data</string> </key>
            <value> <string encoding="cdata"><![CDATA[

t: 0; bottom: 0;" class="no-padding"></div>\',"</div>"].join("")),initialize:function(e){Common.UI.BaseView.prototype.initialize.call(this,arguments),this.menu=e.menu,this.urlPref="resources/help/en/",this.itemclicked=!1,this.en_data=[{src:"UsageInstructions/OpenCreateNew.htm",name:"Create a new spreadsheet or open an existing one",headername:"Usage Instructions",selected:!0},{src:"UsageInstructions/ManageSheets.htm",name:"Manage sheets"},{src:"UsageInstructions/InsertDeleteCells.htm",name:"Insert or delete cells, rows, and columns"},{src:"UsageInstructions/CopyPasteData.htm",name:"Copy and paste data"},{src:"UsageInstructions/FontTypeSizeStyle.htm",name:"Set font type, size, style, and colors"},{src:"UsageInstructions/AlignText.htm",name:"Align data in cells"},{src:"UsageInstructions/AddBorders.htm",name:"Add borders"},{src:"UsageInstructions/MergeCells.htm",name:"Merge cells"},{src:"UsageInstructions/ClearFormatting.htm",name:"Clear text, format in a cell"},{src:"UsageInstructions/SortData.htm",name:"Sort data"},{src:"UsageInstructions/InsertFunction.htm",name:"Insert function"},{src:"UsageInstructions/ChangeNumberFormat.htm",name:"Change number format"},{src:"UsageInstructions/UndoRedo.htm",name:"Undo/redo your actions"},{src:"UsageInstructions/ViewDocInfo.htm",name:"View file information"},{src:"UsageInstructions/SavePrintDownload.htm",name:"Save/print/download your spreadsheet"},{src:"HelpfulHints/About.htm",name:"About ONLYOFFICE Spreadsheet Editor",headername:"Helpful Hints"},{src:"HelpfulHints/SupportedFormats.htm",name:"Supported Formats of Spreadsheets"},{src:"HelpfulHints/Navigation.htm",name:"Navigation through Your Spreadsheet"},{src:"HelpfulHints/Search.htm",name:"Search Function"},{src:"HelpfulHints/KeyboardShortcuts.htm",name:"Keyboard Shortcuts"}],Common.Utils.isIE&&(window.onhelp=function(){return!1})},render:function(){return $(this.el).html(this.template()),this.viewHelpPicker=new Common.UI.DataView({el:$("#id-help-contents"),store:new Common.UI.DataViewStore([]),keyMoveDirection:"vertical",itemTemplate:_.template([\'<div id="<%= id %>" class="help-item-wrap">\',\'<div class="caption"><%= name %></div>\',"</div>"].join(""))}),this.viewHelpPicker.on("item:add",_.bind(function(e,t,n){n.has("headername")&&$(t.el).before(\'<div class="header-name">\'+n.get("headername")+"</div>")},this)),this.viewHelpPicker.on("item:select",_.bind(function(e,t,n){this.itemclicked=!0,this.iFrame.src=this.urlPref+n.get("src")},this)),this.iFrame=document.createElement("iframe"),this.iFrame.src="",this.iFrame.align="top",this.iFrame.frameBorder="0",this.iFrame.width="100%",this.iFrame.height="100%",this.iFrame.onload=_.bind(function(){if(!this.itemclicked){var e=arguments[0].currentTarget.contentDocument.URL,t=this.viewHelpPicker.store.find(function(t){return e.indexOf(t.get("src"))>0});t&&(this.viewHelpPicker.selectRecord(t,!0),this.viewHelpPicker.scrollToRecord(t))}this.itemclicked=!1},this),$("#id-help-frame").append(this.iFrame),this},setLangConfig:function(e){var t=this,n=this.viewHelpPicker.store;if(e){e=e.split("-")[0];var r={dataType:"json",error:function(){t.urlPref.indexOf("resources/help/en/")<0?(t.urlPref="resources/help/en/",n.url="resources/help/en/Contents.json",n.fetch(r)):(t.urlPref="resources/help/en/",n.reset(t.en_data))},success:function(){var e=n.at(0);t.viewHelpPicker.selectRecord(e),t.iFrame.src=t.urlPref+e.get("src")}};n.url="resources/help/"+e+"/Contents.json",n.fetch(r),this.urlPref="resources/help/"+e+"/"}},show:function(){Common.UI.BaseView.prototype.show.call(this),this._scrollerInited||(this.viewHelpPicker.scroller.update(),this._scrollerInited=!0)}})}),define("spreadsheeteditor/main/app/view/FileMenu",["text!spreadsheeteditor/main/app/template/FileMenu.template","underscore","common/main/lib/component/BaseView"],function(e,t){SSE.Views.FileMenu=Common.UI.BaseView.extend(t.extend({el:"#file-menu-panel",template:t.template(e),events:function(){return{"click .fm-btn":t.bind(function(e){var n=$(e.currentTarget);n.hasClass("active")||($(".fm-btn",this.el).removeClass("active"),n.addClass("active"));var r=t.findWhere(this.items,{el:e.currentTarget});if(r){var i=this.panels[r.options.action];this.fireEvent("item:click",[this,r.options.action,!!i]),i&&(this.$el.find(".content-box:visible").hide(),this.active=r.options.action,i.show())}},this)}},initialize:function(){},render:function(){this.$el=$(this.el),this.$el.html(this.template()),this.items=[],this.items.push(new Common.UI.MenuItem({el:$("#fm-btn-return",this.el),action:"back",caption:this.btnReturnCaption,canFocused:!1}),new Common.UI.MenuItem({el:$("#fm-btn-save",this.el),action:"save",caption:this.btnSaveCaption,canFocused:!1}),new Common.UI.MenuItem({el:$("#fm-btn-edit",this.el),action:"edit",caption:this.btnToEditCaption,canFocused:!1}),new Common.UI.MenuItem({el:$("#fm-btn-download",this.el),action:"saveas",caption:this.btnDownloadCaption,canFocused:!1}),new Common.UI.MenuItem({el:$("#fm-btn-print",this.el),action:"print",caption:this.btnPrintCaption,canFocused:!1}),new Common.UI.MenuItem({el:$("#fm-btn-recent",this.el),action:"recent",caption:this.btnRecentFilesCaption,canFocused:!1}),new Common.UI.MenuItem({el:$("#fm-btn-create",this.el),action:"new",caption:this.btnCreateNewCaption,canFocused:!1}),new Common.UI.MenuItem({el:$("#fm-btn-info",this.el),action:"info",caption:this.btnInfoCaption,canFocused:!1}),new Common.UI.MenuItem({el:$("#fm-btn-rights",this.el),action:"rights",caption:this.btnRightsCaption,canFocused:!1}),new Common.UI.MenuItem({el:$("#fm-btn-settings",this.el),action:"opts",caption:this.btnSettingsCaption,canFocused:!1}),new Common.UI.MenuItem({el:$("#fm-btn-help",this.el),action:"help",caption:this.btnHelpCaption,canFocused:!1}),new Common.UI.MenuItem({el:$("#fm-btn-back",this.el),action:"exit",caption:this.btnBackCaption,canFocused:!1}));var e=this;return this.panels={},require(["spreadsheeteditor/main/app/view/FileMenuPanels"],function(){e.panels={saveas:(new SSE.Views.FileMenuPanels.ViewSaveAs({menu:e})).render(),opts:(new SSE.Views.FileMenuPanels.Settings({menu:e})).render(),info:(new SSE.Views.FileMenuPanels.DocumentInfo({menu:e})).render(),rights:(new SSE.Views.FileMenuPanels.DocumentRights({menu:e})).render(),help:(new SSE.Views.FileMenuPanels.Help({menu:e})).render()},e.$el.find(".content-box").hide()}),this},show:function(e){if(this.isVisible()&&e===undefined)return;e||(e=this.active||(this.mode.canDownload?"saveas":"info")),this.$el.show(),this.selectMenu(e),this.mode.isEdit&&SSE.getController("Toolbar").DisableToolbar(!0),this.api.asc_enableKeyEvents(!1)},hide:function(){this.$el.hide(),this.mode.isEdit&&SSE.getController("Toolbar").DisableToolbar(!1),this.api.asc_enableKeyEvents(!0)},applyMode:function(){this.items[5][this.mode.canOpenRecent?"show":"hide"](),this.items[6][this.mode.canCreateNew?"show":"hide"](),this.items[6].$el.find("+.devider")[this.mode.canCreateNew?"show":"hide"](),this.items[3][this.mode.canDownload?"show":"hide"](),this.items[1][this.mode.isEdit?"show":"hide"](),this.items[2][!this.mode.isEdit&&this.mode.canEdit?"show":"hide"](),this.items[8][this.document&&this.document.info&&(this.document.info.sharingSettings&&this.document.info.sharingSettings.length>0||this.mode.sharingSettingsUrl&&this.mode.sharingSettingsUrl.length)?"show":"hide"](),this.items[9][this.mode.isEdit?"show":"hide"](),this.items[9].$el.find("+.devider")[this.mode.isEdit?"show":"hide"](),this.panels.opts.setMode(this.mode),this.panels.info.setMode(this.mode).updateInfo(this.document),this.panels.rights.setMode(this.mode).updateInfo(this.document),this.mode.canCreateNew&&this.mode.templates&&this.mode.templates.length&&($("a",this.items[6].$el).text(this.btnCreateNewCaption+"..."),this.panels["new"]=(new SSE.Views.FileMenuPanels.CreateNew({menu:this,docs:this.mode.templates})).render()),this.mode.canOpenRecent&&this.mode.recent&&(this.panels.recent=(new SSE.Views.FileMenuPanels.RecentFiles({menu:this,recent:this.mode.recent})).render()),this.panels.help.setLangConfig(this.mode.lang)},setMode:function(e,t){e.isDisconnected?(this.mode.canEdit=this.mode.isEdit=!1,this.mode.canOpenRecent=this.mode.canCreateNew=!1):this.mode=e,t||this.applyMode()},setApi:function(e){this.api=e},loadDocument:function(e){this.document=e.doc},selectMenu:function(e){if(e){var t=this._getMenuItem(e),n=this.panels[e];t&&n&&($(".fm-btn",this.el).removeClass("active"),t.$el.addClass("active"),this.$el.find(".content-box:visible").hide(),n.show(),this.active=e)}},_getMenuItem:function(e){return t.find(this.items,function(t){return t.options.action==e})},btnSaveCaption:"Save",btnDownloadCaption:"Download as...",btnInfoCaption:"Document Info...",btnRightsCaption:"Access Rights...",btnCreateNewCaption:"Create New",btnRecentFilesCaption:"Open Recent...",btnPrintCaption:"Print",btnHelpCaption:"Help...",btnReturnCaption:"Back to Document",btnToEditCaption:"Edit Document",btnBackCaption:"Maximize (Minimize)",btnSettingsCaption:"Advanced Settings..."},SSE.Views.FileMenu||{}))}),define("spreadsheeteditor/main/app/view/LeftMenu",["text!spreadsheeteditor/main/app/template/LeftMenu.template","jquery","underscore","backbone","common/main/lib/component/Button","common/main/lib/view/About","common/main/lib/view/Comments","common/main/lib/view/Chat","common/main/lib/view/SearchDialog","spreadsheeteditor/main/app/view/FileMenu"],function(e,t,n,r){var i=40,s=300;SSE.Views.LeftMenu=r.View.extend(n.extend({el:"#left-menu",template:n.template(e),events:function(){return{"click #left-btn-comments":n.bind(this.onCoauthOptions,this),"click #left-btn-chat":n.bind(this.onCoauthOptions,this),"click #left-btn-support":function(){var e=this.mode.customization;!e||!e.feedback||!e.feedback.url?window.open("http://feedback.onlyoffice.com/"):window.open(e.feedback.url)}}},initialize:function(){this.minimizedMode=!0},render:function(){var e=t(this.el);e.html(this.template({})),this.btnFile=new Common.UI.Button({action:"file",el:t("#left-btn-file",this.el),hint:this.tipFile+Common.Utils.String.platformKey("Alt+F"),enableToggle:!0,disabled:!0,toggleGroup:"leftMenuGroup"}),this.btnSearch=new Common.UI.Button({action:"search",el:t("#left-btn-search",this.el),hint:this.tipSearch+Common.Utils.String.platformKey("Ctrl+F"),disabled:!0,enableToggle:!0}),this.btnAbout=new Common.UI.Button({action:"about",el:t("#left-btn-about",this.el),hint:this.tipAbout,enableToggle:!0,disabled:!0,toggleGroup:"leftMenuGroup"}),this.btnSupport=new Common.UI.Button({action:"support",el:t("#left-btn-support",this.el),hint:this.tipSupport,disabled:!0}),this.btnComments=new Common.UI.Button({el:t("#left-btn-comments",this.el),hint:this.tipComments+Common.Utils.String.platformKey("Ctrl+Shift+H"),enableToggle:!0,disabled:!0,toggleGroup:"leftMenuGroup"}),this.btnChat=new Common.UI.Button({el:t("#left-btn-chat",this.el),hint:this.tipChat+Common.Utils.String.platformKey("Ctrl+Alt+Q",null,function(e){return Common.Utils.isMac?e.replace(/Ctrl|ctrl/g,"⌃"):e}),enableToggle:!0,disabled:!0,toggleGroup:"leftMenuGroup"}),this.btnComments.hide(),this.btnChat.hide(),this.btnComments.on("click",n.bind(this.onBtnMenuClick,this)),this.btnChat.on("click",n.bind(this.onBtnMenuClick,this)),this.btnSearch.on("click",n.bind(this.onBtnMenuClick,this)),this.btnAbout.on("toggle",n.bind(this.onBtnMenuToggle,this)),this.btnFile.on("toggle",n.bind(this.onBtnMenuToggle,this));var r=new SSE.Views.FileMenu({});return r.options={alias:"FileMenu"},this.btnFile.panel=r.render(),this.btnAbout.panel=(new Common.Views.About({el:t("#about-menu-panel"),appName:"Spreadsheet Editor"})).render(),this},onBtnMenuToggle:function(e,t){t?(this.btnFile.pressed&&this.fireEvent("file:show",this),e.panel.show(),this.$el.width(i),this.btnSearch.isActive()&&this.btnSearch.toggle(!1)):(this.btnFile.id==e.id&&this.fireEvent("file:hide",this),e.panel.hide()),this.mode.isEdit&&SSE.getController("Toolbar").DisableToolbar(t==1),Common.NotificationCenter.trigger("layout:changed","leftmenu")},onBtnMenuClick:function(e,t){this.btnFile.toggle(!1),this.btnAbout.toggle(!1),e.options.action!="search"&&(e.pressed?this.$el.width()>i||this.$el.width(localStorage.getItem("sse-mainmenu-width")||s):(localStorage.setItem("sse-mainmenu-width",this.$el.width()),this.$el.width(i))),Common.NotificationCenter.trigger("layout:changed","leftmenu")},onCoauthOptions:function(e){this.mode.canCoAuthoring&&(this.mode.canComments&&(this.panelComments[this.btnComments.pressed?"show":"hide"](),this.fireEvent(this.btnComments.pressed?"comments:show":"comments:hide",this)),this.mode.canChat&&(this.btnChat.pressed?(this.btnChat.$el.hasClass("notify")&&this.btnChat.$el.removeClass("notify"),this.panelChat.show(),this.panelChat.focus()):this.panelChat.hide()))},setOptionsPanel:function(e,t){e=="chat"?this.panelChat=t.render("#left-panel-chat"):e=="comment"&&(this.panelComments=t)},markCoauthOptions:function(e){this.btnChat.isVisible()&&!this.btnChat.isDisabled()&&!this.btnChat.pressed&&this.btnChat.$el.addClass("notify")},close:function(e){this.btnFile.toggle(!1),this.btnAbout.toggle(!1),this.$el.width(i),this.mode.canCoAuthoring&&(this.mode.canComments&&(this.panelComments.hide(),this.btnComments.pressed&&this.fireEvent("comments:hide",this),this.btnComments.toggle(!1,!0)),this.mode.canChat&&(this.panelChat.hide(),this.btnChat.toggle(!1,!0)))},isOpened:function(){var e=this.btnFile.pressed||this.btnSearch.pressed;return!e&&(e=this.btnComments.pressed||this.btnChat.pressed),e},disableMenu:function(e,t){this.btnFile.setDisabled(!1),this.btnAbout.setDisabled(!1),this.btnSupport.setDisabled(!1),this.btnSearch.setDisabled(!1),this.btnComments.setDisabled(!1),this.btnChat.setDisabled(!1)},showMenu:function(e){var t=/^(\\w+):?(\\w*)$/.exec(e);t[1]=="file"?(this.btnFile.pressed||(this.btnFile.toggle(!0),this.btnFile.$el.focus()),this.btnFile.panel.show(t[2].length?t[2]:undefined)):e=="chat"?this.btnChat.isVisible()&&!this.btnChat.isDisabled()&&!this.btnChat.pressed&&(this.btnChat.toggle(!0),this.onBtnMenuClick(this.btnChat),this.onCoauthOptions(),this.panelChat.focus()):e=="comments"&&this.btnComments.isVisible()&&!this.btnComments.isDisabled()&&!this.btnComments.pressed&&(this.btnComments.toggle(!0),this.onBtnMenuClick(this.btnComments),this.onCoauthOptions(),this.btnComments.$el.focus())},getMenu:function(e){switch(e){case"file":return this.btnFile.panel;case"about":return this.btnAbout.panel;default:return null}},setMode:function(e){return this.mode=e,this},tipComments:"Comments",tipChat:"Chat",tipAbout:"About",tipSupport:"Feedback & Support",tipFile:"File",tipSearch:"Search"},SSE.Views.LeftMenu||{}))}),define("spreadsheeteditor/main/app/controller/LeftMenu",["core","common/main/lib/util/Shortcuts","spreadsheeteditor/main/app/view/LeftMenu","spreadsheeteditor/main/app/view/FileMenu"],function(){SSE.Controllers.LeftMenu=Backbone.Controller.extend(_.extend({views:["LeftMenu","FileMenu"],initialize:function(){this.addListeners({"Common.Views.Chat":{hide:_.bind(this.onHideChat,this)},Statusbar:{"click:users":_.bind(this.clickStatusbarUsers,this)},LeftMenu:{"file:show":_.bind(this.fileShowHide,this,!0),"file:hide":_.bind(this.fileShowHide,this,!1),"comments:show":_.bind(this.commentsShowHide,this,!0),"comments:hide":_.bind(this.commentsShowHide,this,!1)},"Common.Views.About":{show:_.bind(this.aboutShowHide,this,!0),hide:_.bind(this.aboutShowHide,this,!1)},FileMenu:{"item:click":_.bind(this.clickMenuFileItem,this),"saveas:format":_.bind(this.clickSaveAsFormat,this),"settings:apply":_.bind(this.applySettings,this),"create:new":_.bind(this.onCreateNew,this),"recent:open":_.bind(this.onOpenRecent,this)},Toolbar:{"file:settings":_.bind(this.clickToolbarSettings,this)},SearchDialog:{hide:_.bind(this.onSearchDlgHide,this),"search:back":_.bind(this.onQuerySearch,this,"back"),"search:next":_.bind(this.onQuerySearch,this,"next"),"search:replace":_.bind(this.onQueryReplace,this),"search:replaceall":_.bind(this.onQueryReplaceAll,this)}})},onLaunch:function(){this.leftMenu=this.createView("LeftMenu").render(),this.leftMenu.btnSearch.on("toggle",_.bind(this.onMenuSearch,this)),Common.util.Shortcuts.delegateShortcuts({shortcuts:{"command+shift+s,ctrl+shift+s":_.bind(this.onShortcut,this,"save"),"command+f,ctrl+f":_.bind(this.onShortcut,this,"search"),"command+h,ctrl+h":_.bind(this.onShortcut,this,"replace"),"alt+f":_.bind(this.onShortcut,this,"file"),esc:_.bind(this.onShortcut,this,"escape"),"ctrl+alt+q":_.bind(this.onShortcut,this,"chat"),"command+shift+h,ctrl+shift+h":_.bind(this.onShortcut,this,"comments"),f1:_.bind(this.onShortcut,this,"help")}}),Common.util.Shortcuts.suspendEvents();var e=this;this.leftMenu.$el.find("button").each(function(){$(this).on("keydown",function(t){if(Common.UI.Keys.RETURN===t.keyCode||Common.UI.Keys.SPACE===t.keyCode)e.leftMenu.btnFile.toggle(!1),e.leftMenu.btnAbout.toggle(!1),this.blur(),t.preventDefault(),e.api.asc_enableKeyEvents(!0)})})},setApi:function(e){return this.api=e,this.api.asc_registerCallback("asc_onRenameCellTextEnd",_.bind(this.onRenameText,this)),this.api.asc_registerCallback("asc_onСoAuthoringDisconnect",_.bind(this.onApiServerDisconnect,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onApiServerDisconnect,this)),this.mode.canCoAuthoring&&this.mode.canChat&&this.api.asc_registerCallback("asc_onCoAuthoringChatReceiveMessage",_.bind(this.onApiChatMessage,this)),this.mode.isEditDiagram||this.api.asc_registerCallback("asc_onEditCell",_.bind(this.onApiEditCell,this)),this.leftMenu.getMenu("file").setApi(e),this},setMode:function(e){return this.mode=e,this.leftMenu.setMode(e),this.leftMenu.getMenu("file").setMode(e),this},createDelayedElements:function(){return this.mode.canCoAuthoring?(this.leftMenu.btnComments[this.mode.isEdit&&this.mode.canComments?"show":"hide"](),this.mode.canComments&&this.leftMenu.setOptionsPanel("comment",this.getApplication().getController("Common.Controllers.Comments").getView("Common.Views.Comments")),this.leftMenu.btnChat[this.mode.canChat?"show":"hide"](),this.mode.canChat&&this.leftMenu.setOptionsPanel("chat",this.getApplication().getController("Common.Controllers.Chat").getView("Common.Views.Chat"))):(this.leftMenu.btnChat.hide(),this.leftMenu.btnComments.hide()),Common.util.Shortcuts.resumeEvents(),this.mode.isEditDiagram||Common.NotificationCenter.on("cells:range",_.bind(this.onCellsRange,this)),this},clickMenuFileItem:function(e,t,n){var r=!0;switch(t){case"back":break;case"save":this.api.asc_Save();break;case"print":this.api.asc_Print();break;case"exit":Common.Gateway.goBack();break;case"edit":Common.Gateway.requestEditRights();break;case"new":n?r=!1:this.onCreateNew(undefined,"blank");break;default:r=!1}r&&(e.hide(),this.leftMenu.btnFile.toggle(!1,!0))},clickSaveAsFormat:function(e,t){t==c_oAscFileType.CSV||t!=c_oAscFileType.XLSX&&this.api.asc_drawingObjectsExist()?Common.UI.warning({closable:!1,title:this.textWarning,msg:this.warnDownloadAs,buttons:["ok","cancel"],callback:_.bind(function(n){n=="ok"&&(this.api.asc_DownloadAs(t),e.hide(),this.leftMenu.btnFile.toggle(!1,!0))},this)}):(this.api.asc_DownloadAs(t),e.hide(),this.leftMenu.btnFile.toggle(!1,!0))},applySettings:function(e){this.api.asc_setFontRenderingMode(parseInt(window.localStorage.getItem("sse-settings-fontrender")));var t=window.localStorage.getItem("sse-settings-livecomment");t===null||parseInt(t)!=0?this.api.asc_showComments():this.api.asc_hideComments(),this.mode.canAutosave&&(t=window.localStorage.getItem("sse-settings-autosave"),this.api.asc_setAutoSaveGap(parseInt(t))),e.hide(),this.leftMenu.btnFile.toggle(!1,!0)},onCreateNew:function(e,t){if(this.mode.nativeApp===!0)this.api.asc_openNewDocument(t=="blank"?"":t);else{var n=window.open(_.template(\'<%= url %>?title=<%= title %><% if (doctype != "blank") { %>&template=<%= doctype %><% } %>&action=create&doctype=spreadsheet\',{url:this.mode.createUrl,title:this.newDocumentTitle,doctype:t}));n&&n.focus()}e&&(e.hide(),this.leftMenu.btnFile.toggle(!1,!0))},onOpenRecent:function(e,t){e&&(e.hide(),this.leftMenu.btnFile.toggle(!1,!0));var n=window.open(t);n&&n.focus(),Common.component.Analytics.trackEvent("Open Recent")},clickToolbarSettings:function(e){this.leftMenu.btnFile.pressed&&this.leftMenu.btnFile.panel.active=="opts"?this.leftMenu.close():this.leftMenu.showMenu("file:opts")},clickStatusbarUsers:function(){this.mode.canCoAuthoring&&this.mode.canChat&&(this.leftMenu.btnChat.pressed?this.leftMenu.close():this.leftMenu.showMenu("chat"))},onHideChat:function(){$(this.leftMenu.btnChat.el).blur(),Common.NotificationCenter.trigger("layout:changed","leftmenu")},onQuerySearch:function(e,t,n){if(n.textsearch&&n.textsearch.length){var r=this.dlgSearch.findOptions;r.asc_setFindWhat(n.textsearch),r.asc_setScanForward(e!="back"),r.asc_setIsMatchCase(n.matchcase),r.asc_setIsWholeCell(n.matchword),r.asc_setScanOnOnlySheet(this.dlgSearch.menuWithin.menu.items[0].checked),r.asc_setScanByRows(this.dlgSearch.menuSearch.menu.items[0].checked),r.asc_setLookIn(this.dlgSearch.menuLookin.menu.items[0].checked?c_oAscFindLookIn.Formulas:c_oAscFindLookIn.Value);if(!this.api.asc_findText(r)){var i=this;Common.UI.info({msg:this.textNoTextFound,callback:function(){i.dlgSearch.focus()}})}}},onQueryReplace:function(e,t){if(!_.isEmpty(t.textsearch)&&!_.isEmpty(t.textreplace)){this.api.isReplaceAll=!1;var n=this.dlgSearch.findOptions;n.asc_setFindWhat(t.textsearch),n.asc_setReplaceWith(t.textreplace),n.asc_setIsMatchCase(t.matchcase),n.asc_setIsWholeCell(t.matchword),n.asc_setScanOnOnlySheet(this.dlgSearch.menuWithin.menu.items[0].checked),n.asc_setScanByRows(this.dlgSearch.menuSearch.menu.items[0].checked),n.asc_setLookIn(this.dlgSearch.menuLookin.menu.items[0].checked?c_oAscFindLookIn.Formulas:c_oAscFindLookIn.Value),n.asc_setIsReplaceAll(!1),this.api.asc_replaceText(n)}},onQueryReplaceAll:function(e,t){if(!_.isEmpty(t.textsearch)&&!_.isEmpty(t.textreplace)){this.api.isReplaceAll=!0;var n=this.dlgSearch.findOptions;n.asc_setFindWhat(t.textsearch),n.asc_setReplaceWith(t.textreplace),n.asc_setIsMatchCase(t.matchcase),n.asc_setIsWholeCell(t.matchword),n.asc_setScanOnOnlySheet(this.dlgSearch.menuWithin.menu.items[0].checked),n.asc_setScanByRows(this.dlgSearch.menuSearch.menu.items[0].checked),n.asc_setLookIn(this.dlgSearch.menuLookin.menu.items[0].checked?c_oAscFindLookIn.Formulas:c_oAscFindLookIn.Value),n.asc_setIsReplaceAll(!0),this.api.asc_replaceText(n)}},showSearchDlg:function(e,t){if(!this.dlgSearch){var n=new Common.UI.MenuItem({caption:this.textWithin,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:this.textSheet,toggleGroup:"searchWithih",checkable:!0,checked:!0},{caption:this.textWorkbook,toggleGroup:"searchWithih",checkable:!0,checked:!1}]})}),r=new Common.UI.MenuItem({caption:this.textSearch,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:this.textByRows,toggleGroup:"searchByrows",checkable:!0,checked:!0},{caption:this.textByColumns,toggleGroup:"searchByrows",checkable:!0,checked:!1}]})}),i=new Common.UI.MenuItem({caption:this.textLookin,menu:new Common.UI.Menu({menuAlign:"tl-tr",items:[{caption:this.textFormulas,toggleGroup:"searchLookin",checkable:!0,checked:!0},{caption:this.textValues,toggleGroup:"searchLookin",checkable:!0,checked:!1}]})});this.dlgSearch=new Common.UI.SearchDialog({matchcase:!0,matchword:!0,matchwordstr:this.textItemEntireCell,markresult:!1,extraoptions:[n,r,i]}),this.dlgSearch.menuWithin=n,this.dlgSearch.menuSearch=r,this.dlgSearch.menuLookin=i,this.dlgSearch.findOptions=new Asc.asc_CFindOptions}if(e){var s=this.mode.isEdit?t||undefined:"no-replace";this.dlgSearch.isVisible()?(this.dlgSearch.setMode(s),this.dlgSearch.focus()):this.dlgSearch.show(s),this.api.asc_closeCellEditor()}else this.dlgSearch.hide()},onMenuSearch:function(e,t){this.showSearchDlg(t)},onSearchDlgHide:function(){this.leftMenu.btnSearch.toggle(!1,!0),$(this.leftMenu.btnSearch.el).blur(),this.api.asc_enableKeyEvents(!0)},onRenameText:function(e,t){var n=this;if(this.api.isReplaceAll)Common.UI.info({msg:e?!e-t?Common.Utils.String.format(this.textReplaceSuccess,t):Common.Utils.String.format(this.textReplaceSkipped,e-t):this.textNoTextFound,callback:function(){n.dlgSearch.focus()}});else{var r=this.dlgSearch.getSettings(),i=this.dlgSearch.findOptions;i.asc_setFindWhat(r.textsearch),i.asc_setScanForward(!0),i.asc_setIsMatchCase(r.matchcase),i.asc_setIsWholeCell(r.matchword),i.asc_setScanOnOnlySheet(this.dlgSearch.menuWithin.menu.items[0].checked),i.asc_setScanByRows(this.dlgSearch.menuSearch.menu.items[0].checked),i.asc_setLookIn(this.dlgSearch.menuLookin.menu.items[0].checked?c_oAscFindLookIn.Formulas:c_oAscFindLookIn.Value),n.api.asc_findText(i)||Common.UI.info({msg:this.textNoTextFound,callback:function(){n.dlgSearch.focus()}})}},onApiServerDisconnect:function(){this.mode.isEdit=!1,this.leftMenu.close(),this.leftMenu.btnComments.setDisabled(!0),this.leftMenu.btnChat.setDisabled(!0),this.leftMenu.getMenu("file").setMode({isDisconnected:!0}),this.dlgSearch&&(this.leftMenu.btnSearch.toggle(!1,!0),this.dlgSearch.hide())},onApiChatMessage:function(){this.leftMenu.markCoauthOptions()},commentsShowHide:function(e){if(this.api){var t=window.localStorage.getItem("sse-settings-livecomment");t!==null&&parseInt(t)==0&&(e?this.api.asc_showComments():this.api.asc_hideComments()),e&&this.getApplication().getController("Common.Controllers.Comments").focusOnInput(),this.api.asc_enableKeyEvents(!e),e||$(this.leftMenu.btnComments.el).blur()}},fileShowHide:function(e){this.api&&(this.api.asc_closeCellEditor(),this.api.asc_enableKeyEvents(!e),e||$(this.leftMenu.btnFile.el).blur())},aboutShowHide:function(e){this.api&&(this.api.asc_closeCellEditor(),this.api.asc_enableKeyEvents(!e),e||$(this.leftMenu.btnAbout.el).blur())},onShortcut:function(e,t){if(this.mode.isEditDiagram&&e!="escape")return!1;switch(e){case"replace":case"search":return this.leftMenu.btnSearch.isDisabled()||(Common.UI.Menu.Manager.hideAll(),this.showSearchDlg(!0,e),this.leftMenu.btnSearch.toggle(!0,!0),this.leftMenu.btnFile.toggle(!1),this.leftMenu.btnAbout.toggle(!1)),!1;case"save":return this.mode.canDownload&&!this.leftMenu.btnFile.isDisabled()&&(Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("file:saveas")),!1;case"help":return this.leftMenu.btnFile.isDisabled()||(Common.UI.Menu.Manager.hideAll(),this.api.asc_closeCellEditor(),this.leftMenu.showMenu("file:help")),!1;case"file":return this.leftMenu.btnFile.isDisabled()||(Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("file")),!1;case"escape":var n=SSE.getController("Statusbar"),r=n.statusbar.$el.find(\'.open > [data-toggle="dropdown"]\');if(r.length)return $.fn.dropdown.Constructor.prototype.keydown.call(r[0],t),!1;if(this.leftMenu.btnFile.pressed||this.leftMenu.btnAbout.pressed||$(t.target).parents("#left-menu").length&&this.api.isCellEdited!==!0)return this.leftMenu.close(),Common.NotificationCenter.trigger("layout:changed","leftmenu"),!1;if(this.mode.isEditDiagram){r=$(document.body).find(".open > .dropdown-menu");if(!this.api.isCellEdited&&!r.length)return Common.Gateway.internalMessage("shortcut",{key:"escape"}),!1}break;case"chat":return this.mode.canCoAuthoring&&this.mode.canChat&&(Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("chat")),!1;case"comments":return this.mode.canCoAuthoring&&this.mode.isEdit&&this.mode.canComments&&(Common.UI.Menu.Manager.hideAll(),this.leftMenu.showMenu("comments"),this.getApplication().getController("Common.Controllers.Comments").focusOnInput()),!1}},onCellsRange:function(e){var t=e!=c_oAscSelectionDialogType.None;this.leftMenu.btnFile.setDisabled(t),this.leftMenu.btnAbout.setDisabled(t),this.leftMenu.btnSearch.setDisabled(t)},onApiEditCell:function(e){var t=e==c_oAscCellEditorState.editFormula;this.leftMenu.btnFile.setDisabled(t),this.leftMenu.btnAbout.setDisabled(t),this.leftMenu.btnSearch.setDisabled(t)},textNoTextFound:"Text not found",newDocumentTitle:"Unnamed document",textItemEntireCell:"Entire cell contents",requestEditRightsText:"Requesting editing rights...",textReplaceSuccess:"Search has been done. {0} occurrences have been replaced",textReplaceSkipped:"The replacement has been made. {0} occurrences were skipped.",warnDownloadAs:"If you continue saving in this format all features except the text will be lost.<br>Are you sure you want to continue?",textWarning:"Warning",textSheet:"Sheet",textWorkbook:"Workbook",textByColumns:"By columns",textByRows:"By rows",textFormulas:"Formulas",textValues:"Values",textWithin:"Within",textSearch:"Search",textLookin:"Look in"},SSE.Controllers.LeftMenu||{}))});if(Common===undefined)var Common={};Common.IrregularStack=function(e){var t=[],n=function(e,t){return typeof e=="object"&&typeof t=="object"&&window.JSON?window.JSON.stringify(e)===window.JSON.stringify(t):e===t};e=e||{};var r=e.strongCompare||n,i=e.weakCompare||n,s=function(e,n){for(var r=t.length-1;r>=0;r--)if(n(t[r],e))return r;return-1},o=function(e){t.push(e)},u=function(e){var n=s(e,r);if(n!=-1){var i=t.splice(n,1);return i[0]}return undefined},a=function(e){var n=s(e,i);return n!=-1?t[n]:undefined},f=function(e){return!(s(e,r)<0)};return{push:o,pop:u,get:a,exist:f}},define("irregularstack",function(){});if(Common===undefined)var Common={};Common.Controllers=Common.Controllers||{},define("common/main/lib/controller/Fonts",["core","common/main/lib/collection/Fonts"],function(){Common.Controllers.Fonts=Backbone.Controller.extend(function(){function t(t,n){var r=n.get("type")==e,i=-1,s=t.length,o,u=n.get("name");while(!r&&++i<s){o=t.at(i);if(o.get("type")!=e)break;r=o.get("name")==u}return r}function n(e,n){e.showlastused&&!t(e.store,n)}function r(e){Common.NotificationCenter.trigger("fonts:change",e)}function i(e,t){var n=[];_.each(e,function(e){var t=e.asc_getFontId();n.push({id:_.isEmpty(t)?Common.UI.getId():t,name:e.asc_getFontName(),imgidx:e.asc_getFontThumbnail(),type:e.asc_getFontType()})});var r=this.getCollection("Common.Collections.Fonts");r&&r.add(n),Common.NotificationCenter.trigger("fonts:load",r,t)}var e=4;return{models:["Common.Models.Fonts"],collections:["Common.Collections.Fonts"],views:[],initialize:function(){Common.NotificationCenter.on("fonts:select",_.bind(n,this))},onLaunch:function(){},setApi:function(e){this.api=e,this.api.asc_registerCallback("asc_onInitEditorFonts",_.bind(i,this)),this.api.asc_registerCallback("asc_onFontFamily",_.bind(r,this))},loadFonts:function(e){if(this.api){var t=this.api.get_PropertyEditorFonts();t&&i.call(this,t,e)}}}}())}),define("spreadsheeteditor/main/app/model/ShapeGroup",["backbone"],function(e){SSE.Models=SSE.Models||{},SSE.Models.ShapeModel=e.Model.extend({defaults:function(){return{id:Common.UI.getId(),imageUrl:null,data:null}}}),SSE.Models.ShapeGroup=e.Model.extend({defaults:function(){return{id:Common.UI.getId(),groupName:null,groupId:null,groupStore:null}}})}),define("spreadsheeteditor/main/app/collection/ShapeGroups",["backbone","spreadsheeteditor/main/app/model/ShapeGroup"],function(e){if(t===undefined)var t={};t.Collections=t.Collections||{},SSE.Collections.ShapeGroups=e.Collection.extend({model:SSE.Models.ShapeGroup})}),define("spreadsheeteditor/main/app/model/Formula",["backbone"],function(e){SSE.Models=SSE.Models||{},SSE.Models.FormulaModel=e.Model.extend({defaults:function(){return{id:Common.UI.getId(),index:0,group:null,name:null,args:null}}}),SSE.Models.FormulaGroup=e.Model.extend({defaults:function(){return{id:Common.UI.getId(),index:0,name:null,store:null,functions:[]}}})}),define("spreadsheeteditor/main/app/collection/FormulaGroups",["backbone","spreadsheeteditor/main/app/model/Formula"],function(e){SSE.Collections=SSE.Collections||{},SSE.Collections.FormulaGroups=e.Collection.extend({model:SSE.Models.FormulaGroup})}),define("spreadsheeteditor/main/app/view/FormulaDialog",["common/main/lib/component/Window","spreadsheeteditor/main/app/collection/FormulaGroups"],function(){SSE.Views=SSE.Views||{},SSE.Views.FormulaDialog=Common.UI.Window.extend(_.extend({applyFunction:undefined,initialize:function(e){var t=this,n={};_.extend(n,{width:300,height:490,contentWidth:390,header:!0,cls:"formula-dlg",contentTemplate:"",title:t.txtTitle,items:[]},e),this.template=e.template||[\'<div class="box" style="height:\'+(n.height-85)+\'px;">\',\'<div class="content-panel" >\',\'<label class="header">\'+t.textGroupDescription+"</label>",\'<div id="formula-dlg-combo-group" class="input-group-nr" style="margin-top: 10px"/>\',\'<label class="header" style="margin-top:10px">\'+t.textListDescription+"</label>",\'<div id="formula-dlg-combo-functions" class="combo-functions"/>\',\'<label id="formula-dlg-args" style="margin-top: 10px"></label>\',"</div>","</div>",\'<div class="separator horizontal"/>\',\'<div class="footer center">\',\'<button class="btn normal dlg-btn primary" result="ok" style="margin-right: 10px;">\'+t.okButtonText+"</button>",\'<button class="btn normal dlg-btn" result="cancel">\'+t.cancelButtonText+"</button>","</div>"].join(""),this.api=e.api,this.formulasGroups=e.formulasGroups,this.handler=e.handler,n.tpl=_.template(this.template,n),Common.UI.Window.prototype.initialize.call(this,n)},render:function(){Common.UI.Window.prototype.render.call(this),this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.syntaxLabel=$("#formula-dlg-args"),this.fillFormulasGroups(),this.fillFunctions("All")},show:function(){if(this.$window){var e,t,n,r,i=this.initConfig.height;window.innerHeight===undefined?(e=document.documentElement.offsetWidth,t=document.documentElement.offsetHeight):(e=window.innerWidth,t=window.innerHeight),n=(parseInt(t,10)-parseInt(i,10))/2*.9,r=(parseInt(e,10)-parseInt(this.initConfig.width,10))/2,this.$window.css("left",Math.floor(r)),this.$window.css("top",Math.floor(n))}Common.UI.Window.prototype.show.call(this),this.mask=$(".modals-mask"),this.mask.on("mousedown",_.bind(this.onUpdateFocus,this)),this.$window.on("mousedown",_.bind(this.onUpdateFocus,this)),this.cmbListFunctions&&_.delay(function(e){e.cmbListFunctions.$el.find(".listview").focus()},100,this)},hide:function(){this.mask.off("mousedown",_.bind(this.onUpdateFocus,this)),this.$window.off("mousedown",_.bind(this.onUpdateFocus,this)),Common.UI.Window.prototype.hide.call(this)},onBtnClick:function(e){"ok"===e.currentTarget.attributes.result.value&&this.handler&&this.handler.call(this,this.applyFunction),this.hide()},onDblClickFunction:function(){this.handler&&this.handler.call(this,this.applyFunction),this.hide()},onSelectGroup:function(e,t){!_.isUndefined(t)&&!_.isUndefined(t.value)&&t.value<this.formulasGroups.length&&this.fillFunctions(this.formulasGroups.at(t.value).get("name")),this.onUpdateFocus()},onSelectFunction:function(e,t,n){var r,i,s;this.formulasGroups&&(r=n.get("id"),_.isUndefined(r)||(i=this.formulasGroups.at(0).get("functions"),i&&(s=_.find(i,function(e){return e.get("index")===r?e:null}),s&&(this.applyFunction=s.get("name"),this.syntaxLabel.text(this.syntaxText+": "+this.applyFunction+s.get("args"))))))},onPrimary:function(e,t,n){this.handler&&this.handler.call(this,this.applyFunction),this.hide()},onUpdateFocus:function(){_.delay(function(e){e.cmbListFunctions.$el.find(".listview").focus()},100,this)},fillFormulasGroups:function(){if(this.formulasGroups){var e={All:this.sCategoryAll,Cube:this.sCategoryCube,Database:this.sCategoryDatabase,DateAndTime:this.sCategoryDateTime,Engineering:this.sCategoryEngineering,Financial:this.sCategoryFinancial,Information:this.sCategoryInformation,Logical:this.sCategoryLogical,LookupAndReference:this.sCategoryLookupAndReference,Mathematic:this.sCategoryMathematics,Statistical:this.sCategoryStatistical,TextAndData:this.sCategoryTextData},t,n=[],r=this.formulasGroups.length;for(t=0;t<r;++t)this.formulasGroups.at(t).get("functions").length&&n.push({value:this.formulasGroups.at(t).get("index"),displayValue:e[this.formulasGroups.at(t).get("name")]});this.cmbFuncGroup?this.cmbFuncGroup.setData(n):(this.cmbFuncGroup=new Common.UI.ComboBox({el:$("#formula-dlg-combo-group"),menuStyle:"min-width: 268px;",cls:"input-group-nr",data:n,editable:!1}),this.cmbFuncGroup.setValue(0),this.cmbFuncGroup.on("selected",_.bind(this.onSelectGroup,this)))}},fillFunctions:function(e){if(this.formulasGroups){!this.cmbListFunctions&&!this.functions&&(this.functions=new Common.UI.DataViewStore,this.cmbListFunctions=new Common.UI.ListView({el:$("#formula-dlg-combo-functions"),store:this.functions,itemTemplate:_.template(\'<div id="<%= id %>" class="list-item" style="pointer-events:none;"><%= value %></div>\')}),this.cmbListFunctions.on("item:select",_.bind(this.onSelectFunction,this)),this.cmbListFunctions.on("item:dblclick",_.bind(this.onDblClickFunction,this)),this.cmbListFunctions.on("entervalue",_.bind(this.onPrimary,this)),this.cmbListFunctions.onKeyDown=_.bind(this.onKeyDown,this.cmbListFunctions),this.cmbListFunctions.$el.find(".listview").focus(),this.cmbListFunctions.scrollToRecord=_.bind(this.onScrollToRecordCustom,this.cmbListFunctions));if(this.functions){this.functions.reset();var t=0,n=0,r=null,i=this.formulasGroups.findWhere({name:e});if(i){r=i.get("functions");if(r&&r.length){n=r.length;for(t=0;t<n;++t)this.functions.push(new Common.UI.DataViewModel({id:r[t].get("index"),selected:t<1,allowSelected:!0,value:r[t].get("name")}));this.applyFunction=r[0].get("name"),this.syntaxLabel.text(this.syntaxText+": "+this.applyFunction+r[0].get("args")),this.cmbListFunctions.scroller.update({minScrollbarLength:40,alwaysVisibleY:!0})}}}}},onKeyDown:function(e,t){function p(e){i.selectRecord(e),i.scrollToRecord(e),f=$(i.el).find(".inner"),i.scroller.scrollTop(f.scrollTop(),0),t.preventDefault(),t.stopPropagation()}var n=0,r=null,i=this,s="",o="",u=null,a=!1,f=null,l=!1,c=null,h=!1;if(this.disabled)return;_.isUndefined(undefined)&&(t=e),s=String.fromCharCode(e.keyCode);if(e.keyCode>64&&e.keyCode<91&&s&&s.length){c=this.store.findWhere({selected:!0}),c&&(o=c.get("value"),l=o&&o.length&&o[0]===s);for(n=0;n<this.store.length;++n){r=this.store.at(n),o=r.get("value");if(o[0]===s){null===u&&(u=r);if(l){c===r&&(l=!1);continue}if(r.get("selected"))continue;p(r);return}}if(u){p(u);return}}Common.UI.DataView.prototype.onKeyDown.call(this,e,t)},onScrollToRecordCustom:function(e){var t=$(this.el).find(".inner"),n=t.offset().top,r=t.find("#"+e.get("id")).parent(),i=r.offset().top;if(i<n||i+r.height()>n+t.height())this.scroller?this.scroller.scrollTop(t.scrollTop()+i-n,0):t.scrollTop(t.scrollTop()+i-n)},cancelButtonText:"Cancel",okButtonText:"Ok",sCategoryAll:"All",sCategoryLogical:"Logical",sCategoryCube:"Cube",sCategoryDatabase:"Database",sCategoryDateTime:"Date and time",sCategoryEngineering:"Engineering",sCategoryFinancial:"Financial",sCategoryInformation:"Information",sCategoryLookupAndReference:"LookupAndReference",sCategoryMathematics:"Math and trigonometry",sCategoryStatistical:"Statistical",sCategoryTextData:"Text and data",textGroupDescription:"Select Function Group",textListDescription:"Select Function",sDescription:"Description",txtTitle:"Insert Function",syntaxText:"Syntax"},SSE.Views.FormulaDialog||{}))}),define("spreadsheeteditor/main/app/controller/FormulaDialog",["core","spreadsheeteditor/main/app/collection/FormulaGroups","spreadsheeteditor/main/app/view/FormulaDialog"],function(){SSE.Controllers=SSE.Controllers||{},SSE.Controllers.FormulaDialog=Backbone.Controller.extend({models:[],views:["FormulaDialog"],collections:["FormulaGroups"],initialize:function(){},setApi:function(e){this.api=e;if(this.formulasGroups&&this.api){this.loadingFormulas();var t=this;this.formulas=new SSE.Views.FormulaDialog({api:this.api,toolclose:"hide",formulasGroups:this.formulasGroups,handler:function(e){e&&t.api&&t.api.asc_insertFormula(e)}}),this.formulas.on({hide:function(){t.api&&t.api.asc_enableKeyEvents(!0)}})}return this},onLaunch:function(){this.formulasGroups=this.getApplication().getCollection("FormulaGroups")},showDialog:function(){this.formulas&&this.formulas.show()},hideDialog:function(){this.formulas&&this.formulas.isVisible()&&this.formulas.hide()},loadingFormulas:function(){var e=0,t=0,n,r,i,s=this.formulasGroups,o=null,u=0,a=0,f=null,l=[],c=null;if(s){c=new SSE.Models.FormulaGroup({name:"All",index:u,store:s});if(c){u+=1,s.push(c),f=this.api.asc_getFormulasInfo();for(e=0;e<f.length;e+=1){n=f[e].asc_getGroupName(),r=f[e].asc_getFormulasArray(),o=new SSE.Models.FormulaGroup({name:n,index:u,store:s}),u+=1,i=[];for(t=0;t<r.length;t+=1){var h=new SSE.Models.FormulaModel({index:a,group:n,name:r[t].asc_getName(),args:r[t].asc_getArguments()});a+=1,i.push(h),l.push(h)}o.set("functions",i),s.push(o)}c.set("functions",_.sortBy(l,function(e){return e.get("name")}))}}}})}),define("spreadsheeteditor/main/app/view/OpenDialog",["common/main/lib/component/Window"],function(){SSE.Views=SSE.Views||{},SSE.Views.OpenDialog=Common.UI.Window.extend(_.extend({applyFunction:undefined,initialize:function(e){var t=this,n={};_.extend(n,{width:250,height:220,contentWidth:390,header:!0,cls:"open-dlg",contentTemplate:"",title:t.txtTitle},e),this.template=e.template||[\'<div class="box" style="height:\'+(n.height-85)+\'px;">\',\'<div class="content-panel" >\',\'<label class="header">\'+t.txtEncoding+"</label>",\'<div id="id-codepages-combo" class="input-group-nr" style="margin-top:10px;margin-bottom:10px;"></div>\',\'<label class="header">\'+t.txtDelimiter+"</label>",\'<div id="id-delimiters-combo" class="input-group-nr" style="margin-top:10px;max-width: 110px;"></div>\',"</div>","</div>",\'<div class="separator horizontal"/>\',\'<div class="footer center">\',\'<button class="btn normal dlg-btn primary" result="ok" style="margin-right:10px;">\'+t.okButtonText+"</button>","</div>"].join(""),this.handler=e.handler,this.codepages=e.codepages,this.settings=e.settings,n.tpl=_.template(this.template,n),Common.UI.Window.prototype.initialize.call(this,n)},render:function(){Common.UI.Window.prototype.render.call(this),this.$window&&(this.$window.find(".tool").hide(),this.$window.find(".dlg-btn").on("click",_.bind(this.onBtnClick,this)),this.initCodePages())},onBtnClick:function(e){this.handler&&this.cmbEncoding&&this.cmbDelimiter&&this.handler.call(this,this.cmbEncoding.getValue(),this.cmbDelimiter.getValue()),this.close()},initCodePages:function(){var e,t,n,r=[],i=[],s=0;if(this.codepages){r=[];for(e=0;e<this.codepages.length;++e)n=this.codepages[e],t=[],t[0]=n.asc_getCodePage(),t[1]=n.asc_getCodePageName(),r.push(t)}else r=[[37,"IBM EBCDIC (US-Canada)"],[437,"OEM United States"],[500,"IBM EBCDIC (International)"],[708,"Arabic (ASMO 708)"],[720,"Arabic (DOS)"],[737,"Greek (DOS)"],[775,"Baltic (DOS)"],[850,"Western European (DOS)"],[852,"Central European (DOS)"],[855,"OEM Cyrillic"],[857,"Turkish (DOS)"],[858,"OEM Multilingual Latin I"],[860,"Portuguese (DOS)"],[861,"Icelandic (DOS)"],[862,"Hebrew (DOS)"],[863,"French Canadian (DOS)"],[864,"Arabic (864) "],[865,"Nordic (DOS)"],[866,"Cyrillic (DOS)"],[869,"Greek, Modern (DOS)"],[870,"IBM EBCDIC (Multilingual Latin-2)"],[874,"Thai (Windows)"],[875,"IBM EBCDIC (Greek Modern)"],[932,"Japanese (Shift-JIS)"],[936,"Chinese Simplified (GB2312)"],[949,"Korean"],[950,"Chinese Traditional (Big5)"],[1026,"IBM EBCDIC (Turkish Latin-5)"],[1047,"IBM Latin-1"],[1140,"IBM EBCDIC (US-Canada-Euro)"],[1141,"IBM EBCDIC (Germany-Euro)"],[1142,"IBM EBCDIC (Denmark-Norway-Euro)"],[1143,"IBM EBCDIC (Finland-Sweden-Euro)"],[1144,"IBM EBCDIC (Italy-Euro)"],[1145,"IBM EBCDIC (Spain-Euro)"],[1146,"IBM EBCDIC (UK-Euro)"],[1147,"IBM EBCDIC (France-Euro)"],[1148,"IBM EBCDIC (International-Euro)"],[1149,"IBM EBCDIC (Icelandic-Euro)"],[1200,"Unicode"],[1201,"Unicode (Big-Endian)"],[1250,"Central European (Windows)"],[1251,"Cyrillic (Windows)"],[1252,"Western European (Windows)"],[1253,"Greek (Windows)"],[1254,"Turkish (Windows)"],[1255,"Hebrew (Windows) "],[1256,"Arabic (Windows) "],[1257,"Baltic (Windows)"],[1258,"Vietnamese (Windows)"],[1361,"Korean (Johab)"],[1e4,"Western European (Mac)"],[10001,"Japanese (Mac)"],[10002,"Chinese Traditional (Mac)"],[10003,"Korean (Mac)"],[10004,"Arabic (Mac) "],[10005,"Hebrew (Mac)"],[10006,"Greek (Mac) "],[10007,"Cyrillic (Mac)"],[10008,"Chinese Simplified (Mac)"],[10010,"Romanian (Mac)"],[10017,"Ukrainian (Mac)"],[10021,"Thai (Mac)"],[10029,"Central European (Mac) "],[10079,"Icelandic (Mac)"],[10081,"Turkish (Mac)"],[10082,"Croatian (Mac)"],[12e3,"Unicode (UTF-32)"],[12001,"Unicode (UTF-32 Big-Endian)"],[2e4,"Chinese Traditional (CNS)"],[20001,"TCA Taiwan"],[20002,"Chinese Traditional (Eten)"],[20003,"IBM5550 Taiwan"],[20004,"TeleText Taiwan"],[20005,"Wang Taiwan"],[20105,"Western European (IA5)"],[20106,"German (IA5)"],[20107,"Swedish (IA5) "],[20108,"Norwegian (IA5) "],[20127,"US-ASCII"],[20261,"T.61 "],[20269,"ISO-6937"],[20273,"IBM EBCDIC (Germany)"],[20277,"IBM EBCDIC (Denmark-Norway) "],[20278,"IBM EBCDIC (Finland-Sweden)"],[20280,"IBM EBCDIC (Italy)"],[20284,"IBM EBCDIC (Spain)"],[20285,"IBM EBCDIC (UK)"],[20290,"IBM EBCDIC (Japanese katakana)"],[20297,"IBM EBCDIC (France)"],[20420,"IBM EBCDIC (Arabic)"],[20423,"IBM EBCDIC (Greek)"],[20424,"IBM EBCDIC (Hebrew)"],[20833,"IBM EBCDIC (Korean Extended)"],[20838,"IBM EBCDIC (Thai)"],[20866,"Cyrillic (KOI8-R)"],[20871,"IBM EBCDIC (Icelandic) "],[20880,"IBM EBCDIC (Cyrillic Russian)"],[20905,"IBM EBCDIC (Turkish)"],[20924,"IBM Latin-1 "],[20932,"Japanese (JIS 0208-1990 and 0212-1990)"],[20936,"Chinese Simplified (GB2312-80) "],[20949,"Korean Wansung "],[21025,"IBM EBCDIC (Cyrillic Serbian-Bulgarian)"],[21866,"Cyrillic (KOI8-U)"],[28591,"Western European (ISO) "],[28592,"Central European (ISO)"],[28593,"Latin 3 (ISO)"],[28594,"Baltic (ISO)"],[28595,"Cyrillic (ISO) "],[28596,"Arabic (ISO)"],[28597,"Greek (ISO) "],[28598,"Hebrew (ISO-Visual)"],[28599,"Turkish (ISO)"],[28603,"Estonian (ISO)"],[28605,"Latin 9 (ISO)"],[29001,"Europa"],[38598,"Hebrew (ISO-Logical)"],[50220,"Japanese (JIS)"],[50221,"Japanese (JIS-Allow 1 byte Kana) "],[50222,"Japanese (JIS-Allow 1 byte Kana - SO/SI)"],[50225,"Korean (ISO)"],[50227,"Chinese Simplified (ISO-2022)"],[51932,"Japanese (EUC)"],[51936,"Chinese Simplified (EUC) "],[51949,"Korean (EUC)"],[52936,"Chinese Simplified (HZ)"],[54936,"Chinese Simplified (GB18030)"],[57002,"ISCII Devanagari "],[57003,"ISCII Bengali "],[57004,"ISCII Tamil"],[57005,"ISCII Telugu "],[57006,"ISCII Assamese "],[57007,"ISCII Oriya"],[57008,"ISCII Kannada"],[57009,"ISCII Malayalam "],[57010,"ISCII Gujarati"],[57011,"ISCII Punjabi"],[65e3,"Unicode (UTF-7)"],[65001,"Unicode (UTF-8)"]];s=r.length;if(s){for(e=0;e<s;++e)i.push({value:r[e][0],displayValue:r[e][1]});this.cmbEncoding=new Common.UI.ComboBox({el:$("#id-codepages-combo",this.$window),menuStyle:"min-width: 220px;",cls:"input-group-nr",menuCls:"scrollable-menu",data:i,editable:!1}),this.cmbDelimiter=new Common.UI.ComboBox({el:$("#id-delimiters-combo",this.$window),menuStyle:"min-width: 110px;",cls:"input-group-nr",data:[{value:4,displayValue:","},{value:2,displayValue:";"},{value:3,displayValue:":"},{value:1,displayValue:this.txtTab},{value:5,displayValue:this.txtSpace}],editable:!1}),this.cmbDelimiter.setValue(4),r.length&&(this.cmbEncoding.setValue(r[0][0]),this.settings&&this.settings.asc_getCodePage()&&this.cmbEncoding.setValue(this.settings.asc_getCodePage()),this.settings&&this.settings.asc_getDelimiter()&&this.cmbDelimiter.setValue(this.settings.asc_getDelimiter()))}},okButtonText:"OK",cancelButtonText:"Cancel",txtDelimiter:"Delimiter",txtEncoding:"Encoding ",txtSpace:"Space",txtTab:"Tab",txtTitle:"Choose CSV options"},SSE.Views.OpenDialog||{}))}),define("spreadsheeteditor/main/app/controller/Main",["core","irregularstack","common/main/lib/component/Window","common/main/lib/component/LoadMask","common/main/lib/component/Tooltip","common/main/lib/controller/Fonts","spreadsheeteditor/main/app/collection/ShapeGroups","spreadsheeteditor/main/app/collection/TableTemplates","spreadsheeteditor/main/app/controller/FormulaDialog","spreadsheeteditor/main/app/view/OpenDialog"],function(){SSE.Controllers.Main=Backbone.Controller.extend(_.extend(function(){var e=-254,t=-255,n=-256,r={about:"button#left-btn-about",feedback:"button#left-btn-support",goback:"#fm-btn-back > a, #header-back > div"};return{models:[],collections:["ShapeGroups","TableTemplates"],views:[],initialize:function(){},onLaunch:function(){window.asc_CCommentData=window.Asc.asc_CCommentData||window.asc_CCommentData,window.storagename="table",this._state={};if(!Common.Utils.isBrowserSupported()){Common.Utils.showBrowserRestriction(),Common.Gateway.reportError(undefined,this.unsupportedBrowserErrorText);return}var t=window.localStorage.getItem("sse-settings-fontrender");t===null&&(t=window.devicePixelRatio>1?"1":"3"),this.api=new Asc.spreadsheet_api("editor_sdk","ce-cell-content"),this.api.asc_setFontRenderingMode(parseInt(t)),this.api.asc_Init("../../../sdk/Fonts/"),this.api.asc_registerCallback("asc_onOpenDocumentProgress",_.bind(this.onOpenDocument,this)),this.api.asc_registerCallback("asc_onEndAction",_.bind(this.onLongActionEnd,this)),this.api.asc_registerCallback("asc_onError",_.bind(this.onError,this)),this.api.asc_registerCallback("asc_onСoAuthoringDisconnect",_.bind(this.onCoAuthoringDisconnect,this)),this.api.asc_registerCallback("asc_onAdvancedOptions",_.bind(this.onAdvancedOptions,this)),this.api.asc_registerCallback("asc_onDocumentUpdateVersion",_.bind(this.onUpdateVersion,this)),Common.NotificationCenter.on("api:disconnect",_.bind(this.onCoAuthoringDisconnect,this)),this.stackLongActions=new Common.IrregularStack({strongCompare:this._compareActionStrong,weakCompare:this._compareActionWeak}),this.stackLongActions.push({id:e,type:c_oAscAsyncActionType.BlockInteraction}),this.isShowOpenDialog=!1,this.editorConfig={},Common.Gateway.on("init",_.bind(this.loadConfig,this)),Common.Gateway.on("showmessage",_.bind(this.onExternalMessage,this)),Common.Gateway.on("opendocument",_.bind(this.loadDocument,this)),Common.Gateway.on("internalcommand",_.bind(this.onInternalCommand,this)),Common.Gateway.ready(),this.getApplication().getController("Viewport").setApi(this.api);var n=this;$(document.body).on("focus","input, textarea:not(#ce-cell-content)",function(e){if(e&&e.target&&e.target.id&&e.target.id==="clipboard-helper-text"){n.api.asc_enableKeyEvents(!0);return}if(this.isAppDisabled===!0)return;n.api.asc_enableKeyEvents(!1)}),$("#editor_sdk").focus(function(e){if(this.isAppDisabled===!0)return;n.isModalShowed||n.api.asc_enableKeyEvents(!0)}),$(document.body).on("blur","input, textarea",function(e){if(this.isAppDisabled===!0)return;n.isModalShowed||n.api.asc_enableKeyEvents(!0)}),Common.NotificationCenter.on({"modal:show":function(e){n.isModalShowed=!0,n.api.asc_enableKeyEvents(!1)},"modal:close":function(e){e&&e.$lastmodal&&e.$lastmodal.size()<1&&(n.isModalShowed=!1,n.api.asc_enableKeyEvents(!0))},"modal:hide":function(e){e&&e.$lastmodal&&e.$lastmodal.size()<1&&(n.isModalShowed=!1,n.api.asc_enableKeyEvents(!0))},"edit:complete":_.bind(this.onEditComplete,this),"settings:unitschanged":_.bind(this.unitsChanged,this)}),this.initNames(),Common.util.Shortcuts.delegateShortcuts({shortcuts:{"command+s,ctrl+s":_.bind(function(e){e.preventDefault(),e.stopPropagation()},this)}})},loadConfig:function(e){this.editorConfig=$.extend(this.editorConfig,e.config);if(this.editorConfig.user===undefined||this.editorConfig.user===null){this.editorConfig.user={};if(this.editorConfig.users){this.editorConfig.userId=this.editorConfig.userId||0;for(var t=0;t<this.editorConfig.users.length;t++)if(this.editorConfig.users[t].id===this.editorConfig.userId){this.editorConfig.user={id:this.editorConfig.users[t].id,name:this.editorConfig.users[t].username};break}}}this.editorConfig.user.id=this.editorConfig.user.id||"uid-"+Date.now(),this.editorConfig.user.name=this.editorConfig.user.name||this.textAnonymous,this.appOptions={},this.appOptions.user=this.editorConfig.user,this.appOptions.canBack=this.editorConfig.nativeApp!==!0&&this.editorConfig.canBackToFolder===!0,this.appOptions.nativeApp=this.editorConfig.nativeApp===!0,this.appOptions.isDesktopApp=this.editorConfig.targetApp=="desktop",this.appOptions.canCreateNew=!_.isEmpty(this.editorConfig.createUrl)&&!this.appOptions.isDesktopApp,this.appOptions.canOpenRecent=this.editorConfig.nativeApp!==!0&&this.editorConfig.recent!==undefined&&!this.appOptions.isDesktopApp,this.appOptions.templates=this.editorConfig.templates,this.appOptions.recent=this.editorConfig.recent,this.appOptions.createUrl=this.editorConfig.createUrl,this.appOptions.lang=this.editorConfig.lang,this.appOptions.canAutosave=-1,this.appOptions.canAnalytics=!1,this.appOptions.sharingSettingsUrl=this.editorConfig.sharingSettingsUrl,this.appOptions.isEditDiagram=this.editorConfig.mode=="editdiagram",this.appOptions.customization=this.editorConfig.customization,this.headerView=this.getApplication().getController("Viewport").getView("Common.Views.Header"),this.headerView.setCanBack(this.editorConfig.canBackToFolder===!0),this.editorConfig.lang&&this.api.asc_setLocale(this.editorConfig.lang)},loadDocument:function(e){this.appOptions.spreadsheet=e.doc,this.permissions={};var t={};e.doc&&(this.permissions=_.extend(this.permissions,e.doc.permissions),t.Id=e.doc.key,t.Url=e.doc.url,t.Data=e.doc.data,t.Title=e.doc.title,t.Format=e.doc.fileType,t.Options=e.doc.options,t.UserId=this.editorConfig.user.id,t.UserName=this.editorConfig.user.name,t.VKey=e.doc.vkey,t.Origin=e.doc.origin,t.CallbackUrl=this.editorConfig.callbackUrl,this.headerView.setDocumentCaption(e.doc.title)),this.appOptions.isEditDiagram?this.onEditorPermissions(undefined):(this.api.asc_registerCallback("asc_onGetEditorPermissions",_.bind(this.onEditorPermissions,this)),this.api.asc_setDocInfo(t),this.api.asc_getEditorPermissions())},onProcessSaveResult:function(e){this.api.asc_OnSaveEnd(e.result),e&&e.result===!1&&Common.UI.error({title:this.criticalErrorTitle,msg:_.isEmpty(e.message)?this.errorProcessSaveResult:e.message})},onProcessRightsChange:function(e){e&&e.enabled===!1&&(this.api.asc_coAuthoringDisconnect(),this.getApplication().getController("LeftMenu").leftMenu.getMenu("file").panels.rights.onLostEditRights(),Common.UI.warning({title:this.notcriticalErrorTitle,msg:_.isEmpty(e.message)?this.warnProcessRightsChange:e.message}))},onProcessMouse:function(e){if(e.type=="mouseup"){var t=document.getElementById("editor_sdk");if(t){var n=t.getBoundingClientRect(),r=window.event||arguments.callee.caller.arguments[0];this.api.asc_onMouseUp(r,e.x-n.left,e.y-n.top)}}},goBack:function(){Common.Gateway.goBack()},onEditComplete:function(e,t){t&&t.restorefocus&&this.api.isCEditorFocused?(this.formulaInput.blur(),this.formulaInput.focus()):(this.getApplication().getController("DocumentHolder").getView("DocumentHolder").focus(),this.api.isCEditorFocused=!1)},onLongActionBegin:function(e,t){var n={id:t,type:e};this.stackLongActions.push(n),this.setLongActionView(n)},onLongActionEnd:function(e,t){var n={id:t,type:e};this.stackLongActions.pop(n),this.headerView.setDocumentCaption(this.api.asc_getDocumentName()),this.updateWindowTitle(this.api.asc_isDocumentModified(),!0),e===c_oAscAsyncActionType.BlockInteraction&&t==c_oAscAsyncAction.Open&&(Common.Gateway.internalMessage("documentReady",{}),this.onDocumentReady()),n=this.stackLongActions.get({type:c_oAscAsyncActionType.Information}),n&&this.setLongActionView(n),t==c_oAscAsyncAction.Save&&this.toolbarView.synchronizeChanges(),n=this.stackLongActions.get({type:c_oAscAsyncActionType.BlockInteraction}),n?this.setLongActionView(n):(this.loadMask&&this.loadMask.hide(),e==c_oAscAsyncActionType.BlockInteraction&&this.onEditComplete(this.loadMask,{restorefocus:!0}))},setLongActionView:function(e){var r="";switch(e.id){case c_oAscAsyncAction.Open:r=this.openTitleText;break;case c_oAscAsyncAction.Save:r=this.saveTitleText;break;case c_oAscAsyncAction.LoadDocumentFonts:r=this.loadFontsTitleText;break;case c_oAscAsyncAction.LoadDocumentImages:r=this.loadImagesTitleText;break;case c_oAscAsyncAction.LoadFont:r=this.loadFontTitleText;break;case c_oAscAsyncAction.LoadImage:r=this.loadImageTitleText;break;case c_oAscAsyncAction.DownloadAs:r=this.downloadTitleText;break;case c_oAscAsyncAction.Print:r=this.printTitleText;break;case c_oAscAsyncAction.UploadImage:r=this.uploadImageTitleText;break;case c_oAscAsyncAction.Recalc:r=this.titleRecalcFormulas;break;case c_oAscAsyncAction.SlowOperation:r=this.textPleaseWait;break;case c_oAscAsyncAction.PrepareToSave:r=this.savePreparingText;break;case t:r=this.txtEditingMode;break;case n:r=this.loadingDocumentTitleText}e.type==c_oAscAsyncActionType.BlockInteraction&&(!this.loadMask&&(this.loadMask=new Common.UI.LoadMask({owner:$("#viewport")})),this.loadMask.setTitle(r),this.isShowOpenDialog||this.loadMask.show())},onApplyEditRights:function(e){if(e)if(e.allowed){this.onLongActionBegin(c_oAscAsyncActionType.BlockInteraction,t),this.appOptions.isEdit=!0;var n=this;setTimeout(function(){n.applyModeCommonElements(),n.applyModeEditorElements("view"),n.api.asc_setViewerMode(!1);var e=n.getApplication(),t=e.getController("DocumentHolder");e.getController("LeftMenu").setMode(n.appOptions).createDelayedElements(),Common.NotificationCenter.trigger("layout:changed","main");var r=setInterval(function(){window.styles_loaded&&(clearInterval(r),t.getView("DocumentHolder").createDelayedElements(),t.resetApi(),e.getController("Toolbar").createDelayedElements(),e.getController("RightMenu").createDelayedElements(),e.getController("Statusbar").getView("Statusbar").update(),e.getController("CellEditor").setMode(n.appOptions),n.api.asc_registerCallback("asc_onInitEditorShapes",_.bind(n.fillAutoShapes,n)),n.api.asc_registerCallback("asc_onSaveUrl",_.bind(n.onSaveUrl,n)),n.api.asc_registerCallback("asc_onDocumentModifiedChanged",_.bind(n.onDocumentModifiedChanged,n)),n.api.asc_registerCallback("asc_onDocumentCanSaveChanged",_.bind(n.onDocumentCanSaveChanged,n)),n.updateThemeColors(),e.getController("FormulaDialog").setApi(n.api))},50)},50)}else Common.UI.info({title:this.requestEditFailedTitleText,msg:e.message||this.requestEditFailedMessageText})},onDocumentReady:function(){if(this._isDocReady)return;var e=this,t,r=[];e._isDocReady=!0,e.hidePreloader(),e.onLongActionEnd(c_oAscAsyncActionType.BlockInteraction,n),t=this.appOptions.isEditDiagram?100:window.localStorage.getItem("sse-settings-zoom"),this.api.asc_setZoom(t?parseInt(t)/100:1),t=window.localStorage.getItem("sse-settings-livecomment"),this.isLiveCommenting=t===null||parseInt(t)!=0,this.isLiveCommenting?this.api.asc_showComments():this.api.asc_hideComments(),e.api.asc_registerCallback("asc_onStartAction",_.bind(e.onLongActionBegin,e)),e.api.asc_registerCallback("asc_onConfirmAction",_.bind(e.onConfirmAction,e)),e.api.asc_registerCallback("asc_onActiveSheetChanged",_.bind(e.onActiveSheetChanged,e));var i=e.getApplication();e.headerView.setDocumentCaption(e.api.asc_getDocumentName()),e.updateWindowTitle(e.api.asc_isDocumentModified(),!0);var s=i.getController("Toolbar"),o=i.getController("Statusbar"),u=i.getController("DocumentHolder"),a=i.getController("RightMenu"),f=i.getController("LeftMenu"),l=i.getController("CellEditor"),c=o.getView("Statusbar"),h=f.getView("LeftMenu"),p=u.getView("DocumentHolder"),d=i.getController("Common.Controllers.Chat");h.getMenu("file").loadDocument({doc:e.appOptions.spreadsheet}),f.setMode(e.appOptions).createDelayedElements().setApi(e.api),h.disableMenu("all",!1),!e.appOptions.isEditDiagram&&e.appOptions.canBranding&&e.getApplication().getController("LeftMenu").leftMenu.getMenu("about").setLicInfo(e.editorConfig.customization),u.setApi(e.api).loadConfig({config:e.editorConfig}),l.setApi(e.api).setMode(this.appOptions),l.onApiCellSelection(e.api.asc_getCellInfo()),d.setApi(this.api).setMode(this.appOptions),o.createDelayedElements(),o.setApi(e.api),p.setApi(e.api),c.update(),this.formulaInput=l.getView("CellEditor").$el.find("textarea");if(e.appOptions.isEdit){e.needToUpdateVersion&&(Common.NotificationCenter.trigger("api:disconnect"),s.onApiCoAuthoringDisconnect());var v=setInterval(function(){if(window.styles_loaded||e.appOptions.isEditDiagram){clearInterval(v),Common.NotificationCenter.trigger("comments:updatefilter",{property:"uid",value:new RegExp("^(doc_|sheet"+e.api.asc_getActiveWorksheetId()+"_)")}),p.createDelayedElements(),s.createDelayedElements(),a.createDelayedElements(),e.appOptions.isEditDiagram||(e.api.asc_registerCallback("asc_onInitEditorShapes",_.bind(e.fillAutoShapes,e)),e.updateThemeColors()),e.api.asc_registerCallback("asc_onSaveUrl",_.bind(e.onSaveUrl,e)),e.api.asc_registerCallback("asc_onDocumentModifiedChanged",_.bind(e.onDocumentModifiedChanged,e)),e.api.asc_registerCallback("asc_onDocumentCanSaveChanged",_.bind(e.onDocumentCanSaveChanged,e));var t=i.getController("FormulaDialog");t&&t.setApi(e.api),e.needToUpdateVersion&&s.onApiCoAuthoringDisconnect()}},50)}e.appOptions.canAutosave?(t=window.localStorage.getItem("sse-settings-autosave"),t=t!==null?parseInt(t):1):t=0,e.api.asc_setAutoSaveGap(t),e.appOptions.canAnalytics&&Common.component.Analytics.initialize("UA-12442749-13","Spreadsheet Editor"),Common.Gateway.on("applyeditrights",_.bind(e.onApplyEditRights,e)),Common.Gateway.on("processsaveresult",_.bind(e.onProcessSaveResult,e)),Common.Gateway.on("processrightschange",_.bind(e.onProcessRightsChange,e)),Common.Gateway.on("processmouse",_.bind(e.onProcessMouse,e)),$(document).on("contextmenu",_.bind(e.onContextMenu,e)),!window.AscDesktopEditor||(Common.Utils.isIE9m&&r.push(e.warnBrowserIE9),!Common.Utils.isGecko&&!e.appOptions.isEditDiagram&&!e.appOptions.nativeApp&&Math.abs(e.getBrowseZoomLevel()-1)>.1&&r.push(Common.Utils.String.platformKey(e.warnBrowserZoom,"{0}")),r.length&&e.showTips(r))},onOpenDocument:function(e){var t=document.getElementById("loadmask-text"),n=(e.CurrentFont+e.CurrentImage)/(e.FontsCount+e.ImagesCount);n=this.textLoadingDocument+": "+Math.round(n*100)+"%",t?t.innerHTML=n:this.loadMask.setTitle(n)},onEditorPermissions:function(e){e&&(this.permissions.edit!==!1&&(this.permissions.edit=e.asc_getCanEdit()),this.permissions.download!==!1&&(this.permissions.download=e.asc_getCanDownload()),this.appOptions.canAutosave=this.editorConfig.canAutosave!==!1&&e.asc_getIsAutosaveEnable(),this.appOptions.canAnalytics=e.asc_getIsAnalyticsEnable(),this.appOptions.canCoAuthoring=!0,this.appOptions.canLicense=e.asc_getCanLicense?e.asc_getCanLicense():!1,this.appOptions.canComments=this.appOptions.canLicense&&(typeof this.editorConfig.customization!="object"||this.editorConfig.customization.comments!==!1),this.appOptions.canChat=this.appOptions.canLicense&&(typeof this.editorConfig.customization!="object"||this.editorConfig.customization.chat!==!1),this.appOptions.canBranding=e.asc_getCanBranding()&&typeof this.editorConfig.customization=="object",this.appOptions.canBranding&&this.headerView.setBranding(this.editorConfig.customization)),this.appOptions.canEdit=this.permissions.edit===!0,this.appOptions.isEdit=this.permissions.edit===!0&&this.editorConfig.mode!=="view",this.appOptions.canDownload=!this.appOptions.nativeApp&&(this.permissions.download!==undefined?this.permissions.download:!0),this.applyModeCommonElements(),this.applyModeEditorElements(),this.api.asc_setViewerMode(!this.appOptions.isEdit),this.appOptions.isEditDiagram?this.api.asc_LoadEmptyDocument():this.api.asc_LoadDocument(),this.appOptions.isEdit||(this.hidePreloader(),this.onLongActionBegin(c_oAscAsyncActionType.BlockInteraction,n))},applyModeCommonElements:function(){window.editor_elements_prepared=!0;var e=window.localStorage.getItem("sse-hidden-title");e=this.appOptions.isEdit&&e!==null&&parseInt(e)==1;var t=this.getApplication(),n=t.getController("Viewport").getView("Viewport"),r=t.getController("Statusbar").getView("Statusbar");this.headerView&&(this.headerView.setHeaderCaption(this.appOptions.isEdit?"Spreadsheet Editor":"Spreadsheet Viewer"),this.headerView.setVisible(!this.appOptions.nativeApp&&!e&&!this.appOptions.isDesktopApp&&!this.appOptions.isEditDiagram)),n&&n.setMode(this.appOptions,!0),r&&r.setMode(this.appOptions),t.getController("DocumentHolder").setMode(this.appOptions),this.appOptions.isEditDiagram&&(r.hide(),t.getController("LeftMenu").getView("LeftMenu").hide(),$(window).mouseup(function(e){Common.Gateway.internalMessage("processMouse",{event:"mouse:up"})}).mousemove($.proxy(function(e){this.isDiagramDrag&&Common.Gateway.internalMessage("processMouse",{event:"mouse:move",pagex:e.pageX,pagey:e.pageY})},this)));if(this.api){var i=new Asc.asc_CChartTranslate;i.asc_setTitle(this.txtDiagramTitle),i.asc_setXAxis(this.txtXAxis),i.asc_setYAxis(this.txtYAxis),i.asc_setSeries(this.txtSeries),this.api.asc_setChartTranslate(i)}this.appOptions.isEditDiagram||this.api.asc_registerCallback("asc_onSendThemeColors",_.bind(this.onSendThemeColors,this))},applyModeEditorElements:function(e){if(this.appOptions.isEdit){var r=this,i=this.getApplication(),s=i.getController("Toolbar"),o=i.getController("Statusbar"),u=i.getController("RightMenu"),a=i.getController("Print"),f=i.getController("Common.Controllers.Comments"),l=i.getController("Common.Controllers.Fonts");l&&l.setApi(r.api),s&&s.setApi(r.api),f&&(f.setMode(this.appOptions),f.setConfig({config:r.editorConfig,sdkviewname:"#ws-canvas-outer",hintmode:!0},r.api)),u&&u.setApi(r.api),a&&a.setApi(r.api),o&&o.getView("Statusbar").changeViewMode(!0),e=="view"&&f&&Common.NotificationCenter.trigger("comments:updatefilter",{property:"uid",value:new RegExp("^(doc_|sheet"+this.api.asc_getActiveWorksheetId()+"_)")});var c=this.getApplication().getController("Viewport").getView("Viewport");c.applyEditorMode(),this.toolbarView=s.getView("Toolbar"),_.each([this.toolbarView,u.getView("RightMenu")],func

]]></string> </value>
        </item>
        <item>
            <key> <string>next</string> </key>
            <value>
              <persistent> <string encoding="base64">AAAAAAAAAA8=</string> </persistent>
            </value>
        </item>
      </dictionary>
    </pickle>
  </record>
  <record id="15" aka="AAAAAAAAAA8=">
    <pickle>
      <global name="Pdata" module="OFS.Image"/>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>data</string> </key>
            <value> <string encoding="cdata"><![CDATA[

tion(e){e&&(e.setMode(r.appOptions),e.setApi(r.api))}),this.toolbarView&&(this.toolbarView.on("insertimage",_.bind(r.onInsertImage,r)),this.toolbarView.on("insertshape",_.bind(r.onInsertShape,r)),this.toolbarView.on("insertchart",_.bind(r.onInsertChart,r)));var h=window.localStorage.getItem("sse-settings-unit");Common.Utils.Metric.setCurrentMetric(h!==null?parseInt(h):Common.Utils.Metric.c_MetricUnits.cm);if(!r.appOptions.isEditDiagram){var p={};JSON.parse(window.localStorage.getItem("sse-hidden-title"))&&(p.title=!0),JSON.parse(window.localStorage.getItem("sse-hidden-formula"))&&(p.formula=!0),JSON.parse(window.localStorage.getItem("sse-hidden-headings"))&&(p.headings=!0),i.getController("Toolbar").hideElements(p)}else u.getView("RightMenu").hide();r.stackLongActions.exist({id:t,type:c_oAscAsyncActionType.BlockInteraction})?r.onLongActionEnd(c_oAscAsyncActionType.BlockInteraction,t):this._isDocReady||(r.hidePreloader(),r.onLongActionBegin(c_oAscAsyncActionType.BlockInteraction,n)),window.onbeforeunload=_.bind(r.onBeforeUnload,r)}},onExternalMessage:function(e){if(e){var t=e.msg.charAt(0).toUpperCase()+e.msg.substring(1),n=e.severity.indexOf("error")>=0?this.criticalErrorTitle:this.notcriticalErrorTitle;this.showTips([t],!1,n),Common.component.Analytics.trackEvent("External Error",e.title)}},onError:function(e,t,r){this.hidePreloader(),this.onLongActionEnd(c_oAscAsyncActionType.BlockInteraction,n);var i={closable:!1};switch(e){case c_oAscError.ID.Unknown:i.msg=this.unknownErrorText;break;case c_oAscError.ID.ConvertationTimeout:i.msg=this.convertationTimeoutText;break;case c_oAscError.ID.ConvertationError:i.msg=this.convertationErrorText;break;case c_oAscError.ID.DownloadError:i.msg=this.downloadErrorText;break;case c_oAscError.ID.UplImageSize:i.msg=this.uploadImageSizeMessage;break;case c_oAscError.ID.UplImageExt:i.msg=this.uploadImageExtMessage;break;case c_oAscError.ID.UplImageFileCount:i.msg=this.uploadImageFileCountMessage;break;case c_oAscError.ID.PastInMergeAreaError:i.msg=this.pastInMergeAreaError;break;case c_oAscError.ID.FrmlWrongCountParentheses:i.msg=this.errorWrongBracketsCount;break;case c_oAscError.ID.FrmlWrongOperator:i.msg=this.errorWrongOperator;break;case c_oAscError.ID.FrmlWrongMaxArgument:i.msg=this.errorCountArgExceed;break;case c_oAscError.ID.FrmlWrongCountArgument:i.msg=this.errorCountArg;break;case c_oAscError.ID.FrmlWrongFunctionName:i.msg=this.errorFormulaName;break;case c_oAscError.ID.FrmlAnotherParsingError:i.msg=this.errorFormulaParsing;break;case c_oAscError.ID.FrmlWrongArgumentRange:i.msg=this.errorArgsRange;break;case c_oAscError.ID.UnexpectedGuid:i.msg=this.errorUnexpectedGuid;break;case c_oAscError.ID.Database:i.msg=this.errorDatabaseConnection;break;case c_oAscError.ID.FileRequest:i.msg=this.errorFileRequest;break;case c_oAscError.ID.FileVKey:i.msg=this.errorFileVKey;break;case c_oAscError.ID.StockChartError:i.msg=this.errorStockChart;break;case c_oAscError.ID.DataRangeError:i.msg=this.errorDataRange;break;case c_oAscError.ID.FrmlOperandExpected:i.msg=this.errorOperandExpected;break;case c_oAscError.ID.VKeyEncrypt:i.msg=this.errorKeyEncrypt;break;case c_oAscError.ID.KeyExpire:i.msg=this.errorKeyExpire;break;case c_oAscError.ID.UserCountExceed:i.msg=this.errorUsersExceed;break;case c_oAscError.ID.CannotMoveRange:i.msg=this.errorMoveRange;break;case c_oAscError.ID.UplImageUrl:i.msg=this.errorBadImageUrl;break;case c_oAscError.ID.CoAuthoringDisconnect:i.msg=this.errorCoAuthoringDisconnect;break;case c_oAscError.ID.ConvertationPassword:i.msg=this.errorFilePassProtect;break;case c_oAscError.ID.AutoFilterDataRangeError:i.msg=this.errorAutoFilterDataRange;break;case c_oAscError.ID.AutoFilterChangeFormatTableError:i.msg=this.errorAutoFilterChangeFormatTable;break;case c_oAscError.ID.AutoFilterChangeError:i.msg=this.errorAutoFilterChange;break;case c_oAscError.ID.CannotFillRange:i.msg=this.errorFillRange;break;case c_oAscError.ID.UserDrop:i.msg=this.errorUserDrop;break;default:i.msg=this.errorDefaultMessage.replace("%1",e)}t==c_oAscError.Level.Critical?(Common.Gateway.reportError(e,i.msg),i.title=this.criticalErrorTitle,i.iconCls="error",this.editorConfig.canBackToFolder&&(i.msg+="<br/><br/>"+this.criticalErrorExtText,i.callback=function(e){e=="ok"&&Common.Gateway.goBack()})):(i.title=this.notcriticalErrorTitle,i.iconCls="warn",i.buttons=["ok"],i.callback=_.bind(function(e){this.onEditComplete()},this)),$(".asc-window.modal.alert:visible").length<1&&(Common.UI.alert(i),Common.component.Analytics.trackEvent("Internal Error",e.toString()))},onCoAuthoringDisconnect:function(){this.getApplication().getController("Viewport").getView("Viewport").setMode({isDisconnected:!0})},getBrowseZoomLevel:function(){if(Common.Utils.isIE)return screen.logicalXDPI/screen.deviceXDPI;var e=window.outerWidth/document.documentElement.clientWidth;return Common.Utils.isSafari&&(e=Math.floor(e*10)/10),e},showTips:function(e,t,n){function i(){var t=e.shift();t&&(t+=r.textCloseTip,s.setTitle(t),s.show())}var r=this;if(!e.length)return;typeof e!="object"&&(e=[e]),this.tooltip||(this.tooltip=new Common.UI.Tooltip({owner:this.toolbarView,hideonclick:!0,placement:"bottom",cls:"main-info",offset:30}));var s=this.tooltip;s.on("tooltip:hide",function(){setTimeout(i,300)}),i()},updateWindowTitle:function(e,t){if(this._state.isDocModified!==e||t){var n=this.defaultTitleText;_.isEmpty(this.headerView.getDocumentCaption())||(n=this.headerView.getDocumentCaption()+" - "+n),e?_.isUndefined(n)||(n="* "+n,this.headerView.setDocumentCaption(this.headerView.getDocumentCaption()+"*",!0)):this.headerView.setDocumentCaption(this.headerView.getDocumentCaption()),window.document.title!=n&&(window.document.title=n),this._state.isDocModified=e}},onDocumentChanged:function(){},onDocumentModifiedChanged:function(e){this.updateWindowTitle(e),Common.Gateway.setDocumentModified(e);if(this.toolbarView&&this.api){var t=$(".btn-icon",this.toolbarView.btnSave.cmpEl).hasClass("btn-synch"),n=this.api.asc_isDocumentCanSave();this.toolbarView.btnSave.isDisabled()!==(!n&&!t)&&this.toolbarView.btnSave.setDisabled(!n)}},onDocumentCanSaveChanged:function(e){if(this.toolbarView){var t=$(".btn-icon",this.toolbarView.btnSave.cmpEl).hasClass("btn-synch");this.toolbarView.btnSave.isDisabled()!==(!e&&!t)&&this.toolbarView.btnSave.setDisabled(!e&&!t)}},onBeforeUnload:function(){var e=this.permissions.edit===!0&&this.editorConfig.mode!=="view"&&this.editorConfig.mode!=="editdiagram";if(e&&this.api.asc_isDocumentModified())return this.leavePageText},hidePreloader:function(){!!this.appOptions.customization&&!this.appOptions.customization.done&&(this.appOptions.customization.done=!0,Common.Utils.applyCustomization(this.appOptions.customization,r)),this.stackLongActions.pop({id:e,type:c_oAscAsyncActionType.BlockInteraction}),Common.NotificationCenter.trigger("layout:changed","main"),$("#loading-mask").hide().remove()},onSaveUrl:function(e){Common.Gateway.save(e)},onUpdateVersion:function(e){var t=this;t.needToUpdateVersion=!0,t.onLongActionEnd(c_oAscAsyncActionType.BlockInteraction,n),Common.UI.error({msg:this.errorUpdateVersion,callback:function(){_.defer(function(){Common.Gateway.updateVersion(),e&&e.call(t),t.onLongActionBegin(c_oAscAsyncActionType.BlockInteraction,n)})}})},onAdvancedOptions:function(e){if(e.asc_getOptionId()==c_oAscAdvancedOptionsID.CSV){var t=this,r=new SSE.Views.OpenDialog({codepages:e.asc_getOptions().asc_getCodePages(),settings:e.asc_getOptions().asc_getRecommendedSettings(),handler:function(e,n){t.isShowOpenDialog=!1,t&&t.api&&(t.api.asc_setAdvancedOptions(c_oAscAdvancedOptionsID.CSV,new Asc.asc_CCSVAdvancedOptions(e,n)),t.loadMask&&t.loadMask.show())}});this.isShowOpenDialog=!0,this.loadMask&&this.loadMask.hide(),this.onLongActionEnd(c_oAscAsyncActionType.BlockInteraction,n),r.show()}},onActiveSheetChanged:function(e){!this.appOptions.isEditDiagram&&window.editor_elements_prepared&&(this.application.getController("Statusbar").selectTab(e),this.appOptions.isEdit&&Common.NotificationCenter.trigger("comments:updatefilter",{property:"uid",value:new RegExp("^(doc_|sheet"+this.api.asc_getWorksheetId(e)+"_)")},!1))},onConfirmAction:function(e,t){if(e==c_oAscConfirm.ConfirmReplaceRange){var n=this;Common.UI.warning({closable:!1,title:this.notcriticalErrorTitle,msg:this.confirmMoveCellRange,buttons:["yes","no"],callback:_.bind(function(e){t&&t(e==="ok"),e=="ok"&&n.onEditComplete(n.application.getController("DocumentHolder").getView("DocumentHolder"))},this)})}},initNames:function(){this.shapeGroupNames=[this.txtBasicShapes,this.txtFiguredArrows,this.txtMath,this.txtCharts,this.txtStarsRibbons,this.txtCallouts,this.txtButtons,this.txtRectangles,this.txtLines]},fillAutoShapes:function(e,t){if(_.isEmpty(t)||_.isEmpty(e)||t.length!=e.length)return;var n=this,r=[],i=this.getCollection("ShapeGroups");i.reset();var s=e.length;_.each(e,function(e,i){var s=new Backbone.Collection([],{model:SSE.Models.ShapeModel}),o=t[i].length>18?7:6,u=Math.ceil(t[i].length/o)*35+3,a=30*o;_.each(t[i],function(e,t){s.add({imageUrl:e.Image,data:{shapeType:e.Type},tip:n.textShape+" "+(t+1),allowSelected:!1,selected:!1})}),r.push({groupName:n.shapeGroupNames[i],groupStore:s,groupWidth:a,groupHeight:u})});if(s>0){var o=new Backbone.Collection([],{model:SSE.Models.ShapeModel}),u=t[s-1].length-3>18?7:6,a=Math.ceil((t[s-1].length-3)/u)*35+3,f=30*u;for(var l=0;l<t[s-1].length-3;l++){var c=t[s-1][l];o.add({imageUrl:c.Image,data:{shapeType:c.Type},allowSelected:!1,selected:!1})}r.push({groupName:n.shapeGroupNames[s-1],groupStore:o,groupWidth:f,groupHeight:a})}i.add(r),setTimeout(function(){n.getApplication().getController("Toolbar").fillAutoShapes()},50)},updateThemeColors:function(){var e=this;setTimeout(function(){e.getApplication().getController("RightMenu").UpdateThemeColors()},50),setTimeout(function(){e.getApplication().getController("Toolbar").updateThemeColors()},50),setTimeout(function(){e.getApplication().getController("Statusbar").updateThemeColors()},50)},onSendThemeColors:function(e,t){Common.Utils.ThemeColor.setColors(e,t),window.styles_loaded&&!this.appOptions.isEditDiagram&&this.updateThemeColors()},loadLanguages:function(){},onInsertImage:function(){this.getApplication().getController("RightMenu").onInsertImage()},onInsertChart:function(){this.getApplication().getController("RightMenu").onInsertChart()},onInsertShape:function(){this.getApplication().getController("RightMenu").onInsertShape()},onInternalCommand:function(e){if(e)switch(e.command){case"setChartData":this.setChartData(e.data);break;case"getChartData":this.getChartData();break;case"clearChartData":this.clearChartData();break;case"setAppDisabled":this.isAppDisabled=e.data,this.api.asc_enableKeyEvents(!1);break;case"queryClose":$("body .asc-window:visible").length===0&&Common.Gateway.internalMessage("canClose",{mr:e.data.mr,answer:!0});break;case"window:drag":this.isDiagramDrag=e.data;break;case"processmouse":this.onProcessMouse(e.data)}},setChartData:function(e){typeof e=="object"&&this.api&&this.api.asc_addChartDrawingObject(e)},getChartData:function(){if(this.api){var e=this.api.asc_getWordChartObject();typeof e=="object"&&Common.Gateway.internalMessage("chartData",{data:e})}},clearChartData:function(){this.api&&this.api.asc_cleanWorksheet()},unitsChanged:function(e){var t=window.localStorage.getItem("sse-settings-unit");Common.Utils.Metric.setCurrentMetric(t!==null?parseInt(t):Common.Utils.Metric.c_MetricUnits.cm),this.getApplication().getController("RightMenu").updateMetricUnit(),this.getApplication().getController("Print").getView("MainSettingsPrint").updateMetricUnit()},_compareActionStrong:function(e,t){return e.id===t.id&&e.type===t.type},_compareActionWeak:function(e,t){return e.type===t.type},onContextMenu:function(e){var t=e.target.getAttribute("data-can-copy"),n=e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement;if(n&&t==="false"||!n&&t!=="true")return e.stopPropagation(),e.preventDefault(),!1},leavePageText:"You have unsaved changes in this document. Click \'Stay on this Page\' then \'Save\' to save them. Click \'Leave this Page\' to discard all the unsaved changes.",criticalErrorTitle:"Error",notcriticalErrorTitle:"Warning",errorDefaultMessage:"Error code: %1",criticalErrorExtText:\'Press "Ok" to to back to document list.\',openTitleText:"Opening Document",openTextText:"Opening document...",saveTitleText:"Saving Document",saveTextText:"Saving document...",loadFontsTitleText:"Loading Data",loadFontsTextText:"Loading data...",loadImagesTitleText:"Loading Images",loadImagesTextText:"Loading images...",loadFontTitleText:"Loading Data",loadFontTextText:"Loading data...",loadImageTitleText:"Loading Image",loadImageTextText:"Loading image...",downloadTitleText:"Downloading Document",downloadTextText:"Downloading document...",printTitleText:"Printing Document",printTextText:"Printing document...",uploadImageTitleText:"Uploading Image",uploadImageTextText:"Uploading image...",savePreparingText:"Preparing to save",savePreparingTitle:"Preparing to save. Please wait...",loadingDocumentTitleText:"Loading Document",uploadImageSizeMessage:"Maximium image size limit exceeded.",uploadImageExtMessage:"Unknown image format.",uploadImageFileCountMessage:"No images uploaded.",reloadButtonText:"Reload Page",unknownErrorText:"Unknown error.",convertationTimeoutText:"Convertation timeout exceeded.",convertationErrorText:"Convertation failed.",downloadErrorText:"Download failed.",unsupportedBrowserErrorText:"Your browser is not supported.",requestEditFailedTitleText:"Access denied",requestEditFailedMessageText:"Someone is editing this document right now. Please try again later.",warnBrowserZoom:"Your browser\'s current zoom setting is not fully supported. Please reset to the default zoom by pressing Ctrl+0.",warnBrowserIE9:"The application has low capabilities on IE9. Use IE10 or higher",pastInMergeAreaError:"Cannot change part of a merged cell",titleRecalcFormulas:"Calculating formulas...",textRecalcFormulas:"Calculating formulas...",textPleaseWait:"It\'s working hard. Please wait...",errorWrongBracketsCount:"Found an error in the formula entered.<br>Wrong cout of brackets.",errorWrongOperator:"Found an error in the formula entered.<br>Wrong operator.",errorCountArgExceed:"Found an error in the formula entered.<br>Count of arguments exceeded.",errorCountArg:"Found an error in the formula entered.<br>Invalid number of arguments.",errorFormulaName:"Found an error in the formula entered.<br>Incorrect formula name.",errorFormulaParsing:"Internal error while the formula parsing.",errorArgsRange:"Found an error in the formula entered.<br>Incorrect arguments range.",errorUnexpectedGuid:"External error.<br>Unexpected Guid. Please, contact support.",errorDatabaseConnection:"External error.<br>Database connection error. Please, contact support.",errorFileRequest:"External error.<br>File Request. Please, contact support.",errorFileVKey:"External error.<br>Incorrect securety key. Please, contact support.",errorStockChart:"Incorrect row order. To build a stock chart place the data on the sheet in the following order:<br> opening price, max price, min price, closing price.",errorDataRange:"Incorrect data range.",errorOperandExpected:"Operand expected",errorKeyEncrypt:"Unknown key descriptor",errorKeyExpire:"Key descriptor expired",errorUsersExceed:"Count of users was exceed",errorMoveRange:"Cann\'t change a part of merged cell",errorBadImageUrl:"Image url is incorrect",errorCoAuthoringDisconnect:"Server connection lost. You can\'t edit anymore.",errorFilePassProtect:"The document is password protected.",txtEditingMode:"Set editing mode...",textLoadingDocument:"LOADING DOCUMENT",textConfirm:"Confirmation",confirmMoveCellRange:"The destination cell\'s range can contain data. Continue the operation?",textYes:"Yes",textNo:"No",textAnonymous:"Anonymous",txtBasicShapes:"Basic Shapes",txtFiguredArrows:"Figured Arrows",txtMath:"Math",txtCharts:"Charts",txtStarsRibbons:"Stars & Ribbons",txtCallouts:"Callouts",txtButtons:"Buttons",txtRectangles:"Rectangles",txtLines:"Lines",txtDiagramTitle:"Diagram Title",txtXAxis:"X Axis",txtYAxis:"Y Axis",txtSeries:"Seria",warnProcessRightsChange:"You have been denied the right to edit the file.",errorProcessSaveResult:"Saving is failed.",errorAutoFilterDataRange:"The operation could not be done for the selected range of cells.<br>Select a uniform data range inside or outside the table and try again.",errorAutoFilterChangeFormatTable:"The operation could not be done for the selected cells as you cannot move a part of the table.<br>Select another data range so that the whole table was shifted and try again.",errorAutoFilterChange:"The operation is not allowed, as it is attempting to shift cells in a table on your worksheet.",textCloseTip:"\\nClick to close the tip.",textShape:"Shape",errorFillRange:"Could not fill the selected range of cells.<br>All the merged cells need to be the same size.",errorUpdateVersion:"The file version has been changed. The page will be reloaded.",defaultTitleText:"ONLYOFFICE Spreadsheet Editor",errorUserDrop:"The file cannot be accessed right now."}}(),SSE.Controllers.Main||{}))}),define("text!spreadsheeteditor/main/app/template/PrintSettings.template",[],function(){return\'<div class="settings-panel active">\\r\\n    <div class="padding-large inner-content" >\\r\\n        <div id="printadv-dlg-radio-current" class="padding-small" style="display: block;"></div>\\r\\n        <div id="printadv-dlg-radio-all" class="padding-small" style="display: block;"></div>\\r\\n        <div id="printadv-dlg-radio-selection" style="display: block;"></div>\\r\\n    </div>\\r\\n    <div class="separator horizontal padding-large"/>\\r\\n    <div class="padding-large inner-content" >\\r\\n        <div id="printadv-dlg-combo-pages" class="input-group-nr" />\\r\\n    </div>\\r\\n    <div class="separator horizontal padding-large"/>\\r\\n    <div class="padding-large inner-content" >\\r\\n        <span id="printadv-dlg-combo-orient" />\\r\\n    </div>\\r\\n    <div id="printadv-dlg-content-to-hide">\\r\\n        <div class="separator horizontal padding-large"/>\\r\\n        <div class="padding-large inner-content" >\\r\\n            <table cols="2" class="no-padding">\\r\\n            <tr>\\r\\n                <td><label><%= scope.strTop %></label></td>\\r\\n                <td><label><%= scope.strBottom %></label></td>\\r\\n                </tr>\\r\\n            <tr>\\r\\n                <td class="padding-small"><div id="printadv-dlg-spin-margin-top" style="margin-right: 15px;"></div></td>\\r\\n                <td class="padding-small"><div id="printadv-dlg-spin-margin-bottom"></div></td>\\r\\n            </tr>\\r\\n            <tr>\\r\\n                <td><label><%= scope.strLeft %></label></td>\\r\\n                <td><label><%= scope.strRight %></label></td>\\r\\n                </tr>\\r\\n            <tr>\\r\\n                <td><div id="printadv-dlg-spin-margin-left" style="margin-right: 15px;"></div></td>\\r\\n                <td><div id="printadv-dlg-spin-margin-right"></div></td>\\r\\n                </tr>\\r\\n            </table>\\r\\n        </div>\\r\\n        <div class="separator horizontal padding-large"/>\\r\\n        <!--<div class="padding-large inner-content" >-->\\r\\n            <!--<div id="printadv-dlg-radio-actual" class="padding-small" style="display: block;"></div>-->\\r\\n            <!--<div id="printadv-dlg-radio-fit" class="" style="display: block;"></div>-->\\r\\n        <!--</div>-->\\r\\n        <!--<div class="separator horizontal padding-large"/>-->\\r\\n        <div class="inner-content">\\r\\n            <div id="printadv-dlg-chb-grid" style="margin-bottom: 10px;"/>\\r\\n            <div id="printadv-dlg-chb-rows"/>\\r\\n        </div>\\r\\n    </div>\\r\\n</div>\\r\\n\'}),define("spreadsheeteditor/main/app/view/PrintSettings",["text!spreadsheeteditor/main/app/template/PrintSettings.template","common/main/lib/view/AdvancedSettingsWindow","common/main/lib/component/MetricSpinner","common/main/lib/component/CheckBox","common/main/lib/component/RadioBox","common/main/lib/component/ListView"],function(e){SSE.Views.PrintSettings=Common.Views.AdvancedSettingsWindow.extend(_.extend({options:{alias:"PrintSettings",contentWidth:280,height:482},initialize:function(t){_.extend(this.options,{title:this.textTitle,template:[\'<div class="box" style="height:\'+(this.options.height-85)+\'px;">\',\'<div class="menu-panel" style="overflow: hidden;">\',\'<div style="height: 90px; line-height: 90px;" class="div-category">\'+this.textPrintRange+"</div>",\'<div style="height: 55px; line-height: 55px;" class="div-category">\'+this.textPageSize+"</div>",\'<div style="height: 55px; line-height: 55px;" class="div-category">\'+this.textPageOrientation+"</div>",\'<div style="height: 122px; line-height: 122px;" class="div-category">\'+this.strMargins+"</div>",\'<div style="height: 73px; line-height: 73px;" class="div-category">\'+this.strPrint+"</div>","</div>",\'<div class="separator"/>\',\'<div class="content-panel">\'+_.template(e)({scope:this})+"</div>","</div>",\'<div class="separator horizontal"/>\',\'<div class="footer justify">\',\'<button id="printadv-dlg-btn-hide" class="btn btn-text-default" style="margin-right: 55px; width: 100px;">\'+this.textHideDetails+"</button>",\'<button class="btn normal dlg-btn primary" result="ok" style="margin-right: 10px;  width: 150px;">\'+this.btnPrint+"</button>",\'<button class="btn normal dlg-btn" result="cancel" style="width: 86px;">\'+this.cancelButtonText+"</button>","</div>"].join("")},t),Common.Views.AdvancedSettingsWindow.prototype.initialize.call(this,this.options),this.spinners=[]},render:function(){Common.Views.AdvancedSettingsWindow.prototype.render.call(this),this.radioCurrent=new Common.UI.RadioBox({el:$("#printadv-dlg-radio-current"),labelText:this.textCurrentSheet,name:"asc-radio-printrange",checked:!0}),this.radioCurrent.on("change",_.bind(this.onRadioRangeChange,this)),this.radioAll=new Common.UI.RadioBox({el:$("#printadv-dlg-radio-all"),labelText:this.textAllSheets,name:"asc-radio-printrange"}),this.radioAll.on("change",_.bind(this.onRadioRangeChange,this)),this.radioSelection=new Common.UI.RadioBox({el:$("#printadv-dlg-radio-selection"),labelText:this.textSelection,name:"asc-radio-printrange"}),this.radioSelection.on("change",_.bind(this.onRadioRangeChange,this)),this.cmbPaperSize=new Common.UI.ComboBox({el:$("#printadv-dlg-combo-pages"),style:"width: 260px;",menuStyle:"max-height: 280px; min-width: 260px;",editable:!1,cls:"input-group-nr",data:[{value:"215.9|279.4",displayValue:"US Letter (21,59cm x 27,94cm)"},{value:"215.9|355.6",displayValue:"US Legal (21,59cm x 35,56cm)"},{value:"210|297",displayValue:"A4 (21cm x 29,7cm)"},{value:"148.1|209.9",displayValue:"A5 (14,81cm x 20,99cm)"},{value:"176|250.1",displayValue:"B5 (17,6cm x 25,01cm)"},{value:"104.8|241.3",displayValue:"Envelope #10 (10,48cm x 24,13cm)"},{value:"110.1|220.1",displayValue:"Envelope DL (11,01cm x 22,01cm)"},{value:"279.4|431.7",displayValue:"Tabloid (27,94cm x 43,17cm)"},{value:"297|420.1",displayValue:"A3 (29,7cm x 42,01cm)"},{value:"304.8|457.1",displayValue:"Tabloid Oversize (30,48cm x 45,71cm)"},{value:"196.8|273",displayValue:"ROC 16K (19,68cm x 27,3cm)"},{value:"119.9|234.9",displayValue:"Envelope Choukei 3 (11,99cm x 23,49cm)"},{value:"330.2|482.5",displayValue:"Super B/A3 (33,02cm x 48,25cm)"}]}),this.cmbPaperOrientation=new Common.UI.ComboBox({el:$("#printadv-dlg-combo-orient"),style:"width: 115px;",menuStyle:"min-width: 115px;",editable:!1,cls:"input-group-nr",data:[{value:c_oAscPageOrientation.PagePortrait,displayValue:this.strPortrait},{value:c_oAscPageOrientation.PageLandscape,displayValue:this.strLandscape}]}),this.chPrintGrid=new Common.UI.CheckBox({el:$("#printadv-dlg-chb-grid"),labelText:this.textPrintGrid}),this.chPrintRows=new Common.UI.CheckBox({el:$("#printadv-dlg-chb-rows"),labelText:this.textPrintHeadings}),this.spnMarginTop=new Common.UI.MetricSpinner({el:$("#printadv-dlg-spin-margin-top"),step:.1,width:115,defaultUnit:"cm",value:"0 cm",maxValue:48.25,minValue:0}),this.spinners.push(this.spnMarginTop),this.spnMarginBottom=new Common.UI.MetricSpinner({el:$("#printadv-dlg-spin-margin-bottom"),step:.1,width:115,defaultUnit:"cm",value:"0 cm",maxValue:48.25,minValue:0}),this.spinners.push(this.spnMarginBottom),this.spnMarginLeft=new Common.UI.MetricSpinner({el:$("#printadv-dlg-spin-margin-left"),step:.1,width:115,defaultUnit:"cm",value:"0.19 cm",maxValue:48.25,minValue:0}),this.spinners.push(this.spnMarginLeft),this.spnMarginRight=new Common.UI.MetricSpinner({el:$("#printadv-dlg-spin-margin-right"),step:.1,width:115,defaultUnit:"cm",value:"0.19 cm",maxValue:48.25,minValue:0}),this.spinners.push(this.spnMarginRight),this.btnHide=new Common.UI.Button({el:$("#printadv-dlg-btn-hide")}),this.btnHide.on("click",_.bind(this.handlerShowDetails,this)),this.panelDetails=$("#printadv-dlg-content-to-hide"),this.updateMetricUnit(),this.options.afterrender&&this.options.afterrender.call(this)},setRange:function(e){e==c_oAscPrintType.ActiveSheets?this.radioCurrent.setValue(!0):e==c_oAscPrintType.EntireWorkbook?this.radioAll.setValue(!0):this.radioSelection.setValue(!0)},setLayout:function(e){},getRange:function(){return this.radioCurrent.getValue()?c_oAscPrintType.ActiveSheets:this.radioAll.getValue()?c_oAscPrintType.EntireWorkbook:c_oAscPrintType.Selection},getLayout:function(){},onRadioRangeChange:function(e,t){t&&this.fireEvent("changerange",this)},updateMetricUnit:function(){if(this.spinners)for(var e=0;e<this.spinners.length;e++){var t=this.spinners[e];t.setDefaultUnit(Common.Utils.Metric.metricName[Common.Utils.Metric.getCurrentMetric()]),t.setStep(Common.Utils.Metric.getCurrentMetric()==Common.Utils.Metric.c_MetricUnits.cm?.1:1)}},handlerShowDetails:function(e){this.extended?(this.extended=!1,this.panelDetails.css({display:"block"}),this.setHeight(482),e.setCaption(this.textHideDetails)):(this.extended=!0,this.panelDetails.css({display:"none"}),this.setHeight(286),e.setCaption(this.textShowDetails))},textTitle:"Print Settings",strLeft:"Left",strRight:"Right",strTop:"Top",strBottom:"Bottom",strPortrait:"Portrait",strLandscape:"Landscape",textPrintGrid:"Print Gridlines",textPrintHeadings:"Print Rows and Columns Headings",textPageSize:"Page Size",textPageOrientation:"Page Orientation",strMargins:"Margins",strPrint:"Print",btnPrint:"Save & Print",textPrintRange:"Print Range",textLayout:"Layout",textCurrentSheet:"Current Sheet",textAllSheets:"All Sheets",textSelection:"Selection",textActualSize:"Actual Size",textFit:"Fit to width",textShowDetails:"Show Details",cancelButtonText:"Cancel",textHideDetails:"Hide Details"},SSE.Views.PrintSettings||{}))}),define("spreadsheeteditor/main/app/controller/Print",["core","spreadsheeteditor/main/app/view/FileMenuPanels","spreadsheeteditor/main/app/view/PrintSettings"],function(){SSE.Controllers.Print=Backbone.Controller.extend(_.extend({views:["MainSettingsPrint"],initialize:function(){this.adjPrintParams=new Asc.asc_CAdjustPrint,this.adjPrintParams.asc_setPrintType(c_oAscPrintType.ActiveSheets),this.adjPrintParams.asc_setLayoutPageType(c_oAscLayoutPageType.ActualSize),this.diffParams={},this.addListeners({MainSettingsPrint:{show:_.bind(this.onShowMainSettingsPrint,this),"render:after":_.bind(this.onAfterRender,this)},Statusbar:{updatesheetsinfo:_.bind(function(){this.printSettings.isVisible()?this.updateSettings():(this.isFillSheets=!1,this.diffParams={})},this)},PrintSettings:{changerange:_.bind(this.onChangeRange,this)}})},onLaunch:function(){this.printSettings=this.createView("MainSettingsPrint")},onAfterRender:function(e){this.printSettings.cmbSheet.on("selected",_.bind(this.comboSheetsChange,this)),this.printSettings.btnOk.on("click",_.bind(this.querySavePrintSettings,this));var t=SSE.getController("Toolbar").getView("Toolbar");t&&t.mnuPrint.on("item:click",_.bind(this.openPrintSettings,this))},setApi:function(e){this.api=e},updateSettings:function(){var e=this.api.asc_getWorksheetsCount(),t=-1,n=[{displayValue:this.strAllSheets,value:-255}];while(++t<e)this.api.asc_isWorksheetHidden(t)||n.push({displayValue:this.api.asc_getWorksheetName(t),value:t});this.printSettings.cmbSheet.store.reset(n);var r=this.printSettings.cmbSheet.store.findWhere({value:this.printSettings.cmbSheet.getValue()})||this.printSettings.cmbSheet.store.findWhere({value:this.api.asc_getActiveWorksheetIndex()});r&&this.printSettings.cmbSheet.setValue(r.get("value"))},comboSheetsChange:function(e,t){var n=t.value;n==-255?this.indeterminatePageOptions(this.printSettings):this.fillPageOptions(this.printSettings,this.api.asc_getPageOptions(n))},isDiffRefill:function(){for(var e in this.diffParams)if(this.diffParams[e]==undefined)return!0;return e==undefined},indeterminatePageOptions:function(e){if(this.isDiffRefill()){var t=this.api.asc_getWorksheetsCount();if(t==1)this.diffParams.orientation=!1,this.diffParams.size=!1,this.diffParams.headings=!1,this.diffParams.grid=!1,this.diffParams.margintop=!1,this.diffParams.marginright=!1,this.diffParams.marginbottom=!1,this.diffParams.marginleft=!1;else{var n=0,r=this.api.asc_getPageOptions(n),i;while(++n<t)i=this.api.asc_getPageOptions(n),this.diffParams.orientation==undefined&&(this.diffParams.orientation=r.asc_getPageSetup().asc_getOrientation()!=i.asc_getPageSetup().asc_getOrientation()),this.diffParams.size==undefined&&(this.diffParams.size=r.asc_getPageSetup().asc_getWidth()!=i.asc_getPageSetup().asc_getWidth()||r.asc_getPageSetup().asc_getHeight()!=i.asc_getPageSetup().asc_getHeight()),this.diffParams.headings==undefined&&(this.diffParams.headings=r.asc_getHeadings()!=i.asc_getHeadings()),this.diffParams.grid==undefined&&(this.diffParams.grid=r.asc_getGridLines()!=i.asc_getGridLines()),this.diffParams.margintop==undefined&&(this.diffParams.margintop=Math.abs(r.asc_getPageMargins().asc_getTop()-i.asc_getPageMargins().asc_getTop())>.001),this.diffParams.marginright==undefined&&(this.diffParams.marginright=Math.abs(r.asc_getPageMargins().asc_getRight()-i.asc_getPageMargins().asc_getRight())>.001),this.diffParams.marginbottom==undefined&&(this.diffParams.marginbottom=Math.abs(r.asc_getPageMargins().asc_getBottom()-i.asc_getPageMargins().asc_getBottom())>.001),this.diffParams.marginleft==undefined&&(this.diffParams.marginleft=Math.abs(r.asc_getPageMargins().asc_getLeft()-i.asc_getPageMargins().asc_getLeft())>.001)}}this.diffParams.orientation&&e.cmbPaperOrientation.setValue("-"),this.diffParams.size&&e.cmbPaperSize.setValue("-"),this.diffParams.margintop&&e.spnMarginTop.setValue("-"),this.diffParams.marginright&&e.spnMarginRight.setValue("-"),this.diffParams.marginbottom&&e.spnMarginBottom.setValue("-"),this.diffParams.marginleft&&e.spnMarginLeft.setValue("-"),this.diffParams.grid&&e.chPrintGrid.setValue("indeterminate"),this.diffParams.headings&&e.chPrintRows.setValue("indeterminate")},fillPageOptions:function(e,t){var n=t.asc_getPageSetup(),r=e.cmbPaperOrientation.store.findWhere({value:n.asc_getOrientation()});r&&e.cmbPaperOrientation.setValue(r.get("value"));var i=n.asc_getWidth(),s=n.asc_getHeight();r=e.cmbPaperSize.store.findWhere({value:i+"|"+s}),r?e.cmbPaperSize.setValue(r.get("value")):e.cmbPaperSize.setValue("Custom ("+i+" x "+s),n=t.asc_getPageMargins(),e.spnMarginLeft.setValue(Common.Utils.Metric.fnRecalcFromMM(n.asc_getLeft())),e.spnMarginTop.setValue(Common.Utils.Metric.fnRecalcFromMM(n.asc_getTop())),e.spnMarginRight.setValue(Common.Utils.Metric.fnRecalcFromMM(n.asc_getRight())),e.spnMarginBottom.setValue(Common.Utils.Metric.fnRecalcFromMM(n.asc_getBottom())),e.chPrintGrid.setValue(t.asc_getGridLines()),e.chPrintRows.setValue(t.asc_getHeadings())},fillPrintOptions:function(e,t){e.setRange(t.asc_getPrintType())},getPageOptions:function(e){var t=new Asc.asc_CPageOptions;t.asc_setGridLines(e.chPrintGrid.getValue()=="indeterminate"?undefined:e.chPrintGrid.getValue()=="checked"?1:0),t.asc_setHeadings(e.chPrintRows.getValue()=="indeterminate"?undefined:e.chPrintRows.getValue()=="checked"?1:0);var n=new Asc.asc_CPageSetup;n.asc_setOrientation(e.cmbPaperOrientation.getValue()=="-"?undefined:e.cmbPaperOrientation.getValue());var r=/^\\d{3}\\.?\\d*/.exec(e.cmbPaperSize.getValue()),i=/\\d{3}\\.?\\d*$/.exec(e.cmbPaperSize.getValue());return n.asc_setWidth(r?parseFloat(r[0]):undefined),n.asc_setHeight(i?parseFloat(i[0]):undefined),t.asc_setPageSetup(n),n=new Asc.asc_CPageMargins,n.asc_setLeft(e.spnMarginLeft.getValue()=="-"?undefined:Common.Utils.Metric.fnRecalcToMM(e.spnMarginLeft.getNumberValue())),n.asc_setTop(e.spnMarginTop.getValue()=="-"?undefined:Common.Utils.Metric.fnRecalcToMM(e.spnMarginTop.getNumberValue())),n.asc_setRight(e.spnMarginRight.getValue()=="-"?undefined:Common.Utils.Metric.fnRecalcToMM(e.spnMarginRight.getNumberValue())),n.asc_setBottom(e.spnMarginBottom.getValue()=="-"?undefined:Common.Utils.Metric.fnRecalcToMM(e.spnMarginBottom.getNumberValue())),t.asc_setPageMargins(n),t},savePageOptions:function(e,t){var n=this.getPageOptions(e);if(t==-255){var r=this.api.asc_getWorksheetsCount();t=-1;while(++t<r)this.api.asc_setPageOptions(n,t);this.diffParams.orientation&&(this.diffParams.orientation=n.asc_getPageSetup().asc_getOrientation()==undefined),this.diffParams.size&&(this.diffParams.size=n.asc_getPageSetup().asc_getWidth()==undefined||n.asc_getPageSetup().asc_getHeight()==undefined),this.diffParams.headings&&(this.diffParams.headings=n.asc_getHeadings()==undefined),this.diffParams.grid&&(this.diffParams.grid=n.asc_getGridLines()==undefined),this.diffParams.margintop&&(this.diffParams.margintop=n.asc_getPageMargins().asc_getTop()==undefined),this.diffParams.marginright&&(this.diffParams.marginright=n.asc_getPageMargins().asc_getRight()==undefined),this.diffParams.marginbottom&&(this.diffParams.marginbottom=n.asc_getPageMargins().asc_getBottom()==undefined),this.diffParams.marginleft&&(this.diffParams.marginleft=n.asc_getPageMargins().asc_getLeft()==undefined)}else this.api.asc_setPageOptions(n,t),this.diffParams={}},onShowMainSettingsPrint:function(){this.isFillSheets||(this.isFillSheets=!0,this.updateSettings());if(!this.isUpdatedSettings){this.isUpdatedSettings=!0;var e=this.printSettings.cmbSheet.store.findWhere({value:this.api.asc_getActiveWorksheetIndex()});e&&(this.printSettings.cmbSheet.setValue(e.get("value")),this.comboSheetsChange(this.printSettings.cmbSheet,e.toJSON()))}},openPrintSettings:function(e,t){t.value==="options"&&this.api&&(this.printSettingsDlg=new SSE.Views.PrintSettings({handler:_.bind(this.resultPrintSettings,this),afterrender:_.bind(function(){this.fillPageOptions(this.printSettingsDlg,this.api.asc_getPageOptions()),this.fillPrintOptions(this.printSettingsDlg,this.adjPrintParams)},this)}),this.printSettingsDlg.show())},resultPrintSettings:function(e,t){var n=SSE.getController("Toolbar").getView("Toolbar");if(e=="ok"){if(!this.checkMargins(this.printSettingsDlg))return!0;this.savePageOptions(this.printSettingsDlg,this.printSettingsDlg.getRange()==c_oAscPrintType.EntireWorkbook?-255:undefined),this.adjPrintParams.asc_setPrintType(this.printSettingsDlg.getRange()),this.api.asc_Print(this.adjPrintParams),this.isUpdatedSettings=!1}Common.NotificationCenter.trigger("edit:complete",n)},onChangeRange:function(){var e=this.printSettingsDlg.getRange();e==c_oAscPrintType.EntireWorkbook?this.indeterminatePageOptions(this.printSettingsDlg):this.lastCheckedRange==c_oAscPrintType.EntireWorkbook&&this.fillPageOptions(this.printSettingsDlg,this.api.asc_getPageOptions()),this.lastCheckedRange=e},querySavePrintSettings:function(){this.checkMargins(this.printSettings)&&(this.savePageOptions(this.printSettings,this.printSettings.cmbSheet.getValue()),this.printSettings.applySettings())},checkMargins:function(e){if(e.cmbPaperOrientation.getValue()==c_oAscPageOrientation.PagePortrait)var t=/^\\d{3}\\.?\\d*/.exec(e.cmbPaperSize.getValue()),n=/\\d{3}\\.?\\d*$/.exec(e.cmbPaperSize.getValue());else n=/^\\d{3}\\.?\\d*/.exec(e.cmbPaperSize.getValue()),t=/\\d{3}\\.?\\d*$/.exec(e.cmbPaperSize.getValue());t=parseFloat(t[0]),n=parseFloat(n[0]);var r=Common.Utils.Metric.fnRecalcToMM(e.spnMarginLeft.getNumberValue()),i=Common.Utils.Metric.fnRecalcToMM(e.spnMarginRight.getNumberValue()),s=Common.Utils.Metric.fnRecalcToMM(e.spnMarginTop.getNumberValue()),o=Common.Utils.Metric.fnRecalcToMM(e.spnMarginBottom.getNumberValue()),u=!1;return r>t?u="left":i>t-r?u="right":s>n?u="top":o>n-s&&(u="bottom"),u?(Common.UI.warning({title:this.textWarning,msg:this.warnCheckMargings,callback:function(t,n){switch(u){case"left":e.spnMarginLeft.$el.focus();return;case"right":e.spnMarginRight.$el.focus();return;case"top":e.spnMarginTop.$el.focus();return;case"bottom":e.spnMarginBottom.$el.focus();return}}}),!1):!0},warnCheckMargings:"Margins are incorrect",strAllSheets:"All Sheets",textWarning:"Warning"},SSE.Controllers.Print||{}))});if(Common===undefined)var Common={};Common.Models=Common.Models||{},define("common/main/lib/model/Comment",["underscore","backbone","common/main/lib/component/BaseView"],function(e,t){Common.Models.Comment=t.Model.extend({defaults:{uid:0,userid:0,username:"Guest",date:undefined,quote:"",comment:"",resolved:!1,lock:!1,lockuserid:"",unattached:!1,id:Common.UI.getId(),time:0,showReply:!1,showReplyInPopover:!1,editText:!1,editTextInPopover:!1,last:undefined,replys:[],hideAddReply:!1,scope:null,hide:!1,hint:!1,dummy:undefined}}),Common.Models.Reply=t.Model.extend({defaults:{time:0,userid:0,username:"Guest",reply:"",date:undefined,id:Common.UI.getId(),editText:!1,editTextInPopover:!1,scope:null}})});if(Common===undefined)var Common={};Common.Collections=Common.Collections||{},define("common/main/lib/collection/Comments",["underscore","backbone","common/main/lib/model/Comment"],function(e,t){Common.Collections.Comments=t.Collection.extend({model:Common.Models.Comment,clearEditing:function(){this.each(function(e){e.set("editText",!1),e.set("editTextInPopover",!1),e.set("showReply",!1),e.set("showReplyInPopover",!1),e.set("hideAddReply",!1)})},getCommentsReplysCount:function(e){var t=0;return this.each(function(n){n.get("userid")==e&&t++;var r=n.get("replys");r&&r.length>0&&r.forEach(function(n){n.get("userid")==e&&t++})}),t}})});if(Common===undefined)var Common={};Common.Controllers=Common.Controllers||{},define("common/main/lib/controller/Comments",["core","common/main/lib/model/Comment","common/main/lib/collection/Comments","common/main/lib/view/Comments"],function(){function e(){return typeof asc_CCommentDataWord!="undefined"?new asc_CCommentDataWord(null):new asc_CCommentData(null)}Common.Controllers.Comments=Backbone.Controller.extend(_.extend({models:[],collections:["Common.Collections.Comments"],views:["Common.Views.Comments","Common.Views.CommentsPopover"],sdkViewName:"#id_main",subEditStrings:{},filter:undefined,hintmode:!1,isSelectedComment:!1,uids:[],oldUids:[],isDummyComment:!1,initialize:function(){this.addListeners({"Common.Views.Comments":{"comment:add":_.bind(this.onCreateComment,this),"comment:change":_.bind(this.onChangeComment,this),"comment:remove":_.bind(this.onRemoveComment,this),"comment:resolve":_.bind(this.onResolveComment,this),"comment:show":_.bind(this.onShowComment,this),"comment:addReply":_.bind(this.onAddReplyComment,this),"comment:changeReply":_.bind(this.onChangeReplyComment,this),"comment:removeReply":_.bind(this.onRemoveReplyComment,this),"comment:editReply":_.bind(this.onShowEditReplyComment,this),"comment:closeEditing":_.bind(this.closeEditing,this),"comment:disableHint":_.bind(this.disableHint,this),"comment:addDummyComment":_.bind(this.onAddDummyComment,this)}}),Common.NotificationCenter.on("comments:updatefilter",_.bind(this.onUpdateFilter,this))},onLaunch:function(){this.collection=this.getApplication().getCollection("Common.Collections.Comments"),this.collection&&(this.collection.comparator=function(e){return-e.get("time")}),this.popoverComments=new Common.Collections.Comments,this.popoverComments&&(this.popoverComments.comparator=function(e){return-e.get("time")}),this.view=this.createView("Common.Views.Comments",{store:this.collection,popoverComments:this.popoverComments}),this.view.render(),this.bindViewEvents(this.view,this.events)},setConfig:function(e,t){this.setApi(t),e&&(this.currentUserId=e.config.user.id,this.currentUserName=e.config.user.name,this.sdkViewName=e.sdkviewname||this.sdkViewName,this.hintmode=e.hintmode||!1)},setApi:function(e){e&&(this.api=e,this.api.asc_registerCallback("asc_onAddComment",_.bind(this.onApiAddComment,this)),this.api.asc_registerCallback("asc_onAddComments",_.bind(this.onApiAddComments,this)),this.api.asc_registerCallback("asc_onRemoveComment",_.bind(this.onApiRemoveComment,this)),this.api.asc_registerCallback("asc_onChangeComments",_.bind(this.onChangeComments,this)),this.api.asc_registerCallback("asc_onRemoveComments",_.bind(this.onRemoveComments,this)),this.api.asc_registerCallback("asc_onChangeCommentData",_.bind(this.onApiChangeCommentData,this)),this.api.asc_registerCallback("asc_onLockComment",_.bind(this.onApiLockComment,this)),this.api.asc_registerCallback("asc_onUnLockComment",_.bind(this.onApiUnLockComment,this)),this.api.asc_registerCallback("asc_onShowComment",_.bind(this.onApiShowComment,this)),this.api.asc_registerCallback("asc_onHideComment",_.bind(this.onApiHideComment,this)),this.api.asc_registerCallback("asc_onUpdateCommentPosition",_.bind(this.onApiUpdateCommentPosition,this)),this.api.asc_registerCallback("asc_onDocumentPlaceChanged",_.bind(this.onDocumentPlaceChanged,this)))},setMode:function(e){return this.mode=e,this},onCreateComment:function(t,n,r,i,s){if(this.api&&n&&n.length>0){var o=e();o&&(this.showPopover=!0,this.editPopover=r?!0:!1,this.hidereply=i,this.isSelectedComment=!1,this.uids=[],o.asc_putText(n),o.asc_putTime(this.utcDateToString(new Date)),o.asc_putUserId(this.currentUserId),o.asc_putUserName(this.currentUserName),o.asc_putSolved(!1),_.isUndefined(o.asc_putDocumentFlag)||o.asc_putDocumentFlag(s),this.api.asc_addComment(o),this.view.showEditContainer(!1))}this.view.txtComment.focus()},onRemoveComment:function(e){this.api&&e&&this.api.asc_removeComment(e)},onResolveComment:function(t,n){var r=this,i=null,s=null,o=e(),u=r.findComment(t,n);return _.isUndefined(t)&&(t=u.get("uid")),o&&u?(o.asc_putText(u.get("comment")),o.asc_putQuoteText(u.get("quote")),o.asc_putTime(r.utcDateToString(new Date(u.get("time")))),o.asc_putUserId(r.currentUserId),o.asc_putUserName(r.currentUserName),o.asc_putSolved(!u.get("resolved")),_.isUndefined(o.asc_putDocumentFlag)||o.asc_putDocumentFlag(u.get("unattached")),i=u.get("replys"),i&&i.length&&i.forEach(function(t){s=e(),s&&(s.asc_putText(t.get("reply")),s.asc_putTime(r.utcDateToString(new Date(t.get("time")))),s.asc_putUserId(t.get("userid")),s.asc_putUserName(t.get("username")),o.asc_addReply(s))}),r.api.asc_changeComment(t,o),!0):!1},onShowComment:function(e,t){var n=this.findComment(e,undefined);if(n)if(null!==n.get("quote")){if(this.api){if(this.hintmode){this.animate=!0;if(n.get("unattached")&&this.getPopover()){this.getPopover().hide();return}}else{var r=this.popoverComments.findWhere({uid:e});if(r)return}!_.isUndefined(t)&&this.hintmode&&(this.isSelectedComment=t),this.api.asc_selectComment(e),this.api.asc_showComment(e,!1)}}else this.hintmode&&this.api.asc_selectComment(e),this.getPopover()&&this.getPopover().hide(),this.isSelectedComment=!1,this.uids=[]},onChangeComment:function(t,n){if(n&&n.length>0){var r=this,i=null,s=null,o=null,u=e(),a=r.findComment(t);if(a&&u)return u.asc_putText(n),u.asc_putQuoteText(a.get("quote")),u.asc_putTime(r.utcDateToString(new Date(a.get("time")))),u.asc_putUserId(r.currentUserId),u.asc_putUserName(r.currentUserName),u.asc_putSolved(a.get("resolved")),_.isUndefined(u.asc_putDocumentFlag)||u.asc_putDocumentFlag(a.get("unattached")),a.set("editTextInPopover",!1),i=r.findPopupComment(t),i&&i.set("editTextInPopover",!1),r.subEditStrings[t]&&delete r.subEditStrings[t],r.subEditStrings[t+"-R"]&&delete r.subEditStrings[t+"-R"],s=a.get("replys"),s&&s.length&&s.forEach(function(t){o=e(),o&&(o.asc_putText(t.get("reply")),o.asc_putTime(r.utcDateToString(new Date(t.get("time")))),o.asc_putUserId(t.get("userid")),o.asc_putUserName(t.get("username")),u.asc_addReply(o))}),r.api.asc_changeComment(t,u),!0}return!1},onChangeReplyComment:function(t,n,r){if(r&&r.length>0){var i=this,s=null,o=null,u=e(),a=i.findComment(t);if(u&&a)return u.asc_putText(a.get("comment")),u.asc_putQuoteText(a.get("quote")),u.asc_putTime(i.utcDateToString(new Date(a.get("time")))),u.asc_putUserId(a.get("userid")),u.asc_putUserName(a.get("username")),u.asc_putSolved(a.get("resolved")),_.isUndefined(u.asc_putDocumentFlag)||u.asc_putDocumentFlag(a.get("unattached")),s=a.get("replys"),s&&s.length&&s.forEach(function(t){o=e(),o&&(t.get("id")===n&&!_.isUndefined(r)?(o.asc_putText(r),o.asc_putUserId(i.currentUserId),o.asc_putUserName(i.currentUserName)):(o.asc_putText(t.get("reply")),o.asc_putUserId(t.get("userid")),o.asc_putUserName(t.get("username"))),o.asc_putTime(i.utcDateToString(new Date(t.get("time")))),u.asc_addReply(o))}),i.api.asc_changeComment(t,u),!0}return!1},onAddReplyComment:function(t,n){if(n.length>0){var r=this,i=null,s=null,o=null,u=e(),a=r.findComment(t);if(u&&a){i=a.get("uid"),i&&(r.subEditStrings[i]&&delete r.subEditStrings[i],r.subEditStrings[i+"-R"]&&delete r.subEditStrings[i+"-R"],a.set("showReplyInPopover",!1)),u.asc_putText(a.get("comment")),u.asc_putQuoteText(a.get("quote")),u.asc_putTime(r.utcDateToString(new Date(a.get("time")))),u.asc_putUserId(a.get("userid")),u.asc_putUserName(a.get("username")),u.asc_putSolved(a.get("resolved")),_.isUndefined(u.asc_putDocumentFlag)||u.asc_putDocumentFlag(a.get("unattached")),s=a.get("replys"),s&&s.length&&s.forEach(function(t){o=e(),o&&(o.asc_putText(t.get("reply")),o.asc_putTime(r.utcDateToString(new Date(t.get("time")))),o.asc_putUserId(t.get("userid")),o.asc_putUserName(t.get("username")),u.asc_addReply(o))}),o=e();if(o)return o.asc_putText(n),o.asc_putTime(r.utcDateToString(new Date)),o.asc_putUserId(r.currentUserId),o.asc_putUserName(r.currentUserName),u.asc_addReply(o),r.api.asc_changeComment(t,u),!0}}return!1},onRemoveReplyComment:function(t,n){if(!_.isUndefined(t)&&!_.isUndefined(n)){var r=this,i=null,s=null,o=e(),u=r.findComment(t);if(o&&u)return o.asc_putText(u.get("comment")),o.asc_putQuoteText(u.get("quote")),o.asc_putTime(r.utcDateToString(new Date(u.get("time")))),o.asc_putUserId(u.get("userid")),o.asc_putUserName(u.get("username")),o.asc_putSolved(u.get("resolved")),_.isUndefined(o.asc_putDocumentFlag)||o.asc_putDocumentFlag(u.get("unattached")),i=u.get("replys"),i&&i.length&&i.forEach(function(t){t.get("id")!==n&&(s=e(),s&&(s.asc_putText(t.get("reply")),s.asc_putTime(r.utcDateToString(new Date(t.get("time")))),s.asc_putUserId(t.get("userid")),s.asc_putUserName(t.get("username")),o.asc_addReply(s)))}),r.api.asc_changeComment(t,o),!0}return!1},onShowEditReplyComment:function(e,t,n){var r,i,s,o;if(!_.isUndefined(e)&&!_.isUndefined(t))if(n){i=this.popoverComments.findWhere({uid:e});if(i){s=i.get("replys"),o=_.clone(i.get("replys"));if(o)for(r=0;r<o.length;++r)if(t===o[r].get("id"))return o[r].set("editTextInPopover",!0),s.length=0,i.set("replys",o),!0}}else{i=this.collection.findWhere({uid:e});if(i){s=i.get("replys"),o=_.clone(i.get("replys"));if(o)for(r=0;r<o.length;++r)if(t===o[r].get("id"))return o[r].set("editText",!0),s.length=0,i.set("replys",o),!0}}return!1},onUpdateFilter:function(e,t){if(e){this.filter={property:e.property,value:e.value},t||this.getPopover()&&this.getPopover().hide();var n=this,r=null;this.collection.each(function(e){var t=e.get(n.filter.property);t&&e.set("hide",null===t.match(n.filter.value)),e.get("last")&&e.set("last",!1),e.get("hide")||(r=e)}),r&&r.set("last",!0)}},onApiAddComment:function(e,t){var n=this.readSDKComment(e,t);n&&(this.collection.push(n),this.updateComments(!0),this.showPopover&&(null!==t.asc_getQuoteText()&&(this.api.asc_selectComment(e),this.api.asc_showComment(e,!0)),this.showPopover=undefined,this.editPopover=!1))},onApiAddComments:function(e){for(var t=0;t<e.length;++t){var n=this.readSDKComment(e[t].Id,e[t].Comment);this.collection.push(n)}this.updateComments(!0)},onApiRemoveComment:function(e,t){if(this.collection.length){var n=this.collection.findWhere({uid:e});n&&(this.collection.remove(n),t||this.updateComments(!0)),this.popoverComments.length&&(n=this.popoverComments.findWhere({uid:e}),n&&(this.popoverComments.remove(n),0===this.popoverComments.length&&this.getPopover()&&this.getPopover().hide()))}},onChangeComments:function(e){for(var t=0;t<e.length;++t)this.onApiChangeCommentData(e[t].Comment.Id,e[t].Comment,!0);this.updateComments(!0)},onRemoveComments:function(e){for(var t=0;t<e.length;++t)this.onApiRemoveComment(e[t],!0);this.updateComments(!0)},onApiChangeCommentData:function(e,t,n){var r=this,i=0,s=null,o=null,u=0,a=null,f=this.findComment(e);if(f){r=this,s=t.asc_getTime()==""?new Date:new Date(this.stringUtcToLocalDate(t.asc_getTime())),f.set("comment",t.asc_getText()),f.set("userid",t.asc_getUserId()),f.set("username",t.asc_getUserName()),f.set("resolved",t.asc_getSolved()),f.set("quote",t.asc_getQuoteText()),f.set("time",s.getTime()),f.set("date",r.dateToLocaleTimeString(s)),o=_.clone(f.get("replys")),o.length=0,u=t.asc_getRepliesCount();for(i=0;i<u;++i)a=t.asc_getReply(i).asc_getTime()==""?new Date:new Date(this.stringUtcToLocalDate(t.asc_getReply(i).asc_getTime())),o.push(new Common.Models.Reply({id:Common.UI.getId(),userid:t.asc_getReply(i).asc_getUserId(),username:t.asc_getReply(i).asc_getUserName(),date:r.dateToLocaleTimeString(a),reply:t.asc_getReply(i).asc_getText(),time:a.getTime(),editText:!1,editTextInPopover:!1,showReplyInPopover:!1,scope:r.view}));o.sort(function(e,t){return e.get("time")-t.get("time")}),f.set("replys",o),n||(this.updateComments(!1,!0),this.getPopover()&&this.getPopover().isVisible()&&this.api.asc_showComment(e,!0))}},onApiLockComment:function(e,t){var n=this.findComment(e),r=null,i=null;n&&(r=this.getApplication().getCollection("Common.Collections.Users"),r&&(i=r.findWhere({id:t}),i&&(n.set("lock",!0),n.set("lockuserid",this.view.getUserName(i.get("username"))))))},onApiUnLockComment:function(e){var t=this.findComment(e);t&&t.set("lock",!1)},onApiShowComment:function(e,t,n,r,i,s){if(s&&this.isSelectedComment&&0===_.difference(this.uids,e).length)return;this.mode&&!this.mode.canComments&&(s=!0);if(this.getPopover()){this.clearDummyComment();if(this.isSelectedComment&&0===_.difference(this.uids,e).length){this.api&&(this.getPopover().commentsView.setFocusToTextBox(!0),this.api.asc_enableKeyEvents(!0));return}var o=0,u="",a="",f=null,l="",c=!0;this.popoverComments.reset();for(o=0;o<e.length;++o)u=e[o],a=e[o]+"-R",f=this.findComment(u),this.subEditStrings[u]?(f.set("editTextInPopover",!0),l=this.subEditStrings[u]):this.subEditStrings[a]&&(f.set("showReplyInPopover",!0),l=this.subEditStrings[a]),f.set("hint",_.isUndefined(s)?!1:s),!s&&this.hintmode&&(0===_.difference(this.uids,e).length&&this.uids.length===0&&(c=!1),this.oldUids.length&&0===_.difference(this.oldUids,e).length&&(c=!1,this.oldUids=[])),this.animate&&(c=this.animate,this.animate=!1),this.isSelectedComment=!s,this.uids=_.clone(e),this.popoverComments.push(f);this.getPopover().isVisible()&&this.getPopover().hide(),this.getPopover().setLeftTop(t,n,r),this.getPopover().show(c,!1,!0,l)}},onApiHideComment:function(e){var t=this;if(this.getPopover()){if(this.isSelectedComment&&e)return;this.popoverComments.each(function(e){e.get("editTextInPopover")&&(t.subEditStrings[e.get("uid")]=t.getPopover().getEditText()),e.get("showReplyInPopover")&&(t.subEditStrings[e.get("uid")+"-R"]=t.getPopover().getEditText())}),this.getPopover().saveText(!0),this.getPopover().hide(),this.collection.clearEditing(),this.popoverComments.clearEditing(),this.oldUids=_.clone(this.uids),this.isSelectedComment=!1,this.uids=[],this.popoverComments.reset()}},onApiUpdateCommentPosition:function(e,t,n,r){var i,s=!1,o=null,u=undefined,a="",f="";if(this.getPopover()){this.getPopover().saveText();if(n<0||this.getPopover().sdkBounds.height<n||!_.isUndefined(r)&&this.getPopover().sdkBounds.width<r)this.getPopover().hide();else{if(0===this.popoverComments.length){this.popoverComments.reset();for(i=0;i<e.length;++i)a=e[i],f=e[i]+"-R",o=this.findComment(a),this.subEditStrings[a]?(o.set("editTextInPopover",!0),u=this.subEditStrings[a]):this.subEditStrings[f]&&(o.set("showReplyInPopover",!0),u=this.subEditStrings[f]),this.popoverComments.push(o);s=!0,this.getPopover().show(s,undefined,undefined,u)}else this.getPopover().isVisible()||this.getPopover().show(!1,undefined,undefined,u);this.getPopover().setLeftTop(t,n,r)}}},onDocumentPlaceChanged:function(){if(this.isDummyComment&&this.getPopover()&&this.getPopover().isVisible()){var e=this.api.asc_getAnchorPosition();e&&this.getPopover().setLeftTop(e.asc_getX()+e.asc_getWidth(),e.asc_getY(),this.hintmode?e.asc_getX():undefined)}},updateComments:function(e,t){var n,r=!0;_.isUndefined(t)&&this.collection.sort();if(e){for(n=this.collection.length-1;n>=0;--n)r?this.collection.at(n).set("last",!0,{silent:!0}):this.collection.at(n).get("last")&&this.collection.at(n).set("last",!1,{silent:!0}),r=!1;this.onUpdateFilter(this.filter,!0),this.view.render()}this.view.renderResolvedComboButtons(),this.view.update()},findComment:function(e,t){return _.isUndefined(e)?this.collection.findWhere({id:t}):this.collection.findWhere({uid:e})},findPopupComment:function(e){return this.popoverComments.findWhere({id:e})},closeEditing:function(e){var t=this;if(!_.isUndefined(e)){var n=this.findPopupComment(e);n&&(n.set("editTextInPopover",!1),n.set("showReplyInPopover",!1)),this.subEditStrings[e]&&delete this.subEditStrings[e],this.subEditStrings[e+"-R"]&&delete this.subEditStrings[e+"-R"]}this.collection.clearEditing(),this.collection.each(function(e){var t=_.clone(e.get("replys"));e.get("replys").length=0,t.forEach(function(e){e.get("editText")&&e.set("editText",!1),e.get("editTextInPopover")&&e.set("editTextInPopover",!1)}),e.set("replys",t)}),this.view.showEditContainer(!1),this.view.update()},disableHint:function(e){e&&this.mode.canComments&&(e.set("hint",!1),this.isSelectedComment=!0)},blockPopover:function(e){this.isSelectedComment=e,e&&this.getPopover().isVisible()&&this.getPopover().hide()},getPopover:function(){return this.view.getPopover(this.sdkViewName)},readSDKComment:function(e,t){var n=t.asc_getTime()==""?new Date:new Date(this.stringUtcToLocalDate(t.asc_getTime())),r=new Common.Models.Comment({uid:e,userid:t.asc_getUserId(),username:t.asc_getUserName(),date:this.dateToLocaleTimeString(n),quote:t.asc_getQuoteText(),comment:t.asc_getText(),resolved:t.asc_getSolved(),unattached:_.isUndefined(t.asc_getDocumentFlag)?!1:t.asc_getDocumentFlag(),id:Common.UI.getId(),time:n.getTime(),showReply:!1,editText:!1,last:undefined,editTextInPopover:this.editPopover?!0:!1,showReplyInPopover:!1,hideAddReply:_.isUndefined(this.hidereply)?this.showPopover?!0:!1:this.hidereply,scope:this.view});if(r){var i=this.readSDKReplies(t);i.length&&r.set("replys",i)}return r},readSDKReplies:function(e){var t=0,n=[],r=null,i=e.asc_getRepliesCount();if(i){for(t=0;t<i;++t)r=e.asc_getReply(t).asc_getTime()==""?new Date:new Date(this.stringUtcToLocalDate(e.asc_getReply(t).asc_getTime())),n.push(new Common.Models.Reply({id:Common.UI.getId(),userid:e.asc_getReply(t).asc_getUserId(),username:e.asc_getReply(t).asc_getUserName(),date:this.dateToLocaleTimeString(r),reply:e.asc_getReply(t).asc_getText(),time:r.getTime(),editText:!1,editTextInPopover:!1,showReplyInPopover:!1,scope:this.view}));n.sort(function(e,t){return e.get("time")-t.get("time")})}return n},addDummyComment:function(){if(this.api){var e=this,t=null,n=new Date,r=this.getPopover();if(r){if(this.popoverComments.length){_.delay(function(){e.api.asc_enableKeyEvents(!1),r.commentsView.setFocusToTextBox()},200);return}var i=new Common.Models.Comment({id:-1,time:n.getTime(),date:this.dateToLocaleTimeString(n),userid:this.currentUserId,username:this.currentUserName,editTextInPopover:!0,showReplyInPopover:!1,hideAddReply:!0,scope:this.view,dummy:!0});this.popoverComments.reset(),this.popoverComments.push(i),this.uids=[],this.isSelectedComment=!0,this.isDummyComment=!0,_.isUndefined(this.api.asc_SetDocumentPlaceChangedEnabled)||e.api.asc_SetDocumentPlaceChangedEnabled(!0),r.handlerHide=function(){},r.isVisible()&&r.hide(),r.handlerHide=function(){e.clearDummyComment()},t=this.api.asc_getAnchorPosition(),t&&(r.setLeftTop(t.asc_getX()+t.asc_getWidth(),t.asc_getY(),this.hintmode?t.asc_getX():undefined),r.show(!0,!1,!0))}}},onAddDummyComment:function(t){if(this.api&&t&&t.length>0){var n=e();n&&(this.showPopover=!0,this.editPopover=!1,this.hidereply=!1,this.isSelectedComment=!1,this.uids=[],this.isDummyComment=!1,this.popoverComments.reset(),n.asc_putText(t),n.asc_putTime(this.utcDateToString(new Date)),n.asc_putUserId(this.currentUserId),n.asc_putUserName(this.currentUserName),n.asc_putSolved(!1),_.isUndefined(n.asc_putDocumentFlag)||n.asc_putDocumentFlag(!1),this.api.asc_addComment(n),this.view.showEditContainer(!1),_.isUndefined(this.api.asc_SetDocumentPlaceChangedEnabled)||this.api.asc_SetDocumentPlaceChangedEnabled(!1))}},clearDummyComment:function(){if(this.isDummyComment){this.isDummyComment=!1,this.showPopover=!0,this.editPopover=!1,this.hidereply=!1,this.isSelectedComment=!1,this.uids=[];var e=this.getPopover();e&&(e.handlerHide=function(){},e.isVisible()&&e.hide()),this.popoverComments.reset(),_.isUndefined(this.api.asc_SetDocumentPlaceChangedEnabled)||this.api.asc_SetDocumentPlaceChangedEnabled(!1)}},onEditComments:function(e){if(this.api){var t=0,n=this,r=null,i=this.api.asc_getAnchorPosition();if(i){this.isSelectedComment=!0,this.popoverComments.reset();for(t=0;t<e.length;++t)r=this.findComment(e[t].asc_getId()),r.set("editTextInPopover",!0),r.set("hint",!1),this.popoverComments.push(r);this.getPopover()&&(this.getPopover().isVisible()&&this.getPopover().hide(),this.getPopover().setLeftTop(i.asc_getX()+i.asc_getWidth(),i.asc_getY(),this.hintmode?i.asc_getX():undefined),this.getPopover().show(!0,!1,!0))}}},focusOnInput:function(){if(this.view&&this.api){var e=$("#comments-new-comment-ct",this.view.el);e&&e.length&&"none"!==e.css("display")&&(this.api.asc_enableKeyEvents(!1),this.view.txtComment.focus())}},timeZoneOffsetInMs:(new Date).getTimezoneOffset()*6e4,stringUtcToLocalDate:function(e){return typeof e=="string"?parseInt(e)+this.timeZoneOffsetInMs:0},utcDateToString:function(e){return Object.prototype.toString.call(e)==="[object Date]"?(e.getTime()-this.timeZoneOffsetInMs).toString():""},dateToLocaleTimeString:function(e){function t(e){var t,n=e.getHours(),r=e.getMinutes(),i=n>=12?"pm":"am";return n%=12,n=n?n:12,r=r<10?"0"+r:r,t=n+":"+r+" "+i,t}return e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear()+" "+t(e)}},Common.Controllers.Comments||{}))}),define("common/main/lib/model/User",["backbone"],function(e){Common.Models=Common.Models||{},Common.Models.User=e.Model.extend({defaults:{id:undefined,username:"Guest",color:"#fff",colorval:null,online:!1}})}),define("common/main/lib/collection/Users",["backbone","common/main/lib/model/User"],function(e){Common.Collections=Common.Collections||{},Common.Collections.Users=e.Collection.extend({model:Common.Models.User,getOnlineCount:function(){var e=0;return this.each(function(t){t.online&&e++}),e},findUser:function(e){return this.find(function(t){return t.get("id")==e})}}),Common.Collections.HistoryUsers=e.Collection.extend({model:Common.Models.User,findUser:function(e){return this.find(function(t){return t.get("id")==e})}})}),define("common/main/lib/model/ChatMessage",["backbone"],function(e){Common.Models=Common.Models||{},Common.Models.ChatMessage=e.Model.extend({defaults:{type:0,userid:null,username:"",message:""}})}),define("common/main/lib/collection/ChatMessages",["backbone","common/main/lib/model/ChatMessage"],function(e){!Common.Collections&&(Common.Collections={}),Common.Collections.ChatMessages=e.Collection.extend({model:Common.Models.ChatMessage})}),define("common/main/lib/controller/Chat",["core","common/main/lib/collection/Users","common/main/lib/collection/ChatMessages","common/main/lib/view/Chat"],function(){Common.Controllers.Chat=Backbone.Controller.extend(_.extend({models:[],collections:["Common.Collections.Users","Common.Collections.ChatMessages"],views:["Common.Views.Chat"],initialize:function(){this.addListeners({"Common.Views.Chat":{"message:add":_.bind(this.onSendMessage,this)}})},events:{},onLaunch:function(){this.panelChat=this.createView("Common.Views.Chat",{storeUsers:this.getApplication().getCollection("Common.Collections.Users"),storeMessages:this.getApplication().getCollection("Common.Collections.ChatMessages")})},setMode:function(e){return this.mode=e,this.api&&(this.mode.canCoAuthoring&&this.mode.canChat&&this.api.asc_registerCallback("asc_onCoAuthoringChatReceiveMessage",_.bind(this.onReceiveMessage,this)),this.api.asc_registerCallback("asc_onAuthParticipantsChanged",_.bind(this.onUsersChanged,this)),this.api.asc_registerCallback("asc_onConnectionStateChanged",_.bind(this.onUserConnection,this)),this.api.asc_coAuthoringGetUsers(),this.mode.canCoAuthoring&&this.mode.canChat&&this.api.asc_coAuthoringChatGetMessages()),this},setApi:function(e){return this.api=e,this},onUsersChanged:function(e){if(!this.mode.canCoAuthoring){var t=0;for(i in e)undefined!==i&&t++;if(t>2&&this._isCoAuthoringStopped==undefined){this._isCoAuthoringStopped=!0,this.api.asc_coAuthoringDisconnect(),Common.NotificationCenter.trigger("api:disconnect"),setTimeout(_.bind(function(){Common.UI.alert({closable:!1,title:this.notcriticalErrorTitle,msg:this.textUserLimit,iconCls:"warn",buttons:["ok"]})},this),100);return}}var n=this.getApplication().getCollection("Common.Collections.Users");if(n){var r=[],i,s;for(i in e)undefined!==i&&(s=e[i],s&&r.push(new Common.Models.User({id:s.asc_getId(),username:s.asc_getUserName(),online:!0,color:s.asc_getColor()})));n[n.size()>0?"add":"reset"](r)}},onUserConnection:function(e){var t=this.getApplication().getCollection("Common.Collections.Users");if(t){var n=t.findUser(e.asc_getId());n?n.set({online:e.asc_getState()}):t.add(new Common.Models.User({id:e.asc_getId(),username:e.asc_getUserName(),online:e.asc_getState(),color:e.asc_getColor()}))}},onReceiveMessage:function(e){var t=this.getApplication().getCollection("Common.Collections.ChatMessages");if(t){var n=[];e.forEach(function(e){n.push(new Common.Models.ChatMessage({userid:e.user,message:e.message,username:e.username}))}),t[t.size()>0?"add":"reset"](n)}},onSendMessage:function(e,t){if(t.length>0){var n=function(e,t){var n=[];while(e){if(e.length<t){n.push(e);break}n.push(e.substr(0,t)),e=e.substr(t)}return n},r=this;n(t,2048).forEach(function(e){r.api.asc_coAuthoringChatSendMessage(e)})}},notcriticalErrorTitle:"Warning",textUserLimit:\'You are using ONLYOFFICE Editors free version.<br>Only two users can co-edit the document simultaneously.<br>Want more? Consider buying ONLYOFFICE Editors Pro version.<br><a href="http://www.onlyoffice.com" target="_blank">Read more</a>\'},Common.Controllers.Chat||{}))}),"use strict",require.config({baseUrl:"../../",waitSeconds:360,paths:{jquery:"../vendor/jquery/jquery",underscore:"../vendor/underscore/underscore",backbone:"../vendor/backbone/backbone",bootstrap:"../vendor/bootstrap/dist/js/bootstrap",text:"../vendor/requirejs-text/text",perfectscrollbar:"common/main/lib/mods/perfect-scrollbar",jmousewheel:"../vendor/perfect-scrollbar/src/jquery.mousewheel",xregexp:"../vendor/xregexp/xregexp-all-min",sockjs:"../vendor/sockjs/sockjs.min",allfonts:"../sdk/Common/AllFonts",sdk:"../sdk/Excel/sdk-all",api:"api/documents/api",core:"common/main/lib/core/application",notification:"common/main/lib/core/NotificationCenter",keymaster:"common/main/lib/core/keymaster",tip:"common/main/lib/util/Tip",analytics:"common/Analytics",gateway:"common/Gateway",locale:"common/locale",irregularstack:"common/IrregularStack"},shim:{underscore:{exports:"_"},backbone:{deps:["underscore","jquery"],exports:"Backbone"},bootstrap:{deps:["jquery"]},perfectscrollbar:{deps:["jmousewheel"]},notification:{deps:["backbone"]},core:{deps:["backbone","notification","irregularstack"]},sdk:{deps:["jquery","underscore","allfonts","xregexp","sockjs"]},gateway:{deps:["jquery"]},analytics:{deps:["jquery"]}}}),require(["backbone","bootstrap","core","sdk","api","analytics","gateway","locale"],function(e,t,n){e.history.start();var r=new e.Application({nameSpace:"SSE",autoCreate:!1,controllers:["Viewport","DocumentHolder","CellEditor","FormulaDialog","Print","Toolbar","Statusbar","RightMenu","LeftMenu","Main","Common.Controllers.Fonts","Common.Controllers.Chat","Common.Controllers.Comments"]});Common.Locale.apply(),require(["spreadsheeteditor/main/app/controller/Viewport","spreadsheeteditor/main/app/controller/DocumentHolder","spreadsheeteditor/main/app/controller/CellEditor","spreadsheeteditor/main/app/controller/Toolbar","spreadsheeteditor/main/app/controller/Statusbar","spreadsheeteditor/main/app/controller/RightMenu","spreadsheeteditor/main/app/controller/LeftMenu","spreadsheeteditor/main/app/controller/Main","spreadsheeteditor/main/app/controller/Print","spreadsheeteditor/main/app/view/ParagraphSettings","spreadsheeteditor/main/app/view/ImageSettings","spreadsheeteditor/main/app/view/ChartSettings","spreadsheeteditor/main/app/view/ShapeSettings","common/main/lib/util/utils","common/main/lib/controller/Fonts","common/main/lib/controller/Comments","common/main/lib/controller/Chat"],function(){r.start()})}),define("../apps/spreadsheeteditor/main/app.js",function(){});

]]></string> </value>
        </item>
        <item>
            <key> <string>next</string> </key>
            <value>
              <none/>
            </value>
        </item>
      </dictionary>
    </pickle>
  </record>
</ZopeData>
