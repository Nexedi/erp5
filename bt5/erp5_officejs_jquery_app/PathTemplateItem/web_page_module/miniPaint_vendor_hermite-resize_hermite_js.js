//Hermite resize - fast image resize/resample using Hermite filter.
//Author: ViliusL
//https://github.com/viliusle/Hermite-resize
//http://viliusle.github.io/miniPaint/
function Hermite_class(){var a,c,b=[];this.init=function(){a=navigator.hardwareConcurrency||4}(),this.getCores=function(){return a},this.resample_auto=function(a,b,c,d,e){var f=this.getCores();window.Worker&&f>1?this.resample(a,b,c,d,e):(this.resample_single(a,b,c,!0),e())},this.resize_image=function(a,b,c,d,e){var f=document.getElementById(a),g=document.createElement("canvas");g.width=f.width,g.height=f.height;var h=g.getContext("2d");if(h.drawImage(f,0,0),void 0==b&&void 0==c&&void 0!=d&&(b=f.width/100*d,c=f.height/100*d),void 0==c){var i=f.width/b;c=f.height/i}b=Math.round(b),c=Math.round(c);var j=function(){var a=g.toDataURL();f.width=b,f.height=c,f.src=a,delete a,delete g};void 0==e||1==e?this.resample(g,b,c,!0,j):(this.resample_single(g,b,c,!0),j())},this.resample=function(d,e,f,g,h){var i=d.width,j=d.height;e=Math.round(e),f=Math.round(f);var k=Math.ceil(j/f/2);if(b.length>0)for(var l=0;l<a;l++)void 0!=b[l]&&(b[l].terminate(),delete b[l]);b=new Array(a);for(var m=d.getContext("2d"),n=new Array(a),o=new Array(a),l=0;l<a;l++){var p=Math.ceil(j/a)*l,q=Math.ceil(j/a)+k*a;p+q>j&&(q=j-p),q<1||(n[l]=m.getImageData(0,p,i,q),p=Math.ceil(f/a)*l,q=Math.ceil(f/a),p+q>f&&(q=f-p),q<1||(o[l]=!0))}g===!0?(d.width=e,d.height=f):m.clearRect(0,0,i,j);for(var r=0,l=0;l<a;l++)if(void 0!=o[l]){r++;var s=new Worker(c);b[l]=s,s.onmessage=function(c){r--;var d=c.data.core;delete b[d],o[d]=m.createImageData(e,Math.ceil(f/a)),o[d].data.set(c.data.target);var g=Math.ceil(f/a)*d;m.putImageData(o[d],0,g),r<=0&&h()};var t={width_source:i,height_source:j,width:e,height:f,core:l,cores:a,source:n[l].data.buffer};s.postMessage(t,[t.source])}},c=URL.createObjectURL(new Blob(["(",function(){onmessage=function(a){for(var b=a.data.core,c=a.data.cores,d=a.data.width_source,e=a.data.height_source,f=a.data.width,g=a.data.height,h=d/f,i=e/g,j=Math.ceil(h/2),k=Math.ceil(i/2),l=new Uint8ClampedArray(a.data.source),m=l.length/d/4,n=f*Math.ceil(g/c)*4,o=new ArrayBuffer(n),p=new Uint8ClampedArray(o,0,n),q=Math.ceil(e/c)*b,r=Math.ceil(g/c)*b,s=0;s<Math.ceil(g/c);s++)for(var t=0;t<f;t++){for(var u=4*(t+s*f),v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=(r+s+.5)*i-q,D=Math.floor(s*i),E=Math.ceil((r+s+1)*i-q),F=Math.floor(t*h),G=Math.ceil((t+1)*h),H=D;H<E;H++)if(!(H>=m||H<0))for(var I=Math.abs(C-(H+.5))/k,J=(t+.5)*h,K=I*I,L=F;L<G;L++){var M=Math.abs(J-(L+.5))/j,N=Math.sqrt(K+M*M);if(!(N>=1)){v=2*N*N*N-3*N*N+1;var O=4*(L+H*d);B+=v*l[O+3],x+=v,l[O+3]<255&&(v=v*l[O+3]/250),y+=v*l[O],z+=v*l[O+1],A+=v*l[O+2],w+=v}}p[u]=y/w,p[u+1]=z/w,p[u+2]=A/w,p[u+3]=B/x}var P={core:b,target:p};postMessage(P,[p.buffer])}}.toString(),")()"],{type:"application/javascript"})),this.resample_single=function(a,b,c,d){var e=a.width,f=a.height;b=Math.round(b),c=Math.round(c);for(var g=e/b,h=f/c,i=Math.ceil(g/2),j=Math.ceil(h/2),k=a.getContext("2d"),l=k.getImageData(0,0,e,f),m=k.createImageData(b,c),n=l.data,o=m.data,p=0;p<c;p++)for(var q=0;q<b;q++){for(var r=4*(q+p*b),s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=(p+.5)*h,A=Math.floor(p*h),B=Math.ceil((p+1)*h),C=A;C<B;C++)for(var D=Math.abs(z-(C+.5))/j,E=(q+.5)*g,F=D*D,G=Math.floor(q*g),H=Math.ceil((q+1)*g),I=G;I<H;I++){var J=Math.abs(E-(I+.5))/i,K=Math.sqrt(F+J*J);if(!(K>=1)){s=2*K*K*K-3*K*K+1;var L=4*(I+C*e);y+=s*n[L+3],u+=s,n[L+3]<255&&(s=s*n[L+3]/250),v+=s*n[L],w+=s*n[L+1],x+=s*n[L+2],t+=s}}o[r]=v/t,o[r+1]=w/t,o[r+2]=x/t,o[r+3]=y/u}d===!0?(a.width=b,a.height=c):k.clearRect(0,0,e,f),k.putImageData(m,0,0)}}